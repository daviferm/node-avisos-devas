(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{3630:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{c:()=>at,r:()=>Ue});const at=(Te,De)=>{Te.componentOnReady?Te.componentOnReady().then(dt=>De(dt)):Ue(()=>De(Te))},Ue=Te=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Te):"function"==typeof requestAnimationFrame?requestAnimationFrame(Te):setTimeout(Te)},191:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{L:()=>E,a:()=>he,b:()=>at,c:()=>Ie,d:()=>ge,g:()=>Te});const E="ionViewWillEnter",he="ionViewDidEnter",at="ionViewWillLeave",Ie="ionViewDidLeave",ge="ionViewWillUnload",Te=De=>De.classList.contains("ion-page")?De:De.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||De},4913:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{c:()=>Jt});var E=ae(1848),he=ae(512);let at;const ge=Ot=>Ot.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ve=Ot=>(void 0===at&&(at=void 0===Ot.style.animationName&&void 0!==Ot.style.webkitAnimationName?"-webkit-":""),at),Le=(Ot,Rt,Pt)=>{const hn=Rt.startsWith("animation")?Ve(Ot):"";Ot.style.setProperty(hn+Rt,Pt)},Be=(Ot,Rt)=>{const Pt=Rt.startsWith("animation")?Ve(Ot):"";Ot.style.removeProperty(Pt+Rt)},Ue=[],gt=(Ot=[],Rt)=>{if(void 0!==Rt){const Pt=Array.isArray(Rt)?Rt:[Rt];return[...Ot,...Pt]}return Ot},Jt=Ot=>{let Rt,Pt,hn,lt,me,st,mt,yt,Xe,tt,Ye,rr,Hn,Ft=[],Te=[],De=[],dt=!1,Gt={},en=[],on=[],Un={},nr=0,_n=!1,sn=!1,_t=!0,rn=!1,Gn=!0,mr=!1;const gr=Ot,ei=[],An=[],qe=[],ue=[],ye=[],Me=[],Bt=[],zt=[],nn=[],In=[],Xt=[],Zn="function"==typeof AnimationEffect||void 0!==E.w&&"function"==typeof E.w.AnimationEffect,cn="function"==typeof Element&&"function"==typeof Element.prototype.animate&&Zn,ir=()=>Xt,Lr=(q,ce)=>{const Pe=ce.findIndex(ct=>ct.c===q);Pe>-1&&ce.splice(Pe,1)},ri=(q,ce)=>((null!=ce&&ce.oneTimeCallback?An:ei).push({c:q,o:ce}),Hn),fr=()=>{if(cn)Xt.forEach(q=>{q.cancel()}),Xt.length=0;else{const q=ue.slice();(0,he.r)(()=>{q.forEach(ce=>{Be(ce,"animation-name"),Be(ce,"animation-duration"),Be(ce,"animation-timing-function"),Be(ce,"animation-iteration-count"),Be(ce,"animation-delay"),Be(ce,"animation-play-state"),Be(ce,"animation-fill-mode"),Be(ce,"animation-direction")})})}},io=()=>{Me.forEach(q=>{null!=q&&q.parentNode&&q.parentNode.removeChild(q)}),Me.length=0},Ke=()=>void 0!==me?me:mt?mt.getFill():"both",ot=()=>void 0!==Xe?Xe:void 0!==st?st:mt?mt.getDirection():"normal",rt=()=>_n?"linear":void 0!==hn?hn:mt?mt.getEasing():"linear",Nt=()=>sn?0:void 0!==tt?tt:void 0!==Pt?Pt:mt?mt.getDuration():0,qt=()=>void 0!==lt?lt:mt?mt.getIterations():1,Rn=()=>void 0!==Ye?Ye:void 0!==Rt?Rt:mt?mt.getDelay():0,fo=()=>{0!==nr&&(nr--,0===nr&&((()=>{Se(),nn.forEach($t=>$t()),In.forEach($t=>$t());const q=_t?1:0,ce=en,Pe=on,ct=Un;ue.forEach($t=>{const bt=$t.classList;ce.forEach(fn=>bt.add(fn)),Pe.forEach(fn=>bt.remove(fn));for(const fn in ct)ct.hasOwnProperty(fn)&&Le($t,fn,ct[fn])}),tt=void 0,Xe=void 0,Ye=void 0,ei.forEach($t=>$t.c(q,Hn)),An.forEach($t=>$t.c(q,Hn)),An.length=0,Gn=!0,_t&&(rn=!0),_t=!0})(),mt&&mt.animationFinish()))},us=(q=!0)=>{io();const ce=(Ot=>(Ot.forEach(Rt=>{for(const Pt in Rt)if(Rt.hasOwnProperty(Pt)){const hn=Rt[Pt];if("easing"===Pt)Rt["animation-timing-function"]=hn,delete Rt[Pt];else{const lt=ge(Pt);lt!==Pt&&(Rt[lt]=hn,delete Rt[Pt])}}}),Ot))(Ft);ue.forEach(Pe=>{if(ce.length>0){const ct=((Ot=[])=>Ot.map(Rt=>{const Pt=Rt.offset,hn=[];for(const lt in Rt)Rt.hasOwnProperty(lt)&&"offset"!==lt&&hn.push(`${lt}: ${Rt[lt]};`);return`${100*Pt}% { ${hn.join(" ")} }`}).join(" "))(ce);rr=void 0!==Ot?Ot:(Ot=>{let Rt=Ue.indexOf(Ot);return Rt<0&&(Rt=Ue.push(Ot)-1),`ion-animation-${Rt}`})(ct);const $t=((Ot,Rt,Pt)=>{var hn;const lt=(Ot=>{const Rt=void 0!==Ot.getRootNode?Ot.getRootNode():Ot;return Rt.head||Rt})(Pt),me=Ve(Pt),st=lt.querySelector("#"+Ot);if(st)return st;const Ft=(null!==(hn=Pt.ownerDocument)&&void 0!==hn?hn:document).createElement("style");return Ft.id=Ot,Ft.textContent=`@${me}keyframes ${Ot} { ${Rt} } @${me}keyframes ${Ot}-alt { ${Rt} }`,lt.appendChild(Ft),Ft})(rr,ct,Pe);Me.push($t),Le(Pe,"animation-duration",`${Nt()}ms`),Le(Pe,"animation-timing-function",rt()),Le(Pe,"animation-delay",`${Rn()}ms`),Le(Pe,"animation-fill-mode",Ke()),Le(Pe,"animation-direction",ot());const bt=qt()===1/0?"infinite":qt().toString();Le(Pe,"animation-iteration-count",bt),Le(Pe,"animation-play-state","paused"),q&&Le(Pe,"animation-name",`${$t.id}-alt`),(0,he.r)(()=>{Le(Pe,"animation-name",$t.id||null)})}})},ns=(q=!0)=>{(()=>{Bt.forEach(ct=>ct()),zt.forEach(ct=>ct());const q=Te,ce=De,Pe=Gt;ue.forEach(ct=>{const $t=ct.classList;q.forEach(bt=>$t.add(bt)),ce.forEach(bt=>$t.remove(bt));for(const bt in Pe)Pe.hasOwnProperty(bt)&&Le(ct,bt,Pe[bt])})})(),Ft.length>0&&(cn?(ue.forEach(q=>{const ce=q.animate(Ft,{id:gr,delay:Rn(),duration:Nt(),easing:rt(),iterations:qt(),fill:Ke(),direction:ot()});ce.pause(),Xt.push(ce)}),Xt.length>0&&(Xt[0].onfinish=()=>{fo()})):us(q)),dt=!0},po=q=>{if(q=Math.min(Math.max(q,0),.9999),cn)Xt.forEach(ce=>{ce.currentTime=ce.effect.getComputedTiming().delay+Nt()*q,ce.pause()});else{const ce=`-${Nt()*q}ms`;ue.forEach(Pe=>{Ft.length>0&&(Le(Pe,"animation-delay",ce),Le(Pe,"animation-play-state","paused"))})}},ti=q=>{Xt.forEach(ce=>{ce.effect.updateTiming({delay:Rn(),duration:Nt(),easing:rt(),iterations:qt(),fill:Ke(),direction:ot()})}),void 0!==q&&po(q)},ds=(q=!0,ce)=>{(0,he.r)(()=>{ue.forEach(Pe=>{Le(Pe,"animation-name",rr||null),Le(Pe,"animation-duration",`${Nt()}ms`),Le(Pe,"animation-timing-function",rt()),Le(Pe,"animation-delay",void 0!==ce?`-${ce*Nt()}ms`:`${Rn()}ms`),Le(Pe,"animation-fill-mode",Ke()||null),Le(Pe,"animation-direction",ot()||null);const ct=qt()===1/0?"infinite":qt().toString();Le(Pe,"animation-iteration-count",ct),q&&Le(Pe,"animation-name",`${rr}-alt`),(0,he.r)(()=>{Le(Pe,"animation-name",rr||null)})})})},Qi=(q=!1,ce=!0,Pe)=>(q&&ye.forEach(ct=>{ct.update(q,ce,Pe)}),cn?ti(Pe):ds(ce,Pe),Hn),Br=()=>{dt&&(cn?Xt.forEach(q=>{q.pause()}):ue.forEach(q=>{Le(q,"animation-play-state","paused")}),mr=!0)},Vs=()=>{yt=void 0,fo()},Se=()=>{yt&&clearTimeout(yt)},Z=q=>new Promise(ce=>{null!=q&&q.sync&&(sn=!0,ri(()=>sn=!1,{oneTimeCallback:!0})),dt||ns(),rn&&(cn?(po(0),ti()):ds(),rn=!1),Gn&&(nr=ye.length+1,Gn=!1);const Pe=()=>{Lr(ct,An),ce()},ct=()=>{Lr(Pe,qe),ce()};ri(ct,{oneTimeCallback:!0}),((q,ce)=>{qe.push({c:q,o:{oneTimeCallback:!0}})})(Pe),ye.forEach($t=>{$t.play()}),cn?(Xt.forEach(q=>{q.play()}),(0===Ft.length||0===ue.length)&&fo()):(()=>{if(Se(),(0,he.r)(()=>{ue.forEach(q=>{Ft.length>0&&Le(q,"animation-play-state","running")})}),0===Ft.length||0===ue.length)fo();else{const q=Rn()||0,ce=Nt()||0,Pe=qt()||1;isFinite(Pe)&&(yt=setTimeout(Vs,q+ce*Pe+100)),((Ot,Rt)=>{let Pt;const hn={passive:!0},me=st=>{Ot===st.target&&(Pt&&Pt(),Se(),(0,he.r)(()=>{ue.forEach(q=>{Be(q,"animation-duration"),Be(q,"animation-delay"),Be(q,"animation-play-state")}),(0,he.r)(fo)}))};Ot&&(Ot.addEventListener("webkitAnimationEnd",me,hn),Ot.addEventListener("animationend",me,hn),Pt=()=>{Ot.removeEventListener("webkitAnimationEnd",me,hn),Ot.removeEventListener("animationend",me,hn)})})(ue[0])}})(),mr=!1}),We=(q,ce)=>{const Pe=Ft[0];return void 0===Pe||void 0!==Pe.offset&&0!==Pe.offset?Ft=[{offset:0,[q]:ce},...Ft]:Pe[q]=ce,Hn};return Hn={parentAnimation:mt,elements:ue,childAnimations:ye,id:gr,animationFinish:fo,from:We,to:(q,ce)=>{const Pe=Ft[Ft.length-1];return void 0===Pe||void 0!==Pe.offset&&1!==Pe.offset?Ft=[...Ft,{offset:1,[q]:ce}]:Pe[q]=ce,Hn},fromTo:(q,ce,Pe)=>We(q,ce).to(q,Pe),parent:q=>(mt=q,Hn),play:Z,pause:()=>(ye.forEach(q=>{q.pause()}),Br(),Hn),stop:()=>{ye.forEach(q=>{q.stop()}),dt&&(fr(),dt=!1),_n=!1,sn=!1,Gn=!0,Xe=void 0,tt=void 0,Ye=void 0,nr=0,rn=!1,_t=!0,mr=!1,qe.forEach(q=>q.c(0,Hn)),qe.length=0},destroy:q=>(ye.forEach(ce=>{ce.destroy(q)}),(q=>{fr(),q&&io()})(q),ue.length=0,ye.length=0,Ft.length=0,ei.length=0,An.length=0,dt=!1,Gn=!0,Hn),keyframes:q=>{const ce=Ft!==q;return Ft=q,ce&&(q=>{cn?ir().forEach(ce=>{const Pe=ce.effect;if(Pe.setKeyframes)Pe.setKeyframes(q);else{const ct=new KeyframeEffect(Pe.target,q,Pe.getTiming());ce.effect=ct}}):us()})(Ft),Hn},addAnimation:q=>{if(null!=q)if(Array.isArray(q))for(const ce of q)ce.parent(Hn),ye.push(ce);else q.parent(Hn),ye.push(q);return Hn},addElement:q=>{if(null!=q)if(1===q.nodeType)ue.push(q);else if(q.length>=0)for(let ce=0;ce<q.length;ce++)ue.push(q[ce]);else console.error("Invalid addElement value");return Hn},update:Qi,fill:q=>(me=q,Qi(!0),Hn),direction:q=>(st=q,Qi(!0),Hn),iterations:q=>(lt=q,Qi(!0),Hn),duration:q=>(!cn&&0===q&&(q=1),Pt=q,Qi(!0),Hn),easing:q=>(hn=q,Qi(!0),Hn),delay:q=>(Rt=q,Qi(!0),Hn),getWebAnimations:ir,getKeyframes:()=>Ft,getFill:Ke,getDirection:ot,getDelay:Rn,getIterations:qt,getEasing:rt,getDuration:Nt,afterAddRead:q=>(nn.push(q),Hn),afterAddWrite:q=>(In.push(q),Hn),afterClearStyles:(q=[])=>{for(const ce of q)Un[ce]="";return Hn},afterStyles:(q={})=>(Un=q,Hn),afterRemoveClass:q=>(on=gt(on,q),Hn),afterAddClass:q=>(en=gt(en,q),Hn),beforeAddRead:q=>(Bt.push(q),Hn),beforeAddWrite:q=>(zt.push(q),Hn),beforeClearStyles:(q=[])=>{for(const ce of q)Gt[ce]="";return Hn},beforeStyles:(q={})=>(Gt=q,Hn),beforeRemoveClass:q=>(De=gt(De,q),Hn),beforeAddClass:q=>(Te=gt(Te,q),Hn),onFinish:ri,isRunning:()=>0!==nr&&!mr,progressStart:(q=!1,ce)=>(ye.forEach(Pe=>{Pe.progressStart(q,ce)}),Br(),_n=q,dt||ns(),Qi(!1,!0,ce),Hn),progressStep:q=>(ye.forEach(ce=>{ce.progressStep(q)}),po(q),Hn),progressEnd:(q,ce,Pe)=>(_n=!1,ye.forEach(ct=>{ct.progressEnd(q,ce,Pe)}),void 0!==Pe&&(tt=Pe),rn=!1,_t=!0,0===q?(Xe="reverse"===ot()?"normal":"reverse","reverse"===Xe&&(_t=!1),cn?(Qi(),po(1-ce)):(Ye=(1-ce)*Nt()*-1,Qi(!1,!1))):1===q&&(cn?(Qi(),po(ce)):(Ye=ce*Nt()*-1,Qi(!1,!1))),void 0!==q&&!mt&&Z(),Hn)}}},8958:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{E:()=>wt,a:()=>E,s:()=>Be});const E=Ue=>{try{if(Ue instanceof Le)return Ue.value;if(!Ie()||"string"!=typeof Ue||""===Ue)return Ue;if(Ue.includes("onload="))return"";const vt=document.createDocumentFragment(),Mt=document.createElement("div");vt.appendChild(Mt),Mt.innerHTML=Ue,Ve.forEach(Ot=>{const Rt=vt.querySelectorAll(Ot);for(let Pt=Rt.length-1;Pt>=0;Pt--){const hn=Rt[Pt];hn.parentNode?hn.parentNode.removeChild(hn):vt.removeChild(hn);const lt=at(hn);for(let me=0;me<lt.length;me++)he(lt[me])}});const xt=at(vt);for(let Ot=0;Ot<xt.length;Ot++)he(xt[Ot]);const gt=document.createElement("div");gt.appendChild(vt);const Jt=gt.querySelector("div");return null!==Jt?Jt.innerHTML:gt.innerHTML}catch(vt){return console.error(vt),""}},he=Ue=>{if(Ue.nodeType&&1!==Ue.nodeType)return;if(typeof NamedNodeMap<"u"&&!(Ue.attributes instanceof NamedNodeMap))return void Ue.remove();for(let Mt=Ue.attributes.length-1;Mt>=0;Mt--){const xt=Ue.attributes.item(Mt),gt=xt.name;if(!ge.includes(gt.toLowerCase())){Ue.removeAttribute(gt);continue}const Jt=xt.value,Ot=Ue[gt];(null!=Jt&&Jt.toLowerCase().includes("javascript:")||null!=Ot&&Ot.toLowerCase().includes("javascript:"))&&Ue.removeAttribute(gt)}const vt=at(Ue);for(let Mt=0;Mt<vt.length;Mt++)he(vt[Mt])},at=Ue=>null!=Ue.children?Ue.children:Ue.childNodes,Ie=()=>{var Ue;const vt=window,Mt=null===(Ue=null==vt?void 0:vt.Ionic)||void 0===Ue?void 0:Ue.config;return!Mt||(Mt.get?Mt.get("sanitizerEnabled",!0):!0===Mt.sanitizerEnabled||void 0===Mt.sanitizerEnabled)},ge=["class","id","href","src","name","slot"],Ve=["script","style","iframe","meta","link","object","embed"];class Le{constructor(vt){this.value=vt}}const Be=Ue=>{const vt=window,Mt=vt.Ionic;if(!Mt||!Mt.config||"Object"===Mt.config.constructor.name)return vt.Ionic=vt.Ionic||{},vt.Ionic.config=Object.assign(Object.assign({},vt.Ionic.config),Ue),vt.Ionic.config},wt=!1},4510:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{g:()=>E});const E=(Ve,Le,Be,ze,wt)=>at(Ve[1],Le[1],Be[1],ze[1],wt).map(Ue=>he(Ve[0],Le[0],Be[0],ze[0],Ue)),he=(Ve,Le,Be,ze,wt)=>wt*(3*Le*Math.pow(wt-1,2)+wt*(-3*Be*wt+3*Be+ze*wt))-Ve*Math.pow(wt-1,3),at=(Ve,Le,Be,ze,wt)=>ge((ze-=wt)-3*(Be-=wt)+3*(Le-=wt)-(Ve-=wt),3*Be-6*Le+3*Ve,3*Le-3*Ve,Ve).filter(vt=>vt>=0&&vt<=1),ge=(Ve,Le,Be,ze)=>{if(0===Ve)return((Ve,Le,Be)=>{const ze=Le*Le-4*Ve*Be;return ze<0?[]:[(-Le+Math.sqrt(ze))/(2*Ve),(-Le-Math.sqrt(ze))/(2*Ve)]})(Le,Be,ze);const wt=(3*(Be/=Ve)-(Le/=Ve)*Le)/3,Ue=(2*Le*Le*Le-9*Le*Be+27*(ze/=Ve))/27;if(0===wt)return[Math.pow(-Ue,1/3)];if(0===Ue)return[Math.sqrt(-wt),-Math.sqrt(-wt)];const vt=Math.pow(Ue/2,2)+Math.pow(wt/3,3);if(0===vt)return[Math.pow(Ue/2,.5)-Le/3];if(vt>0)return[Math.pow(-Ue/2+Math.sqrt(vt),1/3)-Math.pow(Ue/2+Math.sqrt(vt),1/3)-Le/3];const Mt=Math.sqrt(Math.pow(-wt/3,3)),xt=Math.acos(-Ue/(2*Math.sqrt(Math.pow(-wt/3,3)))),gt=2*Math.pow(Mt,1/3);return[gt*Math.cos(xt/3)-Le/3,gt*Math.cos((xt+2*Math.PI)/3)-Le/3,gt*Math.cos((xt+4*Math.PI)/3)-Le/3]}},3254:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{C:()=>ge,a:()=>at,d:()=>Ie});var E=ae(5861),he=ae(512);const at=function(){var Ve=(0,E.Z)(function*(Le,Be,ze,wt,Ue,vt){var Mt;if(Le)return Le.attachViewToDom(Be,ze,Ue,wt);if(!(vt||"string"==typeof ze||ze instanceof HTMLElement))throw new Error("framework delegate is missing");const xt="string"==typeof ze?null===(Mt=Be.ownerDocument)||void 0===Mt?void 0:Mt.createElement(ze):ze;return wt&&wt.forEach(gt=>xt.classList.add(gt)),Ue&&Object.assign(xt,Ue),Be.appendChild(xt),yield new Promise(gt=>(0,he.c)(xt,gt)),xt});return function(Be,ze,wt,Ue,vt,Mt){return Ve.apply(this,arguments)}}(),Ie=(Ve,Le)=>{if(Le){if(Ve)return Ve.removeViewFromDom(Le.parentElement,Le);Le.remove()}return Promise.resolve()},ge=()=>{let Ve,Le;return{attachViewToDom:function(){var wt=(0,E.Z)(function*(Ue,vt,Mt={},xt=[]){var gt,Jt;let Ot;if(Ve=Ue,vt){const Pt="string"==typeof vt?null===(gt=Ve.ownerDocument)||void 0===gt?void 0:gt.createElement(vt):vt;xt.forEach(hn=>Pt.classList.add(hn)),Object.assign(Pt,Mt),Ve.appendChild(Pt),Ot=Pt,yield new Promise(hn=>(0,he.c)(Pt,hn))}else if(Ve.children.length>0&&("ION-MODAL"===Ve.tagName||"ION-POPOVER"===Ve.tagName)&&!(Ot=Ve.children[0]).classList.contains("ion-delegate-host")){const hn=null===(Jt=Ve.ownerDocument)||void 0===Jt?void 0:Jt.createElement("div");hn.classList.add("ion-delegate-host"),xt.forEach(lt=>hn.classList.add(lt)),hn.append(...Ve.children),Ve.appendChild(hn),Ot=hn}const Rt=document.querySelector("ion-app")||document.body;return Le=document.createComment("ionic teleport"),Ve.parentNode.insertBefore(Le,Ve),Rt.appendChild(Ve),null!=Ot?Ot:Ve});return function(vt,Mt){return wt.apply(this,arguments)}}(),removeViewFromDom:()=>(Ve&&Le&&(Le.parentNode.insertBefore(Ve,Le),Le.remove()),Promise.resolve())}}},2019:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{G:()=>ge});class he{constructor(Le,Be,ze,wt,Ue){this.id=Be,this.name=ze,this.disableScroll=Ue,this.priority=1e6*wt+Be,this.ctrl=Le}canStart(){return!!this.ctrl&&this.ctrl.canStart(this.name)}start(){return!!this.ctrl&&this.ctrl.start(this.name,this.id,this.priority)}capture(){if(!this.ctrl)return!1;const Le=this.ctrl.capture(this.name,this.id,this.priority);return Le&&this.disableScroll&&this.ctrl.disableScroll(this.id),Le}release(){this.ctrl&&(this.ctrl.release(this.id),this.disableScroll&&this.ctrl.enableScroll(this.id))}destroy(){this.release(),this.ctrl=void 0}}class at{constructor(Le,Be,ze,wt){this.id=Be,this.disable=ze,this.disableScroll=wt,this.ctrl=Le}block(){if(this.ctrl){if(this.disable)for(const Le of this.disable)this.ctrl.disableGesture(Le,this.id);this.disableScroll&&this.ctrl.disableScroll(this.id)}}unblock(){if(this.ctrl){if(this.disable)for(const Le of this.disable)this.ctrl.enableGesture(Le,this.id);this.disableScroll&&this.ctrl.enableScroll(this.id)}}destroy(){this.unblock(),this.ctrl=void 0}}const Ie="backdrop-no-scroll",ge=new class E{constructor(){this.gestureId=0,this.requestedStart=new Map,this.disabledGestures=new Map,this.disabledScroll=new Set}createGesture(Le){var Be;return new he(this,this.newID(),Le.name,null!==(Be=Le.priority)&&void 0!==Be?Be:0,!!Le.disableScroll)}createBlocker(Le={}){return new at(this,this.newID(),Le.disable,!!Le.disableScroll)}start(Le,Be,ze){return this.canStart(Le)?(this.requestedStart.set(Be,ze),!0):(this.requestedStart.delete(Be),!1)}capture(Le,Be,ze){if(!this.start(Le,Be,ze))return!1;const wt=this.requestedStart;let Ue=-1e4;if(wt.forEach(vt=>{Ue=Math.max(Ue,vt)}),Ue===ze){this.capturedId=Be,wt.clear();const vt=new CustomEvent("ionGestureCaptured",{detail:{gestureName:Le}});return document.dispatchEvent(vt),!0}return wt.delete(Be),!1}release(Le){this.requestedStart.delete(Le),this.capturedId===Le&&(this.capturedId=void 0)}disableGesture(Le,Be){let ze=this.disabledGestures.get(Le);void 0===ze&&(ze=new Set,this.disabledGestures.set(Le,ze)),ze.add(Be)}enableGesture(Le,Be){const ze=this.disabledGestures.get(Le);void 0!==ze&&ze.delete(Be)}disableScroll(Le){this.disabledScroll.add(Le),1===this.disabledScroll.size&&document.body.classList.add(Ie)}enableScroll(Le){this.disabledScroll.delete(Le),0===this.disabledScroll.size&&document.body.classList.remove(Ie)}canStart(Le){return!(void 0!==this.capturedId||this.isDisabled(Le))}isCaptured(){return void 0!==this.capturedId}isScrollDisabled(){return this.disabledScroll.size>0}isDisabled(Le){const Be=this.disabledGestures.get(Le);return!!(Be&&Be.size>0)}newID(){return this.gestureId++,this.gestureId}}},4393:(ur,Kt,ae)=>{"use strict";ae.r(Kt),ae.d(Kt,{MENU_BACK_BUTTON_PRIORITY:()=>ge,OVERLAY_BACK_BUTTON_PRIORITY:()=>Ie,blockHardwareBackButton:()=>he,startHardwareBackButton:()=>at});var E=ae(5861);const he=()=>{document.addEventListener("backbutton",()=>{})},at=()=>{const Ve=document;let Le=!1;Ve.addEventListener("backbutton",()=>{if(Le)return;let Be=0,ze=[];const wt=new CustomEvent("ionBackButton",{bubbles:!1,detail:{register(Mt,xt){ze.push({priority:Mt,handler:xt,id:Be++})}}});Ve.dispatchEvent(wt);const Ue=function(){var Mt=(0,E.Z)(function*(xt){try{if(null!=xt&&xt.handler){const gt=xt.handler(vt);null!=gt&&(yield gt)}}catch(gt){console.error(gt)}});return function(gt){return Mt.apply(this,arguments)}}(),vt=()=>{if(ze.length>0){let Mt={priority:Number.MIN_SAFE_INTEGER,handler:()=>{},id:-1};ze.forEach(xt=>{xt.priority>=Mt.priority&&(Mt=xt)}),Le=!0,ze=ze.filter(xt=>xt.id!==Mt.id),Ue(Mt).then(()=>Le=!1)}};vt()})},Ie=100,ge=99},512:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{a:()=>Be,b:()=>ze,c:()=>at,d:()=>Jt,e:()=>gt,f:()=>xt,g:()=>wt,h:()=>Mt,i:()=>Le,j:()=>me,k:()=>ge,l:()=>Ot,m:()=>Ie,n:()=>vt,o:()=>Rt,p:()=>lt,q:()=>st,r:()=>Ue,s:()=>Ft,t:()=>E,u:()=>Pt,v:()=>hn});const E=(Te,De=0)=>new Promise(dt=>{he(Te,De,dt)}),he=(Te,De=0,dt)=>{let mt,Gt;const en={passive:!0},Un=()=>{mt&&mt()},nr=_n=>{(void 0===_n||Te===_n.target)&&(Un(),dt(_n))};return Te&&(Te.addEventListener("webkitTransitionEnd",nr,en),Te.addEventListener("transitionend",nr,en),Gt=setTimeout(nr,De+500),mt=()=>{Gt&&(clearTimeout(Gt),Gt=void 0),Te.removeEventListener("webkitTransitionEnd",nr,en),Te.removeEventListener("transitionend",nr,en)}),Un},at=(Te,De)=>{Te.componentOnReady?Te.componentOnReady().then(dt=>De(dt)):Ue(()=>De(Te))},Ie=Te=>void 0!==Te.componentOnReady,ge=(Te,De=[])=>{const dt={};return De.forEach(mt=>{Te.hasAttribute(mt)&&(null!==Te.getAttribute(mt)&&(dt[mt]=Te.getAttribute(mt)),Te.removeAttribute(mt))}),dt},Ve=["role","aria-activedescendant","aria-atomic","aria-autocomplete","aria-braillelabel","aria-brailleroledescription","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colindextext","aria-colspan","aria-controls","aria-current","aria-describedby","aria-description","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowindextext","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext"],Le=(Te,De)=>{let dt=Ve;return De&&De.length>0&&(dt=dt.filter(mt=>!De.includes(mt))),ge(Te,dt)},Be=(Te,De,dt,mt)=>{var Gt;if(typeof window<"u"){const en=window,on=null===(Gt=null==en?void 0:en.Ionic)||void 0===Gt?void 0:Gt.config;if(on){const Un=on.get("_ael");if(Un)return Un(Te,De,dt,mt);if(on._ael)return on._ael(Te,De,dt,mt)}}return Te.addEventListener(De,dt,mt)},ze=(Te,De,dt,mt)=>{var Gt;if(typeof window<"u"){const en=window,on=null===(Gt=null==en?void 0:en.Ionic)||void 0===Gt?void 0:Gt.config;if(on){const Un=on.get("_rel");if(Un)return Un(Te,De,dt,mt);if(on._rel)return on._rel(Te,De,dt,mt)}}return Te.removeEventListener(De,dt,mt)},wt=(Te,De=Te)=>Te.shadowRoot||De,Ue=Te=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(Te):"function"==typeof requestAnimationFrame?requestAnimationFrame(Te):setTimeout(Te),vt=Te=>!!Te.shadowRoot&&!!Te.attachShadow,Mt=Te=>{const De=Te.closest("ion-item");return De?De.querySelector("ion-label"):null},xt=Te=>{if(Te.focus(),Te.classList.contains("ion-focusable")){const De=Te.closest("ion-app");De&&De.setFocus([Te])}},gt=(Te,De)=>{let dt;const mt=Te.getAttribute("aria-labelledby"),Gt=Te.id;let en=null!==mt&&""!==mt.trim()?mt:De+"-lbl",on=null!==mt&&""!==mt.trim()?document.getElementById(mt):Mt(Te);return on?(null===mt&&(on.id=en),dt=on.textContent,on.setAttribute("aria-hidden","true")):""!==Gt.trim()&&(on=document.querySelector(`label[for="${Gt}"]`),on&&(""!==on.id?en=on.id:on.id=en=`${Gt}-lbl`,dt=on.textContent)),{label:on,labelId:en,labelText:dt}},Jt=(Te,De,dt,mt,Gt)=>{if(Te||vt(De)){let en=De.querySelector("input.aux-input");en||(en=De.ownerDocument.createElement("input"),en.type="hidden",en.classList.add("aux-input"),De.appendChild(en)),en.disabled=Gt,en.name=dt,en.value=mt||""}},Ot=(Te,De,dt)=>Math.max(Te,Math.min(De,dt)),Rt=(Te,De)=>{if(!Te){const dt="ASSERT: "+De;throw console.error(dt),new Error(dt)}},Pt=Te=>Te.timeStamp||Date.now(),hn=Te=>{if(Te){const De=Te.changedTouches;if(De&&De.length>0){const dt=De[0];return{x:dt.clientX,y:dt.clientY}}if(void 0!==Te.pageX)return{x:Te.pageX,y:Te.pageY}}return{x:0,y:0}},lt=Te=>{const De="rtl"===document.dir;switch(Te){case"start":return De;case"end":return!De;default:throw new Error(`"${Te}" is not a valid value for [side]. Use "start" or "end" instead.`)}},me=(Te,De)=>{const dt=Te._original||Te;return{_original:Te,emit:st(dt.emit.bind(dt),De)}},st=(Te,De=0)=>{let dt;return(...mt)=>{clearTimeout(dt),dt=setTimeout(Te,De,...mt)}},Ft=(Te,De)=>{if(null!=Te||(Te={}),null!=De||(De={}),Te===De)return!0;const dt=Object.keys(Te);if(dt.length!==Object.keys(De).length)return!1;for(const mt of dt)if(!(mt in De)||Te[mt]!==De[mt])return!1;return!0}},5613:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{m:()=>Mt});var E=ae(5861),he=ae(1848),at=ae(4393),Ie=ae(2400),ge=ae(512),Ve=ae(2905),Le=ae(4913);const Be=xt=>(0,Le.c)().duration(xt?400:300),ze=xt=>{let gt,Jt;const Ot=xt.width+8,Rt=(0,Le.c)(),Pt=(0,Le.c)();xt.isEndSide?(gt=Ot+"px",Jt="0px"):(gt=-Ot+"px",Jt="0px"),Rt.addElement(xt.menuInnerEl).fromTo("transform",`translateX(${gt})`,`translateX(${Jt})`);const lt="ios"===(0,Ve.b)(xt),me=lt?.2:.25;return Pt.addElement(xt.backdropEl).fromTo("opacity",.01,me),Be(lt).addAnimation([Rt,Pt])},wt=xt=>{let gt,Jt;const Ot=(0,Ve.b)(xt),Rt=xt.width;xt.isEndSide?(gt=-Rt+"px",Jt=Rt+"px"):(gt=Rt+"px",Jt=-Rt+"px");const Pt=(0,Le.c)().addElement(xt.menuInnerEl).fromTo("transform",`translateX(${Jt})`,"translateX(0px)"),hn=(0,Le.c)().addElement(xt.contentEl).fromTo("transform","translateX(0px)",`translateX(${gt})`),lt=(0,Le.c)().addElement(xt.backdropEl).fromTo("opacity",.01,.32);return Be("ios"===Ot).addAnimation([Pt,hn,lt])},Ue=xt=>{const gt=(0,Ve.b)(xt),Jt=xt.width*(xt.isEndSide?-1:1)+"px",Ot=(0,Le.c)().addElement(xt.contentEl).fromTo("transform","translateX(0px)",`translateX(${Jt})`);return Be("ios"===gt).addAnimation(Ot)},Mt=(()=>{const xt=new Map,gt=[],Jt=function(){var Xe=(0,E.Z)(function*(tt){const Ye=yield st(tt,!0);return!!Ye&&Ye.open()});return function(Ye){return Xe.apply(this,arguments)}}(),Ot=function(){var Xe=(0,E.Z)(function*(tt){const Ye=yield void 0!==tt?st(tt,!0):Ft();return void 0!==Ye&&Ye.close()});return function(Ye){return Xe.apply(this,arguments)}}(),Rt=function(){var Xe=(0,E.Z)(function*(tt){const Ye=yield st(tt,!0);return!!Ye&&Ye.toggle()});return function(Ye){return Xe.apply(this,arguments)}}(),Pt=function(){var Xe=(0,E.Z)(function*(tt,Ye){const _t=yield st(Ye);return _t&&(_t.disabled=!tt),_t});return function(Ye,_t){return Xe.apply(this,arguments)}}(),hn=function(){var Xe=(0,E.Z)(function*(tt,Ye){const _t=yield st(Ye);return _t&&(_t.swipeGesture=tt),_t});return function(Ye,_t){return Xe.apply(this,arguments)}}(),lt=function(){var Xe=(0,E.Z)(function*(tt){if(null!=tt){const Ye=yield st(tt);return void 0!==Ye&&Ye.isOpen()}return void 0!==(yield Ft())});return function(Ye){return Xe.apply(this,arguments)}}(),me=function(){var Xe=(0,E.Z)(function*(tt){const Ye=yield st(tt);return!!Ye&&!Ye.disabled});return function(Ye){return Xe.apply(this,arguments)}}(),st=function(){var Xe=(0,E.Z)(function*(tt,Ye=!1){if(yield yt(),"start"===tt||"end"===tt){const rn=gt.filter(rr=>rr.side===tt&&!rr.disabled);if(rn.length>=1)return rn.length>1&&Ye&&(0,Ie.p)(`menuController queried for a menu on the "${tt}" side, but ${rn.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,rn.map(rr=>rr.el)),rn[0].el;const Gn=gt.filter(rr=>rr.side===tt);if(Gn.length>=1)return Gn.length>1&&Ye&&(0,Ie.p)(`menuController queried for a menu on the "${tt}" side, but ${Gn.length} menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side.`,Gn.map(rr=>rr.el)),Gn[0].el}else if(null!=tt)return sn(rn=>rn.menuId===tt);return sn(rn=>!rn.disabled)||(gt.length>0?gt[0].el:void 0)});return function(Ye){return Xe.apply(this,arguments)}}(),Ft=function(){var Xe=(0,E.Z)(function*(){return yield yt(),Un()});return function(){return Xe.apply(this,arguments)}}(),Te=function(){var Xe=(0,E.Z)(function*(){return yield yt(),nr()});return function(){return Xe.apply(this,arguments)}}(),De=function(){var Xe=(0,E.Z)(function*(){return yield yt(),_n()});return function(){return Xe.apply(this,arguments)}}(),dt=(Xe,tt)=>{xt.set(Xe,tt)},en=function(){var Xe=(0,E.Z)(function*(tt,Ye,_t){if(_n())return!1;if(Ye){const rn=yield Ft();rn&&tt.el!==rn&&(yield rn.setOpen(!1,!1))}return tt._setOpen(Ye,_t)});return function(Ye,_t,rn){return Xe.apply(this,arguments)}}(),Un=()=>sn(Xe=>Xe._isOpen),nr=()=>gt.map(Xe=>Xe.el),_n=()=>gt.some(Xe=>Xe.isAnimating),sn=Xe=>{const tt=gt.find(Xe);if(void 0!==tt)return tt.el},yt=()=>Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(Xe=>new Promise(tt=>(0,ge.c)(Xe,tt))));return dt("reveal",Ue),dt("push",wt),dt("overlay",ze),null==he.d||he.d.addEventListener("ionBackButton",Xe=>{const tt=Un();tt&&Xe.detail.register(at.MENU_BACK_BUTTON_PRIORITY,()=>tt.close())}),{registerAnimation:dt,get:st,getMenus:Te,getOpen:Ft,isEnabled:me,swipeGesture:hn,isAnimating:De,isOpen:lt,enable:Pt,toggle:Rt,close:Ot,open:Jt,_getOpenSync:Un,_createAnimation:(Xe,tt)=>{const Ye=xt.get(Xe);if(!Ye)throw new Error("animation not registered");return Ye(tt)},_register:Xe=>{gt.indexOf(Xe)<0&&gt.push(Xe)},_unregister:Xe=>{const tt=gt.indexOf(Xe);tt>-1&&gt.splice(tt,1)},_setOpen:en}})()},6535:(ur,Kt,ae)=>{"use strict";ae.r(Kt),ae.d(Kt,{GESTURE_CONTROLLER:()=>E.G,createGesture:()=>ze});var E=ae(2019);const he=(Mt,xt,gt,Jt)=>{const Ot=at(Mt)?{capture:!!Jt.capture,passive:!!Jt.passive}:!!Jt.capture;let Rt,Pt;return Mt.__zone_symbol__addEventListener?(Rt="__zone_symbol__addEventListener",Pt="__zone_symbol__removeEventListener"):(Rt="addEventListener",Pt="removeEventListener"),Mt[Rt](xt,gt,Ot),()=>{Mt[Pt](xt,gt,Ot)}},at=Mt=>{if(void 0===Ie)try{const xt=Object.defineProperty({},"passive",{get:()=>{Ie=!0}});Mt.addEventListener("optsTest",()=>{},xt)}catch{Ie=!1}return!!Ie};let Ie;const Le=Mt=>Mt instanceof Document?Mt:Mt.ownerDocument,ze=Mt=>{let xt=!1,gt=!1,Jt=!0,Ot=!1;const Rt=Object.assign({disableScroll:!1,direction:"x",gesturePriority:0,passive:!0,maxAngle:40,threshold:10},Mt),Pt=Rt.canStart,hn=Rt.onWillStart,lt=Rt.onStart,me=Rt.onEnd,st=Rt.notCaptured,Ft=Rt.onMove,Te=Rt.threshold,De=Rt.passive,dt=Rt.blurOnStart,mt={type:"pan",startX:0,startY:0,startTime:0,currentX:0,currentY:0,velocityX:0,velocityY:0,deltaX:0,deltaY:0,currentTime:0,event:void 0,data:void 0},Gt=((Mt,xt,gt)=>{const Jt=gt*(Math.PI/180),Ot="x"===Mt,Rt=Math.cos(Jt),Pt=xt*xt;let hn=0,lt=0,me=!1,st=0;return{start(Ft,Te){hn=Ft,lt=Te,st=0,me=!0},detect(Ft,Te){if(!me)return!1;const De=Ft-hn,dt=Te-lt,mt=De*De+dt*dt;if(mt<Pt)return!1;const Gt=Math.sqrt(mt),en=(Ot?De:dt)/Gt;return st=en>Rt?1:en<-Rt?-1:0,me=!1,!0},isGesture:()=>0!==st,getDirection:()=>st}})(Rt.direction,Rt.threshold,Rt.maxAngle),en=E.G.createGesture({name:Mt.gestureName,priority:Mt.gesturePriority,disableScroll:Mt.disableScroll}),nr=()=>{xt&&(Ot=!1,Ft&&Ft(mt))},_n=()=>!!en.capture()&&(xt=!0,Jt=!1,mt.startX=mt.currentX,mt.startY=mt.currentY,mt.startTime=mt.currentTime,hn?hn(mt).then(yt):yt(),!0),yt=()=>{dt&&(()=>{if(typeof document<"u"){const rn=document.activeElement;null!=rn&&rn.blur&&rn.blur()}})(),lt&&lt(mt),Jt=!0},Xe=()=>{xt=!1,gt=!1,Ot=!1,Jt=!0,en.release()},tt=rn=>{const Gn=xt,rr=Jt;if(Xe(),rr){if(wt(mt,rn),Gn)return void(me&&me(mt));st&&st(mt)}},Ye=((Mt,xt,gt,Jt,Ot)=>{let Rt,Pt,hn,lt,me,st,Ft,Te=0;const De=sn=>{Te=Date.now()+2e3,xt(sn)&&(!Pt&&gt&&(Pt=he(Mt,"touchmove",gt,Ot)),hn||(hn=he(sn.target,"touchend",mt,Ot)),lt||(lt=he(sn.target,"touchcancel",mt,Ot)))},dt=sn=>{Te>Date.now()||xt(sn)&&(!st&&gt&&(st=he(Le(Mt),"mousemove",gt,Ot)),Ft||(Ft=he(Le(Mt),"mouseup",Gt,Ot)))},mt=sn=>{en(),Jt&&Jt(sn)},Gt=sn=>{on(),Jt&&Jt(sn)},en=()=>{Pt&&Pt(),hn&&hn(),lt&&lt(),Pt=hn=lt=void 0},on=()=>{st&&st(),Ft&&Ft(),st=Ft=void 0},Un=()=>{en(),on()},nr=(sn=!0)=>{sn?(Rt||(Rt=he(Mt,"touchstart",De,Ot)),me||(me=he(Mt,"mousedown",dt,Ot))):(Rt&&Rt(),me&&me(),Rt=me=void 0,Un())};return{enable:nr,stop:Un,destroy:()=>{nr(!1),Jt=gt=xt=void 0}}})(Rt.el,rn=>{const Gn=vt(rn);return!(gt||!Jt||(Ue(rn,mt),mt.startX=mt.currentX,mt.startY=mt.currentY,mt.startTime=mt.currentTime=Gn,mt.velocityX=mt.velocityY=mt.deltaX=mt.deltaY=0,mt.event=rn,Pt&&!1===Pt(mt))||(en.release(),!en.start()))&&(gt=!0,0===Te?_n():(Gt.start(mt.startX,mt.startY),!0))},rn=>{xt?!Ot&&Jt&&(Ot=!0,wt(mt,rn),requestAnimationFrame(nr)):(wt(mt,rn),Gt.detect(mt.currentX,mt.currentY)&&(!Gt.isGesture()||!_n())&&_t())},tt,{capture:!1,passive:De}),_t=()=>{Xe(),Ye.stop(),st&&st(mt)};return{enable(rn=!0){rn||(xt&&tt(void 0),Xe()),Ye.enable(rn)},destroy(){en.destroy(),Ye.destroy()}}},wt=(Mt,xt)=>{if(!xt)return;const gt=Mt.currentX,Jt=Mt.currentY,Ot=Mt.currentTime;Ue(xt,Mt);const Rt=Mt.currentX,Pt=Mt.currentY,lt=(Mt.currentTime=vt(xt))-Ot;if(lt>0&&lt<100){const st=(Pt-Jt)/lt;Mt.velocityX=(Rt-gt)/lt*.7+.3*Mt.velocityX,Mt.velocityY=.7*st+.3*Mt.velocityY}Mt.deltaX=Rt-Mt.startX,Mt.deltaY=Pt-Mt.startY,Mt.event=xt},Ue=(Mt,xt)=>{let gt=0,Jt=0;if(Mt){const Ot=Mt.changedTouches;if(Ot&&Ot.length>0){const Rt=Ot[0];gt=Rt.clientX,Jt=Rt.clientY}else void 0!==Mt.pageX&&(gt=Mt.pageX,Jt=Mt.pageY)}xt.currentX=gt,xt.currentY=Jt},vt=Mt=>Mt.timeStamp||Date.now()},2325:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{b:()=>Ve,c:()=>Le,d:()=>Be,e:()=>Te,g:()=>mt,l:()=>st,s:()=>De,t:()=>Ue,w:()=>Ft});var E=ae(5861),he=ae(771),at=ae(512);const Ve="ionViewWillLeave",Le="ionViewDidLeave",Be="ionViewWillUnload",Ue=Gt=>new Promise((en,on)=>{(0,he.w)(()=>{vt(Gt),Mt(Gt).then(Un=>{Un.animation&&Un.animation.destroy(),xt(Gt),en(Un)},Un=>{xt(Gt),on(Un)})})}),vt=Gt=>{const en=Gt.enteringEl,on=Gt.leavingEl;dt(en,on,Gt.direction),Gt.showGoBack?en.classList.add("can-go-back"):en.classList.remove("can-go-back"),De(en,!1),en.style.setProperty("pointer-events","none"),on&&(De(on,!1),on.style.setProperty("pointer-events","none"))},Mt=function(){var Gt=(0,E.Z)(function*(en){const on=yield gt(en);return on&&he.B.isBrowser?Jt(on,en):Ot(en)});return function(on){return Gt.apply(this,arguments)}}(),xt=Gt=>{const en=Gt.enteringEl,on=Gt.leavingEl;en.classList.remove("ion-page-invisible"),en.style.removeProperty("pointer-events"),void 0!==on&&(on.classList.remove("ion-page-invisible"),on.style.removeProperty("pointer-events"))},gt=function(){var Gt=(0,E.Z)(function*(en){return en.leavingEl&&en.animated&&0!==en.duration?en.animationBuilder?en.animationBuilder:"ios"===en.mode?(yield Promise.resolve().then(ae.bind(ae,3433))).iosTransitionAnimation:(yield Promise.resolve().then(ae.bind(ae,6615))).mdTransitionAnimation:void 0});return function(on){return Gt.apply(this,arguments)}}(),Jt=function(){var Gt=(0,E.Z)(function*(en,on){yield Rt(on,!0);const Un=en(on.baseEl,on);lt(on.enteringEl,on.leavingEl);const nr=yield hn(Un,on);return on.progressCallback&&on.progressCallback(void 0),nr&&me(on.enteringEl,on.leavingEl),{hasCompleted:nr,animation:Un}});return function(on,Un){return Gt.apply(this,arguments)}}(),Ot=function(){var Gt=(0,E.Z)(function*(en){const on=en.enteringEl,Un=en.leavingEl;return yield Rt(en,!1),lt(on,Un),me(on,Un),{hasCompleted:!0}});return function(on){return Gt.apply(this,arguments)}}(),Rt=function(){var Gt=(0,E.Z)(function*(en,on){(void 0!==en.deepWait?en.deepWait:on)&&(yield Promise.all([Te(en.enteringEl),Te(en.leavingEl)])),yield Pt(en.viewIsReady,en.enteringEl)});return function(on,Un){return Gt.apply(this,arguments)}}(),Pt=function(){var Gt=(0,E.Z)(function*(en,on){en&&(yield en(on))});return function(on,Un){return Gt.apply(this,arguments)}}(),hn=(Gt,en)=>{const on=en.progressCallback,Un=new Promise(nr=>{Gt.onFinish(_n=>nr(1===_n))});return on?(Gt.progressStart(!0),on(Gt)):Gt.play(),Un},lt=(Gt,en)=>{st(en,Ve),st(Gt,"ionViewWillEnter")},me=(Gt,en)=>{st(Gt,"ionViewDidEnter"),st(en,Le)},st=(Gt,en)=>{if(Gt){const on=new CustomEvent(en,{bubbles:!1,cancelable:!1});Gt.dispatchEvent(on)}},Ft=()=>new Promise(Gt=>(0,at.r)(()=>(0,at.r)(()=>Gt()))),Te=function(){var Gt=(0,E.Z)(function*(en){const on=en;if(on){if(null!=on.componentOnReady){if(null!=(yield on.componentOnReady()))return}else if(null!=on.__registerHost)return void(yield new Promise(nr=>(0,at.r)(nr)));yield Promise.all(Array.from(on.children).map(Te))}});return function(on){return Gt.apply(this,arguments)}}(),De=(Gt,en)=>{en?(Gt.setAttribute("aria-hidden","true"),Gt.classList.add("ion-page-hidden")):(Gt.hidden=!1,Gt.removeAttribute("aria-hidden"),Gt.classList.remove("ion-page-hidden"))},dt=(Gt,en,on)=>{void 0!==Gt&&(Gt.style.zIndex="back"===on?"99":"101"),void 0!==en&&(en.style.zIndex="100")},mt=Gt=>Gt.classList.contains("ion-page")?Gt:Gt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")||Gt},2400:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{a:()=>he,b:()=>at,p:()=>E});const E=(Ie,...ge)=>console.warn(`[Ionic Warning]: ${Ie}`,...ge),he=(Ie,...ge)=>console.error(`[Ionic Error]: ${Ie}`,...ge),at=(Ie,...ge)=>console.error(`<${Ie.tagName.toLowerCase()}> must be used inside ${ge.join(" or ")}.`)},1848:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{d:()=>he,w:()=>E});const E=typeof window<"u"?window:void 0,he=typeof document<"u"?document:void 0},771:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{B:()=>vt,H:()=>_n,a:()=>Bs,b:()=>ho,c:()=>rr,d:()=>ei,e:()=>Ct,f:()=>gr,g:()=>Hn,h:()=>Un,i:()=>Ke,j:()=>Mt,r:()=>us,w:()=>Qt});var E=ae(5861);let Ie,ge,Ve,Le=!1,Be=!1,ze=!1,wt=!1,Ue=!1;const vt={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1},Mt=q=>{const ce=new URL(q,Br.$resourcesUrl$);return ce.origin!==xs.location.origin?ce.href:ce.pathname},hn="s-id",lt="sty-id",Ft="slot-fb{display:contents}slot-fb[hidden]{display:none}",Te="http://www.w3.org/1999/xlink",De={},en=q=>"object"==(q=typeof q)||"function"===q;function on(q){var ce,Pe,ct;return null!==(ct=null===(Pe=null===(ce=q.head)||void 0===ce?void 0:ce.querySelector('meta[name="csp-nonce"]'))||void 0===Pe?void 0:Pe.getAttribute("content"))&&void 0!==ct?ct:void 0}const Un=(q,ce,...Pe)=>{let ct=null,$t=null,bt=null,fn=!1,bn=!1;const Fn=[],Pn=wn=>{for(let Kn=0;Kn<wn.length;Kn++)ct=wn[Kn],Array.isArray(ct)?Pn(ct):null!=ct&&"boolean"!=typeof ct&&((fn="function"!=typeof q&&!en(ct))&&(ct=String(ct)),fn&&bn?Fn[Fn.length-1].$text$+=ct:Fn.push(fn?nr(null,ct):ct),bn=fn)};if(Pn(Pe),ce){ce.key&&($t=ce.key),ce.name&&(bt=ce.name);{const wn=ce.className||ce.class;wn&&(ce.class="object"!=typeof wn?wn:Object.keys(wn).filter(Kn=>wn[Kn]).join(" "))}}if("function"==typeof q)return q(null===ce?{}:ce,Fn,yt);const kt=nr(q,null);return kt.$attrs$=ce,Fn.length>0&&(kt.$children$=Fn),kt.$key$=$t,kt.$name$=bt,kt},nr=(q,ce)=>({$flags$:0,$tag$:q,$text$:ce,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null}),_n={},yt={forEach:(q,ce)=>q.map(Xe).forEach(ce),map:(q,ce)=>q.map(Xe).map(ce).map(tt)},Xe=q=>({vattrs:q.$attrs$,vchildren:q.$children$,vkey:q.$key$,vname:q.$name$,vtag:q.$tag$,vtext:q.$text$}),tt=q=>{if("function"==typeof q.vtag){const Pe=Object.assign({},q.vattrs);return q.vkey&&(Pe.key=q.vkey),q.vname&&(Pe.name=q.vname),Un(q.vtag,Pe,...q.vchildren||[])}const ce=nr(q.vtag,q.vtext);return ce.$attrs$=q.vattrs,ce.$children$=q.vchildren,ce.$key$=q.vkey,ce.$name$=q.vname,ce},_t=(q,ce,Pe,ct,$t,bt,fn)=>{let bn,Fn,Pn,kt;if(1===bt.nodeType){for(bn=bt.getAttribute("c-id"),bn&&(Fn=bn.split("."),(Fn[0]===fn||"0"===Fn[0])&&(Pn={$flags$:0,$hostId$:Fn[0],$nodeId$:Fn[1],$depth$:Fn[2],$index$:Fn[3],$tag$:bt.tagName.toLowerCase(),$elm$:bt,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},ce.push(Pn),bt.removeAttribute("c-id"),q.$children$||(q.$children$=[]),q.$children$[Pn.$index$]=Pn,q=Pn,ct&&"0"===Pn.$depth$&&(ct[Pn.$index$]=Pn.$elm$))),kt=bt.childNodes.length-1;kt>=0;kt--)_t(q,ce,Pe,ct,$t,bt.childNodes[kt],fn);if(bt.shadowRoot)for(kt=bt.shadowRoot.childNodes.length-1;kt>=0;kt--)_t(q,ce,Pe,ct,$t,bt.shadowRoot.childNodes[kt],fn)}else if(8===bt.nodeType)Fn=bt.nodeValue.split("."),(Fn[1]===fn||"0"===Fn[1])&&(bn=Fn[0],Pn={$flags$:0,$hostId$:Fn[1],$nodeId$:Fn[2],$depth$:Fn[3],$index$:Fn[4],$elm$:bt,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===bn?(Pn.$elm$=bt.nextSibling,Pn.$elm$&&3===Pn.$elm$.nodeType&&(Pn.$text$=Pn.$elm$.textContent,ce.push(Pn),bt.remove(),q.$children$||(q.$children$=[]),q.$children$[Pn.$index$]=Pn,ct&&"0"===Pn.$depth$&&(ct[Pn.$index$]=Pn.$elm$))):Pn.$hostId$===fn&&("s"===bn?(Pn.$tag$="slot",bt["s-sn"]=Fn[5]?Pn.$name$=Fn[5]:"",bt["s-sr"]=!0,ct&&(Pn.$elm$=Wi.createElement(Pn.$tag$),Pn.$name$&&Pn.$elm$.setAttribute("name",Pn.$name$),bt.parentNode.insertBefore(Pn.$elm$,bt),bt.remove(),"0"===Pn.$depth$&&(ct[Pn.$index$]=Pn.$elm$)),Pe.push(Pn),q.$children$||(q.$children$=[]),q.$children$[Pn.$index$]=Pn):"r"===bn&&(ct?bt.remove():($t["s-cr"]=bt,bt["s-cn"]=!0))));else if(q&&"style"===q.$tag$){const wn=nr(null,bt.textContent);wn.$elm$=bt,wn.$index$="0",q.$children$=[wn]}},rn=(q,ce)=>{if(1===q.nodeType){let Pe=0;for(;Pe<q.childNodes.length;Pe++)rn(q.childNodes[Pe],ce);if(q.shadowRoot)for(Pe=0;Pe<q.shadowRoot.childNodes.length;Pe++)rn(q.shadowRoot.childNodes[Pe],ce)}else if(8===q.nodeType){const Pe=q.nodeValue.split(".");"o"===Pe[0]&&(ce.set(Pe[1]+"."+Pe[2],q),q.nodeValue="",q["s-en"]=Pe[3])}},rr=q=>pi.push(q),Hn=q=>fo(q).$modeName$,gr=q=>fo(q).$hostElement$,ei=(q,ce,Pe)=>{const ct=gr(q);return{emit:$t=>An(ct,ce,{bubbles:!!(4&Pe),composed:!!(2&Pe),cancelable:!!(1&Pe),detail:$t})}},An=(q,ce,Pe)=>{const ct=Br.ce(ce,Pe);return q.dispatchEvent(ct),ct},qe=new WeakMap,ue=(q,ce,Pe)=>{let ct=Qi.get(q);Et&&Pe?(ct=ct||new CSSStyleSheet,"string"==typeof ct?ct=ce:ct.replaceSync(ce)):ct=ce,Qi.set(q,ct)},ye=(q,ce,Pe)=>{var ct;const $t=Bt(ce,Pe),bt=Qi.get($t);if(q=11===q.nodeType?q:Wi,bt)if("string"==typeof bt){let bn,fn=qe.get(q=q.head||q);if(fn||qe.set(q,fn=new Set),!fn.has($t)){if(q.host&&(bn=q.querySelector(`[${lt}="${$t}"]`)))bn.innerHTML=bt;else{bn=Wi.createElement("style"),bn.innerHTML=bt;const Fn=null!==(ct=Br.$nonce$)&&void 0!==ct?ct:on(Wi);null!=Fn&&bn.setAttribute("nonce",Fn),q.insertBefore(bn,q.querySelector("link"))}4&ce.$flags$&&(bn.innerHTML+=Ft),fn&&fn.add($t)}}else q.adoptedStyleSheets.includes(bt)||(q.adoptedStyleSheets=[...q.adoptedStyleSheets,bt]);return $t},Bt=(q,ce)=>"sc-"+(ce&&32&q.$flags$?q.$tagName$+"-"+ce:q.$tagName$),zt=q=>q.replace(/\/\*!@([^\/]+)\*\/[^\{]+\{/g,"$1{"),nn=(q,ce,Pe,ct,$t,bt)=>{if(Pe!==ct){let fn=ns(q,ce),bn=ce.toLowerCase();if("class"===ce){const Fn=q.classList,Pn=Xt(Pe),kt=Xt(ct);Fn.remove(...Pn.filter(wn=>wn&&!kt.includes(wn))),Fn.add(...kt.filter(wn=>wn&&!Pn.includes(wn)))}else if("style"===ce){for(const Fn in Pe)(!ct||null==ct[Fn])&&(Fn.includes("-")?q.style.removeProperty(Fn):q.style[Fn]="");for(const Fn in ct)(!Pe||ct[Fn]!==Pe[Fn])&&(Fn.includes("-")?q.style.setProperty(Fn,ct[Fn]):q.style[Fn]=ct[Fn])}else if("key"!==ce)if("ref"===ce)ct&&ct(q);else if(fn||"o"!==ce[0]||"n"!==ce[1]){const Fn=en(ct);if((fn||Fn&&null!==ct)&&!$t)try{if(q.tagName.includes("-"))q[ce]=ct;else{const kt=null==ct?"":ct;"list"===ce?fn=!1:(null==Pe||q[ce]!=kt)&&(q[ce]=kt)}}catch{}let Pn=!1;bn!==(bn=bn.replace(/^xlink\:?/,""))&&(ce=bn,Pn=!0),null==ct||!1===ct?(!1!==ct||""===q.getAttribute(ce))&&(Pn?q.removeAttributeNS(Te,ce):q.removeAttribute(ce)):(!fn||4&bt||$t)&&!Fn&&(ct=!0===ct?"":ct,Pn?q.setAttributeNS(Te,ce,ct):q.setAttribute(ce,ct))}else if(ce="-"===ce[2]?ce.slice(3):ns(xs,bn)?bn.slice(2):bn[2]+ce.slice(3),Pe||ct){const Fn=ce.endsWith(Zn);ce=ce.replace(cn,""),Pe&&Br.rel(q,ce,Pe,Fn),ct&&Br.ael(q,ce,ct,Fn)}}},In=/\s/,Xt=q=>q?q.split(In):[],Zn="Capture",cn=new RegExp(Zn+"$"),Dn=(q,ce,Pe,ct)=>{const $t=11===ce.$elm$.nodeType&&ce.$elm$.host?ce.$elm$.host:ce.$elm$,bt=q&&q.$attrs$||De,fn=ce.$attrs$||De;for(ct in bt)ct in fn||nn($t,ct,bt[ct],void 0,Pe,ce.$flags$);for(ct in fn)nn($t,ct,bt[ct],fn[ct],Pe,ce.$flags$)},ir=(q,ce,Pe,ct)=>{var $t;const bt=ce.$children$[Pe];let bn,Fn,Pn,fn=0;if(Le||(ze=!0,"slot"===bt.$tag$&&(Ie&&ct.classList.add(Ie+"-s"),bt.$flags$|=bt.$children$?2:1)),null!==bt.$text$)bn=bt.$elm$=Wi.createTextNode(bt.$text$);else if(1&bt.$flags$)bn=bt.$elm$=Wi.createTextNode("");else{if(wt||(wt="svg"===bt.$tag$),bn=bt.$elm$=Wi.createElementNS(wt?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&bt.$flags$?"slot-fb":bt.$tag$),wt&&"foreignObject"===bt.$tag$&&(wt=!1),Dn(null,bt,wt),(q=>null!=q)(Ie)&&bn["s-si"]!==Ie&&bn.classList.add(bn["s-si"]=Ie),bt.$children$)for(fn=0;fn<bt.$children$.length;++fn)Fn=ir(q,bt,fn,bn),Fn&&bn.appendChild(Fn);"svg"===bt.$tag$?wt=!1:"foreignObject"===bn.tagName&&(wt=!0)}return bn["s-hn"]=Ve,3&bt.$flags$&&(bn["s-sr"]=!0,bn["s-fs"]=null===($t=bt.$attrs$)||void 0===$t?void 0:$t.slot,bn["s-cr"]=ge,bn["s-sn"]=bt.$name$||"",Pn=q&&q.$children$&&q.$children$[Pe],Pn&&Pn.$tag$===bt.$tag$&&q.$elm$&&bi(q.$elm$,!1)),bn},bi=(q,ce)=>{var Pe;Br.$flags$|=1;const ct=q.childNodes;for(let $t=ct.length-1;$t>=0;$t--){const bt=ct[$t];bt["s-hn"]!==Ve&&bt["s-ol"]&&(ri(bt).insertBefore(bt,qi(bt)),bt["s-ol"].remove(),bt["s-ol"]=void 0,bt["s-sh"]=void 0,1===bt.nodeType&&bt.setAttribute("slot",null!==(Pe=bt["s-sn"])&&void 0!==Pe?Pe:""),ze=!0),ce&&bi(bt,ce)}Br.$flags$&=-2},Mi=(q,ce,Pe,ct,$t,bt)=>{let bn,fn=q["s-cr"]&&q["s-cr"].parentNode||q;for(fn.shadowRoot&&fn.tagName===Ve&&(fn=fn.shadowRoot);$t<=bt;++$t)ct[$t]&&(bn=ir(null,Pe,$t,q),bn&&(ct[$t].$elm$=bn,fn.insertBefore(bn,qi(ce))))},Nn=(q,ce,Pe)=>{for(let ct=ce;ct<=Pe;++ct){const $t=q[ct];if($t){const bt=$t.$elm$;Gr($t),bt&&(Be=!0,bt["s-ol"]?bt["s-ol"].remove():bi(bt,!0),bt.remove())}}},Lr=(q,ce)=>q.$tag$===ce.$tag$&&("slot"===q.$tag$?q.$name$===ce.$name$:q.$key$===ce.$key$),qi=q=>q&&q["s-ol"]||q,ri=q=>(q["s-ol"]?q["s-ol"]:q).parentNode,Ui=(q,ce)=>{const Pe=ce.$elm$=q.$elm$,ct=q.$children$,$t=ce.$children$,bt=ce.$tag$,fn=ce.$text$;let bn;null===fn?(wt="svg"===bt||"foreignObject"!==bt&&wt,"slot"===bt||Dn(q,ce,wt),null!==ct&&null!==$t?((q,ce,Pe,ct)=>{let Sn,Ji,$t=0,bt=0,fn=0,bn=0,Fn=ce.length-1,Pn=ce[0],kt=ce[Fn],wn=ct.length-1,Kn=ct[0],ut=ct[wn];for(;$t<=Fn&&bt<=wn;)if(null==Pn)Pn=ce[++$t];else if(null==kt)kt=ce[--Fn];else if(null==Kn)Kn=ct[++bt];else if(null==ut)ut=ct[--wn];else if(Lr(Pn,Kn))Ui(Pn,Kn),Pn=ce[++$t],Kn=ct[++bt];else if(Lr(kt,ut))Ui(kt,ut),kt=ce[--Fn],ut=ct[--wn];else if(Lr(Pn,ut))("slot"===Pn.$tag$||"slot"===ut.$tag$)&&bi(Pn.$elm$.parentNode,!1),Ui(Pn,ut),q.insertBefore(Pn.$elm$,kt.$elm$.nextSibling),Pn=ce[++$t],ut=ct[--wn];else if(Lr(kt,Kn))("slot"===Pn.$tag$||"slot"===ut.$tag$)&&bi(kt.$elm$.parentNode,!1),Ui(kt,Kn),q.insertBefore(kt.$elm$,Pn.$elm$),kt=ce[--Fn],Kn=ct[++bt];else{for(fn=-1,bn=$t;bn<=Fn;++bn)if(ce[bn]&&null!==ce[bn].$key$&&ce[bn].$key$===Kn.$key$){fn=bn;break}fn>=0?(Ji=ce[fn],Ji.$tag$!==Kn.$tag$?Sn=ir(ce&&ce[bt],Pe,fn,q):(Ui(Ji,Kn),ce[fn]=void 0,Sn=Ji.$elm$),Kn=ct[++bt]):(Sn=ir(ce&&ce[bt],Pe,bt,q),Kn=ct[++bt]),Sn&&ri(Pn.$elm$).insertBefore(Sn,qi(Pn.$elm$))}$t>Fn?Mi(q,null==ct[wn+1]?null:ct[wn+1].$elm$,Pe,ct,bt,wn):bt>wn&&Nn(ce,$t,Fn)})(Pe,ct,ce,$t):null!==$t?(null!==q.$text$&&(Pe.textContent=""),Mi(Pe,null,ce,$t,0,$t.length-1)):null!==ct&&Nn(ct,0,ct.length-1),wt&&"svg"===bt&&(wt=!1)):(bn=Pe["s-cr"])?bn.parentNode.textContent=fn:q.$text$!==fn&&(Pe.data=fn)},fr=q=>{const ce=q.childNodes;for(const Pe of ce)if(1===Pe.nodeType){if(Pe["s-sr"]){const ct=Pe["s-sn"];Pe.hidden=!1;for(const $t of ce)if($t!==Pe)if($t["s-hn"]!==Pe["s-hn"]||""!==ct){if(1===$t.nodeType&&(ct===$t.getAttribute("slot")||ct===$t["s-sn"])){Pe.hidden=!0;break}}else if(1===$t.nodeType||3===$t.nodeType&&""!==$t.textContent.trim()){Pe.hidden=!0;break}}fr(Pe)}},io=[],Io=q=>{let ce,Pe,ct;for(const $t of q.childNodes){if($t["s-sr"]&&(ce=$t["s-cr"])&&ce.parentNode){Pe=ce.parentNode.childNodes;const bt=$t["s-sn"];for(ct=Pe.length-1;ct>=0;ct--)if(ce=Pe[ct],!ce["s-cn"]&&!ce["s-nr"]&&ce["s-hn"]!==$t["s-hn"])if(Tr(ce,bt)){let fn=io.find(bn=>bn.$nodeToRelocate$===ce);Be=!0,ce["s-sn"]=ce["s-sn"]||bt,fn?(fn.$nodeToRelocate$["s-sh"]=$t["s-hn"],fn.$slotRefNode$=$t):(ce["s-sh"]=$t["s-hn"],io.push({$slotRefNode$:$t,$nodeToRelocate$:ce})),ce["s-sr"]&&io.map(bn=>{Tr(bn.$nodeToRelocate$,ce["s-sn"])&&(fn=io.find(Fn=>Fn.$nodeToRelocate$===ce),fn&&!bn.$slotRefNode$&&(bn.$slotRefNode$=fn.$slotRefNode$))})}else io.some(fn=>fn.$nodeToRelocate$===ce)||io.push({$nodeToRelocate$:ce})}1===$t.nodeType&&Io($t)}},Tr=(q,ce)=>1===q.nodeType?null===q.getAttribute("slot")&&""===ce||q.getAttribute("slot")===ce:q["s-sn"]===ce||""===ce,Gr=q=>{q.$attrs$&&q.$attrs$.ref&&q.$attrs$.ref(null),q.$children$&&q.$children$.map(Gr)},Ht=(q,ce)=>{ce&&!q.$onRenderResolve$&&ce["s-p"]&&ce["s-p"].push(new Promise(Pe=>q.$onRenderResolve$=Pe))},an=(q,ce)=>{if(q.$flags$|=16,!(4&q.$flags$))return Ht(q,q.$ancestorComponent$),Qt(()=>yn(q,ce));q.$flags$|=512},yn=(q,ce)=>{const ct=q.$lazyInstance$;let $t;return ce&&(q.$flags$|=256,q.$queuedListeners$&&(q.$queuedListeners$.map(([bt,fn])=>rt(ct,bt,fn)),q.$queuedListeners$=void 0),$t=rt(ct,"componentWillLoad")),$t=vn($t,()=>rt(ct,"componentWillRender")),vn($t,()=>xn(q,ct,ce))},vn=(q,ce)=>En(q)?q.then(ce):ce(),En=q=>q instanceof Promise||q&&q.then&&"function"==typeof q.then,xn=function(){var q=(0,E.Z)(function*(ce,Pe,ct){var $t;const bt=ce.$hostElement$,bn=bt["s-rc"];ct&&(q=>{const ce=q.$cmpMeta$,Pe=q.$hostElement$,ct=ce.$flags$,bt=ye(Pe.shadowRoot?Pe.shadowRoot:Pe.getRootNode(),ce,q.$modeName$);10&ct&&(Pe["s-sc"]=bt,Pe.classList.add(bt+"-h"),2&ct&&Pe.classList.add(bt+"-s"))})(ce);Ln(ce,Pe,bt,ct),bn&&(bn.map(Pn=>Pn()),bt["s-rc"]=void 0);{const Pn=null!==($t=bt["s-p"])&&void 0!==$t?$t:[],kt=()=>ht(ce);0===Pn.length?kt():(Promise.all(Pn).then(kt),ce.$flags$|=4,Pn.length=0)}});return function(Pe,ct,$t){return q.apply(this,arguments)}}(),Ln=(q,ce,Pe,ct)=>{try{ce=ce.render&&ce.render(),q.$flags$&=-17,q.$flags$|=2,((q,ce,Pe=!1)=>{var ct,$t,bt,fn;const bn=q.$hostElement$,Fn=q.$cmpMeta$,Pn=q.$vnode$||nr(null,null),kt=(q=>q&&q.$tag$===_n)(ce)?ce:Un(null,null,ce);if(Ve=bn.tagName,Fn.$attrsToReflect$&&(kt.$attrs$=kt.$attrs$||{},Fn.$attrsToReflect$.map(([wn,Kn])=>kt.$attrs$[Kn]=bn[wn])),Pe&&kt.$attrs$)for(const wn of Object.keys(kt.$attrs$))bn.hasAttribute(wn)&&!["key","ref","style","class"].includes(wn)&&(kt.$attrs$[wn]=bn[wn]);if(kt.$tag$=null,kt.$flags$|=4,q.$vnode$=kt,kt.$elm$=Pn.$elm$=bn.shadowRoot||bn,Ie=bn["s-sc"],ge=bn["s-cr"],Le=0!=(1&Fn.$flags$),Be=!1,Ui(Pn,kt),Br.$flags$|=1,ze){Io(kt.$elm$);for(const wn of io){const Kn=wn.$nodeToRelocate$;if(!Kn["s-ol"]){const ut=Wi.createTextNode("");ut["s-nr"]=Kn,Kn.parentNode.insertBefore(Kn["s-ol"]=ut,Kn)}}for(const wn of io){const Kn=wn.$nodeToRelocate$,ut=wn.$slotRefNode$;if(ut){const Sn=ut.parentNode;let Ji=ut.nextSibling;{let N=null===(ct=Kn["s-ol"])||void 0===ct?void 0:ct.previousSibling;for(;N;){let be=null!==($t=N["s-nr"])&&void 0!==$t?$t:null;if(be&&be["s-sn"]===Kn["s-sn"]&&Sn===be.parentNode&&(be=be.nextSibling,!be||!be["s-nr"])){Ji=be;break}N=N.previousSibling}}(!Ji&&Sn!==Kn.parentNode||Kn.nextSibling!==Ji)&&Kn!==Ji&&(!Kn["s-hn"]&&Kn["s-ol"]&&(Kn["s-hn"]=Kn["s-ol"].parentNode.nodeName),Sn.insertBefore(Kn,Ji),1===Kn.nodeType&&(Kn.hidden=null!==(bt=Kn["s-ih"])&&void 0!==bt&&bt))}else 1===Kn.nodeType&&(Pe&&(Kn["s-ih"]=null!==(fn=Kn.hidden)&&void 0!==fn&&fn),Kn.hidden=!0)}}Be&&fr(kt.$elm$),Br.$flags$&=-2,io.length=0})(q,ce,ct)}catch($t){po($t,q.$hostElement$)}return null},ht=q=>{const Pe=q.$hostElement$,$t=q.$lazyInstance$,bt=q.$ancestorComponent$;rt($t,"componentDidRender"),64&q.$flags$?rt($t,"componentDidUpdate"):(q.$flags$|=64,Nt(Pe),rt($t,"componentDidLoad"),q.$onReadyResolve$(Pe),bt||ot()),q.$onInstanceResolve$(Pe),q.$onRenderResolve$&&(q.$onRenderResolve$(),q.$onRenderResolve$=void 0),512&q.$flags$&&We(()=>an(q,!1)),q.$flags$&=-517},Ke=q=>{{const ce=fo(q),Pe=ce.$hostElement$.isConnected;return Pe&&2==(18&ce.$flags$)&&an(ce,!1),Pe}},ot=q=>{Nt(Wi.documentElement),We(()=>An(xs,"appload",{detail:{namespace:"ionic"}}))},rt=(q,ce,Pe)=>{if(q&&q[ce])try{return q[ce](Pe)}catch(ct){po(ct)}},Nt=q=>q.classList.add("hydrated"),cr=(q,ce,Pe)=>{var ct;const $t=q.prototype;if(ce.$members$){q.watchers&&(ce.$watchers$=q.watchers);const bt=Object.entries(ce.$members$);if(bt.map(([fn,[bn]])=>{31&bn||2&Pe&&32&bn?Object.defineProperty($t,fn,{get(){return((q,ce)=>fo(this).$instanceValues$.get(ce))(0,fn)},set(Fn){((q,ce,Pe,ct)=>{const $t=fo(q),bt=$t.$hostElement$,fn=$t.$instanceValues$.get(ce),bn=$t.$flags$,Fn=$t.$lazyInstance$;Pe=((q,ce)=>null==q||en(q)?q:4&ce?"false"!==q&&(""===q||!!q):2&ce?parseFloat(q):1&ce?String(q):q)(Pe,ct.$members$[ce][0]);const Pn=Number.isNaN(fn)&&Number.isNaN(Pe);if((!(8&bn)||void 0===fn)&&Pe!==fn&&!Pn&&($t.$instanceValues$.set(ce,Pe),Fn)){if(ct.$watchers$&&128&bn){const wn=ct.$watchers$[ce];wn&&wn.map(Kn=>{try{Fn[Kn](Pe,fn,ce)}catch(ut){po(ut,bt)}})}2==(18&bn)&&an($t,!1)}})(this,fn,Fn,ce)},configurable:!0,enumerable:!0}):1&Pe&&64&bn&&Object.defineProperty($t,fn,{value(...Fn){var Pn;const kt=fo(this);return null===(Pn=null==kt?void 0:kt.$onInstancePromise$)||void 0===Pn?void 0:Pn.then(()=>{var wn;return null===(wn=kt.$lazyInstance$)||void 0===wn?void 0:wn[fn](...Fn)})}})}),1&Pe){const fn=new Map;$t.attributeChangedCallback=function(bn,Fn,Pn){Br.jmp(()=>{var kt;const wn=fn.get(bn);if(this.hasOwnProperty(wn))Pn=this[wn],delete this[wn];else{if($t.hasOwnProperty(wn)&&"number"==typeof this[wn]&&this[wn]==Pn)return;if(null==wn){const Kn=fo(this),ut=null==Kn?void 0:Kn.$flags$;if(ut&&!(8&ut)&&128&ut&&Pn!==Fn){const Sn=Kn.$lazyInstance$,Ji=null===(kt=ce.$watchers$)||void 0===kt?void 0:kt[bn];null==Ji||Ji.forEach(N=>{null!=Sn[N]&&Sn[N].call(Sn,Pn,Fn,bn)})}return}}this[wn]=(null!==Pn||"boolean"!=typeof this[wn])&&Pn})},q.observedAttributes=Array.from(new Set([...Object.keys(null!==(ct=ce.$watchers$)&&void 0!==ct?ct:{}),...bt.filter(([bn,Fn])=>15&Fn[0]).map(([bn,Fn])=>{var Pn;const kt=Fn[1]||bn;return fn.set(kt,bn),512&Fn[0]&&(null===(Pn=ce.$attrsToReflect$)||void 0===Pn||Pn.push([bn,kt])),kt})]))}}return q},Sr=function(){var q=(0,E.Z)(function*(ce,Pe,ct,$t){let bt;if(!(32&Pe.$flags$)){Pe.$flags$|=32;{if(bt=ds(ct),bt.then){const Pn=()=>{};bt=yield bt,Pn()}bt.isProxied||(ct.$watchers$=bt.watchers,cr(bt,ct,2),bt.isProxied=!0);const Fn=()=>{};Pe.$flags$|=8;try{new bt(Pe)}catch(Pn){po(Pn)}Pe.$flags$&=-9,Pe.$flags$|=128,Fn(),ii(Pe.$lazyInstance$)}if(bt.style){let Fn=bt.style;"string"!=typeof Fn&&(Fn=Fn[Pe.$modeName$=(q=>pi.map(ce=>ce(q)).find(ce=>!!ce))(ce)]);const Pn=Bt(ct,Pe.$modeName$);if(!Qi.has(Pn)){const kt=()=>{};ue(Pn,Fn,!!(1&ct.$flags$)),kt()}}}const fn=Pe.$ancestorComponent$,bn=()=>an(Pe,!0);fn&&fn["s-rc"]?fn["s-rc"].push(bn):bn()});return function(Pe,ct,$t,bt){return q.apply(this,arguments)}}(),ii=q=>{rt(q,"connectedCallback")},wi=q=>{const ce=q["s-cr"]=Wi.createComment("");ce["s-cn"]=!0,q.insertBefore(ce,q.firstChild)},dr=q=>{rt(q,"disconnectedCallback")},Oo=function(){var q=(0,E.Z)(function*(ce){if(!(1&Br.$flags$)){const Pe=fo(ce);Pe.$rmListeners$&&(Pe.$rmListeners$.map(ct=>ct()),Pe.$rmListeners$=void 0),null!=Pe&&Pe.$lazyInstance$?dr(Pe.$lazyInstance$):null!=Pe&&Pe.$onReadyPromise$&&Pe.$onReadyPromise$.then(()=>dr(Pe.$lazyInstance$))}});return function(Pe){return q.apply(this,arguments)}}(),ho=(q,ce={})=>{var Pe;const $t=[],bt=ce.exclude||[],fn=xs.customElements,bn=Wi.head,Fn=bn.querySelector("meta[charset]"),Pn=Wi.createElement("style"),kt=[],wn=Wi.querySelectorAll(`[${lt}]`);let Kn,ut=!0,Sn=0;for(Object.assign(Br,ce),Br.$resourcesUrl$=new URL(ce.resourcesUrl||"./",Wi.baseURI).href,Br.$flags$|=2;Sn<wn.length;Sn++)ue(wn[Sn].getAttribute(lt),zt(wn[Sn].innerHTML),!0);let Ji=!1;if(q.map(N=>{N[1].map(be=>{var K;const Fe={$flags$:be[0],$tagName$:be[1],$members$:be[2],$listeners$:be[3]};4&Fe.$flags$&&(Ji=!0),Fe.$members$=be[2],Fe.$listeners$=be[3],Fe.$attrsToReflect$=[],Fe.$watchers$=null!==(K=be[4])&&void 0!==K?K:{};const Lt=Fe.$tagName$,Hr=class extends HTMLElement{constructor($o){super($o),Fs($o=this,Fe),1&Fe.$flags$&&$o.attachShadow({mode:"open",delegatesFocus:!!(16&Fe.$flags$)})}connectedCallback(){Kn&&(clearTimeout(Kn),Kn=null),ut?kt.push(this):Br.jmp(()=>(q=>{if(!(1&Br.$flags$)){const ce=fo(q),Pe=ce.$cmpMeta$,ct=()=>{};if(1&ce.$flags$)vs(q,ce,Pe.$listeners$),null!=ce&&ce.$lazyInstance$?ii(ce.$lazyInstance$):null!=ce&&ce.$onReadyPromise$&&ce.$onReadyPromise$.then(()=>ii(ce.$lazyInstance$));else{let $t;if(ce.$flags$|=1,$t=q.getAttribute(hn),$t){if(1&Pe.$flags$){const bt=ye(q.shadowRoot,Pe,q.getAttribute("s-mode"));q.classList.remove(bt+"-h",bt+"-s")}((q,ce,Pe,ct)=>{const bt=q.shadowRoot,fn=[],Fn=bt?[]:null,Pn=ct.$vnode$=nr(ce,null);Br.$orgLocNodes$||rn(Wi.body,Br.$orgLocNodes$=new Map),q[hn]=Pe,q.removeAttribute(hn),_t(Pn,fn,[],Fn,q,q,Pe),fn.map(kt=>{const wn=kt.$hostId$+"."+kt.$nodeId$,Kn=Br.$orgLocNodes$.get(wn),ut=kt.$elm$;Kn&&Vs&&""===Kn["s-en"]&&Kn.parentNode.insertBefore(ut,Kn.nextSibling),bt||(ut["s-hn"]=ce,Kn&&(ut["s-ol"]=Kn,ut["s-ol"]["s-nr"]=ut)),Br.$orgLocNodes$.delete(wn)}),bt&&Fn.map(kt=>{kt&&bt.appendChild(kt)})})(q,Pe.$tagName$,$t,ce)}$t||12&Pe.$flags$&&wi(q);{let bt=q;for(;bt=bt.parentNode||bt.host;)if(1===bt.nodeType&&bt.hasAttribute("s-id")&&bt["s-p"]||bt["s-p"]){Ht(ce,ce.$ancestorComponent$=bt);break}}Pe.$members$&&Object.entries(Pe.$members$).map(([bt,[fn]])=>{if(31&fn&&q.hasOwnProperty(bt)){const bn=q[bt];delete q[bt],q[bt]=bn}}),Sr(q,ce,Pe)}ct()}})(this))}disconnectedCallback(){Br.jmp(()=>Oo(this))}componentOnReady(){return fo(this).$onReadyPromise$}};Fe.$lazyBundleId$=N[0],!bt.includes(Lt)&&!fn.get(Lt)&&($t.push(Lt),fn.define(Lt,cr(Hr,Fe,1)))})}),Ji&&(Pn.innerHTML+=Ft),Pn.innerHTML+=$t+"{visibility:hidden}.hydrated{visibility:inherit}",Pn.innerHTML.length){Pn.setAttribute("data-styles","");const N=null!==(Pe=Br.$nonce$)&&void 0!==Pe?Pe:on(Wi);null!=N&&Pn.setAttribute("nonce",N),bn.insertBefore(Pn,Fn?Fn.nextSibling:bn.firstChild)}ut=!1,kt.length?kt.map(N=>N.connectedCallback()):Br.jmp(()=>Kn=setTimeout(ot,30))},vs=(q,ce,Pe,ct)=>{Pe&&Pe.map(([$t,bt,fn])=>{const bn=Ei(q,$t),Fn=cs(ce,fn),Pn=ko($t);Br.ael(bn,bt,Fn,Pn),(ce.$rmListeners$=ce.$rmListeners$||[]).push(()=>Br.rel(bn,bt,Fn,Pn))})},cs=(q,ce)=>Pe=>{try{256&q.$flags$?q.$lazyInstance$[ce](Pe):(q.$queuedListeners$=q.$queuedListeners$||[]).push([ce,Pe])}catch(ct){po(ct)}},Ei=(q,ce)=>4&ce?Wi:8&ce?xs:16&ce?Wi.body:q,ko=q=>0!=(2&q),ts=new WeakMap,fo=q=>ts.get(q),us=(q,ce)=>ts.set(ce.$lazyInstance$=q,ce),Fs=(q,ce)=>{const Pe={$flags$:0,$hostElement$:q,$cmpMeta$:ce,$instanceValues$:new Map};return Pe.$onInstancePromise$=new Promise(ct=>Pe.$onInstanceResolve$=ct),Pe.$onReadyPromise$=new Promise(ct=>Pe.$onReadyResolve$=ct),q["s-p"]=[],q["s-rc"]=[],vs(q,Pe,ce.$listeners$),ts.set(q,Pe)},ns=(q,ce)=>ce in q,po=(q,ce)=>(0,console.error)(q,ce),ti=new Map,ds=(q,ce,Pe)=>{const ct=q.$tagName$.replace(/-/g,"_"),$t=q.$lazyBundleId$,bt=ti.get($t);return bt?bt[ct]:ae(863)(`./${$t}.entry.js`).then(fn=>(ti.set($t,fn),fn[ct]),po)},Qi=new Map,pi=[],xs=typeof window<"u"?window:{},Wi=xs.document||{head:{}},Br={$flags$:0,$resourcesUrl$:"",jmp:q=>q(),raf:q=>requestAnimationFrame(q),ael:(q,ce,Pe,ct)=>q.addEventListener(ce,Pe,ct),rel:(q,ce,Pe,ct)=>q.removeEventListener(ce,Pe,ct),ce:(q,ce)=>new CustomEvent(q,ce)},Bs=q=>{Object.assign(Br,q)},Vs=!0,Et=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch{}return!1})(),Ze=[],re=[],ne=(q,ce)=>Pe=>{q.push(Pe),Ue||(Ue=!0,ce&&4&Br.$flags$?We(_e):Br.raf(_e))},Z=q=>{for(let ce=0;ce<q.length;ce++)try{q[ce](performance.now())}catch(Pe){po(Pe)}q.length=0},_e=()=>{Z(Ze),Z(re),(Ue=Ze.length>0)&&Br.raf(_e)},We=q=>Promise.resolve(void 0).then(q),Ct=ne(Ze,!1),Qt=ne(re,!0)},2905:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{a:()=>Ue,b:()=>nr,c:()=>at,i:()=>_n});var E=ae(771);class he{constructor(){this.m=new Map}reset(yt){this.m=new Map(Object.entries(yt))}get(yt,Xe){const tt=this.m.get(yt);return void 0!==tt?tt:Xe}getBoolean(yt,Xe=!1){const tt=this.m.get(yt);return void 0===tt?Xe:"string"==typeof tt?"true"===tt:!!tt}getNumber(yt,Xe){const tt=parseFloat(this.m.get(yt));return isNaN(tt)?void 0!==Xe?Xe:NaN:tt}set(yt,Xe){this.m.set(yt,Xe)}}const at=new he,ze="ionic-persist-config",Ue=(sn,yt)=>("string"==typeof sn&&(yt=sn,sn=void 0),(sn=>vt(sn))(sn).includes(yt)),vt=(sn=window)=>{if(typeof sn>"u")return[];sn.Ionic=sn.Ionic||{};let yt=sn.Ionic.platforms;return null==yt&&(yt=sn.Ionic.platforms=Mt(sn),yt.forEach(Xe=>sn.document.documentElement.classList.add(`plt-${Xe}`))),yt},Mt=sn=>{const yt=at.get("platform");return Object.keys(on).filter(Xe=>{const tt=null==yt?void 0:yt[Xe];return"function"==typeof tt?tt(sn):on[Xe](sn)})},gt=sn=>!!(Gt(sn,/iPad/i)||Gt(sn,/Macintosh/i)&&me(sn)),Rt=sn=>Gt(sn,/android|sink/i),me=sn=>en(sn,"(any-pointer:coarse)"),Ft=sn=>Te(sn)||De(sn),Te=sn=>!!(sn.cordova||sn.phonegap||sn.PhoneGap),De=sn=>{const yt=sn.Capacitor;return!(null==yt||!yt.isNative)},Gt=(sn,yt)=>yt.test(sn.navigator.userAgent),en=(sn,yt)=>{var Xe;return null===(Xe=sn.matchMedia)||void 0===Xe?void 0:Xe.call(sn,yt).matches},on={ipad:gt,iphone:sn=>Gt(sn,/iPhone/i),ios:sn=>Gt(sn,/iPhone|iPod/i)||gt(sn),android:Rt,phablet:sn=>{const yt=sn.innerWidth,Xe=sn.innerHeight,tt=Math.min(yt,Xe),Ye=Math.max(yt,Xe);return tt>390&&tt<520&&Ye>620&&Ye<800},tablet:sn=>{const yt=sn.innerWidth,Xe=sn.innerHeight,tt=Math.min(yt,Xe),Ye=Math.max(yt,Xe);return gt(sn)||(sn=>Rt(sn)&&!Gt(sn,/mobile/i))(sn)||tt>460&&tt<820&&Ye>780&&Ye<1400},cordova:Te,capacitor:De,electron:sn=>Gt(sn,/electron/i),pwa:sn=>{var yt;return!!(null!==(yt=sn.matchMedia)&&void 0!==yt&&yt.call(sn,"(display-mode: standalone)").matches||sn.navigator.standalone)},mobile:me,mobileweb:sn=>me(sn)&&!Ft(sn),desktop:sn=>!me(sn),hybrid:Ft};let Un;const nr=sn=>sn&&(0,E.g)(sn)||Un,_n=(sn={})=>{if(typeof window>"u")return;const yt=window.document,Xe=window,tt=Xe.Ionic=Xe.Ionic||{},Ye={};sn._ael&&(Ye.ael=sn._ael),sn._rel&&(Ye.rel=sn._rel),sn._ce&&(Ye.ce=sn._ce),(0,E.a)(Ye);const _t=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(sn=>{try{const yt=sn.sessionStorage.getItem(ze);return null!==yt?JSON.parse(yt):{}}catch{return{}}})(Xe)),{persistConfig:!1}),tt.config),(sn=>{const yt={};return sn.location.search.slice(1).split("&").map(Xe=>Xe.split("=")).map(([Xe,tt])=>[decodeURIComponent(Xe),decodeURIComponent(tt)]).filter(([Xe])=>((sn,yt)=>sn.substr(0,yt.length)===yt)(Xe,"ionic:")).map(([Xe,tt])=>[Xe.slice(6),tt]).forEach(([Xe,tt])=>{yt[Xe]=tt}),yt})(Xe)),sn);at.reset(_t),at.getBoolean("persistConfig")&&((sn,yt)=>{try{sn.sessionStorage.setItem(ze,JSON.stringify(yt))}catch{return}})(Xe,_t),vt(Xe),tt.config=at,tt.mode=Un=at.get("mode",yt.documentElement.getAttribute("mode")||(Ue(Xe,"ios")?"ios":"md")),at.set("mode",Un),yt.documentElement.setAttribute("mode",Un),yt.documentElement.classList.add(Un),at.getBoolean("_testing")&&at.set("animated",!1);const rn=rr=>{var Hn;return null===(Hn=rr.tagName)||void 0===Hn?void 0:Hn.startsWith("ION-")},Gn=rr=>["ios","md"].includes(rr);(0,E.c)(rr=>{for(;rr;){const Hn=rr.mode||rr.getAttribute("mode");if(Hn){if(Gn(Hn))return Hn;rn(rr)&&console.warn('Invalid ionic mode: "'+Hn+'", expected: "ios" or "md"')}rr=rr.parentElement}return Un})}},3433:(ur,Kt,ae)=>{"use strict";ae.r(Kt),ae.d(Kt,{iosTransitionAnimation:()=>Mt,shadow:()=>Le});var E=ae(4913),he=ae(2325);ae(1848),ae(771);const Ve=gt=>document.querySelector(`${gt}.ion-cloned-element`),Le=gt=>gt.shadowRoot||gt,Be=gt=>{const Jt="ION-TABS"===gt.tagName?gt:gt.querySelector("ion-tabs"),Ot="ion-content ion-header:not(.header-collapse-condense-inactive) ion-title.title-large";if(null!=Jt){const Rt=Jt.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");return null!=Rt?Rt.querySelector(Ot):null}return gt.querySelector(Ot)},ze=(gt,Jt)=>{const Ot="ION-TABS"===gt.tagName?gt:gt.querySelector("ion-tabs");let Rt=[];if(null!=Ot){const Pt=Ot.querySelector("ion-tab:not(.tab-hidden), .ion-page:not(.ion-page-hidden)");null!=Pt&&(Rt=Pt.querySelectorAll("ion-buttons"))}else Rt=gt.querySelectorAll("ion-buttons");for(const Pt of Rt){const hn=Pt.closest("ion-header"),lt=hn&&!hn.classList.contains("header-collapse-condense-inactive"),me=Pt.querySelector("ion-back-button"),st=Pt.classList.contains("buttons-collapse");if(null!==me&&("start"===Pt.slot||""===Pt.slot)&&(st&&lt&&Jt||!st))return me}return null},Ue=(gt,Jt,Ot,Rt,Pt,hn,lt,me,st)=>{var Ft,Te;const De=Jt?`calc(100% - ${Pt.right+4}px)`:Pt.left-4+"px",dt=Jt?"right":"left",mt=Jt?"left":"right",Gt=Jt?"right":"left",en=(null===(Ft=hn.textContent)||void 0===Ft?void 0:Ft.trim())===(null===(Te=me.textContent)||void 0===Te?void 0:Te.trim()),Un=(st.height-xt)/lt.height,nr=en?`scale(${st.width/lt.width}, ${Un})`:`scale(${Un})`,_n="scale(1)",yt=Le(Rt).querySelector("ion-icon").getBoundingClientRect(),Xe=Jt?yt.width/2-(yt.right-Pt.right)+"px":Pt.left-yt.width/2+"px",tt=Jt?`-${window.innerWidth-Pt.right}px`:`${Pt.left}px`,Ye=`${st.top}px`,_t=`${Pt.top}px`,rr=Ot?[{offset:0,transform:`translate3d(${tt}, ${_t}, 0)`},{offset:1,transform:`translate3d(${Xe}, ${Ye}, 0)`}]:[{offset:0,transform:`translate3d(${Xe}, ${Ye}, 0)`},{offset:1,transform:`translate3d(${tt}, ${_t}, 0)`}],gr=Ot?[{offset:0,opacity:1,transform:_n},{offset:1,opacity:0,transform:nr}]:[{offset:0,opacity:0,transform:nr},{offset:1,opacity:1,transform:_n}],qe=Ot?[{offset:0,opacity:1,transform:"scale(1)"},{offset:.2,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:0,transform:"scale(0.6)"}]:[{offset:0,opacity:0,transform:"scale(0.6)"},{offset:.6,opacity:0,transform:"scale(0.6)"},{offset:1,opacity:1,transform:"scale(1)"}],ue=(0,E.c)(),ye=(0,E.c)(),Me=(0,E.c)(),Bt=Ve("ion-back-button"),zt=Le(Bt).querySelector(".button-text"),nn=Le(Bt).querySelector("ion-icon");Bt.text=Rt.text,Bt.mode=Rt.mode,Bt.icon=Rt.icon,Bt.color=Rt.color,Bt.disabled=Rt.disabled,Bt.style.setProperty("display","block"),Bt.style.setProperty("position","fixed"),ye.addElement(nn),ue.addElement(zt),Me.addElement(Bt),Me.beforeStyles({position:"absolute",top:"0px",[Gt]:"0px"}).keyframes(rr),ue.beforeStyles({"transform-origin":`${dt} top`}).beforeAddWrite(()=>{Rt.style.setProperty("display","none"),Bt.style.setProperty(dt,De)}).afterAddWrite(()=>{Rt.style.setProperty("display",""),Bt.style.setProperty("display","none"),Bt.style.removeProperty(dt)}).keyframes(gr),ye.beforeStyles({"transform-origin":`${mt} center`}).keyframes(qe),gt.addAnimation([ue,ye,Me])},vt=(gt,Jt,Ot,Rt,Pt,hn,lt,me)=>{var st,Ft;const Te=Jt?"right":"left",De=Jt?`calc(100% - ${Pt.right}px)`:`${Pt.left}px`,mt=`${Pt.top}px`,en=Jt?`-${window.innerWidth-me.right-8}px`:me.x-8+"px",Un=me.y-2+"px",nr=(null===(st=lt.textContent)||void 0===st?void 0:st.trim())===(null===(Ft=Rt.textContent)||void 0===Ft?void 0:Ft.trim()),sn=me.height/(hn.height-xt),yt="scale(1)",Xe=nr?`scale(${me.width/hn.width}, ${sn})`:`scale(${sn})`,_t=Ot?[{offset:0,opacity:0,transform:`translate3d(${en}, ${Un}, 0) ${Xe}`},{offset:.1,opacity:0},{offset:1,opacity:1,transform:`translate3d(0px, ${mt}, 0) ${yt}`}]:[{offset:0,opacity:.99,transform:`translate3d(0px, ${mt}, 0) ${yt}`},{offset:.6,opacity:0},{offset:1,opacity:0,transform:`translate3d(${en}, ${Un}, 0) ${Xe}`}],rn=Ve("ion-title"),Gn=(0,E.c)();rn.innerText=Rt.innerText,rn.size=Rt.size,rn.color=Rt.color,Gn.addElement(rn),Gn.beforeStyles({"transform-origin":`${Te} top`,height:`${Pt.height}px`,display:"",position:"relative",[Te]:De}).beforeAddWrite(()=>{Rt.style.setProperty("opacity","0")}).afterAddWrite(()=>{Rt.style.setProperty("opacity",""),rn.style.setProperty("display","none")}).keyframes(_t),gt.addAnimation(Gn)},Mt=(gt,Jt)=>{var Ot;try{const Rt="cubic-bezier(0.32,0.72,0,1)",Pt="opacity",hn="transform",lt="0%",st="rtl"===gt.ownerDocument.dir,Ft=st?"-99.5%":"99.5%",Te=st?"33%":"-33%",De=Jt.enteringEl,dt=Jt.leavingEl,mt="back"===Jt.direction,Gt=De.querySelector(":scope > ion-content"),en=De.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *"),on=De.querySelectorAll(":scope > ion-header > ion-toolbar"),Un=(0,E.c)(),nr=(0,E.c)();if(Un.addElement(De).duration((null!==(Ot=Jt.duration)&&void 0!==Ot?Ot:0)||540).easing(Jt.easing||Rt).fill("both").beforeRemoveClass("ion-page-invisible"),dt&&null!=gt){const Xe=(0,E.c)();Xe.addElement(gt),Un.addAnimation(Xe)}if(Gt||0!==on.length||0!==en.length?(nr.addElement(Gt),nr.addElement(en)):nr.addElement(De.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Un.addAnimation(nr),mt?nr.beforeClearStyles([Pt]).fromTo("transform",`translateX(${Te})`,`translateX(${lt})`).fromTo(Pt,.8,1):nr.beforeClearStyles([Pt]).fromTo("transform",`translateX(${Ft})`,`translateX(${lt})`),Gt){const Xe=Le(Gt).querySelector(".transition-effect");if(Xe){const tt=Xe.querySelector(".transition-cover"),Ye=Xe.querySelector(".transition-shadow"),_t=(0,E.c)(),rn=(0,E.c)(),Gn=(0,E.c)();_t.addElement(Xe).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),rn.addElement(tt).beforeClearStyles([Pt]).fromTo(Pt,0,.1),Gn.addElement(Ye).beforeClearStyles([Pt]).fromTo(Pt,.03,.7),_t.addAnimation([rn,Gn]),nr.addAnimation([_t])}}const _n=De.querySelector("ion-header.header-collapse-condense"),{forward:sn,backward:yt}=((gt,Jt,Ot,Rt,Pt)=>{const hn=ze(Rt,Ot),lt=Be(Pt),me=Be(Rt),st=ze(Pt,Ot),Ft=null!==hn&&null!==lt&&!Ot,Te=null!==me&&null!==st&&Ot;if(Ft){const De=lt.getBoundingClientRect(),dt=hn.getBoundingClientRect(),mt=Le(hn).querySelector(".button-text"),Gt=mt.getBoundingClientRect(),on=Le(lt).querySelector(".toolbar-title").getBoundingClientRect();vt(gt,Jt,Ot,lt,De,on,mt,Gt),Ue(gt,Jt,Ot,hn,dt,mt,Gt,lt,on)}else if(Te){const De=me.getBoundingClientRect(),dt=st.getBoundingClientRect(),mt=Le(st).querySelector(".button-text"),Gt=mt.getBoundingClientRect(),on=Le(me).querySelector(".toolbar-title").getBoundingClientRect();vt(gt,Jt,Ot,me,De,on,mt,Gt),Ue(gt,Jt,Ot,st,dt,mt,Gt,me,on)}return{forward:Ft,backward:Te}})(Un,st,mt,De,dt);if(on.forEach(Xe=>{const tt=(0,E.c)();tt.addElement(Xe),Un.addAnimation(tt);const Ye=(0,E.c)();Ye.addElement(Xe.querySelector("ion-title"));const _t=(0,E.c)(),rn=Array.from(Xe.querySelectorAll("ion-buttons,[menuToggle]")),Gn=Xe.closest("ion-header"),rr=null==Gn?void 0:Gn.classList.contains("header-collapse-condense-inactive");let Hn;Hn=rn.filter(mt?qe=>{const ue=qe.classList.contains("buttons-collapse");return ue&&!rr||!ue}:qe=>!qe.classList.contains("buttons-collapse")),_t.addElement(Hn);const mr=(0,E.c)();mr.addElement(Xe.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])"));const gr=(0,E.c)();gr.addElement(Le(Xe).querySelector(".toolbar-background"));const ei=(0,E.c)(),An=Xe.querySelector("ion-back-button");if(An&&ei.addElement(An),tt.addAnimation([Ye,_t,mr,gr,ei]),_t.fromTo(Pt,.01,1),mr.fromTo(Pt,.01,1),mt)rr||Ye.fromTo("transform",`translateX(${Te})`,`translateX(${lt})`).fromTo(Pt,.01,1),mr.fromTo("transform",`translateX(${Te})`,`translateX(${lt})`),ei.fromTo(Pt,.01,1);else if(_n||Ye.fromTo("transform",`translateX(${Ft})`,`translateX(${lt})`).fromTo(Pt,.01,1),mr.fromTo("transform",`translateX(${Ft})`,`translateX(${lt})`),gr.beforeClearStyles([Pt,"transform"]),(null==Gn?void 0:Gn.translucent)?gr.fromTo("transform",st?"translateX(-100%)":"translateX(100%)","translateX(0px)"):gr.fromTo(Pt,.01,"var(--opacity)"),sn||ei.fromTo(Pt,.01,1),An&&!sn){const ue=(0,E.c)();ue.addElement(Le(An).querySelector(".button-text")).fromTo("transform",st?"translateX(-100px)":"translateX(100px)","translateX(0px)"),tt.addAnimation(ue)}}),dt){const Xe=(0,E.c)(),tt=dt.querySelector(":scope > ion-content"),Ye=dt.querySelectorAll(":scope > ion-header > ion-toolbar"),_t=dt.querySelectorAll(":scope > ion-header > *:not(ion-toolbar), :scope > ion-footer > *");if(tt||0!==Ye.length||0!==_t.length?(Xe.addElement(tt),Xe.addElement(_t)):Xe.addElement(dt.querySelector(":scope > .ion-page, :scope > ion-nav, :scope > ion-tabs")),Un.addAnimation(Xe),mt){Xe.beforeClearStyles([Pt]).fromTo("transform",`translateX(${lt})`,st?"translateX(-100%)":"translateX(100%)");const rn=(0,he.g)(dt);Un.afterAddWrite(()=>{"normal"===Un.getDirection()&&rn.style.setProperty("display","none")})}else Xe.fromTo("transform",`translateX(${lt})`,`translateX(${Te})`).fromTo(Pt,1,.8);if(tt){const rn=Le(tt).querySelector(".transition-effect");if(rn){const Gn=rn.querySelector(".transition-cover"),rr=rn.querySelector(".transition-shadow"),Hn=(0,E.c)(),mr=(0,E.c)(),gr=(0,E.c)();Hn.addElement(rn).beforeStyles({opacity:"1",display:"block"}).afterStyles({opacity:"",display:""}),mr.addElement(Gn).beforeClearStyles([Pt]).fromTo(Pt,.1,0),gr.addElement(rr).beforeClearStyles([Pt]).fromTo(Pt,.7,.03),Hn.addAnimation([mr,gr]),Xe.addAnimation([Hn])}}Ye.forEach(rn=>{const Gn=(0,E.c)();Gn.addElement(rn);const rr=(0,E.c)();rr.addElement(rn.querySelector("ion-title"));const Hn=(0,E.c)(),mr=rn.querySelectorAll("ion-buttons,[menuToggle]"),gr=rn.closest("ion-header"),ei=null==gr?void 0:gr.classList.contains("header-collapse-condense-inactive"),An=Array.from(mr).filter(zt=>{const nn=zt.classList.contains("buttons-collapse");return nn&&!ei||!nn});Hn.addElement(An);const qe=(0,E.c)(),ue=rn.querySelectorAll(":scope > *:not(ion-title):not(ion-buttons):not([menuToggle])");ue.length>0&&qe.addElement(ue);const ye=(0,E.c)();ye.addElement(Le(rn).querySelector(".toolbar-background"));const Me=(0,E.c)(),Bt=rn.querySelector("ion-back-button");if(Bt&&Me.addElement(Bt),Gn.addAnimation([rr,Hn,qe,Me,ye]),Un.addAnimation(Gn),Me.fromTo(Pt,.99,0),Hn.fromTo(Pt,.99,0),qe.fromTo(Pt,.99,0),mt){if(ei||rr.fromTo("transform",`translateX(${lt})`,st?"translateX(-100%)":"translateX(100%)").fromTo(Pt,.99,0),qe.fromTo("transform",`translateX(${lt})`,st?"translateX(-100%)":"translateX(100%)"),ye.beforeClearStyles([Pt,"transform"]),(null==gr?void 0:gr.translucent)?ye.fromTo("transform","translateX(0px)",st?"translateX(-100%)":"translateX(100%)"):ye.fromTo(Pt,"var(--opacity)",0),Bt&&!yt){const nn=(0,E.c)();nn.addElement(Le(Bt).querySelector(".button-text")).fromTo("transform",`translateX(${lt})`,`translateX(${(st?-124:124)+"px"})`),Gn.addAnimation(nn)}}else ei||rr.fromTo("transform",`translateX(${lt})`,`translateX(${Te})`).fromTo(Pt,.99,0).afterClearStyles([hn,Pt]),qe.fromTo("transform",`translateX(${lt})`,`translateX(${Te})`).afterClearStyles([hn,Pt]),Me.afterClearStyles([Pt]),rr.afterClearStyles([Pt]),Hn.afterClearStyles([Pt])})}return Un}catch(Rt){throw Rt}},xt=10},6615:(ur,Kt,ae)=>{"use strict";ae.r(Kt),ae.d(Kt,{mdTransitionAnimation:()=>ge});var E=ae(4913),he=ae(2325);ae(1848),ae(771);const ge=(Ve,Le)=>{var Be,ze,wt;const Mt="back"===Le.direction,gt=Le.leavingEl,Jt=(0,he.g)(Le.enteringEl),Ot=Jt.querySelector("ion-toolbar"),Rt=(0,E.c)();if(Rt.addElement(Jt).fill("both").beforeRemoveClass("ion-page-invisible"),Mt?Rt.duration((null!==(Be=Le.duration)&&void 0!==Be?Be:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)"):Rt.duration((null!==(ze=Le.duration)&&void 0!==ze?ze:0)||280).easing("cubic-bezier(0.36,0.66,0.04,1)").fromTo("transform","translateY(40px)","translateY(0px)").fromTo("opacity",.01,1),Ot){const Pt=(0,E.c)();Pt.addElement(Ot),Rt.addAnimation(Pt)}if(gt&&Mt){Rt.duration((null!==(wt=Le.duration)&&void 0!==wt?wt:0)||200).easing("cubic-bezier(0.47,0,0.745,0.715)");const Pt=(0,E.c)();Pt.addElement((0,he.g)(gt)).onFinish(hn=>{1===hn&&Pt.elements.length>0&&Pt.elements[0].style.setProperty("display","none")}).fromTo("transform","translateY(0px)","translateY(40px)").fromTo("opacity",1,0),Rt.addAnimation(Pt)}return Rt}},9207:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{B:()=>rr,G:()=>Hn,O:()=>mr,a:()=>vt,b:()=>Mt,c:()=>Ot,d:()=>gr,e:()=>ei,f:()=>nr,g:()=>sn,h:()=>tt,i:()=>_t,j:()=>Pt,k:()=>hn,m:()=>gt,n:()=>wt,o:()=>st,q:()=>on,s:()=>Gn,t:()=>Rt});var E=ae(5861),he=ae(1848),at=ae(2905),Ie=ae(3254),ge=ae(4393),Ve=ae(512),Le=ae(2400);let Be=0,ze=0;const wt=new WeakMap,Ue=An=>({create:qe=>lt(An,qe),dismiss:(qe,ue,ye)=>mt(document,qe,ue,An,ye),getTop:()=>(0,E.Z)(function*(){return on(document,An)})()}),vt=Ue("ion-alert"),Mt=Ue("ion-action-sheet"),gt=Ue("ion-modal"),Ot=Ue("ion-popover"),Rt=Ue("ion-toast"),Pt=An=>{typeof document<"u"&&dt(document);const qe=Be++;An.overlayIndex=qe},hn=An=>(An.hasAttribute("id")||(An.id="ion-overlay-"+ ++ze),An.id),lt=(An,qe)=>typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(An).then(()=>{const ue=document.createElement(An);return ue.classList.add("overlay-hidden"),Object.assign(ue,Object.assign(Object.assign({},qe),{hasController:!0})),yt(document).appendChild(ue),new Promise(ye=>(0,Ve.c)(ue,ye))}):Promise.resolve(),me='[tabindex]:not([tabindex^="-"]):not([hidden]):not([disabled]), input:not([type=hidden]):not([tabindex^="-"]):not([hidden]):not([disabled]), textarea:not([tabindex^="-"]):not([hidden]):not([disabled]), button:not([tabindex^="-"]):not([hidden]):not([disabled]), select:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable:not([tabindex^="-"]):not([hidden]):not([disabled]), .ion-focusable[disabled="false"]:not([tabindex^="-"]):not([hidden])',st=(An,qe)=>{let ue=An.querySelector(me);const ye=null==ue?void 0:ue.shadowRoot;ye&&(ue=ye.querySelector(me)||ue),ue?(0,Ve.f)(ue):qe.focus()},Te=(An,qe)=>{const ue=Array.from(An.querySelectorAll(me));let ye=ue.length>0?ue[ue.length-1]:null;const Me=null==ye?void 0:ye.shadowRoot;Me&&(ye=Me.querySelector(me)||ye),ye?ye.focus():qe.focus()},dt=An=>{0===Be&&(Be=1,An.addEventListener("focus",qe=>{((An,qe)=>{const ue=on(qe,"ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover"),ye=An.target;ue&&ye&&!ue.classList.contains("ion-disable-focus-trap")&&(ue.shadowRoot?(()=>{if(ue.contains(ye))ue.lastFocus=ye;else{const zt=ue.lastFocus;st(ue,ue),zt===qe.activeElement&&Te(ue,ue),ue.lastFocus=qe.activeElement}})():(()=>{if(ue===ye)ue.lastFocus=void 0;else{const zt=(0,Ve.g)(ue);if(!zt.contains(ye))return;const nn=zt.querySelector(".ion-overlay-wrapper");if(!nn)return;if(nn.contains(ye)||ye===zt.querySelector("ion-backdrop"))ue.lastFocus=ye;else{const In=ue.lastFocus;st(nn,ue),In===qe.activeElement&&Te(nn,ue),ue.lastFocus=qe.activeElement}}})())})(qe,An)},!0),An.addEventListener("ionBackButton",qe=>{const ue=on(An);null!=ue&&ue.backdropDismiss&&qe.detail.register(ge.OVERLAY_BACK_BUTTON_PRIORITY,()=>ue.dismiss(void 0,rr))}),An.addEventListener("keydown",qe=>{if("Escape"===qe.key){const ue=on(An);null!=ue&&ue.backdropDismiss&&ue.dismiss(void 0,rr)}}))},mt=(An,qe,ue,ye,Me)=>{const Bt=on(An,ye,Me);return Bt?Bt.dismiss(qe,ue):Promise.reject("overlay does not exist")},en=(An,qe)=>((An,qe)=>(void 0===qe&&(qe="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker,ion-popover,ion-toast"),Array.from(An.querySelectorAll(qe)).filter(ue=>ue.overlayIndex>0)))(An,qe).filter(ue=>!(An=>An.classList.contains("overlay-hidden"))(ue)),on=(An,qe,ue)=>{const ye=en(An,qe);return void 0===ue?ye[ye.length-1]:ye.find(Me=>Me.id===ue)},Un=(An=!1)=>{const ue=yt(document).querySelector("ion-router-outlet, ion-nav, #ion-view-container-root");ue&&(An?ue.setAttribute("aria-hidden","true"):ue.removeAttribute("aria-hidden"))},nr=function(){var An=(0,E.Z)(function*(qe,ue,ye,Me,Bt){var zt,nn;if(qe.presented)return;Un(!0),qe.presented=!0,qe.willPresent.emit(),null===(zt=qe.willPresentShorthand)||void 0===zt||zt.emit();const In=(0,at.b)(qe),Xt=qe.enterAnimation?qe.enterAnimation:at.c.get(ue,"ios"===In?ye:Me);(yield Xe(qe,Xt,qe.el,Bt))&&(qe.didPresent.emit(),null===(nn=qe.didPresentShorthand)||void 0===nn||nn.emit()),"ION-TOAST"!==qe.el.tagName&&_n(qe.el),qe.keyboardClose&&(null===document.activeElement||!qe.el.contains(document.activeElement))&&qe.el.focus()});return function(ue,ye,Me,Bt,zt){return An.apply(this,arguments)}}(),_n=function(){var An=(0,E.Z)(function*(qe){let ue=document.activeElement;if(!ue)return;const ye=null==ue?void 0:ue.shadowRoot;ye&&(ue=ye.querySelector(me)||ue),yield qe.onDidDismiss(),ue.focus()});return function(ue){return An.apply(this,arguments)}}(),sn=function(){var An=(0,E.Z)(function*(qe,ue,ye,Me,Bt,zt,nn){var In,Xt;if(!qe.presented)return!1;void 0!==he.d&&1===en(he.d).length&&Un(!1),qe.presented=!1;try{qe.el.style.setProperty("pointer-events","none"),qe.willDismiss.emit({data:ue,role:ye}),null===(In=qe.willDismissShorthand)||void 0===In||In.emit({data:ue,role:ye});const Zn=(0,at.b)(qe),cn=qe.leaveAnimation?qe.leaveAnimation:at.c.get(Me,"ios"===Zn?Bt:zt);ye!==Hn&&(yield Xe(qe,cn,qe.el,nn)),qe.didDismiss.emit({data:ue,role:ye}),null===(Xt=qe.didDismissShorthand)||void 0===Xt||Xt.emit({data:ue,role:ye}),wt.delete(qe),qe.el.classList.add("overlay-hidden"),qe.el.style.removeProperty("pointer-events"),void 0!==qe.el.lastFocus&&(qe.el.lastFocus=void 0)}catch(Zn){console.error(Zn)}return qe.el.remove(),!0});return function(ue,ye,Me,Bt,zt,nn,In){return An.apply(this,arguments)}}(),yt=An=>An.querySelector("ion-app")||An.body,Xe=function(){var An=(0,E.Z)(function*(qe,ue,ye,Me){ye.classList.remove("overlay-hidden");const zt=ue(qe.el,Me);(!qe.animated||!at.c.getBoolean("animated",!0))&&zt.duration(0),qe.keyboardClose&&zt.beforeAddWrite(()=>{const In=ye.ownerDocument.activeElement;null!=In&&In.matches("input,ion-input, ion-textarea")&&In.blur()});const nn=wt.get(qe)||[];return wt.set(qe,[...nn,zt]),yield zt.play(),!0});return function(ue,ye,Me,Bt){return An.apply(this,arguments)}}(),tt=(An,qe)=>{let ue;const ye=new Promise(Me=>ue=Me);return Ye(An,qe,Me=>{ue(Me.detail)}),ye},Ye=(An,qe,ue)=>{const ye=Me=>{(0,Ve.b)(An,qe,ye),ue(Me)};(0,Ve.a)(An,qe,ye)},_t=An=>"cancel"===An||An===rr,rn=An=>An(),Gn=(An,qe)=>{if("function"==typeof An)return at.c.get("_zoneGate",rn)(()=>{try{return An(qe)}catch(ye){throw ye}})},rr="backdrop",Hn="gesture",mr=39,gr=An=>{let ue,qe=!1;const ye=(0,Ie.C)(),Me=(nn=!1)=>{if(ue&&!nn)return{delegate:ue,inline:qe};const{el:In,hasController:Xt,delegate:Zn}=An;return qe=null!==In.parentNode&&!Xt,ue=qe?Zn||ye:Zn,{inline:qe,delegate:ue}};return{attachViewToDom:function(){var nn=(0,E.Z)(function*(In){const{delegate:Xt}=Me(!0);if(Xt)return yield Xt.attachViewToDom(An.el,In);const{hasController:Zn}=An;if(Zn&&void 0!==In)throw new Error("framework delegate is missing");return null});return function(Xt){return nn.apply(this,arguments)}}(),removeViewFromDom:()=>{const{delegate:nn}=Me();nn&&void 0!==An.el&&nn.removeViewFromDom(An.el.parentElement,An.el)}}},ei=()=>{let An;const qe=()=>{An&&(An(),An=void 0)};return{addClickListener:(ye,Me)=>{qe();const Bt=void 0!==Me?document.getElementById(Me):null;Bt?An=((nn,In)=>{const Xt=()=>{In.present()};return nn.addEventListener("click",Xt),()=>{nn.removeEventListener("click",Xt)}})(Bt,ye):(0,Le.p)(`A trigger element with the ID "${Me}" was not found in the DOM. The trigger element must be in the DOM when the "trigger" property is set on an overlay component.`,ye)},removeClickListener:qe}}},2014:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{K:()=>Ve});var E=ae(5861),he=ae(9422),at=ae.n(he);const Ie={SecureStorage:"ionicSecureStorage",IndexedDB:at().INDEXEDDB,LocalStorage:at().LOCALSTORAGE},ge={name:"_ionicstorage",storeName:"_ionickv",dbKey:"_ionickey",driverOrder:[Ie.SecureStorage,Ie.IndexedDB,Ie.LocalStorage]};class Ve{constructor(Be=ge){this._db=null,this._secureStorageDriver=null;const ze=Object.assign({},ge,Be||{});this._config=ze}create(){var Be=this;return(0,E.Z)(function*(){const ze=at().createInstance(Be._config);return Be._db=ze,yield ze.setDriver(Be._config.driverOrder||[]),Be})()}defineDriver(Be){var ze=this;return(0,E.Z)(function*(){return Be._driver===Ie.SecureStorage&&(ze._secureStorageDriver=Be),at().defineDriver(Be)})()}get driver(){var Be;return(null===(Be=this._db)||void 0===Be?void 0:Be.driver())||null}assertDb(){if(!this._db)throw new Error("Database not created. Must call create() first");return this._db}get(Be){return this.assertDb().getItem(Be)}set(Be,ze){return this.assertDb().setItem(Be,ze)}remove(Be){return this.assertDb().removeItem(Be)}clear(){return this.assertDb().clear()}length(){return this.assertDb().length()}keys(){return this.assertDb().keys()}forEach(Be){return this.assertDb().iterate(Be)}setEncryptionKey(Be){var ze;if(!this._secureStorageDriver)throw new Error("@ionic-enterprise/secure-storage not installed. Encryption support not available");null===(ze=this._secureStorageDriver)||void 0===ze||ze.setEncryptionKey(Be)}}},9900:(ur,Kt,ae)=>{"use strict";var E=ae(6593),he=ae(9212),at=ae(4653),Ie=ae(7346),ge=ae(1929);const Ve=[{path:"home/:id",loadChildren:()=>ae.e(6538).then(ae.bind(ae,6538)).then(l=>l.HomePageModule)},{path:"login",loadChildren:()=>ae.e(3687).then(ae.bind(ae,3687)).then(l=>l.LoginPageModule)},{path:"",redirectTo:"login",pathMatch:"full"}];let Le=(()=>{var l;class r{}return(l=r).\u0275fac=function(h){return new(h||l)},l.\u0275mod=he.oAB({type:l}),l.\u0275inj=he.cJS({imports:[at.Bz.forRoot(Ve,{preloadingStrategy:at.wm}),at.Bz]}),r})(),Be=(()=>{var l;class r{constructor(){}}return(l=r).\u0275fac=function(h){return new(h||l)},l.\u0275cmp=he.Xpm({type:l,selectors:[["app-root"]],decls:2,vars:0,template:function(h,m){1&h&&(he.TgZ(0,"ion-app"),he._UZ(1,"ion-router-outlet"),he.qZA())},dependencies:[ge.dr,ge.jP]}),r})();var ze=ae(5861),wt=ae(6814),Ue=ae(2014);const vt=new he.OlP("STORAGE_CONFIG_TOKEN");class Mt extends Ue.K{constructor(){super()}create(){var r=this;return(0,ze.Z)(function*(){return r})()}defineDriver(){return(0,ze.Z)(function*(){})()}get driver(){return"noop"}get(r){return(0,ze.Z)(function*(){return null})()}set(r,o){return(0,ze.Z)(function*(){})()}remove(r){return(0,ze.Z)(function*(){})()}clear(){return(0,ze.Z)(function*(){})()}length(){return(0,ze.Z)(function*(){return 0})()}keys(){return(0,ze.Z)(function*(){return[]})()}forEach(r){return(0,ze.Z)(function*(){})()}setEncryptionKey(r){}}function xt(l,r){return(0,wt.PM)(l)?new Mt:new Ue.K(r)}let gt=(()=>{class l{static forRoot(o=null){return{ngModule:l,providers:[{provide:vt,useValue:o},{provide:Ue.K,useFactory:xt,deps:[he.Lbi,vt]}]}}}return l.\u0275fac=function(o){return new(o||l)},l.\u0275mod=he.oAB({type:l}),l.\u0275inj=he.cJS({}),l})();function Jt(l){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(l)}function Pt(l,r,o){return(r=function Rt(l){var r=function Ot(l,r){if("object"!==Jt(l)||null===l)return l;var o=l[Symbol.toPrimitive];if(void 0!==o){var h=o.call(l,r||"default");if("object"!==Jt(h))return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(l)}(l,"string");return"symbol"===Jt(r)?r:String(r)}(r))in l?Object.defineProperty(l,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):l[r]=o,l}const st=function(l){const r=[];let o=0;for(let h=0;h<l.length;h++){let m=l.charCodeAt(h);m<128?r[o++]=m:m<2048?(r[o++]=m>>6|192,r[o++]=63&m|128):55296==(64512&m)&&h+1<l.length&&56320==(64512&l.charCodeAt(h+1))?(m=65536+((1023&m)<<10)+(1023&l.charCodeAt(++h)),r[o++]=m>>18|240,r[o++]=m>>12&63|128,r[o++]=m>>6&63|128,r[o++]=63&m|128):(r[o++]=m>>12|224,r[o++]=m>>6&63|128,r[o++]=63&m|128)}return r},Te={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(l,r){if(!Array.isArray(l))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=r?this.byteToCharMapWebSafe_:this.byteToCharMap_,h=[];for(let m=0;m<l.length;m+=3){const x=l[m],T=m+1<l.length,k=T?l[m+1]:0,U=m+2<l.length,te=U?l[m+2]:0;let Tt=(15&k)<<2|te>>6,un=63&te;U||(un=64,T||(Tt=64)),h.push(o[x>>2],o[(3&x)<<4|k>>4],o[Tt],o[un])}return h.join("")},encodeString(l,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(l):this.encodeByteArray(st(l),r)},decodeString(l,r){return this.HAS_NATIVE_SUPPORT&&!r?atob(l):function(l){const r=[];let o=0,h=0;for(;o<l.length;){const m=l[o++];if(m<128)r[h++]=String.fromCharCode(m);else if(m>191&&m<224){const x=l[o++];r[h++]=String.fromCharCode((31&m)<<6|63&x)}else if(m>239&&m<365){const U=((7&m)<<18|(63&l[o++])<<12|(63&l[o++])<<6|63&l[o++])-65536;r[h++]=String.fromCharCode(55296+(U>>10)),r[h++]=String.fromCharCode(56320+(1023&U))}else{const x=l[o++],T=l[o++];r[h++]=String.fromCharCode((15&m)<<12|(63&x)<<6|63&T)}}return r.join("")}(this.decodeStringToByteArray(l,r))},decodeStringToByteArray(l,r){this.init_();const o=r?this.charToByteMapWebSafe_:this.charToByteMap_,h=[];for(let m=0;m<l.length;){const x=o[l.charAt(m++)],k=m<l.length?o[l.charAt(m)]:0;++m;const te=m<l.length?o[l.charAt(m)]:64;++m;const Oe=m<l.length?o[l.charAt(m)]:64;if(++m,null==x||null==k||null==te||null==Oe)throw new De;h.push(x<<2|k>>4),64!==te&&(h.push(k<<4&240|te>>2),64!==Oe&&h.push(te<<6&192|Oe))}return h},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let l=0;l<this.ENCODED_VALS.length;l++)this.byteToCharMap_[l]=this.ENCODED_VALS.charAt(l),this.charToByteMap_[this.byteToCharMap_[l]]=l,this.byteToCharMapWebSafe_[l]=this.ENCODED_VALS_WEBSAFE.charAt(l),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[l]]=l,l>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(l)]=l,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(l)]=l)}}};class De extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mt=function(l){return function(l){const r=st(l);return Te.encodeByteArray(r,!0)}(l).replace(/\./g,"")},Gt=function(l){try{return Te.decodeString(l,!0)}catch(r){console.error("base64Decode failed: ",r)}return null},Xe=()=>{try{return function nr(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const l=process.env.__FIREBASE_DEFAULTS__;return l?JSON.parse(l):void 0})()||(()=>{if(typeof document>"u")return;let l;try{l=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const r=l&&Gt(l[1]);return r&&JSON.parse(r)})()}catch(l){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${l}`)}},_t=()=>{var l;return null===(l=Xe())||void 0===l?void 0:l.config};class Gn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}wrapCallback(r){return(o,h)=>{o?this.reject(o):this.resolve(h),"function"==typeof r&&(this.promise.catch(()=>{}),1===r.length?r(o):r(o,h))}}}function Hn(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class cn extends Error{constructor(r,o,h){super(o),this.code=r,this.customData=h,this.name="FirebaseError",Object.setPrototypeOf(this,cn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dn.prototype.create)}}class Dn{constructor(r,o,h){this.service=r,this.serviceName=o,this.errors=h}create(r,...o){const h=o[0]||{},m=`${this.service}/${r}`,x=this.errors[r],T=x?function ir(l,r){return l.replace(bi,(o,h)=>{const m=r[h];return null!=m?String(m):`<${h}?>`})}(x,h):"Error";return new cn(m,`${this.serviceName}: ${T} (${m}).`,h)}}const bi=/\{\$([^}]+)}/g;function Gr(l,r){if(l===r)return!0;const o=Object.keys(l),h=Object.keys(r);for(const m of o){if(!h.includes(m))return!1;const x=l[m],T=r[m];if(Mo(x)&&Mo(T)){if(!Gr(x,T))return!1}else if(x!==T)return!1}for(const m of h)if(!o.includes(m))return!1;return!0}function Mo(l){return null!==l&&"object"==typeof l}function an(l){const r=[];for(const[o,h]of Object.entries(l))Array.isArray(h)?h.forEach(m=>{r.push(encodeURIComponent(o)+"="+encodeURIComponent(m))}):r.push(encodeURIComponent(o)+"="+encodeURIComponent(h));return r.length?"&"+r.join("&"):""}class Ln{constructor(r,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{r(this)}).catch(h=>{this.error(h)})}next(r){this.forEachObserver(o=>{o.next(r)})}error(r){this.forEachObserver(o=>{o.error(r)}),this.close(r)}complete(){this.forEachObserver(r=>{r.complete()}),this.close()}subscribe(r,o,h){let m;if(void 0===r&&void 0===o&&void 0===h)throw new Error("Missing Observer.");m=function Ke(l,r){if("object"!=typeof l||null===l)return!1;for(const o of r)if(o in l&&"function"==typeof l[o])return!0;return!1}(r,["next","error","complete"])?r:{next:r,error:o,complete:h},void 0===m.next&&(m.next=ot),void 0===m.error&&(m.error=ot),void 0===m.complete&&(m.complete=ot);const x=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?m.error(this.finalError):m.complete()}catch{}}),this.observers.push(m),x}unsubscribeOne(r){void 0===this.observers||void 0===this.observers[r]||(delete this.observers[r],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(r){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,r)}sendOne(r,o){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[r])try{o(this.observers[r])}catch(h){typeof console<"u"&&console.error&&console.error(h)}})}close(r){this.finalized||(this.finalized=!0,void 0!==r&&(this.finalError=r),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ot(){}function ko(l){return l&&l._delegate?l._delegate:l}class es{constructor(r,o,h){this.name=r,this.instanceFactory=o,this.type=h,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(r){return this.instantiationMode=r,this}setMultipleInstances(r){return this.multipleInstances=r,this}setServiceProps(r){return this.serviceProps=r,this}setInstanceCreatedCallback(r){return this.onInstanceCreated=r,this}}const ts="[DEFAULT]";class fo{constructor(r,o){this.name=r,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(r){const o=this.normalizeInstanceIdentifier(r);if(!this.instancesDeferred.has(o)){const h=new Gn;if(this.instancesDeferred.set(o,h),this.isInitialized(o)||this.shouldAutoInitialize())try{const m=this.getOrInitializeService({instanceIdentifier:o});m&&h.resolve(m)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(r){var o;const h=this.normalizeInstanceIdentifier(null==r?void 0:r.identifier),m=null!==(o=null==r?void 0:r.optional)&&void 0!==o&&o;if(!this.isInitialized(h)&&!this.shouldAutoInitialize()){if(m)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:h})}catch(x){if(m)return null;throw x}}getComponent(){return this.component}setComponent(r){if(r.name!==this.name)throw Error(`Mismatching Component ${r.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=r,this.shouldAutoInitialize()){if(function Fs(l){return"EAGER"===l.instantiationMode}(r))try{this.getOrInitializeService({instanceIdentifier:ts})}catch{}for(const[o,h]of this.instancesDeferred.entries()){const m=this.normalizeInstanceIdentifier(o);try{const x=this.getOrInitializeService({instanceIdentifier:m});h.resolve(x)}catch{}}}}clearInstance(r=ts){this.instancesDeferred.delete(r),this.instancesOptions.delete(r),this.instances.delete(r)}delete(){var r=this;return(0,ze.Z)(function*(){const o=Array.from(r.instances.values());yield Promise.all([...o.filter(h=>"INTERNAL"in h).map(h=>h.INTERNAL.delete()),...o.filter(h=>"_delete"in h).map(h=>h._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(r=ts){return this.instances.has(r)}getOptions(r=ts){return this.instancesOptions.get(r)||{}}initialize(r={}){const{options:o={}}=r,h=this.normalizeInstanceIdentifier(r.instanceIdentifier);if(this.isInitialized(h))throw Error(`${this.name}(${h}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const m=this.getOrInitializeService({instanceIdentifier:h,options:o});for(const[x,T]of this.instancesDeferred.entries())h===this.normalizeInstanceIdentifier(x)&&T.resolve(m);return m}onInit(r,o){var h;const m=this.normalizeInstanceIdentifier(o),x=null!==(h=this.onInitCallbacks.get(m))&&void 0!==h?h:new Set;x.add(r),this.onInitCallbacks.set(m,x);const T=this.instances.get(m);return T&&r(T,m),()=>{x.delete(r)}}invokeOnInitCallbacks(r,o){const h=this.onInitCallbacks.get(o);if(h)for(const m of h)try{m(r,o)}catch{}}getOrInitializeService({instanceIdentifier:r,options:o={}}){let h=this.instances.get(r);if(!h&&this.component&&(h=this.component.instanceFactory(this.container,{instanceIdentifier:(l=r,l===ts?void 0:l),options:o}),this.instances.set(r,h),this.instancesOptions.set(r,o),this.invokeOnInitCallbacks(h,r),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,r,h)}catch{}var l;return h||null}normalizeInstanceIdentifier(r=ts){return this.component?this.component.multipleInstances?r:ts:r}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ns{constructor(r){this.name=r,this.providers=new Map}addComponent(r){const o=this.getProvider(r.name);if(o.isComponentSet())throw new Error(`Component ${r.name} has already been registered with ${this.name}`);o.setComponent(r)}addOrOverwriteComponent(r){this.getProvider(r.name).isComponentSet()&&this.providers.delete(r.name),this.addComponent(r)}getProvider(r){if(this.providers.has(r))return this.providers.get(r);const o=new fo(r,this);return this.providers.set(r,o),o}getProviders(){return Array.from(this.providers.values())}}const po=[];var ti=function(l){return l[l.DEBUG=0]="DEBUG",l[l.VERBOSE=1]="VERBOSE",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.SILENT=5]="SILENT",l}(ti||{});const ds={debug:ti.DEBUG,verbose:ti.VERBOSE,info:ti.INFO,warn:ti.WARN,error:ti.ERROR,silent:ti.SILENT},Qi=ti.INFO,pi={[ti.DEBUG]:"log",[ti.VERBOSE]:"log",[ti.INFO]:"info",[ti.WARN]:"warn",[ti.ERROR]:"error"},xs=(l,r,...o)=>{if(r<l.logLevel)return;const h=(new Date).toISOString(),m=pi[r];if(!m)throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`);console[m](`[${h}]  ${l.name}:`,...o)};class Wi{constructor(r){this.name=r,this._logLevel=Qi,this._logHandler=xs,this._userLogHandler=null,po.push(this)}get logLevel(){return this._logLevel}set logLevel(r){if(!(r in ti))throw new TypeError(`Invalid value "${r}" assigned to \`logLevel\``);this._logLevel=r}setLogLevel(r){this._logLevel="string"==typeof r?ds[r]:r}get logHandler(){return this._logHandler}set logHandler(r){if("function"!=typeof r)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=r}get userLogHandler(){return this._userLogHandler}set userLogHandler(r){this._userLogHandler=r}debug(...r){this._userLogHandler&&this._userLogHandler(this,ti.DEBUG,...r),this._logHandler(this,ti.DEBUG,...r)}log(...r){this._userLogHandler&&this._userLogHandler(this,ti.VERBOSE,...r),this._logHandler(this,ti.VERBOSE,...r)}info(...r){this._userLogHandler&&this._userLogHandler(this,ti.INFO,...r),this._logHandler(this,ti.INFO,...r)}warn(...r){this._userLogHandler&&this._userLogHandler(this,ti.WARN,...r),this._logHandler(this,ti.WARN,...r)}error(...r){this._userLogHandler&&this._userLogHandler(this,ti.ERROR,...r),this._logHandler(this,ti.ERROR,...r)}}const Vs=(l,r)=>r.some(o=>l instanceof o);let Se,Et;const ne=new WeakMap,Z=new WeakMap,_e=new WeakMap,We=new WeakMap,Ct=new WeakMap;let ce={get(l,r,o){if(l instanceof IDBTransaction){if("done"===r)return Z.get(l);if("objectStoreNames"===r)return l.objectStoreNames||_e.get(l);if("store"===r)return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return bt(l[r])},set:(l,r,o)=>(l[r]=o,!0),has:(l,r)=>l instanceof IDBTransaction&&("done"===r||"store"===r)||r in l};function $t(l){return"function"==typeof l?function ct(l){return l!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function re(){return Et||(Et=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(l)?function(...r){return l.apply(fn(this),r),bt(ne.get(this))}:function(...r){return bt(l.apply(fn(this),r))}:function(r,...o){const h=l.call(fn(this),r,...o);return _e.set(h,r.sort?r.sort():[r]),bt(h)}}(l):(l instanceof IDBTransaction&&function q(l){if(Z.has(l))return;const r=new Promise((o,h)=>{const m=()=>{l.removeEventListener("complete",x),l.removeEventListener("error",T),l.removeEventListener("abort",T)},x=()=>{o(),m()},T=()=>{h(l.error||new DOMException("AbortError","AbortError")),m()};l.addEventListener("complete",x),l.addEventListener("error",T),l.addEventListener("abort",T)});Z.set(l,r)}(l),Vs(l,function Ze(){return Se||(Se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(l,ce):l)}function bt(l){if(l instanceof IDBRequest)return function Qt(l){const r=new Promise((o,h)=>{const m=()=>{l.removeEventListener("success",x),l.removeEventListener("error",T)},x=()=>{o(bt(l.result)),m()},T=()=>{h(l.error),m()};l.addEventListener("success",x),l.addEventListener("error",T)});return r.then(o=>{o instanceof IDBCursor&&ne.set(o,l)}).catch(()=>{}),Ct.set(r,l),r}(l);if(We.has(l))return We.get(l);const r=$t(l);return r!==l&&(We.set(l,r),Ct.set(r,l)),r}const fn=l=>Ct.get(l),Pn=["get","getKey","getAll","getAllKeys","count"],kt=["put","add","delete","clear"],wn=new Map;function Kn(l,r){if(!(l instanceof IDBDatabase)||r in l||"string"!=typeof r)return;if(wn.get(r))return wn.get(r);const o=r.replace(/FromIndex$/,""),h=r!==o,m=kt.includes(o);if(!(o in(h?IDBIndex:IDBObjectStore).prototype)||!m&&!Pn.includes(o))return;const x=function(){var T=(0,ze.Z)(function*(k,...U){const te=this.transaction(k,m?"readwrite":"readonly");let fe=te.store;return h&&(fe=fe.index(U.shift())),(yield Promise.all([fe[o](...U),m&&te.done]))[0]});return function(U){return T.apply(this,arguments)}}();return wn.set(r,x),x}!function Pe(l){ce=l(ce)}(l=>({...l,get:(r,o,h)=>Kn(r,o)||l.get(r,o,h),has:(r,o)=>!!Kn(r,o)||l.has(r,o)}));class ut{constructor(r){this.container=r}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(function Sn(l){const r=l.getComponent();return"VERSION"===(null==r?void 0:r.type)}(o)){const h=o.getImmediate();return`${h.library}/${h.version}`}return null}).filter(o=>o).join(" ")}}const Ji="@firebase/app",N="0.9.25",be=new Wi("@firebase/app"),ic="[DEFAULT]",Zc={[Ji]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},hs=new Map,Ur=new Map;function nd(l,r){try{l.container.addComponent(r)}catch(o){be.debug(`Component ${r.name} failed to register with FirebaseApp ${l.name}`,o)}}function Us(l){const r=l.name;if(Ur.has(r))return be.debug(`There were multiple attempts to register component ${r}.`),!1;Ur.set(r,l);for(const o of hs.values())nd(o,l);return!0}const Oa=new Dn("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ql{constructor(r,o,h){this._isDeleted=!1,this._options=Object.assign({},r),this._config=Object.assign({},o),this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=h,this.container.addComponent(new es("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(r){this.checkDestroyed(),this._automaticDataCollectionEnabled=r}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(r){this._isDeleted=r}checkDestroyed(){if(this.isDeleted)throw Oa.create("app-deleted",{appName:this._name})}}const Rl="10.7.1";function fs(l,r={}){let o=l;"object"!=typeof r&&(r={name:r});const h=Object.assign({name:ic,automaticDataCollectionEnabled:!1},r),m=h.name;if("string"!=typeof m||!m)throw Oa.create("bad-app-name",{appName:String(m)});if(o||(o=_t()),!o)throw Oa.create("no-options");const x=hs.get(m);if(x){if(Gr(o,x.options)&&Gr(h,x.config))return x;throw Oa.create("duplicate-app",{appName:m})}const T=new ns(m);for(const U of Ur.values())T.addComponent(U);const k=new ql(o,h,T);return hs.set(m,k),k}function oc(l=ic){const r=hs.get(l);if(!r&&l===ic&&_t())return fs();if(!r)throw Oa.create("no-app",{appName:l});return r}function di(){return Array.from(hs.values())}function is(l,r,o){var h;let m=null!==(h=Zc[l])&&void 0!==h?h:l;o&&(m+=`-${o}`);const x=m.match(/\s|\//),T=r.match(/\s|\//);if(x||T){const k=[`Unable to register library "${m}" with version "${r}":`];return x&&k.push(`library name "${m}" contains illegal characters (whitespace or "/")`),x&&T&&k.push("and"),T&&k.push(`version name "${r}" contains illegal characters (whitespace or "/")`),void be.warn(k.join(" "))}Us(new es(`${m}-version`,()=>({library:m,version:r}),"VERSION"))}const th="firebase-heartbeat-database",cl=1,rd="firebase-heartbeat-store";let id=null;function eo(){return id||(id=function bn(l,r,{blocked:o,upgrade:h,blocking:m,terminated:x}={}){const T=indexedDB.open(l,r),k=bt(T);return h&&T.addEventListener("upgradeneeded",U=>{h(bt(T.result),U.oldVersion,U.newVersion,bt(T.transaction),U)}),o&&T.addEventListener("blocked",U=>o(U.oldVersion,U.newVersion,U)),k.then(U=>{x&&U.addEventListener("close",()=>x()),m&&U.addEventListener("versionchange",te=>m(te.oldVersion,te.newVersion,te))}).catch(()=>{}),k}(th,cl,{upgrade:(l,r)=>{0===r&&l.createObjectStore(rd)}}).catch(l=>{throw Oa.create("idb-open",{originalErrorMessage:l.message})})),id}function $r(){return($r=(0,ze.Z)(function*(l){try{return yield(yield eo()).transaction(rd).objectStore(rd).get(ws(l))}catch(r){if(r instanceof cn)be.warn(r.message);else{const o=Oa.create("idb-get",{originalErrorMessage:null==r?void 0:r.message});be.warn(o.message)}}})).apply(this,arguments)}function jo(l,r){return ta.apply(this,arguments)}function ta(){return(ta=(0,ze.Z)(function*(l,r){try{const h=(yield eo()).transaction(rd,"readwrite");yield h.objectStore(rd).put(r,ws(l)),yield h.done}catch(o){if(o instanceof cn)be.warn(o.message);else{const h=Oa.create("idb-set",{originalErrorMessage:null==o?void 0:o.message});be.warn(h.message)}}})).apply(this,arguments)}function ws(l){return`${l.name}!${l.options.appId}`}class _i{constructor(r){this.container=r,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new Y(o),this._heartbeatsCachePromise=this._storage.read().then(h=>(this._heartbeatsCache=h,h))}triggerHeartbeat(){var r=this;return(0,ze.Z)(function*(){var o,h;const x=r.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),T=Ps();if((null!=(null===(o=r._heartbeatsCache)||void 0===o?void 0:o.heartbeats)||(r._heartbeatsCache=yield r._heartbeatsCachePromise,null!=(null===(h=r._heartbeatsCache)||void 0===h?void 0:h.heartbeats)))&&r._heartbeatsCache.lastSentHeartbeatDate!==T&&!r._heartbeatsCache.heartbeats.some(k=>k.date===T))return r._heartbeatsCache.heartbeats.push({date:T,agent:x}),r._heartbeatsCache.heartbeats=r._heartbeatsCache.heartbeats.filter(k=>{const U=new Date(k.date).valueOf();return Date.now()-U<=2592e6}),r._storage.overwrite(r._heartbeatsCache)})()}getHeartbeatsHeader(){var r=this;return(0,ze.Z)(function*(){var o;if(null===r._heartbeatsCache&&(yield r._heartbeatsCachePromise),null==(null===(o=r._heartbeatsCache)||void 0===o?void 0:o.heartbeats)||0===r._heartbeatsCache.heartbeats.length)return"";const h=Ps(),{heartbeatsToSend:m,unsentEntries:x}=function se(l,r=1024){const o=[];let h=l.slice();for(const m of l){const x=o.find(T=>T.agent===m.agent);if(x){if(x.dates.push(m.date),Re(o)>r){x.dates.pop();break}}else if(o.push({agent:m.agent,dates:[m.date]}),Re(o)>r){o.pop();break}h=h.slice(1)}return{heartbeatsToSend:o,unsentEntries:h}}(r._heartbeatsCache.heartbeats),T=mt(JSON.stringify({version:2,heartbeats:m}));return r._heartbeatsCache.lastSentHeartbeatDate=h,x.length>0?(r._heartbeatsCache.heartbeats=x,yield r._storage.overwrite(r._heartbeatsCache)):(r._heartbeatsCache.heartbeats=[],r._storage.overwrite(r._heartbeatsCache)),T})()}}function Ps(){return(new Date).toISOString().substring(0,10)}class Y{constructor(r){this.app=r,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,ze.Z)(function*(){return!!function nn(){try{return"object"==typeof indexedDB}catch{return!1}}()&&function In(){return new Promise((l,r)=>{try{let o=!0;const h="validate-browser-context-for-indexeddb-analytics-module",m=self.indexedDB.open(h);m.onsuccess=()=>{m.result.close(),o||self.indexedDB.deleteDatabase(h),l(!0)},m.onupgradeneeded=()=>{o=!1},m.onerror=()=>{var x;r((null===(x=m.error)||void 0===x?void 0:x.message)||"")}}catch(o){r(o)}})}().then(()=>!0).catch(()=>!1)})()}read(){var r=this;return(0,ze.Z)(function*(){if(yield r._canUseIndexedDBPromise){const h=yield function Qn(l){return $r.apply(this,arguments)}(r.app);return null!=h&&h.heartbeats?h:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(r){var o=this;return(0,ze.Z)(function*(){var h;if(yield o._canUseIndexedDBPromise){const x=yield o.read();return jo(o.app,{lastSentHeartbeatDate:null!==(h=r.lastSentHeartbeatDate)&&void 0!==h?h:x.lastSentHeartbeatDate,heartbeats:r.heartbeats})}})()}add(r){var o=this;return(0,ze.Z)(function*(){var h;if(yield o._canUseIndexedDBPromise){const x=yield o.read();return jo(o.app,{lastSentHeartbeatDate:null!==(h=r.lastSentHeartbeatDate)&&void 0!==h?h:x.lastSentHeartbeatDate,heartbeats:[...x.heartbeats,...r.heartbeats]})}})()}}function Re(l){return mt(JSON.stringify({version:2,heartbeats:l})).length}!function le(l){Us(new es("platform-logger",r=>new ut(r),"PRIVATE")),Us(new es("heartbeat",r=>new _i(r),"PRIVATE")),is(Ji,N,l),is(Ji,N,"esm2017"),is("fire-js","")}(""),is("firebase","10.7.1","app");var Nr=ae(1954),as=ae(9931);const dl=new class ul extends as.v{}(class Fo extends Nr.o{constructor(r,o){super(r,o),this.scheduler=r,this.work=o}schedule(r,o=0){return o>0?super.schedule(r,o):(this.delay=o,this.state=r,this.scheduler.flush(this),this)}execute(r,o){return o>0||this.closed?super.execute(r,o):this._execute(r,o)}requestAsyncId(r,o,h=0){return null!=h&&h>0||null==h&&this.delay>0?super.requestAsyncId(r,o,h):(r.flush(this),0)}});var wc=ae(6321),Ia=ae(5592),hi=ae(9397),Wh=ae(5137),Kc=ae(3093);const ja=new he.GfV("ANGULARFIRE2_VERSION");const Bo=(l,r)=>{const o=r?[r]:di(),h=[];return o.forEach(m=>{m.container.getProvider(l).instances.forEach(T=>{h.includes(T)||h.push(T)})}),h};class wu{constructor(){return Bo(na)}}const na="app-check";function ps(){}class od{constructor(r,o=dl){Pt(this,"zone",void 0),Pt(this,"delegate",void 0),this.zone=r,this.delegate=o}now(){return this.delegate.now()}schedule(r,o,h){const m=this.zone;return this.delegate.schedule(function(T){m.runGuarded(()=>{r.apply(this,[T])})},o,h)}}class Ta{constructor(r){Pt(this,"zone",void 0),Pt(this,"task",null),this.zone=r}call(r,o){const h=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ps,{},ps,ps)),o.pipe((0,hi.b)({next:h,complete:h,error:h})).subscribe(r).add(h)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let sd=(()=>{var l;class r{constructor(h){Pt(this,"ngZone",void 0),Pt(this,"outsideAngular",void 0),Pt(this,"insideAngular",void 0),this.ngZone=h,this.outsideAngular=h.runOutsideAngular(()=>new od(Zone.current)),this.insideAngular=h.run(()=>new od(Zone.current,wc.z)),globalThis.\u0275AngularFireScheduler||(globalThis.\u0275AngularFireScheduler=this)}}return l=r,Pt(r,"\u0275fac",function(h){return new(h||l)(he.LFG(he.R0b))}),Pt(r,"\u0275prov",he.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})),r})();function ms(){const l=globalThis.\u0275AngularFireScheduler;if(!l)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return l}function hl(l){return ms().ngZone.run(()=>l())}function ap(l){return function fy(l){return function(o){return(o=o.lift(new Ta(l.ngZone))).pipe((0,Wh.R)(l.outsideAngular),(0,Kc.Q)(l.insideAngular))}}(ms())(l)}const Eu=(l,r)=>function(){const h=arguments;return r&&setTimeout(()=>{"scheduled"===r.state&&r.invoke()},10),hl(()=>l.apply(void 0,h))},U0=(l,r)=>function(){let o;const h=arguments;for(let x=0;x<arguments.length;x++)"function"==typeof h[x]&&(r&&(o||(o=hl(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ps,{},ps,ps)))),h[x]=Eu(h[x],o));const m=function nh(l){return ms().ngZone.runOutsideAngular(()=>l())}(()=>l.apply(this,h));if(!r){if(m instanceof Ia.y){const x=ms();return m.pipe((0,Wh.R)(x.outsideAngular),(0,Kc.Q)(x.insideAngular))}return hl(()=>m)}return m instanceof Ia.y?m.pipe(ap):m instanceof Promise?hl(()=>new Promise((x,T)=>m.then(k=>hl(()=>x(k)),k=>hl(()=>T(k))))):"function"==typeof m&&o?function(){return setTimeout(()=>{o&&"scheduled"===o.state&&o.invoke()},10),m.apply(this,arguments)}:hl(()=>m)};class lp{constructor(r){return r}}class $0{constructor(){return di()}}const py=new he.OlP("angularfire2._apps"),Nm={provide:lp,useFactory:function j0(l){return l&&1===l.length?l[0]:new lp(oc())},deps:[[new he.FiY,py]]},H1={provide:$0,deps:[[new he.FiY,py]]};function rh(l){return(r,o)=>{const h=r.runOutsideAngular(()=>l(o));return new lp(h)}}let G0=(()=>{var l;class r{constructor(h){is("angularfire",ja.full,"core"),is("angularfire",ja.full,"app"),is("angular",he.q4F.full,h.toString())}}return l=r,Pt(r,"\u0275fac",function(h){return new(h||l)(he.LFG(he.Lbi))}),Pt(r,"\u0275mod",he.oAB({type:l})),Pt(r,"\u0275inj",he.cJS({providers:[Nm,H1]})),r})();function V(l,...r){return{ngModule:G0,providers:[{provide:py,useFactory:rh(l),multi:!0,deps:[he.R0b,he.zs3,sd,...r]}]}}const Ne=U0(fs,!0);var yi=ae(7582);const Yl=function Ol(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},kl=new Dn("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ga=new Wi("@firebase/auth");function Ll(l,...r){Ga.logLevel<=ti.ERROR&&Ga.error(`Auth (${Rl}): ${l}`,...r)}function Aa(l,...r){throw Tu(l,...r)}function Iu(l,...r){return Tu(l,...r)}function Tu(l,...r){if("string"!=typeof l){const o=r[0],h=[...r.slice(1)];return h[0]&&(h[0].appName=l.name),l._errorFactory.create(o,...h)}return kl.create(l,...r)}function tr(l,r,...o){if(!l)throw Tu(r,...o)}function ac(l){const r="INTERNAL ASSERTION FAILED: "+l;throw Ll(r),new Error(r)}function Ca(l,r){l||ac(r)}function H0(){var l;return typeof self<"u"&&(null===(l=self.location)||void 0===l?void 0:l.protocol)||null}function ih(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function Ha(){return"http:"===H0()||"https:"===H0()}()||function An(){const l="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof l&&void 0!==l.id}()||"connection"in navigator))||navigator.onLine}class fl{constructor(r,o){this.shortDelay=r,this.longDelay=o,Ca(o>r,"Short delay should be less than long delay!"),this.isMobile=function mr(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Hn())}()||function qe(){return"object"==typeof navigator&&"ReactNative"===navigator.product}()}get(){return ih()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}class sh{static initialize(r,o,h){this.fetchImpl=r,o&&(this.headersImpl=o),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void ac("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void ac("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void ac("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ec={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Fm=new fl(3e4,6e4);function Go(l,r){return l.tenantId&&!r.tenantId?Object.assign(Object.assign({},r),{tenantId:l.tenantId}):r}function Ro(l,r,o,h){return qh.apply(this,arguments)}function qh(){return(qh=(0,ze.Z)(function*(l,r,o,h,m={}){return Yh(l,m,(0,ze.Z)(function*(){let x={},T={};h&&("GET"===r?T=h:x={body:JSON.stringify(h)});const k=an(Object.assign({key:l.config.apiKey},T)).slice(1),U=yield l._getAdditionalHeaders();return U["Content-Type"]="application/json",l.languageCode&&(U["X-Firebase-Locale"]=l.languageCode),sh.fetch()(Zh(l,l.config.apiHost,o,k),Object.assign({method:r,headers:U,referrerPolicy:"no-referrer"},x))}))})).apply(this,arguments)}function Yh(l,r,o){return mi.apply(this,arguments)}function mi(){return(mi=(0,ze.Z)(function*(l,r,o){l._canInitEmulator=!1;const h=Object.assign(Object.assign({},Ec),r);try{const m=new my(l),x=yield Promise.race([o(),m.promise]);m.clearNetworkTimeout();const T=yield x.json();if("needConfirmation"in T)throw cp(l,"account-exists-with-different-credential",T);if(x.ok&&!("errorMessage"in T))return T;{const k=x.ok?T.errorMessage:T.error.message,[U,te]=k.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===U)throw cp(l,"credential-already-in-use",T);if("EMAIL_EXISTS"===U)throw cp(l,"email-already-in-use",T);if("USER_DISABLED"===U)throw cp(l,"user-disabled",T);const fe=h[U]||U.toLowerCase().replace(/[_\s]+/g,"-");if(te)throw function Yo(l,r,o){const h=Object.assign(Object.assign({},Yl()),{[r]:o});return new Dn("auth","Firebase",h).create(r,{appName:l.name})}(l,fe,te);Aa(l,fe)}}catch(m){if(m instanceof cn)throw m;Aa(l,"network-request-failed",{message:String(m)})}})).apply(this,arguments)}function Zh(l,r,o,h){const m=`${r}${o}?${h}`;return l.config.emulator?function oh(l,r){Ca(l.emulator,"Emulator should always be set here");const{url:o}=l.emulator;return r?`${o}${r.startsWith("/")?r.slice(1):r}`:o}(l.config,m):`${l.config.apiScheme}://${m}`}class my{constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((o,h)=>{this.timer=setTimeout(()=>h(Iu(this.auth,"network-request-failed")),Fm.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function cp(l,r,o){const h={appName:l.name};o.email&&(h.email=o.email),o.phoneNumber&&(h.phoneNumber=o.phoneNumber);const m=Iu(l,r,h);return m.customData._tokenResponse=o,m}function up(){return(up=(0,ze.Z)(function*(l,r){return Ro(l,"POST","/v1/accounts:delete",r)})).apply(this,arguments)}function Qh(){return(Qh=(0,ze.Z)(function*(l,r){return Ro(l,"POST","/v1/accounts:lookup",r)})).apply(this,arguments)}function qa(l){if(l)try{const r=new Date(Number(l));if(!isNaN(r.getTime()))return r.toUTCString()}catch{}}function dp(){return(dp=(0,ze.Z)(function*(l,r=!1){const o=ko(l),h=yield o.getIdToken(r),m=Jh(h);tr(m&&m.exp&&m.auth_time&&m.iat,o.auth,"internal-error");const x="object"==typeof m.firebase?m.firebase:void 0,T=null==x?void 0:x.sign_in_provider;return{claims:m,token:h,authTime:qa(_y(m.auth_time)),issuedAtTime:qa(_y(m.iat)),expirationTime:qa(_y(m.exp)),signInProvider:T||null,signInSecondFactor:(null==x?void 0:x.sign_in_second_factor)||null}})).apply(this,arguments)}function _y(l){return 1e3*Number(l)}function Jh(l){const[r,o,h]=l.split(".");if(void 0===r||void 0===o||void 0===h)return Ll("JWT malformed, contained fewer than 3 sections"),null;try{const m=Gt(o);return m?JSON.parse(m):(Ll("Failed to decode base64 JWT payload"),null)}catch(m){return Ll("Caught error parsing JWT payload as JSON",null==m?void 0:m.toString()),null}}function ua(l,r){return hp.apply(this,arguments)}function hp(){return(hp=(0,ze.Z)(function*(l,r,o=!1){if(o)return r;try{return yield r}catch(h){throw h instanceof cn&&function Za({code:l}){return"auth/user-disabled"===l||"auth/user-token-expired"===l}(h)&&l.auth.currentUser===l&&(yield l.auth.signOut()),h}})).apply(this,arguments)}class Kl{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(r){var o;if(r){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const m=(null!==(o=this.user.stsTokenManager.expirationTime)&&void 0!==o?o:0)-Date.now()-3e5;return Math.max(0,m)}}schedule(r=!1){var o=this;if(!this.isRunning)return;const h=this.getInterval(r);this.timerId=setTimeout((0,ze.Z)(function*(){yield o.iteration()}),h)}iteration(){var r=this;return(0,ze.Z)(function*(){try{yield r.user.getIdToken(!0)}catch(o){return void("auth/network-request-failed"===(null==o?void 0:o.code)&&r.schedule(!0))}r.schedule()})()}}class zm{constructor(r,o){this.createdAt=r,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=qa(this.lastLoginAt),this.creationTime=qa(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function cc(l){return yy.apply(this,arguments)}function yy(){return yy=(0,ze.Z)(function*(l){var r;const o=l.auth,h=yield l.getIdToken(),m=yield ua(l,function Y1(l,r){return Qh.apply(this,arguments)}(o,{idToken:h}));tr(null==m?void 0:m.users.length,o,"internal-error");const x=m.users[0];l._notifyReloadListener(x);const T=null!==(r=x.providerUserInfo)&&void 0!==r&&r.length?function vy(l){return l.map(r=>{var{providerId:o}=r,h=(0,yi._T)(r,["providerId"]);return{providerId:o,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}(x.providerUserInfo):[],k=function Um(l,r){return[...l.filter(h=>!r.some(m=>m.providerId===h.providerId)),...r]}(l.providerData,T),fe=!!l.isAnonymous&&!(l.email&&x.passwordHash||null!=k&&k.length),Oe={uid:x.localId,displayName:x.displayName||null,photoURL:x.photoUrl||null,email:x.email||null,emailVerified:x.emailVerified||!1,phoneNumber:x.phoneNumber||null,tenantId:x.tenantId||null,providerData:k,metadata:new zm(x.createdAt,x.lastLoginAt),isAnonymous:fe};Object.assign(l,Oe)}),yy.apply(this,arguments)}function fp(){return(fp=(0,ze.Z)(function*(l){const r=ko(l);yield cc(r),yield r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)})).apply(this,arguments)}function L(){return(L=(0,ze.Z)(function*(l,r){const o=yield Yh(l,{},(0,ze.Z)(function*(){const h=an({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:m,apiKey:x}=l.config,T=Zh(l,m,"/v1/token",`key=${x}`),k=yield l._getAdditionalHeaders();return k["Content-Type"]="application/x-www-form-urlencoded",sh.fetch()(T,{method:"POST",headers:k,body:h})}));return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}})).apply(this,arguments)}function X(){return(X=(0,ze.Z)(function*(l,r){return Ro(l,"POST","/v2/accounts:revokeToken",Go(l,r))})).apply(this,arguments)}class B{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){tr(r.idToken,"internal-error"),tr(typeof r.idToken<"u","internal-error"),tr(typeof r.refreshToken<"u","internal-error");const o="expiresIn"in r&&typeof r.expiresIn<"u"?Number(r.expiresIn):function Ya(l){const r=Jh(l);return tr(r,"internal-error"),tr(typeof r.exp<"u","internal-error"),tr(typeof r.iat<"u","internal-error"),Number(r.exp)-Number(r.iat)}(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,o)}getToken(r,o=!1){var h=this;return(0,ze.Z)(function*(){return tr(!h.accessToken||h.refreshToken,r,"user-token-expired"),o||!h.accessToken||h.isExpired?h.refreshToken?(yield h.refresh(r,h.refreshToken),h.accessToken):null:h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(r,o){var h=this;return(0,ze.Z)(function*(){const{accessToken:m,refreshToken:x,expiresIn:T}=yield function pp(l,r){return L.apply(this,arguments)}(r,o);h.updateTokensAndExpiration(m,x,Number(T))})()}updateTokensAndExpiration(r,o,h){this.refreshToken=o||null,this.accessToken=r||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(r,o){const{refreshToken:h,accessToken:m,expirationTime:x}=o,T=new B;return h&&(tr("string"==typeof h,"internal-error",{appName:r}),T.refreshToken=h),m&&(tr("string"==typeof m,"internal-error",{appName:r}),T.accessToken=m),x&&(tr("number"==typeof x,"internal-error",{appName:r}),T.expirationTime=x),T}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new B,this.toJSON())}_performRefresh(){return ac("not implemented")}}function Q(l,r){tr("string"==typeof l||typeof l>"u","internal-error",{appName:r})}class Ee{constructor(r){var{uid:o,auth:h,stsTokenManager:m}=r,x=(0,yi._T)(r,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Kl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=o,this.auth=h,this.stsTokenManager=m,this.accessToken=m.accessToken,this.displayName=x.displayName||null,this.email=x.email||null,this.emailVerified=x.emailVerified||!1,this.phoneNumber=x.phoneNumber||null,this.photoURL=x.photoURL||null,this.isAnonymous=x.isAnonymous||!1,this.tenantId=x.tenantId||null,this.providerData=x.providerData?[...x.providerData]:[],this.metadata=new zm(x.createdAt||void 0,x.lastLoginAt||void 0)}getIdToken(r){var o=this;return(0,ze.Z)(function*(){const h=yield ua(o,o.stsTokenManager.getToken(o.auth,r));return tr(h,o.auth,"internal-error"),o.accessToken!==h&&(o.accessToken=h,yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)),h})()}getIdTokenResult(r){return function Vm(l){return dp.apply(this,arguments)}(this,r)}reload(){return function ef(l){return fp.apply(this,arguments)}(this)}_assign(r){this!==r&&(tr(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(o=>Object.assign({},o)),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){const o=new Ee(Object.assign(Object.assign({},this),{auth:r,stsTokenManager:this.stsTokenManager._clone()}));return o.metadata._copy(this.metadata),o}_onReload(r){tr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(r,o=!1){var h=this;return(0,ze.Z)(function*(){let m=!1;r.idToken&&r.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(r),m=!0),o&&(yield cc(h)),yield h.auth._persistUserIfCurrent(h),m&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var r=this;return(0,ze.Z)(function*(){const o=yield r.getIdToken();return yield ua(r,function yo(l,r){return up.apply(this,arguments)}(r.auth,{idToken:o})),r.stsTokenManager.clearRefreshToken(),r.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>Object.assign({},r)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,o){var h,m,x,T,k,U,te,fe;const Oe=null!==(h=o.displayName)&&void 0!==h?h:void 0,Tt=null!==(m=o.email)&&void 0!==m?m:void 0,un=null!==(x=o.phoneNumber)&&void 0!==x?x:void 0,sr=null!==(T=o.photoURL)&&void 0!==T?T:void 0,xr=null!==(k=o.tenantId)&&void 0!==k?k:void 0,vr=null!==(U=o._redirectEventId)&&void 0!==U?U:void 0,vi=null!==(te=o.createdAt)&&void 0!==te?te:void 0,Oi=null!==(fe=o.lastLoginAt)&&void 0!==fe?fe:void 0,{uid:xi,emailVerified:Eo,isAnonymous:Rs,providerData:ss,stsTokenManager:ll}=o;tr(xi&&ll,r,"internal-error");const Jd=B.fromJSON(this.name,ll);tr("string"==typeof xi,r,"internal-error"),Q(Oe,r.name),Q(Tt,r.name),tr("boolean"==typeof Eo,r,"internal-error"),tr("boolean"==typeof Rs,r,"internal-error"),Q(un,r.name),Q(sr,r.name),Q(xr,r.name),Q(vr,r.name),Q(vi,r.name),Q(Oi,r.name);const DD=new Ee({uid:xi,auth:r,email:Tt,emailVerified:Eo,displayName:Oe,isAnonymous:Rs,photoURL:sr,phoneNumber:un,tenantId:xr,stsTokenManager:Jd,createdAt:vi,lastLoginAt:Oi});return ss&&Array.isArray(ss)&&(DD.providerData=ss.map(uM=>Object.assign({},uM))),vr&&(DD._redirectEventId=vr),DD}static _fromIdTokenResponse(r,o,h=!1){return(0,ze.Z)(function*(){const m=new B;m.updateFromServerResponse(o);const x=new Ee({uid:o.localId,auth:r,stsTokenManager:m,isAnonymous:h});return yield cc(x),x})()}}const je=new Map;function jt(l){Ca(l instanceof Function,"Expected a class definition");let r=je.get(l);return r?(Ca(r instanceof l,"Instance stored in cache mismatched with class"),r):(r=new l,je.set(l,r),r)}const Zt=(()=>{class l{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,ze.Z)(function*(){return!0})()}_set(o,h){var m=this;return(0,ze.Z)(function*(){m.storage[o]=h})()}_get(o){var h=this;return(0,ze.Z)(function*(){const m=h.storage[o];return void 0===m?null:m})()}_remove(o){var h=this;return(0,ze.Z)(function*(){delete h.storage[o]})()}_addListener(o,h){}_removeListener(o,h){}}return l.type="NONE",l})();function ar(l,r,o){return`firebase:${l}:${r}:${o}`}class _r{constructor(r,o,h){this.persistence=r,this.auth=o,this.userKey=h;const{config:m,name:x}=this.auth;this.fullUserKey=ar(this.userKey,m.apiKey,x),this.fullPersistenceKey=ar("persistence",m.apiKey,x),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}getCurrentUser(){var r=this;return(0,ze.Z)(function*(){const o=yield r.persistence._get(r.fullUserKey);return o?Ee._fromJSON(r.auth,o):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(r){var o=this;return(0,ze.Z)(function*(){if(o.persistence===r)return;const h=yield o.getCurrentUser();return yield o.removeCurrentUser(),o.persistence=r,h?o.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(r,o,h="authUser"){return(0,ze.Z)(function*(){if(!o.length)return new _r(jt(Zt),r,h);const m=(yield Promise.all(o.map(function(){var te=(0,ze.Z)(function*(fe){if(yield fe._isAvailable())return fe});return function(fe){return te.apply(this,arguments)}}()))).filter(te=>te);let x=m[0]||jt(Zt);const T=ar(h,r.config.apiKey,r.name);let k=null;for(const te of o)try{const fe=yield te._get(T);if(fe){const Oe=Ee._fromJSON(r,fe);te!==x&&(k=Oe),x=te;break}}catch{}const U=m.filter(te=>te._shouldAllowMigration);return x._shouldAllowMigration&&U.length?(x=U[0],k&&(yield x._set(T,k.toJSON())),yield Promise.all(o.map(function(){var te=(0,ze.Z)(function*(fe){if(fe!==x)try{yield fe._remove(T)}catch{}});return function(fe){return te.apply(this,arguments)}}())),new _r(x,r,h)):new _r(x,r,h)})()}}function os(l){const r=l.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if(function cd(l=Hn()){return/iemobile/i.test(l)}(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(function mo(l=Hn()){return/firefox\//i.test(l)}(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(function eu(l=Hn()){return/blackberry/i.test(l)}(r))return"Blackberry";if(function ha(l=Hn()){return/webos/i.test(l)}(r))return"Webos";if(function js(l=Hn()){const r=l.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}(r))return"Safari";if((r.includes("chrome/")||function da(l=Hn()){return/crios\//i.test(l)}(r))&&!r.includes("edge/"))return"Chrome";if(function ud(l=Hn()){return/android/i.test(l)}(r))return"Android";{const h=l.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function tf(l,r=[]){let o;switch(l){case"Browser":o=os(Hn());break;case"Worker":o=`${os(Hn())}-${l}`;break;default:o=l}const h=r.length?r.join(","):"FirebaseCore-web";return`${o}/JsCore/${Rl}/${h}`}class YC{constructor(r){this.auth=r,this.queue=[]}pushCallback(r,o){const h=x=>new Promise((T,k)=>{try{T(r(x))}catch(U){k(U)}});h.onAbort=o,this.queue.push(h);const m=this.queue.length-1;return()=>{this.queue[m]=()=>Promise.resolve()}}runMiddleware(r){var o=this;return(0,ze.Z)(function*(){if(o.auth.currentUser===r)return;const h=[];try{for(const m of o.queue)yield m(r),m.onAbort&&h.push(m.onAbort)}catch(m){h.reverse();for(const x of h)try{x()}catch{}throw o.auth._errorFactory.create("login-blocked",{originalMessage:null==m?void 0:m.message})}})()}}function nf(){return(nf=(0,ze.Z)(function*(l,r={}){return Ro(l,"GET","/v2/passwordPolicy",Go(l,r))})).apply(this,arguments)}class xy{constructor(r){var o,h,m,x;const T=r.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(o=T.minPasswordLength)&&void 0!==o?o:6,T.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=T.maxPasswordLength),void 0!==T.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=T.containsLowercaseCharacter),void 0!==T.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=T.containsUppercaseCharacter),void 0!==T.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=T.containsNumericCharacter),void 0!==T.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=T.containsNonAlphanumericCharacter),this.enforcementState=r.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(m=null===(h=r.allowedNonAlphanumericCharacters)||void 0===h?void 0:h.join(""))&&void 0!==m?m:"",this.forceUpgradeOnSignin=null!==(x=r.forceUpgradeOnSignin)&&void 0!==x&&x,this.schemaVersion=r.schemaVersion}validatePassword(r){var o,h,m,x,T,k;const U={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(r,U),this.validatePasswordCharacterOptions(r,U),U.isValid&&(U.isValid=null===(o=U.meetsMinPasswordLength)||void 0===o||o),U.isValid&&(U.isValid=null===(h=U.meetsMaxPasswordLength)||void 0===h||h),U.isValid&&(U.isValid=null===(m=U.containsLowercaseLetter)||void 0===m||m),U.isValid&&(U.isValid=null===(x=U.containsUppercaseLetter)||void 0===x||x),U.isValid&&(U.isValid=null===(T=U.containsNumericCharacter)||void 0===T||T),U.isValid&&(U.isValid=null===(k=U.containsNonAlphanumericCharacter)||void 0===k||k),U}validatePasswordLengthOptions(r,o){const h=this.customStrengthOptions.minPasswordLength,m=this.customStrengthOptions.maxPasswordLength;h&&(o.meetsMinPasswordLength=r.length>=h),m&&(o.meetsMaxPasswordLength=r.length<=m)}validatePasswordCharacterOptions(r,o){let h;this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);for(let m=0;m<r.length;m++)h=r.charAt(m),this.updatePasswordCharacterOptionsStatuses(o,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(r,o,h,m,x){this.customStrengthOptions.containsLowercaseLetter&&(r.containsLowercaseLetter||(r.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(r.containsUppercaseLetter||(r.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(r.containsNumericCharacter||(r.containsNumericCharacter=m)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(r.containsNonAlphanumericCharacter||(r.containsNonAlphanumericCharacter=x))}}class tT{constructor(r,o,h,m){this.app=r,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=h,this.config=m,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new by(this),this.idTokenSubscription=new by(this),this.beforeStateQueue=new YC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kl,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=m.sdkClientVersion}_initializeWithPersistence(r,o){var h=this;return o&&(this._popupRedirectResolver=jt(o)),this._initializationPromise=this.queue((0,ze.Z)(function*(){var m,x;if(!h._deleted&&(h.persistenceManager=yield _r.create(h,r),!h._deleted)){if(null!==(m=h._popupRedirectResolver)&&void 0!==m&&m._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch{}yield h.initializeCurrentUser(o),h.lastNotifiedUid=(null===(x=h.currentUser)||void 0===x?void 0:x.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var r=this;return(0,ze.Z)(function*(){if(r._deleted)return;const o=yield r.assertedPersistence.getCurrentUser();if(r.currentUser||o){if(r.currentUser&&o&&r.currentUser.uid===o.uid)return r._currentUser._assign(o),void(yield r.currentUser.getIdToken());yield r._updateCurrentUser(o,!0)}})()}initializeCurrentUser(r){var o=this;return(0,ze.Z)(function*(){var h;const m=yield o.assertedPersistence.getCurrentUser();let x=m,T=!1;if(r&&o.config.authDomain){yield o.getOrInitRedirectPersistenceManager();const k=null===(h=o.redirectUser)||void 0===h?void 0:h._redirectEventId,U=null==x?void 0:x._redirectEventId,te=yield o.tryRedirectSignIn(r);(!k||k===U)&&null!=te&&te.user&&(x=te.user,T=!0)}if(!x)return o.directlySetCurrentUser(null);if(!x._redirectEventId){if(T)try{yield o.beforeStateQueue.runMiddleware(x)}catch(k){x=m,o._popupRedirectResolver._overrideRedirectResult(o,()=>Promise.reject(k))}return x?o.reloadAndSetCurrentUserOrClear(x):o.directlySetCurrentUser(null)}return tr(o._popupRedirectResolver,o,"argument-error"),yield o.getOrInitRedirectPersistenceManager(),o.redirectUser&&o.redirectUser._redirectEventId===x._redirectEventId?o.directlySetCurrentUser(x):o.reloadAndSetCurrentUserOrClear(x)})()}tryRedirectSignIn(r){var o=this;return(0,ze.Z)(function*(){let h=null;try{h=yield o._popupRedirectResolver._completeRedirectFn(o,r,!0)}catch{yield o._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(r){var o=this;return(0,ze.Z)(function*(){try{yield cc(r)}catch(h){if("auth/network-request-failed"!==(null==h?void 0:h.code))return o.directlySetCurrentUser(null)}return o.directlySetCurrentUser(r)})()}useDeviceLanguage(){this.languageCode=function Wa(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}()}_delete(){var r=this;return(0,ze.Z)(function*(){r._deleted=!0})()}updateCurrentUser(r){var o=this;return(0,ze.Z)(function*(){const h=r?ko(r):null;return h&&tr(h.auth.config.apiKey===o.config.apiKey,o,"invalid-user-token"),o._updateCurrentUser(h&&h._clone(o))})()}_updateCurrentUser(r,o=!1){var h=this;return(0,ze.Z)(function*(){if(!h._deleted)return r&&tr(h.tenantId===r.tenantId,h,"tenant-id-mismatch"),o||(yield h.beforeStateQueue.runMiddleware(r)),h.queue((0,ze.Z)(function*(){yield h.directlySetCurrentUser(r),h.notifyAuthListeners()}))})()}signOut(){var r=this;return(0,ze.Z)(function*(){return yield r.beforeStateQueue.runMiddleware(null),(r.redirectPersistenceManager||r._popupRedirectResolver)&&(yield r._setRedirectUser(null)),r._updateCurrentUser(null,!0)})()}setPersistence(r){var o=this;return this.queue((0,ze.Z)(function*(){yield o.assertedPersistence.setPersistence(jt(r))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(r){var o=this;return(0,ze.Z)(function*(){o._getPasswordPolicyInternal()||(yield o._updatePasswordPolicy());const h=o._getPasswordPolicyInternal();return h.schemaVersion!==o.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(o._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(r)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var r=this;return(0,ze.Z)(function*(){const o=yield function Gm(l){return nf.apply(this,arguments)}(r),h=new xy(o);null===r.tenantId?r._projectPasswordPolicy=h:r._tenantPasswordPolicies[r.tenantId]=h})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(r){this._errorFactory=new Dn("auth","Firebase",r())}onAuthStateChanged(r,o,h){return this.registerStateListener(this.authStateSubscription,r,o,h)}beforeAuthStateChanged(r,o){return this.beforeStateQueue.pushCallback(r,o)}onIdTokenChanged(r,o,h){return this.registerStateListener(this.idTokenSubscription,r,o,h)}authStateReady(){return new Promise((r,o)=>{if(this.currentUser)r();else{const h=this.onAuthStateChanged(()=>{h(),r()},o)}})}revokeAccessToken(r){var o=this;return(0,ze.Z)(function*(){if(o.currentUser){const h=yield o.currentUser.getIdToken(),m={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:r,idToken:h};null!=o.tenantId&&(m.tenantId=o.tenantId),yield function $(l,r){return X.apply(this,arguments)}(o,m)}})()}toJSON(){var r;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(r=this._currentUser)||void 0===r?void 0:r.toJSON()}}_setRedirectUser(r,o){var h=this;return(0,ze.Z)(function*(){const m=yield h.getOrInitRedirectPersistenceManager(o);return null===r?m.removeCurrentUser():m.setCurrentUser(r)})()}getOrInitRedirectPersistenceManager(r){var o=this;return(0,ze.Z)(function*(){if(!o.redirectPersistenceManager){const h=r&&jt(r)||o._popupRedirectResolver;tr(h,o,"argument-error"),o.redirectPersistenceManager=yield _r.create(o,[jt(h._redirectPersistence)],"redirectUser"),o.redirectUser=yield o.redirectPersistenceManager.getCurrentUser()}return o.redirectPersistenceManager})()}_redirectUserForId(r){var o=this;return(0,ze.Z)(function*(){var h,m;return o._isInitialized&&(yield o.queue((0,ze.Z)(function*(){}))),(null===(h=o._currentUser)||void 0===h?void 0:h._redirectEventId)===r?o._currentUser:(null===(m=o.redirectUser)||void 0===m?void 0:m._redirectEventId)===r?o.redirectUser:null})()}_persistUserIfCurrent(r){var o=this;return(0,ze.Z)(function*(){if(r===o.currentUser)return o.queue((0,ze.Z)(function*(){return o.directlySetCurrentUser(r)}))})()}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var r,o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(o=null===(r=this.currentUser)||void 0===r?void 0:r.uid)&&void 0!==o?o:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,o,h,m){if(this._deleted)return()=>{};const x="function"==typeof o?o:o.next.bind(o);let T=!1;const k=this._isInitialized?Promise.resolve():this._initializationPromise;if(tr(k,this,"internal-error"),k.then(()=>{T||x(this.currentUser)}),"function"==typeof o){const U=r.addObserver(o,h,m);return()=>{T=!0,U()}}{const U=r.addObserver(o);return()=>{T=!0,U()}}}directlySetCurrentUser(r){var o=this;return(0,ze.Z)(function*(){o.currentUser&&o.currentUser!==r&&o._currentUser._stopProactiveRefresh(),r&&o.isProactiveRefreshEnabled&&r._startProactiveRefresh(),o.currentUser=r,r?yield o.assertedPersistence.setCurrentUser(r):yield o.assertedPersistence.removeCurrentUser()})()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return tr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=tf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var r=this;return(0,ze.Z)(function*(){var o;const h={"X-Client-Version":r.clientVersion};r.app.options.appId&&(h["X-Firebase-gmpid"]=r.app.options.appId);const m=yield null===(o=r.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===o?void 0:o.getHeartbeatsHeader();m&&(h["X-Firebase-Client"]=m);const x=yield r._getAppCheckToken();return x&&(h["X-Firebase-AppCheck"]=x),h})()}_getAppCheckToken(){var r=this;return(0,ze.Z)(function*(){var o;const h=yield null===(o=r.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===o?void 0:o.getToken();return null!=h&&h.error&&function Qc(l,...r){Ga.logLevel<=ti.WARN&&Ga.warn(`Auth (${Rl}): ${l}`,...r)}(`Error while retrieving App Check token: ${h.error}`),null==h?void 0:h.token})()}}class by{constructor(r){this.auth=r,this.observer=null,this.addObserver=function xn(l,r){const o=new Ln(l,r);return o.subscribe.bind(o)}(o=>this.observer=o)}get next(){return tr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}(function wy(l){return`__${l}${Math.floor(1e6*Math.random())}`})("rcb"),new fl(3e4,6e4),new fl(2e3,1e4),new fl(3e4,6e4),new fl(5e3,15e3),encodeURIComponent("fac");var gS="@firebase/auth";class vw{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){var r;return this.assertAuthConfigured(),(null===(r=this.auth.currentUser)||void 0===r?void 0:r.uid)||null}getToken(r){var o=this;return(0,ze.Z)(function*(){return o.assertAuthConfigured(),yield o.auth._initializationPromise,o.auth.currentUser?{accessToken:yield o.auth.currentUser.getIdToken(r)}:null})()}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const o=this.auth.onIdTokenChanged(h=>{r((null==h?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(r,o),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const o=this.internalListeners.get(r);o&&(this.internalListeners.delete(r),o(),this.updateProactiveRefresh())}assertAuthConfigured(){tr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Xe(),function xw(l){Us(new es("auth",(r,{options:o})=>{const h=r.getProvider("app").getImmediate(),m=r.getProvider("heartbeat"),x=r.getProvider("app-check-internal"),{apiKey:T,authDomain:k}=h.options;tr(T&&!T.includes(":"),"invalid-api-key",{appName:h.name});const U={apiKey:T,authDomain:k,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tf(l)},te=new tT(h,m,x,U);return function Iy(l,r){const o=(null==r?void 0:r.persistence)||[],h=(Array.isArray(o)?o:[o]).map(jt);null!=r&&r.errorMap&&l._updateErrorMap(r.errorMap),l._initializeWithPersistence(h,null==r?void 0:r.popupRedirectResolver)}(te,o),te},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,o,h)=>{r.getProvider("auth-internal").initialize()})),Us(new es("auth-internal",r=>{const o=function ra(l){return ko(l)}(r.getProvider("auth").getImmediate());return new vw(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),is(gS,"1.5.1",function _S(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(l)),is(gS,"1.5.1","esm2017")}("Browser");class lu{constructor(){return Bo("auth")}}var Ar,JT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zl={},Lw=Lw||{},Di=JT||self;function qx(l){var r=typeof l;return"array"==(r="object"!=r?r:l?Array.isArray(l)?"array":r:"null")||"object"==r&&"number"==typeof l.length}function ev(l){var r=typeof l;return"object"==r&&null!=l||"function"==r}var Yx="closure_uid_"+(1e9*Math.random()>>>0),eA=0;function tA(l,r,o){return l.call.apply(l.bind,arguments)}function TS(l,r,o){if(!l)throw Error();if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var m=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(m,h),l.apply(r,m)}}return function(){return l.apply(r,arguments)}}function xl(l,r,o){return(xl=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?tA:TS).apply(null,arguments)}function tv(l,r){var o=Array.prototype.slice.call(arguments,1);return function(){var h=o.slice();return h.push.apply(h,arguments),l.apply(this,h)}}function Na(l,r){function o(){}o.prototype=r.prototype,l.$=r.prototype,l.prototype=new o,l.prototype.constructor=l,l.ac=function(h,m,x){for(var T=Array(arguments.length-2),k=2;k<arguments.length;k++)T[k-2]=arguments[k];return r.prototype[m].apply(h,T)}}function Id(){this.s=this.s,this.o=this.o}Id.prototype.s=!1,Id.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Nw(l){Object.prototype.hasOwnProperty.call(l,Yx)&&l[Yx]||(l[Yx]=++eA)}(this)},Id.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Fw=Array.prototype.indexOf?function(l,r){return Array.prototype.indexOf.call(l,r,void 0)}:function(l,r){if("string"==typeof l)return"string"!=typeof r||1!=r.length?-1:l.indexOf(r,0);for(let o=0;o<l.length;o++)if(o in l&&l[o]===r)return o;return-1};function Dg(l){const r=l.length;if(0<r){const o=Array(r);for(let h=0;h<r;h++)o[h]=l[h];return o}return[]}function cu(l,r){for(let o=1;o<arguments.length;o++){const h=arguments[o];if(qx(h)){const m=l.length||0,x=h.length||0;l.length=m+x;for(let T=0;T<x;T++)l[m+T]=h[T]}else l.push(h)}}function Ki(l,r){this.type=l,this.g=this.target=r,this.defaultPrevented=!1}Ki.prototype.h=function(){this.defaultPrevented=!0};var Bw=function(){if(!Di.addEventListener||!Object.defineProperty)return!1;var l=!1,r=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const o=()=>{};Di.addEventListener("test",o,r),Di.removeEventListener("test",o,r)}catch{}return l}();function Lp(l){return/^[\s\xa0]*$/.test(l)}function Zx(){var l=Di.navigator;return l&&(l=l.userAgent)?l:""}function bl(l){return-1!=Zx().indexOf(l)}function Kx(l){return Kx[" "](l),l}Kx[" "]=function(){};var Td,AS=bl("Opera"),Mg=bl("Trident")||bl("MSIE"),Xx=bl("Edge"),Rg=Xx||Mg,Qx=bl("Gecko")&&!(-1!=Zx().toLowerCase().indexOf("webkit")&&!bl("Edge"))&&!(bl("Trident")||bl("MSIE"))&&!bl("Edge"),Pg=-1!=Zx().toLowerCase().indexOf("webkit")&&!bl("Edge");function bf(){var l=Di.document;return l?l.documentMode:void 0}e:{var Jx="",Og=function(){var l=Zx();return Qx?/rv:([^\);]+)(\)|;)/.exec(l):Xx?/Edge\/([\d\.]+)/.exec(l):Mg?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(l):Pg?/WebKit\/(\S+)/.exec(l):AS?/(?:Version)[ \/]?(\S+)/.exec(l):void 0}();if(Og&&(Jx=Og?Og[1]:""),Mg){var eb=bf();if(null!=eb&&eb>parseFloat(Jx)){Td=String(eb);break e}}Td=Jx}var CS=Di.document&&Mg&&(bf()||parseInt(Td,10))||void 0;function Np(l,r){if(Ki.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var o=this.type=l.type,h=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=r,r=l.relatedTarget){if(Qx){e:{try{Kx(r.nodeName);var m=!0;break e}catch{}m=!1}m||(r=null)}}else"mouseover"==o?r=l.fromElement:"mouseout"==o&&(r=l.toElement);this.relatedTarget=r,h?(this.clientX=void 0!==h.clientX?h.clientX:h.pageX,this.clientY=void 0!==h.clientY?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0):(this.clientX=void 0!==l.clientX?l.clientX:l.pageX,this.clientY=void 0!==l.clientY?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType="string"==typeof l.pointerType?l.pointerType:SS[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Np.$.h.call(this)}}Na(Np,Ki);var SS={2:"touch",3:"pen",4:"mouse"};Np.prototype.h=function(){Np.$.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Lu="closure_listenable_"+(1e6*Math.random()|0),jD=0;function Xs(l,r,o,h,m){this.listener=l,this.proxy=null,this.src=r,this.type=o,this.capture=!!h,this.la=m,this.key=++jD,this.fa=this.ia=!1}function kg(l){l.fa=!0,l.listener=null,l.proxy=null,l.src=null,l.la=null}function Vw(l,r,o){for(const h in l)r.call(o,l[h],h,l)}function Lg(l){const r={};for(const o in l)r[o]=l[o];return r}const rv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ni(l,r){let o,h;for(let m=1;m<arguments.length;m++){for(o in h=arguments[m],h)l[o]=h[o];for(let x=0;x<rv.length;x++)o=rv[x],Object.prototype.hasOwnProperty.call(h,o)&&(l[o]=h[o])}}function Ng(l){this.src=l,this.g={},this.h=0}function wf(l,r){var o=r.type;if(o in l.g){var x,h=l.g[o],m=Fw(h,r);(x=0<=m)&&Array.prototype.splice.call(h,m,1),x&&(kg(r),0==l.g[o].length&&(delete l.g[o],l.h--))}}function Ad(l,r,o,h){for(var m=0;m<l.length;++m){var x=l[m];if(!x.fa&&x.listener==r&&x.capture==!!o&&x.la==h)return m}return-1}Ng.prototype.add=function(l,r,o,h,m){var x=l.toString();(l=this.g[x])||(l=this.g[x]=[],this.h++);var T=Ad(l,r,h,m);return-1<T?(r=l[T],o||(r.ia=!1)):((r=new Xs(r,this.src,x,!!h,m)).ia=o,l.push(r)),r};var Fg="closure_lm_"+(1e6*Math.random()|0),Bg={};function Fp(l,r,o,h,m){if(h&&h.once)return Ef(l,r,o,h,m);if(Array.isArray(r)){for(var x=0;x<r.length;x++)Fp(l,r[x],o,h,m);return null}return o=Uw(o),l&&l[Lu]?l.O(r,o,ev(h)?!!h.capture:!!h,m):Bp(l,r,o,!1,h,m)}function Bp(l,r,o,h,m,x){if(!r)throw Error("Invalid event type");var T=ev(m)?!!m.capture:!!m,k=rb(l);if(k||(l[Fg]=k=new Ng(l)),(o=k.add(r,o,h,T,x)).proxy)return o;if(h=function iv(){const r=zw;return function l(o){return r.call(l.src,l.listener,o)}}(),o.proxy=h,h.src=l,h.listener=o,l.addEventListener)Bw||(m=T),void 0===m&&(m=!1),l.addEventListener(r.toString(),h,m);else if(l.attachEvent)l.attachEvent(nb(r.toString()),h);else{if(!l.addListener||!l.removeListener)throw Error("addEventListener and attachEvent are unavailable.");l.addListener(h)}return o}function Ef(l,r,o,h,m){if(Array.isArray(r)){for(var x=0;x<r.length;x++)Ef(l,r[x],o,h,m);return null}return o=Uw(o),l&&l[Lu]?l.P(r,o,ev(h)?!!h.capture:!!h,m):Bp(l,r,o,!0,h,m)}function Vg(l,r,o,h,m){if(Array.isArray(r))for(var x=0;x<r.length;x++)Vg(l,r[x],o,h,m);else h=ev(h)?!!h.capture:!!h,o=Uw(o),l&&l[Lu]?(l=l.i,(r=String(r).toString())in l.g&&-1<(o=Ad(x=l.g[r],o,h,m))&&(kg(x[o]),Array.prototype.splice.call(x,o,1),0==x.length&&(delete l.g[r],l.h--))):l&&(l=rb(l))&&(r=l.g[r.toString()],l=-1,r&&(l=Ad(r,o,h,m)),(o=-1<l?r[l]:null)&&ov(o))}function ov(l){if("number"!=typeof l&&l&&!l.fa){var r=l.src;if(r&&r[Lu])wf(r.i,l);else{var o=l.type,h=l.proxy;r.removeEventListener?r.removeEventListener(o,h,l.capture):r.detachEvent?r.detachEvent(nb(o),h):r.addListener&&r.removeListener&&r.removeListener(h),(o=rb(r))?(wf(o,l),0==o.h&&(o.src=null,r[Fg]=null)):kg(l)}}}function nb(l){return l in Bg?Bg[l]:Bg[l]="on"+l}function zw(l,r){if(l.fa)l=!0;else{r=new Np(r,this);var o=l.listener,h=l.la||l.src;l.ia&&ov(l),l=o.call(h,r)}return l}function rb(l){return(l=l[Fg])instanceof Ng?l:null}var sv="__closure_events_fn_"+(1e9*Math.random()>>>0);function Uw(l){return"function"==typeof l?l:(l[sv]||(l[sv]=function(r){return l.handleEvent(r)}),l[sv])}function nl(){Id.call(this),this.i=new Ng(this),this.S=this,this.J=null}function wl(l,r){var o,h=l.J;if(h)for(o=[];h;h=h.J)o.push(h);if(l=l.S,h=r.type||r,"string"==typeof r)r=new Ki(r,l);else if(r instanceof Ki)r.target=r.target||l;else{var m=r;Ni(r=new Ki(h,l),m)}if(m=!0,o)for(var x=o.length-1;0<=x;x--){var T=r.g=o[x];m=If(T,h,!0,r)&&m}if(m=If(T=r.g=l,h,!0,r)&&m,m=If(T,h,!1,r)&&m,o)for(x=0;x<o.length;x++)m=If(T=r.g=o[x],h,!1,r)&&m}function If(l,r,o,h){if(!(r=l.i.g[String(r)]))return!0;r=r.concat();for(var m=!0,x=0;x<r.length;++x){var T=r[x];if(T&&!T.fa&&T.capture==o){var k=T.listener,U=T.la||T.src;T.ia&&wf(l.i,T),m=!1!==k.call(U,h)&&m}}return m&&!h.defaultPrevented}Na(nl,Id),nl.prototype[Lu]=!0,nl.prototype.removeEventListener=function(l,r,o,h){Vg(this,l,r,o,h)},nl.prototype.N=function(){if(nl.$.N.call(this),this.i){var r,l=this.i;for(r in l.g){for(var o=l.g[r],h=0;h<o.length;h++)kg(o[h]);delete l.g[r],l.h--}}this.J=null},nl.prototype.O=function(l,r,o,h){return this.i.add(String(l),r,!1,o,h)},nl.prototype.P=function(l,r,o,h){return this.i.add(String(l),r,!0,o,h)};var $w=Di.JSON.stringify;function zg(){var l=Gw;let r=null;return l.g&&(r=l.g,l.g=l.g.next,l.g||(l.h=null),r.next=null),r}var jw=new class oA{constructor(r,o){this.i=r,this.j=o,this.h=0,this.g=null}get(){let r;return 0<this.h?(this.h--,r=this.g,this.g=r.next,r.next=null):r=this.i(),r}}(()=>new sA,l=>l.reset());class sA{constructor(){this.next=this.g=this.h=null}set(r,o){this.h=r,this.g=o,this.next=null}reset(){this.next=this.g=this.h=null}}function aA(l){var r=1;l=l.split(":");const o=[];for(;0<r&&l.length;)o.push(l.shift()),r--;return l.length&&o.push(l.join(":")),o}function lA(l){Di.setTimeout(()=>{throw l},0)}let El,av=!1,Gw=new class DS{constructor(){this.h=this.g=null}add(r,o){const h=jw.get();h.set(r,o),this.h?this.h.next=h:this.g=h,this.h=h}},Hw=()=>{const l=Di.Promise.resolve(void 0);El=()=>{l.then(Ug)}};var Ug=()=>{for(var l;l=zg();){try{l.h.call(l.g)}catch(o){lA(o)}var r=jw;r.j(l),100>r.h&&(r.h++,l.next=r.g,r.g=l)}av=!1};function Tf(l,r){nl.call(this),this.h=l||1,this.g=r||Di,this.j=xl(this.qb,this),this.l=Date.now()}function ib(l){l.ga=!1,l.T&&(l.g.clearTimeout(l.T),l.T=null)}function Ww(l,r,o){if("function"==typeof l)o&&(l=xl(l,o));else{if(!l||"function"!=typeof l.handleEvent)throw Error("Invalid listener argument");l=xl(l.handleEvent,l)}return 2147483647<Number(r)?-1:Di.setTimeout(l,r||0)}function qw(l){l.g=Ww(()=>{l.g=null,l.i&&(l.i=!1,qw(l))},l.j);const r=l.h;l.h=null,l.m.apply(null,r)}Na(Tf,nl),(Ar=Tf.prototype).ga=!1,Ar.T=null,Ar.qb=function(){if(this.ga){var l=Date.now()-this.l;0<l&&l<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-l):(this.T&&(this.g.clearTimeout(this.T),this.T=null),wl(this,"tick"),this.ga&&(ib(this),this.start()))}},Ar.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ar.N=function(){Tf.$.N.call(this),ib(this),delete this.g};class lv extends Id{constructor(r,o){super(),this.m=r,this.j=o,this.h=null,this.i=!1,this.g=null}l(r){this.h=arguments,this.g?this.i=!0:qw(this)}N(){super.N(),this.g&&(Di.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function wo(l){Id.call(this),this.h=l,this.g={}}Na(wo,Id);var ob=[];function cv(l,r,o,h){Array.isArray(o)||(o&&(ob[0]=o.toString()),o=ob);for(var m=0;m<o.length;m++){var x=Fp(r,o[m],h||l.handleEvent,!1,l.h||l);if(!x)break;l.g[x.key]=x}}function Yw(l){Vw(l.g,function(r,o){this.g.hasOwnProperty(o)&&ov(r)},l),l.g={}}function uu(){this.g=!0}function jg(l,r,o,h){l.info(function(){return"XMLHTTP TEXT ("+r+"): "+function Zw(l,r){if(!l.g)return r;if(!r)return null;try{var o=JSON.parse(r);if(o)for(l=0;l<o.length;l++)if(Array.isArray(o[l])){var h=o[l];if(!(2>h.length)){var m=h[1];if(Array.isArray(m)&&!(1>m.length)){var x=m[0];if("noop"!=x&&"stop"!=x&&"close"!=x)for(var T=1;T<m.length;T++)m[T]=""}}}return $w(o)}catch{return r}}(l,o)+(h?" "+h:"")})}wo.prototype.N=function(){wo.$.N.call(this),Yw(this)},wo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},uu.prototype.Ea=function(){this.g=!1},uu.prototype.info=function(){};var Vp={},Kw=null;function sb(){return Kw=Kw||new nl}function Xw(l){Ki.call(this,Vp.Ta,l)}function Gg(l){const r=sb();wl(r,new Xw(r))}function uv(l,r){Ki.call(this,Vp.STAT_EVENT,l),this.stat=r}function Da(l){const r=sb();wl(r,new uv(r,l))}function Hg(l,r){Ki.call(this,Vp.Ua,l),this.size=r}function zp(l,r){if("function"!=typeof l)throw Error("Fn must not be null and must be a function");return Di.setTimeout(function(){l()},r)}Vp.Ta="serverreachability",Na(Xw,Ki),Vp.STAT_EVENT="statevent",Na(uv,Ki),Vp.Ua="timingevent",Na(Hg,Ki);var Af={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Qw={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Up(){}function Nu(){}Up.prototype.h=null;var Jw,Wg={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function qg(){Ki.call(this,"d")}function lb(){Ki.call(this,"c")}function dv(){}function Yg(l,r,o,h){this.l=l,this.j=r,this.m=o,this.W=h||1,this.U=new wo(this),this.P=uA,this.V=new Tf(l=Rg?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Sd}function Sd(){this.i=null,this.g="",this.h=!1}Na(qg,Ki),Na(lb,Ki),Na(dv,Up),dv.prototype.g=function(){return new XMLHttpRequest},dv.prototype.i=function(){return{}},Jw=new dv;var uA=45e3,cb={},Zg={};function Fu(l,r,o){l.L=1,l.A=fc(Vu(r)),l.u=o,l.S=!0,eE(l,null)}function eE(l,r){l.G=Date.now(),hv(l),l.B=Vu(l.A);var o=l.B,h=l.W;Array.isArray(h)||(h=[String(h)]),hb(o.i,"t",h),l.o=0,o=l.l.J,l.h=new Sd,l.g=pc(l.l,o?r:null,!l.u),0<l.O&&(l.M=new lv(xl(l.Pa,l,l.g),l.O)),cv(l.U,l.g,"readystatechange",l.nb),r=l.I?Lg(l.I):{},l.u?(l.v||(l.v="POST"),r["Content-Type"]="application/x-www-form-urlencoded",l.g.ha(l.B,l.v,l.u,r)):(l.v="GET",l.g.ha(l.B,l.v,null,r)),Gg(),function $g(l,r,o,h,m,x){l.info(function(){if(l.g)if(x)for(var T="",k=x.split("&"),U=0;U<k.length;U++){var te=k[U].split("=");if(1<te.length){var fe=te[0];te=te[1];var Oe=fe.split("_");T=2<=Oe.length&&"type"==Oe[1]?T+(fe+"=")+te+"&":T+(fe+"=redacted&")}}else T=null;else T=x;return"XMLHTTP REQ ("+h+") [attempt "+m+"]: "+r+"\n"+o+"\n"+T})}(l.j,l.v,l.B,l.m,l.W,l.u)}function Bu(l){return!!l.g&&"GET"==l.v&&2!=l.L&&l.l.Ha}function Cf(l,r,o){let m,h=!0;for(;!l.J&&l.o<o.length;){if(m=tE(l,o),m==Zg){4==r&&(l.s=4,Da(14),h=!1),jg(l.j,l.m,null,"[Incomplete Response]");break}if(m==cb){l.s=4,Da(15),jg(l.j,l.m,o,"[Invalid Chunk]"),h=!1;break}jg(l.j,l.m,m,null),hA(l,m)}Bu(l)&&0!=l.o&&(l.h.g=l.h.g.slice(l.o),l.o=0),4!=r||0!=o.length||l.h.h||(l.s=1,Da(16),h=!1),l.i=l.i&&h,h?0<o.length&&!l.ba&&(l.ba=!0,(r=l.l).g==l&&r.ca&&!r.M&&(r.l.info("Great, no buffering proxy detected. Bytes received: "+o.length),ju(r),r.M=!0,Da(11))):(jg(l.j,l.m,o,"[Invalid Chunked Response]"),Kg(l),fv(l))}function tE(l,r){var o=l.o,h=r.indexOf("\n",o);return-1==h?Zg:(o=Number(r.substring(o,h)),isNaN(o)?cb:(h+=1)+o>r.length?Zg:(r=r.slice(h,h+o),l.o=h+o,r))}function hv(l){l.Y=Date.now()+l.P,dA(l,l.P)}function dA(l,r){if(null!=l.C)throw Error("WatchDog timer not null");l.C=zp(xl(l.lb,l),r)}function ub(l){l.C&&(Di.clearTimeout(l.C),l.C=null)}function fv(l){0==l.l.H||l.J||Pd(l.l,l)}function Kg(l){ub(l);var r=l.M;r&&"function"==typeof r.sa&&r.sa(),l.M=null,ib(l.V),Yw(l.U),l.g&&(r=l.g,l.g=null,r.abort(),r.sa())}function hA(l,r){try{var o=l.l;if(0!=o.H&&(o.g==l||aE(o.i,l)))if(!l.K&&aE(o.i,l)&&3==o.H){try{var h=o.Ja.g.parse(r)}catch{h=null}if(Array.isArray(h)&&3==h.length){var m=h;if(0==m[0]){e:if(!o.u){if(o.g){if(!(o.g.G+3e3<l.G))break e;$l(o),Hp(o)}ks(o),Da(18)}}else o.Fa=m[1],0<o.Fa-o.V&&37500>m[2]&&o.G&&0==o.A&&!o.v&&(o.v=zp(xl(o.ib,o),6e3));if(1>=pb(o.i)&&o.oa){try{o.oa()}catch{}o.oa=void 0}}else Nc(o,11)}else if((l.K||o.g==l)&&$l(o),!Lp(r))for(m=o.Ja.g.parse(r),r=0;r<m.length;r++){let te=m[r];if(o.V=te[0],te=te[1],2==o.H)if("c"==te[0]){o.K=te[1],o.pa=te[2];const fe=te[3];null!=fe&&(o.ra=fe,o.l.info("VER="+o.ra));const Oe=te[4];null!=Oe&&(o.Ga=Oe,o.l.info("SVER="+o.Ga));const Tt=te[5];null!=Tt&&"number"==typeof Tt&&0<Tt&&(o.L=h=1.5*Tt,o.l.info("backChannelRequestTimeoutMs_="+h)),h=o;const un=l.g;if(un){const sr=un.g?un.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(sr){var x=h.i;x.g||-1==sr.indexOf("spdy")&&-1==sr.indexOf("quic")&&-1==sr.indexOf("h2")||(x.j=x.l,x.g=new Set,x.h&&(gv(x,x.h),x.h=null))}if(h.F){const xr=un.g?un.g.getResponseHeader("X-HTTP-Session-Id"):null;xr&&(h.Da=xr,Cs(h.I,h.F,xr))}}o.H=3,o.h&&o.h.Ba(),o.ca&&(o.S=Date.now()-l.G,o.l.info("Handshake RTT: "+o.S+"ms"));var T=l;if((h=o).wa=Yp(h,h.J?h.pa:null,h.Y),T.K){mb(h.i,T);var k=T,U=h.L;U&&k.setTimeout(U),k.C&&(ub(k),hv(k)),h.g=T}else qp(h);0<o.j.length&&n_(o)}else"stop"!=te[0]&&"close"!=te[0]||Nc(o,7);else 3==o.H&&("stop"==te[0]||"close"==te[0]?"stop"==te[0]?Nc(o,7):uE(o):"noop"!=te[0]&&o.h&&o.h.Aa(te),o.A=0)}Gg()}catch{}}function nE(l,r){if(l.forEach&&"function"==typeof l.forEach)l.forEach(r,void 0);else if(qx(l)||"string"==typeof l)Array.prototype.forEach.call(l,r,void 0);else for(var o=function MS(l){if(l.ta&&"function"==typeof l.ta)return l.ta();if(!l.Z||"function"!=typeof l.Z){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(qx(l)||"string"==typeof l){var r=[];l=l.length;for(var o=0;o<l;o++)r.push(o);return r}r=[],o=0;for(const h in l)r[o++]=h;return r}}}(l),h=function db(l){if(l.Z&&"function"==typeof l.Z)return l.Z();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if("string"==typeof l)return l.split("");if(qx(l)){for(var r=[],o=l.length,h=0;h<o;h++)r.push(l[h]);return r}for(h in r=[],o=0,l)r[o++]=l[h];return r}(l),m=h.length,x=0;x<m;x++)r.call(void 0,h[x],o&&o[x],l)}(Ar=Yg.prototype).setTimeout=function(l){this.P=l},Ar.nb=function(l){l=l.target;const r=this.M;r&&3==Ul(l)?r.l():this.Pa(l)},Ar.Pa=function(l){try{if(l==this.g)e:{const fe=Ul(this.g);var r=this.g.Ia();if(this.g.da(),!(3>fe)&&(3!=fe||Rg||this.g&&(this.h.h||this.g.ja()||yA(this.g)))){this.J||4!=fe||7==r||Gg(),ub(this);var o=this.g.da();this.ca=o;t:if(Bu(this)){var h=yA(this.g);l="";var m=h.length,x=4==Ul(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Kg(this),fv(this);var T="";break t}this.h.i=new Di.TextDecoder}for(r=0;r<m;r++)this.h.h=!0,l+=this.h.i.decode(h[r],{stream:x&&r==m-1});h.length=0,this.h.g+=l,this.o=0,T=this.h.g}else T=this.g.ja();if(this.i=200==o,function cA(l,r,o,h,m,x,T){l.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+m+"]: "+r+"\n"+o+"\n"+x+" "+T})}(this.j,this.v,this.B,this.m,this.W,fe,o),this.i){if(this.aa&&!this.K){t:{if(this.g){var k,U=this.g;if((k=U.g?U.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Lp(k)){var te=k;break t}}te=null}if(!(o=te)){this.i=!1,this.s=3,Da(12),Kg(this),fv(this);break e}jg(this.j,this.m,o,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hA(this,o)}this.S?(Cf(this,fe,T),Rg&&this.i&&3==fe&&(cv(this.U,this.V,"tick",this.mb),this.V.start())):(jg(this.j,this.m,T,null),hA(this,T)),4==fe&&Kg(this),this.i&&!this.J&&(4==fe?Pd(this.l,this):(this.i=!1,hv(this)))}else(function kS(l){const r={};l=(l.g&&2<=Ul(l)&&l.g.getAllResponseHeaders()||"").split("\r\n");for(let h=0;h<l.length;h++){if(Lp(l[h]))continue;var o=aA(l[h]);const m=o[0];if("string"!=typeof(o=o[1]))continue;o=o.trim();const x=r[m]||[];r[m]=x,x.push(o)}!function nv(l,r){for(const o in l)r.call(void 0,l[o],o,l)}(r,function(h){return h.join(", ")})})(this.g),400==o&&0<T.indexOf("Unknown SID")?(this.s=3,Da(12)):(this.s=0,Da(13)),Kg(this),fv(this)}}}catch{}},Ar.mb=function(){if(this.g){var l=Ul(this.g),r=this.g.ja();this.o<r.length&&(ub(this),Cf(this,l,r),this.i&&4!=l&&hv(this))}},Ar.cancel=function(){this.J=!0,Kg(this)},Ar.lb=function(){this.C=null;const l=Date.now();0<=l-this.Y?(function Cd(l,r){l.info(function(){return"TIMEOUT: "+r})}(this.j,this.B),2!=this.L&&(Gg(),Da(17)),Kg(this),this.s=2,fv(this)):dA(this,this.Y-l)};var RS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Il(l){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,l instanceof Il){this.h=l.h,Sf(this,l.j),this.s=l.s,this.g=l.g,kc(this,l.m),this.l=l.l;var r=l.i,o=new va;o.i=r.i,r.g&&(o.g=new Map(r.g),o.h=r.h),fA(this,o),this.o=l.o}else l&&(r=String(l).match(RS))?(this.h=!1,Sf(this,r[1]||"",!0),this.s=pv(r[2]||""),this.g=pv(r[3]||"",!0),kc(this,r[4]),this.l=pv(r[5]||"",!0),fA(this,r[6]||"",!0),this.o=pv(r[7]||"")):(this.h=!1,this.i=new va(null,this.h))}function Vu(l){return new Il(l)}function Sf(l,r,o){l.j=o?pv(r,!0):r,l.j&&(l.j=l.j.replace(/:$/,""))}function kc(l,r){if(r){if(r=Number(r),isNaN(r)||0>r)throw Error("Bad port number "+r);l.m=r}else l.m=null}function fA(l,r,o){r instanceof va?(l.i=r,function Xg(l,r){r&&!l.j&&(Dd(l),l.i=null,l.g.forEach(function(o,h){var m=h.toLowerCase();h!=m&&(oE(this,h),hb(this,m,o))},l)),l.j=r}(l.i,l.h)):(o||(r=$p(r,ya)),l.i=new va(r,l.h))}function Cs(l,r,o){l.i.set(r,o)}function fc(l){return Cs(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function pv(l,r){return l?r?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function $p(l,r,o){return"string"==typeof l?(l=encodeURI(l).replace(r,du),o&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function du(l){return"%"+((l=l.charCodeAt(0))>>4&15).toString(16)+(15&l).toString(16)}Il.prototype.toString=function(){var l=[],r=this.j;r&&l.push($p(r,rE,!0),":");var o=this.g;return(o||"file"==r)&&(l.push("//"),(r=this.s)&&l.push($p(r,rE,!0),"@"),l.push(encodeURIComponent(String(o)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(o=this.m)&&l.push(":",String(o))),(o=this.l)&&(this.g&&"/"!=o.charAt(0)&&l.push("/"),l.push($p(o,"/"==o.charAt(0)?GD:PS,!0))),(o=this.i.toString())&&l.push("?",o),(o=this.o)&&l.push("#",$p(o,iE)),l.join("")};var rE=/[#\/\?@]/g,PS=/[#\?:]/g,GD=/[#\?]/g,ya=/[#\?@]/g,iE=/#/g;function va(l,r){this.h=this.g=null,this.i=l||null,this.j=!!r}function Dd(l){l.g||(l.g=new Map,l.h=0,l.i&&function _a(l,r){if(l){l=l.split("&");for(var o=0;o<l.length;o++){var h=l[o].indexOf("="),m=null;if(0<=h){var x=l[o].substring(0,h);m=l[o].substring(h+1)}else x=l[o];r(x,m?decodeURIComponent(m.replace(/\+/g," ")):"")}}}(l.i,function(r,o){l.add(decodeURIComponent(r.replace(/\+/g," ")),o)}))}function oE(l,r){Dd(l),r=zu(l,r),l.g.has(r)&&(l.i=null,l.h-=l.g.get(r).length,l.g.delete(r))}function Ao(l,r){return Dd(l),r=zu(l,r),l.g.has(r)}function hb(l,r,o){oE(l,r),0<o.length&&(l.i=null,l.g.set(zu(l,r),Dg(o)),l.h+=o.length)}function zu(l,r){return r=String(r),l.j&&(r=r.toLowerCase()),r}(Ar=va.prototype).add=function(l,r){Dd(this),this.i=null,l=zu(this,l);var o=this.g.get(l);return o||this.g.set(l,o=[]),o.push(r),this.h+=1,this},Ar.forEach=function(l,r){Dd(this),this.g.forEach(function(o,h){o.forEach(function(m){l.call(r,m,h,this)},this)},this)},Ar.ta=function(){Dd(this);const l=Array.from(this.g.values()),r=Array.from(this.g.keys()),o=[];for(let h=0;h<r.length;h++){const m=l[h];for(let x=0;x<m.length;x++)o.push(r[h])}return o},Ar.Z=function(l){Dd(this);let r=[];if("string"==typeof l)Ao(this,l)&&(r=r.concat(this.g.get(zu(this,l))));else{l=Array.from(this.g.values());for(let o=0;o<l.length;o++)r=r.concat(l[o])}return r},Ar.set=function(l,r){return Dd(this),this.i=null,Ao(this,l=zu(this,l))&&(this.h-=this.g.get(l).length),this.g.set(l,[r]),this.h+=1,this},Ar.get=function(l,r){return l&&0<(l=this.Z(l)).length?String(l[0]):r},Ar.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],r=Array.from(this.g.keys());for(var o=0;o<r.length;o++){var h=r[o];const x=encodeURIComponent(String(h)),T=this.Z(h);for(h=0;h<T.length;h++){var m=x;""!==T[h]&&(m+="="+encodeURIComponent(String(T[h]))),l.push(m)}}return this.i=l.join("&")};var sE=class{constructor(l,r){this.g=l,this.map=r}};function mv(l){this.l=l||jp,l=Di.PerformanceNavigationTiming?0<(l=Di.performance.getEntriesByType("navigation")).length&&("hq"==l[0].nextHopProtocol||"h2"==l[0].nextHopProtocol):!!(Di.g&&Di.g.Ka&&Di.g.Ka()&&Di.g.Ka().dc),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var jp=10;function fb(l){return!!l.h||!!l.g&&l.g.size>=l.j}function pb(l){return l.h?1:l.g?l.g.size:0}function aE(l,r){return l.h?l.h==r:!!l.g&&l.g.has(r)}function gv(l,r){l.g?l.g.add(r):l.h=r}function mb(l,r){l.h&&l.h==r?l.h=null:l.g&&l.g.has(r)&&l.g.delete(r)}function Qg(l){if(null!=l.h)return l.i.concat(l.h.F);if(null!=l.g&&0!==l.g.size){let r=l.i;for(const o of l.g.values())r=r.concat(o.F);return r}return Dg(l.i)}mv.prototype.cancel=function(){if(this.i=Qg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const l of this.g.values())l.cancel();this.g.clear()}};var _v=class{stringify(l){return Di.JSON.stringify(l,void 0)}parse(l){return Di.JSON.parse(l,void 0)}};function OS(){this.g=new _v}function pA(l,r,o){const h=o||"";try{nE(l,function(m,x){let T=m;ev(m)&&(T=$w(m)),r.push(h+x+"="+encodeURIComponent(T))})}catch(m){throw r.push(h+"type="+encodeURIComponent("_badmap")),m}}function yv(l,r,o,h,m){try{r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null,m(h)}catch{}}function wh(l){this.l=l.ec||null,this.j=l.ob||!1}function Jg(l,r){nl.call(this),this.F=l,this.u=r,this.m=void 0,this.readyState=vv,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Na(wh,Up),wh.prototype.g=function(){return new Jg(this.l,this.j)},wh.prototype.i=function(l){return function(){return l}}({}),Na(Jg,nl);var vv=0;function mA(l){l.j.read().then(l.Xa.bind(l)).catch(l.ka.bind(l))}function xv(l){l.readyState=4,l.l=null,l.j=null,l.A=null,Md(l)}function Md(l){l.onreadystatechange&&l.onreadystatechange.call(l)}(Ar=Jg.prototype).open=function(l,r){if(this.readyState!=vv)throw this.abort(),Error("Error reopening a connection");this.C=l,this.B=r,this.readyState=1,Md(this)},Ar.send=function(l){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const r={headers:this.v,method:this.C,credentials:this.m,cache:void 0};l&&(r.body=l),(this.F||Di).fetch(new Request(this.B,r)).then(this.$a.bind(this),this.ka.bind(this))},Ar.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,xv(this)),this.readyState=vv},Ar.$a=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Md(this)),this.g&&(this.readyState=3,Md(this),this.g)))if("arraybuffer"===this.responseType)l.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Di.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;mA(this)}else l.text().then(this.Za.bind(this),this.ka.bind(this))},Ar.Xa=function(l){if(this.g){if(this.u&&l.value)this.response.push(l.value);else if(!this.u){var r=l.value?l.value:new Uint8Array(0);(r=this.A.decode(r,{stream:!l.done}))&&(this.response=this.responseText+=r)}l.done?xv(this):Md(this),3==this.readyState&&mA(this)}},Ar.Za=function(l){this.g&&(this.response=this.responseText=l,xv(this))},Ar.Ya=function(l){this.g&&(this.response=l,xv(this))},Ar.ka=function(){this.g&&xv(this)},Ar.setRequestHeader=function(l,r){this.v.append(l,r)},Ar.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},Ar.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],r=this.h.entries();for(var o=r.next();!o.done;)l.push((o=o.value)[0]+": "+o[1]),o=r.next();return l.join("\r\n")},Object.defineProperty(Jg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(l){this.m=l?"include":"same-origin"}});var gA=Di.JSON.parse;function Ss(l){nl.call(this),this.headers=new Map,this.u=l||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=lE,this.L=this.M=!1}Na(Ss,nl);var lE="",_A=/^https?$/i,$u=["POST","PUT"];function Eh(l,r){l.h=!1,l.g&&(l.l=!0,l.g.abort(),l.l=!1),l.j=r,l.m=5,cE(l),Gp(l)}function cE(l){l.F||(l.F=!0,wl(l,"complete"),wl(l,"error"))}function t_(l){if(l.h&&typeof Lw<"u"&&(!l.C[1]||4!=Ul(l)||2!=l.da()))if(l.v&&4==Ul(l))Ww(l.La,0,l);else if(wl(l,"readystatechange"),4==Ul(l)){l.h=!1;try{const T=l.da();e:switch(T){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}var o;if(!(o=r)){var h;if(h=0===T){var m=String(l.I).match(RS)[1]||null;!m&&Di.self&&Di.self.location&&(m=Di.self.location.protocol.slice(0,-1)),h=!_A.test(m?m.toLowerCase():"")}o=h}if(o)wl(l,"complete"),wl(l,"success");else{l.m=6;try{var x=2<Ul(l)?l.g.statusText:""}catch{x=""}l.j=x+" ["+l.da()+"]",cE(l)}}finally{Gp(l)}}}function Gp(l,r){if(l.g){bv(l);const o=l.g,h=l.C[0]?()=>{}:null;l.g=null,l.C=null,r||wl(l,"ready");try{o.onreadystatechange=h}catch{}}}function bv(l){l.g&&l.L&&(l.g.ontimeout=null),l.A&&(Di.clearTimeout(l.A),l.A=null)}function Ul(l){return l.g?l.g.readyState:0}function yA(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.K){case lE:case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function vA(l){let r="";return Vw(l,function(o,h){r+=h,r+=":",r+=o,r+="\r\n"}),r}function Df(l,r,o){e:{for(h in o){var h=!1;break e}h=!0}h||(o=vA(o),"string"==typeof l?null!=o&&encodeURIComponent(String(o)):Cs(l,r,o))}function Rd(l,r,o){return o&&o.internalChannelParams&&o.internalChannelParams[l]||r}function gb(l){this.Ga=0,this.j=[],this.l=new uu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Rd("failFast",!1,l),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Rd("baseRetryDelayMs",5e3,l),this.hb=Rd("retryDelaySeedMs",1e4,l),this.eb=Rd("forwardChannelMaxRetries",2,l),this.xa=Rd("forwardChannelRequestTimeoutMs",2e4,l),this.va=l&&l.xmlHttpFactory||void 0,this.Ha=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.i=new mv(l&&l.concurrentRequestLimit),this.Ja=new OS,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=l&&l.bc||!1,l&&l.Ea&&this.l.Ea(),l&&l.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&l&&l.detectBufferingProxy||!1,this.qa=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.qa=l.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function uE(l){if(dE(l),3==l.H){var r=l.W++,o=Vu(l.I);if(Cs(o,"SID",l.K),Cs(o,"RID",r),Cs(o,"TYPE","terminate"),Lc(l,o),(r=new Yg(l,l.l,r)).L=2,r.A=fc(Vu(o)),o=!1,Di.navigator&&Di.navigator.sendBeacon)try{o=Di.navigator.sendBeacon(r.A.toString(),"")}catch{}!o&&Di.Image&&((new Image).src=r.A,o=!0),o||(r.g=pc(r.l,null),r.g.ha(r.A)),r.G=Date.now(),hv(r)}Rf(l)}function Hp(l){l.g&&(ju(l),l.g.cancel(),l.g=null)}function dE(l){Hp(l),l.u&&(Di.clearTimeout(l.u),l.u=null),$l(l),l.i.cancel(),l.m&&("number"==typeof l.m&&Di.clearTimeout(l.m),l.m=null)}function n_(l){if(!fb(l.i)&&!l.m){l.m=!0;var r=l.Na;El||Hw(),av||(El(),av=!0),Gw.add(r,l),l.C=0}}function Wp(l,r){var o;o=r?r.m:l.W++;const h=Vu(l.I);Cs(h,"SID",l.K),Cs(h,"RID",o),Cs(h,"AID",l.V),Lc(l,h),l.o&&l.s&&Df(h,l.o,l.s),o=new Yg(l,l.l,o,l.C+1),null===l.o&&(o.I=l.s),r&&(l.j=r.F.concat(l.j)),r=hu(l,o,1e3),o.setTimeout(Math.round(.5*l.xa)+Math.round(.5*l.xa*Math.random())),gv(l.i,o),Fu(o,h,r)}function Lc(l,r){l.na&&Vw(l.na,function(o,h){Cs(r,h,o)}),l.h&&nE({},function(o,h){Cs(r,h,o)})}function hu(l,r,o){o=Math.min(l.j.length,o);var h=l.h?xl(l.h.Va,l.h,l):null;e:{var m=l.j;let x=-1;for(;;){const T=["count="+o];-1==x?0<o?(x=m[0].g,T.push("ofs="+x)):x=0:T.push("ofs="+x);let k=!0;for(let U=0;U<o;U++){let te=m[U].g;const fe=m[U].map;if(te-=x,0>te)x=Math.max(0,m[U].g-100),k=!1;else try{pA(fe,T,"req"+te+"_")}catch{h&&h(fe)}}if(k){h=T.join("&");break e}}}return l=l.j.splice(0,o),r.F=l,h}function qp(l){if(!l.g&&!l.u){l.ba=1;var r=l.Ma;El||Hw(),av||(El(),av=!0),Gw.add(r,l),l.A=0}}function ks(l){return!(l.g||l.u||3<=l.A||(l.ba++,l.u=zp(xl(l.Ma,l),Mf(l,l.A)),l.A++,0))}function ju(l){null!=l.B&&(Di.clearTimeout(l.B),l.B=null)}function wv(l){l.g=new Yg(l,l.l,"rpc",l.ba),null===l.o&&(l.g.I=l.s),l.g.O=0;var r=Vu(l.wa);Cs(r,"RID","rpc"),Cs(r,"SID",l.K),Cs(r,"AID",l.V),Cs(r,"CI",l.G?"0":"1"),!l.G&&l.qa&&Cs(r,"TO",l.qa),Cs(r,"TYPE","xmlhttp"),Lc(l,r),l.o&&l.s&&Df(r,l.o,l.s),l.L&&l.g.setTimeout(l.L);var o=l.g;l=l.pa,o.L=1,o.A=fc(Vu(r)),o.u=null,o.S=!0,eE(o,l)}function $l(l){null!=l.v&&(Di.clearTimeout(l.v),l.v=null)}function Pd(l,r){var o=null;if(l.g==r){$l(l),ju(l),l.g=null;var h=2}else{if(!aE(l.i,r))return;o=r.F,mb(l.i,r),h=1}if(0!=l.H)if(r.i)if(1==h){o=r.u?r.u.length:0,r=Date.now()-r.G;var m=l.C;wl(h=sb(),new Hg(h,o)),n_(l)}else qp(l);else if(3==(m=r.s)||0==m&&0<r.ca||!(1==h&&function HD(l,r){return!(pb(l.i)>=l.i.j-(l.m?1:0)||(l.m?(l.j=r.F.concat(l.j),0):1==l.H||2==l.H||l.C>=(l.cb?0:l.eb)||(l.m=zp(xl(l.Na,l,r),Mf(l,l.C)),l.C++,0)))}(l,r)||2==h&&ks(l)))switch(o&&0<o.length&&(r=l.i,r.i=r.i.concat(o)),m){case 1:Nc(l,5);break;case 4:Nc(l,10);break;case 3:Nc(l,6);break;default:Nc(l,2)}}function Mf(l,r){let o=l.ab+Math.floor(Math.random()*l.hb);return l.isActive()||(o*=2),o*r}function Nc(l,r){if(l.l.info("Error code "+r),2==r){var o=null;l.h&&(o=null);var h=xl(l.pb,l);o||(o=new Il("//www.google.com/images/cleardot.gif"),Di.location&&"http"==Di.location.protocol||Sf(o,"https"),fc(o)),function Uu(l,r){const o=new uu;if(Di.Image){const h=new Image;h.onload=tv(yv,o,h,"TestLoadImage: loaded",!0,r),h.onerror=tv(yv,o,h,"TestLoadImage: error",!1,r),h.onabort=tv(yv,o,h,"TestLoadImage: abort",!1,r),h.ontimeout=tv(yv,o,h,"TestLoadImage: timeout",!1,r),Di.setTimeout(function(){h.ontimeout&&h.ontimeout()},1e4),h.src=l}else r(!1)}(o.toString(),h)}else Da(2);l.H=0,l.h&&l.h.za(r),Rf(l),dE(l)}function Rf(l){if(l.H=0,l.ma=[],l.h){const r=Qg(l.i);(0!=r.length||0!=l.j.length)&&(cu(l.ma,r),cu(l.ma,l.j),l.i.i.length=0,Dg(l.j),l.j.length=0),l.h.ya()}}function Yp(l,r,o){var h=o instanceof Il?Vu(o):new Il(o);if(""!=h.g)r&&(h.g=r+"."+h.g),kc(h,h.m);else{var m=Di.location;h=m.protocol,r=r?r+"."+m.hostname:m.hostname,m=+m.port;var x=new Il(null);h&&Sf(x,h),r&&(x.g=r),m&&kc(x,m),o&&(x.l=o),h=x}return r=l.Da,(o=l.F)&&r&&Cs(h,o,r),Cs(h,"VER",l.ra),Lc(l,h),h}function pc(l,r,o){if(r&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return(r=new Ss(l.Ha&&!l.va?new wh({ob:o}):l.va)).Oa(l.J),r}function Zp(){}function Fc(){if(Mg&&!(10<=Number(CS)))throw Error("Environmental error: no available transport.")}function oa(l,r){nl.call(this),this.g=new gb(r),this.l=l,this.h=r&&r.messageUrlParams||null,l=r&&r.messageHeaders||null,r&&r.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.s=l,l=r&&r.initMessageHeaders||null,r&&r.messageContentType&&(l?l["X-WebChannel-Content-Type"]=r.messageContentType:l={"X-WebChannel-Content-Type":r.messageContentType}),r&&r.Ca&&(l?l["X-WebChannel-Client-Profile"]=r.Ca:l={"X-WebChannel-Client-Profile":r.Ca}),this.g.U=l,(l=r&&r.cc)&&!Lp(l)&&(this.g.o=l),this.A=r&&r.supportsCrossDomainXhr||!1,this.v=r&&r.sendRawJson||!1,(r=r&&r.httpSessionIdParam)&&!Lp(r)&&(this.g.F=r,null!==(l=this.h)&&r in l&&r in(l=this.h)&&delete l[r]),this.j=new Od(this)}function Gu(l){qg.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var r=l.__sm__;if(r){e:{for(const o in r){l=o;break e}l=void 0}(this.i=l)&&(l=this.i,r=null!==r&&l in r?r[l]:void 0),this.data=r}else this.data=l}function Kp(){lb.call(this),this.status=1}function Od(l){this.g=l}function fu(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Ih(l,r,o){o||(o=0);var h=Array(16);if("string"==typeof r)for(var m=0;16>m;++m)h[m]=r.charCodeAt(o++)|r.charCodeAt(o++)<<8|r.charCodeAt(o++)<<16|r.charCodeAt(o++)<<24;else for(m=0;16>m;++m)h[m]=r[o++]|r[o++]<<8|r[o++]<<16|r[o++]<<24;var x=l.g[3],T=(r=l.g[0])+(x^(o=l.g[1])&((m=l.g[2])^x))+h[0]+3614090360&4294967295;T=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=(o=(m=(x=(r=o+(T<<7&4294967295|T>>>25))+((T=x+(m^r&(o^m))+h[1]+3905402710&4294967295)<<12&4294967295|T>>>20))+((T=m+(o^x&(r^o))+h[2]+606105819&4294967295)<<17&4294967295|T>>>15))+((T=o+(r^m&(x^r))+h[3]+3250441966&4294967295)<<22&4294967295|T>>>10))+((T=r+(x^o&(m^x))+h[4]+4118548399&4294967295)<<7&4294967295|T>>>25))+((T=x+(m^r&(o^m))+h[5]+1200080426&4294967295)<<12&4294967295|T>>>20))+((T=m+(o^x&(r^o))+h[6]+2821735955&4294967295)<<17&4294967295|T>>>15))+((T=o+(r^m&(x^r))+h[7]+4249261313&4294967295)<<22&4294967295|T>>>10))+((T=r+(x^o&(m^x))+h[8]+1770035416&4294967295)<<7&4294967295|T>>>25))+((T=x+(m^r&(o^m))+h[9]+2336552879&4294967295)<<12&4294967295|T>>>20))+((T=m+(o^x&(r^o))+h[10]+4294925233&4294967295)<<17&4294967295|T>>>15))+((T=o+(r^m&(x^r))+h[11]+2304563134&4294967295)<<22&4294967295|T>>>10))+((T=r+(x^o&(m^x))+h[12]+1804603682&4294967295)<<7&4294967295|T>>>25))+((T=x+(m^r&(o^m))+h[13]+4254626195&4294967295)<<12&4294967295|T>>>20))+((T=m+(o^x&(r^o))+h[14]+2792965006&4294967295)<<17&4294967295|T>>>15))+((T=o+(r^m&(x^r))+h[15]+1236535329&4294967295)<<22&4294967295|T>>>10))+((T=r+(m^x&(o^m))+h[1]+4129170786&4294967295)<<5&4294967295|T>>>27))+((T=x+(o^m&(r^o))+h[6]+3225465664&4294967295)<<9&4294967295|T>>>23))+((T=m+(r^o&(x^r))+h[11]+643717713&4294967295)<<14&4294967295|T>>>18))+((T=o+(x^r&(m^x))+h[0]+3921069994&4294967295)<<20&4294967295|T>>>12))+((T=r+(m^x&(o^m))+h[5]+3593408605&4294967295)<<5&4294967295|T>>>27))+((T=x+(o^m&(r^o))+h[10]+38016083&4294967295)<<9&4294967295|T>>>23))+((T=m+(r^o&(x^r))+h[15]+3634488961&4294967295)<<14&4294967295|T>>>18))+((T=o+(x^r&(m^x))+h[4]+3889429448&4294967295)<<20&4294967295|T>>>12))+((T=r+(m^x&(o^m))+h[9]+568446438&4294967295)<<5&4294967295|T>>>27))+((T=x+(o^m&(r^o))+h[14]+3275163606&4294967295)<<9&4294967295|T>>>23))+((T=m+(r^o&(x^r))+h[3]+4107603335&4294967295)<<14&4294967295|T>>>18))+((T=o+(x^r&(m^x))+h[8]+1163531501&4294967295)<<20&4294967295|T>>>12))+((T=r+(m^x&(o^m))+h[13]+2850285829&4294967295)<<5&4294967295|T>>>27))+((T=x+(o^m&(r^o))+h[2]+4243563512&4294967295)<<9&4294967295|T>>>23))+((T=m+(r^o&(x^r))+h[7]+1735328473&4294967295)<<14&4294967295|T>>>18))+((T=o+(x^r&(m^x))+h[12]+2368359562&4294967295)<<20&4294967295|T>>>12))+((T=r+(o^m^x)+h[5]+4294588738&4294967295)<<4&4294967295|T>>>28))+((T=x+(r^o^m)+h[8]+2272392833&4294967295)<<11&4294967295|T>>>21))+((T=m+(x^r^o)+h[11]+1839030562&4294967295)<<16&4294967295|T>>>16))+((T=o+(m^x^r)+h[14]+4259657740&4294967295)<<23&4294967295|T>>>9))+((T=r+(o^m^x)+h[1]+2763975236&4294967295)<<4&4294967295|T>>>28))+((T=x+(r^o^m)+h[4]+1272893353&4294967295)<<11&4294967295|T>>>21))+((T=m+(x^r^o)+h[7]+4139469664&4294967295)<<16&4294967295|T>>>16))+((T=o+(m^x^r)+h[10]+3200236656&4294967295)<<23&4294967295|T>>>9))+((T=r+(o^m^x)+h[13]+681279174&4294967295)<<4&4294967295|T>>>28))+((T=x+(r^o^m)+h[0]+3936430074&4294967295)<<11&4294967295|T>>>21))+((T=m+(x^r^o)+h[3]+3572445317&4294967295)<<16&4294967295|T>>>16))+((T=o+(m^x^r)+h[6]+76029189&4294967295)<<23&4294967295|T>>>9))+((T=r+(o^m^x)+h[9]+3654602809&4294967295)<<4&4294967295|T>>>28))+((T=x+(r^o^m)+h[12]+3873151461&4294967295)<<11&4294967295|T>>>21))+((T=m+(x^r^o)+h[15]+530742520&4294967295)<<16&4294967295|T>>>16))+((T=o+(m^x^r)+h[2]+3299628645&4294967295)<<23&4294967295|T>>>9))+((T=r+(m^(o|~x))+h[0]+4096336452&4294967295)<<6&4294967295|T>>>26))+((T=x+(o^(r|~m))+h[7]+1126891415&4294967295)<<10&4294967295|T>>>22))+((T=m+(r^(x|~o))+h[14]+2878612391&4294967295)<<15&4294967295|T>>>17))+((T=o+(x^(m|~r))+h[5]+4237533241&4294967295)<<21&4294967295|T>>>11))+((T=r+(m^(o|~x))+h[12]+1700485571&4294967295)<<6&4294967295|T>>>26))+((T=x+(o^(r|~m))+h[3]+2399980690&4294967295)<<10&4294967295|T>>>22))+((T=m+(r^(x|~o))+h[10]+4293915773&4294967295)<<15&4294967295|T>>>17))+((T=o+(x^(m|~r))+h[1]+2240044497&4294967295)<<21&4294967295|T>>>11))+((T=r+(m^(o|~x))+h[8]+1873313359&4294967295)<<6&4294967295|T>>>26))+((T=x+(o^(r|~m))+h[15]+4264355552&4294967295)<<10&4294967295|T>>>22))+((T=m+(r^(x|~o))+h[6]+2734768916&4294967295)<<15&4294967295|T>>>17))+((T=o+(x^(m|~r))+h[13]+1309151649&4294967295)<<21&4294967295|T>>>11))+((x=(r=o+((T=r+(m^(o|~x))+h[4]+4149444226&4294967295)<<6&4294967295|T>>>26))+((T=x+(o^(r|~m))+h[11]+3174756917&4294967295)<<10&4294967295|T>>>22))^((m=x+((T=m+(r^(x|~o))+h[2]+718787259&4294967295)<<15&4294967295|T>>>17))|~r))+h[9]+3951481745&4294967295,l.g[0]=l.g[0]+r&4294967295,l.g[1]=l.g[1]+(m+(T<<21&4294967295|T>>>11))&4294967295,l.g[2]=l.g[2]+m&4294967295,l.g[3]=l.g[3]+x&4294967295}function Po(l,r){this.h=r;for(var o=[],h=!0,m=l.length-1;0<=m;m--){var x=0|l[m];h&&x==r||(o[m]=x,h=!1)}this.g=o}(Ar=Ss.prototype).Oa=function(l){this.M=l},Ar.ha=function(l,r,o,h){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+l);r=r?r.toUpperCase():"GET",this.I=l,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Jw.g(),this.C=function ab(l){return l.h||(l.h=l.i())}(this.u?this.u:Jw),this.g.onreadystatechange=xl(this.La,this);try{this.G=!0,this.g.open(r,String(l),!0),this.G=!1}catch(x){return void Eh(this,x)}if(l=o||"",o=new Map(this.headers),h)if(Object.getPrototypeOf(h)===Object.prototype)for(var m in h)o.set(m,h[m]);else{if("function"!=typeof h.keys||"function"!=typeof h.get)throw Error("Unknown input type for opt_headers: "+String(h));for(const x of h.keys())o.set(x,h.get(x))}h=Array.from(o.keys()).find(x=>"content-type"==x.toLowerCase()),m=Di.FormData&&l instanceof Di.FormData,!(0<=Fw($u,r))||h||m||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,T]of o)this.g.setRequestHeader(x,T);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{bv(this),0<this.B&&((this.L=function e_(l){return Mg&&"number"==typeof l.timeout&&void 0!==l.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xl(this.ua,this)):this.A=Ww(this.ua,this.B,this)),this.v=!0,this.g.send(l),this.v=!1}catch(x){Eh(this,x)}},Ar.ua=function(){typeof Lw<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,wl(this,"timeout"),this.abort(8))},Ar.abort=function(l){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=l||7,wl(this,"complete"),wl(this,"abort"),Gp(this))},Ar.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gp(this,!0)),Ss.$.N.call(this)},Ar.La=function(){this.s||(this.G||this.v||this.l?t_(this):this.kb())},Ar.kb=function(){t_(this)},Ar.isActive=function(){return!!this.g},Ar.da=function(){try{return 2<Ul(this)?this.g.status:-1}catch{return-1}},Ar.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},Ar.Wa=function(l){if(this.g){var r=this.g.responseText;return l&&0==r.indexOf(l)&&(r=r.substring(l.length)),gA(r)}},Ar.Ia=function(){return this.m},Ar.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ar=gb.prototype).ra=8,Ar.H=1,Ar.Na=function(l){if(this.m)if(this.m=null,1==this.H){if(!l){this.W=Math.floor(1e5*Math.random()),l=this.W++;const m=new Yg(this,this.l,l);let x=this.s;if(this.U&&(x?(x=Lg(x),Ni(x,this.U)):x=this.U),null!==this.o||this.O||(m.I=x,x=null),this.P)e:{for(var r=0,o=0;o<this.j.length;o++){var h=this.j[o];if(void 0===(h="__data__"in h.map&&"string"==typeof(h=h.map.__data__)?h.length:void 0))break;if(4096<(r+=h)){r=o;break e}if(4096===r||o===this.j.length-1){r=o+1;break e}}r=1e3}else r=1e3;r=hu(this,m,r),Cs(o=Vu(this.I),"RID",l),Cs(o,"CVER",22),this.F&&Cs(o,"X-HTTP-Session-Id",this.F),Lc(this,o),x&&(this.O?r="headers="+encodeURIComponent(String(vA(x)))+"&"+r:this.o&&Df(o,this.o,x)),gv(this.i,m),this.bb&&Cs(o,"TYPE","init"),this.P?(Cs(o,"$req",r),Cs(o,"SID","null"),m.aa=!0,Fu(m,o,null)):Fu(m,o,r),this.H=2}}else 3==this.H&&(l?Wp(this,l):0==this.j.length||fb(this.i)||Wp(this))},Ar.Ma=function(){if(this.u=null,wv(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var l=2*this.S;this.l.info("BP detection timer enabled: "+l),this.B=zp(xl(this.jb,this),l)}},Ar.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Da(10),Hp(this),wv(this))},Ar.ib=function(){null!=this.v&&(this.v=null,Hp(this),ks(this),Da(19))},Ar.pb=function(l){l?(this.l.info("Successfully pinged google.com"),Da(2)):(this.l.info("Failed to ping google.com"),Da(1))},Ar.isActive=function(){return!!this.h&&this.h.isActive(this)},(Ar=Zp.prototype).Ba=function(){},Ar.Aa=function(){},Ar.za=function(){},Ar.ya=function(){},Ar.isActive=function(){return!0},Ar.Va=function(){},Fc.prototype.g=function(l,r){return new oa(l,r)},Na(oa,nl),oa.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var l=this.g,r=this.l,o=this.h||void 0;Da(0),l.Y=r,l.na=o||{},l.G=l.aa,l.I=Yp(l,null,l.Y),n_(l)},oa.prototype.close=function(){uE(this.g)},oa.prototype.u=function(l){var r=this.g;if("string"==typeof l){var o={};o.__data__=l,l=o}else this.v&&((o={}).__data__=$w(l),l=o);r.j.push(new sE(r.fb++,l)),3==r.H&&n_(r)},oa.prototype.N=function(){this.g.h=null,delete this.j,uE(this.g),delete this.g,oa.$.N.call(this)},Na(Gu,qg),Na(Kp,lb),Na(Od,Zp),Od.prototype.Ba=function(){wl(this.g,"a")},Od.prototype.Aa=function(l){wl(this.g,new Gu(l))},Od.prototype.za=function(l){wl(this.g,new Kp)},Od.prototype.ya=function(){wl(this.g,"b")},Na(fu,function xA(){this.blockSize=-1}),fu.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},fu.prototype.j=function(l,r){void 0===r&&(r=l.length);for(var o=r-this.blockSize,h=this.m,m=this.h,x=0;x<r;){if(0==m)for(;x<=o;)Ih(this,l,x),x+=this.blockSize;if("string"==typeof l){for(;x<r;)if(h[m++]=l.charCodeAt(x++),m==this.blockSize){Ih(this,h),m=0;break}}else for(;x<r;)if(h[m++]=l[x++],m==this.blockSize){Ih(this,h),m=0;break}}this.h=m,this.i+=r},fu.prototype.l=function(){var l=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);l[0]=128;for(var r=1;r<l.length-8;++r)l[r]=0;var o=8*this.i;for(r=l.length-8;r<l.length;++r)l[r]=255&o,o/=256;for(this.j(l),l=Array(16),r=o=0;4>r;++r)for(var h=0;32>h;h+=8)l[o++]=this.g[r]>>>h&255;return l};var bA={};function Ev(l){return-128<=l&&128>l?function rA(l,r){var o=bA;return Object.prototype.hasOwnProperty.call(o,l)?o[l]:o[l]=r(l)}(l,function(r){return new Po([0|r],0>r?-1:0)}):new Po([0|l],0>l?-1:0)}function pu(l){if(isNaN(l)||!isFinite(l))return r_;if(0>l)return Fa(pu(-l));for(var r=[],o=1,h=0;l>=o;h++)r[h]=l/o|0,o*=Hu;return new Po(r,0)}var Hu=4294967296,r_=Ev(0),_b=Ev(1),yb=Ev(16777216);function rl(l){if(0!=l.h)return!1;for(var r=0;r<l.g.length;r++)if(0!=l.g[r])return!1;return!0}function mc(l){return-1==l.h}function Fa(l){for(var r=l.g.length,o=[],h=0;h<r;h++)o[h]=~l.g[h];return new Po(o,~l.h).add(_b)}function Xp(l,r){return l.add(Fa(r))}function i_(l,r){for(;(65535&l[r])!=l[r];)l[r+1]+=l[r]>>>16,l[r]&=65535,r++}function vb(l,r){this.g=l,this.h=r}function xb(l,r){if(rl(r))throw Error("division by zero");if(rl(l))return new vb(r_,r_);if(mc(l))return r=xb(Fa(l),r),new vb(Fa(r.g),Fa(r.h));if(mc(r))return r=xb(l,Fa(r)),new vb(Fa(r.g),r.h);if(30<l.g.length){if(mc(l)||mc(r))throw Error("slowDivide_ only works with positive integers.");for(var o=_b,h=r;0>=h.X(l);)o=Tv(o),h=Tv(h);var m=kd(o,1),x=kd(h,1);for(h=kd(h,2),o=kd(o,2);!rl(h);){var T=x.add(h);0>=T.X(l)&&(m=m.add(o),x=T),h=kd(h,1),o=kd(o,1)}return r=Xp(l,m.R(r)),new vb(m,r)}for(m=r_;0<=l.X(r);){for(o=Math.max(1,Math.floor(l.ea()/r.ea())),h=48>=(h=Math.ceil(Math.log(o)/Math.LN2))?1:Math.pow(2,h-48),T=(x=pu(o)).R(r);mc(T)||0<T.X(l);)T=(x=pu(o-=h)).R(r);rl(x)&&(x=_b),m=m.add(x),l=Xp(l,T)}return new vb(m,l)}function Tv(l){for(var r=l.g.length+1,o=[],h=0;h<r;h++)o[h]=l.D(h)<<1|l.D(h-1)>>>31;return new Po(o,l.h)}function kd(l,r){var o=r>>5;r%=32;for(var h=l.g.length-o,m=[],x=0;x<h;x++)m[x]=0<r?l.D(x+o)>>>r|l.D(x+o+1)<<32-r:l.D(x+o);return new Po(m,l.h)}(Ar=Po.prototype).ea=function(){if(mc(this))return-Fa(this).ea();for(var l=0,r=1,o=0;o<this.g.length;o++){var h=this.D(o);l+=(0<=h?h:Hu+h)*r,r*=Hu}return l},Ar.toString=function(l){if(2>(l=l||10)||36<l)throw Error("radix out of range: "+l);if(rl(this))return"0";if(mc(this))return"-"+Fa(this).toString(l);for(var r=pu(Math.pow(l,6)),o=this,h="";;){var m=xb(o,r).g,x=((0<(o=Xp(o,m.R(r))).g.length?o.g[0]:o.h)>>>0).toString(l);if(rl(o=m))return x+h;for(;6>x.length;)x="0"+x;h=x+h}},Ar.D=function(l){return 0>l?0:l<this.g.length?this.g[l]:this.h},Ar.X=function(l){return mc(l=Xp(this,l))?-1:rl(l)?0:1},Ar.abs=function(){return mc(this)?Fa(this):this},Ar.add=function(l){for(var r=Math.max(this.g.length,l.g.length),o=[],h=0,m=0;m<=r;m++){var x=h+(65535&this.D(m))+(65535&l.D(m)),T=(x>>>16)+(this.D(m)>>>16)+(l.D(m)>>>16);h=T>>>16,o[m]=(T&=65535)<<16|(x&=65535)}return new Po(o,-2147483648&o[o.length-1]?-1:0)},Ar.R=function(l){if(rl(this)||rl(l))return r_;if(mc(this))return mc(l)?Fa(this).R(Fa(l)):Fa(Fa(this).R(l));if(mc(l))return Fa(this.R(Fa(l)));if(0>this.X(yb)&&0>l.X(yb))return pu(this.ea()*l.ea());for(var r=this.g.length+l.g.length,o=[],h=0;h<2*r;h++)o[h]=0;for(h=0;h<this.g.length;h++)for(var m=0;m<l.g.length;m++){var x=this.D(h)>>>16,T=65535&this.D(h),k=l.D(m)>>>16,U=65535&l.D(m);o[2*h+2*m]+=T*U,i_(o,2*h+2*m),o[2*h+2*m+1]+=x*U,i_(o,2*h+2*m+1),o[2*h+2*m+1]+=T*k,i_(o,2*h+2*m+1),o[2*h+2*m+2]+=x*k,i_(o,2*h+2*m+2)}for(h=0;h<r;h++)o[h]=o[2*h+1]<<16|o[2*h];for(h=r;h<2*r;h++)o[h]=0;return new Po(o,0)},Ar.gb=function(l){return xb(this,l).h},Ar.and=function(l){for(var r=Math.max(this.g.length,l.g.length),o=[],h=0;h<r;h++)o[h]=this.D(h)&l.D(h);return new Po(o,this.h&l.h)},Ar.or=function(l){for(var r=Math.max(this.g.length,l.g.length),o=[],h=0;h<r;h++)o[h]=this.D(h)|l.D(h);return new Po(o,this.h|l.h)},Ar.xor=function(l){for(var r=Math.max(this.g.length,l.g.length),o=[],h=0;h<r;h++)o[h]=this.D(h)^l.D(h);return new Po(o,this.h^l.h)},Fc.prototype.createWebChannel=Fc.prototype.g,oa.prototype.send=oa.prototype.u,oa.prototype.open=oa.prototype.m,oa.prototype.close=oa.prototype.close,Af.NO_ERROR=0,Af.TIMEOUT=8,Af.HTTP_ERROR=6,Qw.COMPLETE="complete",Nu.EventType=Wg,Wg.OPEN="a",Wg.CLOSE="b",Wg.ERROR="c",Wg.MESSAGE="d",nl.prototype.listen=nl.prototype.O,Ss.prototype.listenOnce=Ss.prototype.P,Ss.prototype.getLastError=Ss.prototype.Sa,Ss.prototype.getLastErrorCode=Ss.prototype.Ia,Ss.prototype.getStatus=Ss.prototype.da,Ss.prototype.getResponseJson=Ss.prototype.Wa,Ss.prototype.getResponseText=Ss.prototype.ja,Ss.prototype.send=Ss.prototype.ha,Ss.prototype.setWithCredentials=Ss.prototype.Oa,fu.prototype.digest=fu.prototype.l,fu.prototype.reset=fu.prototype.reset,fu.prototype.update=fu.prototype.j,Po.prototype.add=Po.prototype.add,Po.prototype.multiply=Po.prototype.R,Po.prototype.modulo=Po.prototype.gb,Po.prototype.compare=Po.prototype.X,Po.prototype.toNumber=Po.prototype.ea,Po.prototype.toString=Po.prototype.toString,Po.prototype.getBits=Po.prototype.D,Po.fromNumber=pu,Po.fromString=function Iv(l,r){if(0==l.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==l.charAt(0))return Fa(Iv(l.substring(1),r));if(0<=l.indexOf("-"))throw Error('number format error: interior "-" character');for(var o=pu(Math.pow(r,8)),h=r_,m=0;m<l.length;m+=8){var x=Math.min(8,l.length-m),T=parseInt(l.substring(m,m+x),r);8>x?(x=pu(Math.pow(r,x)),h=h.R(x).add(pu(T))):h=(h=h.R(o)).add(pu(T))}return h},zl.createWebChannelTransport=function(){return new Fc},zl.getStatEventTarget=function(){return sb()},zl.ErrorCode=Af,zl.EventType=Qw,zl.Event=Vp,zl.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},zl.FetchXmlHttpFactory=wh,zl.WebChannel=Nu,zl.XhrIo=Ss,zl.Md5=fu;var NS=zl.Integer=Po;const EA="@firebase/firestore";class Ba{constructor(r){this.uid=r}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(r){return r.uid===this.uid}}Ba.UNAUTHENTICATED=new Ba(null),Ba.GOOGLE_CREDENTIALS=new Ba("google-credentials-uid"),Ba.FIRST_PARTY=new Ba("first-party-uid"),Ba.MOCK_USER=new Ba("mock-user");let Sv="10.7.0";const mu=new Wi("@firebase/firestore");function jn(l,...r){if(mu.logLevel<=ti.DEBUG){const o=r.map(wa);mu.debug(`Firestore (${Sv}): ${l}`,...o)}}function Wo(l,...r){if(mu.logLevel<=ti.ERROR){const o=r.map(wa);mu.error(`Firestore (${Sv}): ${l}`,...o)}}function wa(l){if("string"==typeof l)return l;try{return JSON.stringify(l)}catch{return l}}function Mr(l="Unexpected state"){const r=`FIRESTORE (${Sv}) INTERNAL ASSERTION FAILED: `+l;throw Wo(r),new Error(r)}function qr(l,r){l||Mr()}const gn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qn extends cn{constructor(r,o){super(r,o),this.code=r,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ma{constructor(){this.promise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}}class mE{constructor(r,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${r}`)}}class FS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(r,o){r.enqueueRetryable(()=>o(Ba.UNAUTHENTICATED))}shutdown(){}}class BS{constructor(r){this.token=r,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(r,o){this.changeListener=o,r.enqueueRetryable(()=>o(this.token.user))}shutdown(){this.changeListener=null}}class zo{constructor(r){this.t=r,this.currentUser=Ba.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(r,o){var h=this;let m=this.i;const x=te=>this.i!==m?(m=this.i,o(te)):Promise.resolve();let T=new Ma;this.o=()=>{this.i++,this.currentUser=this.u(),T.resolve(),T=new Ma,r.enqueueRetryable(()=>x(this.currentUser))};const k=()=>{const te=T;r.enqueueRetryable((0,ze.Z)(function*(){yield te.promise,yield x(h.currentUser)}))},U=te=>{jn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=te,this.auth.addAuthTokenListener(this.o),k()};this.t.onInit(te=>U(te)),setTimeout(()=>{if(!this.auth){const te=this.t.getImmediate({optional:!0});te?U(te):(jn("FirebaseAuthCredentialsProvider","Auth not yet detected"),T.resolve(),T=new Ma)}},0),k()}getToken(){const r=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(h=>this.i!==r?(jn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):h?(qr("string"==typeof h.accessToken),new mE(h.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const r=this.auth&&this.auth.getUid();return qr(null===r||"string"==typeof r),new Ba(r)}}class gE{constructor(r,o,h){this.l=r,this.h=o,this.P=h,this.type="FirstParty",this.user=Ba.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const r=this.T();return r&&this.I.set("Authorization",r),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Mv{constructor(r,o,h){this.l=r,this.h=o,this.P=h}getToken(){return Promise.resolve(new gE(this.l,this.h,this.P))}start(r,o){r.enqueueRetryable(()=>o(Ba.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class IA{constructor(r){this.value=r,this.type="AppCheck",this.headers=new Map,r&&r.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class TA{constructor(r){this.A=r,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(r,o){const h=x=>{null!=x.error&&jn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${x.error.message}`);const T=x.token!==this.R;return this.R=x.token,jn("FirebaseAppCheckTokenProvider",`Received ${T?"new":"existing"} token.`),T?o(x.token):Promise.resolve()};this.o=x=>{r.enqueueRetryable(()=>h(x))};const m=x=>{jn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=x,this.appCheck.addTokenListener(this.o)};this.A.onInit(x=>m(x)),setTimeout(()=>{if(!this.appCheck){const x=this.A.getImmediate({optional:!0});x?m(x):jn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const r=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(r).then(o=>o?(qr("string"==typeof o.token),this.R=o.token,new IA(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function VS(l){const r=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(l);if(r&&"function"==typeof r.getRandomValues)r.getRandomValues(o);else for(let h=0;h<l;h++)o[h]=Math.floor(256*Math.random());return o}class _E{static newId(){const o=62*Math.floor(256/62);let h="";for(;h.length<20;){const m=VS(40);for(let x=0;x<m.length;++x)h.length<20&&m[x]<o&&(h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(m[x]%62))}return h}}function ki(l,r){return l<r?-1:l>r?1:0}class bb{constructor(r,o,h){void 0===o?o=0:o>r.length&&Mr(),void 0===h?h=r.length-o:h>r.length-o&&Mr(),this.segments=r,this.offset=o,this.len=h}get length(){return this.len}isEqual(r){return 0===bb.comparator(this,r)}child(r){const o=this.segments.slice(this.offset,this.limit());return r instanceof bb?r.forEach(h=>{o.push(h)}):o.push(r),this.construct(o)}limit(){return this.offset+this.length}popFirst(r){return this.construct(this.segments,this.offset+(r=void 0===r?1:r),this.length-r)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(r){return this.segments[this.offset+r]}isEmpty(){return 0===this.length}isPrefixOf(r){if(r.length<this.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==r.get(o))return!1;return!0}isImmediateParentOf(r){if(this.length+1!==r.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==r.get(o))return!1;return!0}forEach(r){for(let o=this.offset,h=this.limit();o<h;o++)r(this.segments[o])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(r,o){const h=Math.min(r.length,o.length);for(let m=0;m<h;m++){const x=r.get(m),T=o.get(m);if(x<T)return-1;if(x>T)return 1}return r.length<o.length?-1:r.length>o.length?1:0}}class Co extends bb{construct(r,o,h){return new Co(r,o,h)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...r){const o=[];for(const h of r){if(h.indexOf("//")>=0)throw new qn(gn.INVALID_ARGUMENT,`Invalid segment (${h}). Paths must not contain // in them.`);o.push(...h.split("/").filter(m=>m.length>0))}return new Co(o)}static emptyPath(){return new Co([])}}class Cr{constructor(r){this.path=r}static fromPath(r){return new Cr(Co.fromString(r))}static fromName(r){return new Cr(Co.fromString(r).popFirst(5))}static empty(){return new Cr(Co.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(r){return this.path.length>=2&&this.path.get(this.path.length-2)===r}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(r){return null!==r&&0===Co.comparator(this.path,r.path)}toString(){return this.path.toString()}static comparator(r,o){return Co.comparator(r.path,o.path)}static isDocumentKey(r){return r.length%2==0}static fromSegments(r){return new Cr(new Co(r.slice()))}}function Rr(l){return"IndexedDbTransactionError"===l.name}class ys{constructor(r,o){this.comparator=r,this.root=o||Va.EMPTY}insert(r,o){return new ys(this.comparator,this.root.insert(r,o,this.comparator).copy(null,null,Va.BLACK,null,null))}remove(r){return new ys(this.comparator,this.root.remove(r,this.comparator).copy(null,null,Va.BLACK,null,null))}get(r){let o=this.root;for(;!o.isEmpty();){const h=this.comparator(r,o.key);if(0===h)return o.value;h<0?o=o.left:h>0&&(o=o.right)}return null}indexOf(r){let o=0,h=this.root;for(;!h.isEmpty();){const m=this.comparator(r,h.key);if(0===m)return o+h.left.size;m<0?h=h.left:(o+=h.left.size+1,h=h.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(r){return this.root.inorderTraversal(r)}forEach(r){this.inorderTraversal((o,h)=>(r(o,h),!1))}toString(){const r=[];return this.inorderTraversal((o,h)=>(r.push(`${o}:${h}`),!1)),`{${r.join(", ")}}`}reverseTraversal(r){return this.root.reverseTraversal(r)}getIterator(){return new Fv(this.root,null,this.comparator,!1)}getIteratorFrom(r){return new Fv(this.root,r,this.comparator,!1)}getReverseIterator(){return new Fv(this.root,null,this.comparator,!0)}getReverseIteratorFrom(r){return new Fv(this.root,r,this.comparator,!0)}}class Fv{constructor(r,o,h,m){this.isReverse=m,this.nodeStack=[];let x=1;for(;!r.isEmpty();)if(x=o?h(r.key,o):1,o&&m&&(x*=-1),x<0)r=this.isReverse?r.left:r.right;else{if(0===x){this.nodeStack.push(r);break}this.nodeStack.push(r),r=this.isReverse?r.right:r.left}}getNext(){let r=this.nodeStack.pop();const o={key:r.key,value:r.value};if(this.isReverse)for(r=r.left;!r.isEmpty();)this.nodeStack.push(r),r=r.right;else for(r=r.right;!r.isEmpty();)this.nodeStack.push(r),r=r.left;return o}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const r=this.nodeStack[this.nodeStack.length-1];return{key:r.key,value:r.value}}}class Va{constructor(r,o,h,m,x){this.key=r,this.value=o,this.color=null!=h?h:Va.RED,this.left=null!=m?m:Va.EMPTY,this.right=null!=x?x:Va.EMPTY,this.size=this.left.size+1+this.right.size}copy(r,o,h,m,x){return new Va(null!=r?r:this.key,null!=o?o:this.value,null!=h?h:this.color,null!=m?m:this.left,null!=x?x:this.right)}isEmpty(){return!1}inorderTraversal(r){return this.left.inorderTraversal(r)||r(this.key,this.value)||this.right.inorderTraversal(r)}reverseTraversal(r){return this.right.reverseTraversal(r)||r(this.key,this.value)||this.left.reverseTraversal(r)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(r,o,h){let m=this;const x=h(r,m.key);return m=x<0?m.copy(null,null,null,m.left.insert(r,o,h),null):0===x?m.copy(null,o,null,null,null):m.copy(null,null,null,null,m.right.insert(r,o,h)),m.fixUp()}removeMin(){if(this.left.isEmpty())return Va.EMPTY;let r=this;return r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.removeMin(),null),r.fixUp()}remove(r,o){let h,m=this;if(o(r,m.key)<0)m.left.isEmpty()||m.left.isRed()||m.left.left.isRed()||(m=m.moveRedLeft()),m=m.copy(null,null,null,m.left.remove(r,o),null);else{if(m.left.isRed()&&(m=m.rotateRight()),m.right.isEmpty()||m.right.isRed()||m.right.left.isRed()||(m=m.moveRedRight()),0===o(r,m.key)){if(m.right.isEmpty())return Va.EMPTY;h=m.right.min(),m=m.copy(h.key,h.value,null,null,m.right.removeMin())}m=m.copy(null,null,null,null,m.right.remove(r,o))}return m.fixUp()}isRed(){return this.color}fixUp(){let r=this;return r.right.isRed()&&!r.left.isRed()&&(r=r.rotateLeft()),r.left.isRed()&&r.left.left.isRed()&&(r=r.rotateRight()),r.left.isRed()&&r.right.isRed()&&(r=r.colorFlip()),r}moveRedLeft(){let r=this.colorFlip();return r.right.left.isRed()&&(r=r.copy(null,null,null,null,r.right.rotateRight()),r=r.rotateLeft(),r=r.colorFlip()),r}moveRedRight(){let r=this.colorFlip();return r.left.left.isRed()&&(r=r.rotateRight(),r=r.colorFlip()),r}rotateLeft(){const r=this.copy(null,null,Va.RED,null,this.right.left);return this.right.copy(null,null,this.color,r,null)}rotateRight(){const r=this.copy(null,null,Va.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,r)}colorFlip(){const r=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,r,o)}checkMaxDepth(){const r=this.check();return Math.pow(2,r)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Mr();const r=this.left.check();if(r!==this.right.check())throw Mr();return r+(this.isRed()?0:1)}}Va.EMPTY=null,Va.RED=!0,Va.BLACK=!1,Va.EMPTY=new class{constructor(){this.size=0}get key(){throw Mr()}get value(){throw Mr()}get color(){throw Mr()}get left(){throw Mr()}get right(){throw Mr()}copy(r,o,h,m,x){return this}insert(r,o,h){return new Va(r,o)}remove(r,o){return this}isEmpty(){return!0}inorderTraversal(r){return!1}reverseTraversal(r){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ko{constructor(r){this.comparator=r,this.data=new ys(this.comparator)}has(r){return null!==this.data.get(r)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(r){return this.data.indexOf(r)}forEach(r){this.data.inorderTraversal((o,h)=>(r(o),!1))}forEachInRange(r,o){const h=this.data.getIteratorFrom(r[0]);for(;h.hasNext();){const m=h.getNext();if(this.comparator(m.key,r[1])>=0)return;o(m.key)}}forEachWhile(r,o){let h;for(h=void 0!==o?this.data.getIteratorFrom(o):this.data.getIterator();h.hasNext();)if(!r(h.getNext().key))return}firstAfterOrEqual(r){const o=this.data.getIteratorFrom(r);return o.hasNext()?o.getNext().key:null}getIterator(){return new rm(this.data.getIterator())}getIteratorFrom(r){return new rm(this.data.getIteratorFrom(r))}add(r){return this.copy(this.data.remove(r).insert(r,!0))}delete(r){return this.has(r)?this.copy(this.data.remove(r)):this}isEmpty(){return this.data.isEmpty()}unionWith(r){let o=this;return o.size<r.size&&(o=r,r=this),r.forEach(h=>{o=o.add(h)}),o}isEqual(r){if(!(r instanceof Ko)||this.size!==r.size)return!1;const o=this.data.getIterator(),h=r.data.getIterator();for(;o.hasNext();){const m=o.getNext().key,x=h.getNext().key;if(0!==this.comparator(m,x))return!1}return!0}toArray(){const r=[];return this.forEach(o=>{r.push(o)}),r}toString(){const r=[];return this.forEach(o=>r.push(o)),"SortedSet("+r.toString()+")"}copy(r){const o=new Ko(this.comparator);return o.data=r,o}}class rm{constructor(r){this.iter=r}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sa{constructor(r){this.binaryString=r}static fromBase64String(r){const o=function(m){try{return atob(m)}catch(x){throw typeof DOMException<"u"&&x instanceof DOMException?new Cb("Invalid base64 string: "+x):x}}(r);return new sa(o)}static fromUint8Array(r){const o=function(m){let x="";for(let T=0;T<m.length;++T)x+=String.fromCharCode(m[T]);return x}(r);return new sa(o)}[Symbol.iterator](){let r=0;return{next:()=>r<this.binaryString.length?{value:this.binaryString.charCodeAt(r++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(o){const h=new Uint8Array(o.length);for(let m=0;m<o.length;m++)h[m]=o.charCodeAt(m);return h}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(r){return ki(this.binaryString,r.binaryString)}isEqual(r){return this.binaryString===r.binaryString}}function Qs(l){return"number"==typeof l?l:"string"==typeof l?Number(l):0}sa.EMPTY_BYTE_STRING=new sa("");class LA{constructor(r,o,h,m,x,T,k,U,te){this.databaseId=r,this.appId=o,this.persistenceKey=h,this.host=m,this.ssl=x,this.forceLongPolling=T,this.autoDetectLongPolling=k,this.longPollingOptions=U,this.useFetchStreams=te}}class Sh{constructor(r,o){this.projectId=r,this.database=o||"(default)"}static empty(){return new Sh("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(r){return r instanceof Sh&&r.projectId===this.projectId&&r.database===this.database}}var Xo,ro;new ys(Cr.comparator),new ys(Cr.comparator),new ys(Cr.comparator),new Ko(Cr.comparator),new Ko(ki),(ro=Xo||(Xo={}))[ro.OK=0]="OK",ro[ro.CANCELLED=1]="CANCELLED",ro[ro.UNKNOWN=2]="UNKNOWN",ro[ro.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ro[ro.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ro[ro.NOT_FOUND=5]="NOT_FOUND",ro[ro.ALREADY_EXISTS=6]="ALREADY_EXISTS",ro[ro.PERMISSION_DENIED=7]="PERMISSION_DENIED",ro[ro.UNAUTHENTICATED=16]="UNAUTHENTICATED",ro[ro.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ro[ro.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ro[ro.ABORTED=10]="ABORTED",ro[ro.OUT_OF_RANGE=11]="OUT_OF_RANGE",ro[ro.UNIMPLEMENTED=12]="UNIMPLEMENTED",ro[ro.INTERNAL=13]="INTERNAL",ro[ro.UNAVAILABLE=14]="UNAVAILABLE",ro[ro.DATA_LOSS=15]="DATA_LOSS",new NS([4294967295,4294967295],0);class Yf{constructor(){}ht(r,o){this.Pt(r,o),o.It()}Pt(r,o){if("nullValue"in r)this.Tt(o,5);else if("booleanValue"in r)this.Tt(o,10),o.Et(r.booleanValue?1:0);else if("integerValue"in r)this.Tt(o,15),o.Et(Qs(r.integerValue));else if("doubleValue"in r){const h=Qs(r.doubleValue);isNaN(h)?this.Tt(o,13):(this.Tt(o,15),function ec(l){return 0===l&&1/l==-1/0}(h)?o.Et(0):o.Et(h))}else if("timestampValue"in r){const h=r.timestampValue;this.Tt(o,20),"string"==typeof h?o.dt(h):(o.dt(`${h.seconds||""}`),o.Et(h.nanos||0))}else if("stringValue"in r)this.At(r.stringValue,o),this.Rt(o);else if("bytesValue"in r)this.Tt(o,30),o.Vt(function nc(l){return"string"==typeof l?sa.fromBase64String(l):sa.fromUint8Array(l)}(r.bytesValue)),this.Rt(o);else if("referenceValue"in r)this.ft(r.referenceValue,o);else if("geoPointValue"in r){const h=r.geoPointValue;this.Tt(o,45),o.Et(h.latitude||0),o.Et(h.longitude||0)}else"mapValue"in r?function Mh(l){return"__max__"===(((l.mapValue||{}).fields||{}).__type__||{}).stringValue}(r)?this.Tt(o,Number.MAX_SAFE_INTEGER):(this.gt(r.mapValue,o),this.Rt(o)):"arrayValue"in r?(this.yt(r.arrayValue,o),this.Rt(o)):Mr()}At(r,o){this.Tt(o,25),this.wt(r,o)}wt(r,o){o.dt(r)}gt(r,o){const h=r.fields||{};this.Tt(o,55);for(const m of Object.keys(h))this.At(m,o),this.Pt(h[m],o)}yt(r,o){const h=r.values||[];this.Tt(o,50);for(const m of h)this.Pt(m,o)}ft(r,o){this.Tt(o,37),Cr.fromName(r).path.forEach(h=>{this.Tt(o,60),this.wt(h,o)})}Tt(r,o){r.Et(o)}Rt(r){r.Et(2)}}Yf.St=new Yf,new Uint8Array(0);class ol{constructor(r,o,h){this.cacheSizeCollectionThreshold=r,this.percentileToCollect=o,this.maximumSequenceNumbersToCollect=h}static withCacheSize(r){return new ol(r,ol.DEFAULT_COLLECTION_PERCENTILE,ol.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Qf(){return typeof document<"u"?document:null}ol.DEFAULT_COLLECTION_PERCENTILE=10,ol.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ol.DEFAULT=new ol(41943040,ol.DEFAULT_COLLECTION_PERCENTILE,ol.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ol.DISABLED=new ol(-1,0,0);class T1{constructor(r,o,h=1e3,m=1.5,x=6e4){this.si=r,this.timerId=o,this.Fo=h,this.Mo=m,this.xo=x,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(r){this.cancel();const o=Math.floor(this.Oo+this.qo()),h=Math.max(0,Date.now()-this.Bo),m=Math.max(0,o-h);m>0&&jn("ExponentialBackoff",`Backing off for ${m} ms (base delay: ${this.Oo} ms, delay with jitter: ${o} ms, last attempt: ${h} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,m,()=>(this.Bo=Date.now(),r())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class Mm{constructor(r,o,h,m,x){this.asyncQueue=r,this.timerId=o,this.targetTimeMs=h,this.op=m,this.removalCallback=x,this.deferred=new Ma,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(T=>{})}get promise(){return this.deferred.promise}static createAndSchedule(r,o,h,m,x){const T=Date.now()+h,k=new Mm(r,o,T,m,x);return k.start(h),k}start(r){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),r)}skipDelay(){return this.handleDelayElapsed()}cancel(r){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qn(gn.CANCELLED,"Operation cancelled"+(r?": "+r:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(r=>this.deferred.resolve(r))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Jn{constructor(r,o,h,m){var x=this;this.authCredentials=r,this.appCheckCredentials=o,this.asyncQueue=h,this.databaseInfo=m,this.user=Ba.UNAUTHENTICATED,this.clientId=_E.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(h,function(){var T=(0,ze.Z)(function*(k){jn("FirestoreClient","Received user=",k.uid),yield x.authCredentialListener(k),x.user=k});return function(k){return T.apply(this,arguments)}}()),this.appCheckCredentials.start(h,T=>(jn("FirestoreClient","Received new app check token=",T),this.appCheckCredentialListener(T,this.user)))}getConfiguration(){var r=this;return(0,ze.Z)(function*(){return{asyncQueue:r.asyncQueue,databaseInfo:r.databaseInfo,clientId:r.clientId,authCredentials:r.authCredentials,appCheckCredentials:r.appCheckCredentials,initialUser:r.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(r){this.authCredentialListener=r}setAppCheckTokenChangeListener(r){this.appCheckCredentialListener=r}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qn(gn.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var r=this;this.asyncQueue.enterRestrictedMode();const o=new Ma;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,ze.Z)(function*(){try{r._onlineComponents&&(yield r._onlineComponents.terminate()),r._offlineComponents&&(yield r._offlineComponents.terminate()),r.authCredentials.shutdown(),r.appCheckCredentials.shutdown(),o.resolve()}catch(h){const m=function Rm(l,r){if(Wo("AsyncQueue",`${r}: ${l}`),Rr(l))return new qn(gn.UNAVAILABLE,`${r}: ${l}`);throw l}(h,"Failed to shutdown persistence");o.reject(m)}})),o.promise}}function N1(l){const r={};return void 0!==l.timeoutSeconds&&(r.timeoutSeconds=l.timeoutSeconds),r}const NI=new Map;function uo(l,r){if("_delegate"in l&&(l=l._delegate),!(l instanceof r)){if(r.name===l.constructor.name)throw new qn(gn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=function rp(l){if(void 0===l)return"undefined";if(null===l)return"null";if("string"==typeof l)return l.length>20&&(l=`${l.substring(0,20)}...`),JSON.stringify(l);if("number"==typeof l||"boolean"==typeof l)return""+l;if("object"==typeof l){if(l instanceof Array)return"an array";{const r=(h=l).constructor?h.constructor.name:null;return r?`a custom ${r} object`:"an object"}}var h;return"function"==typeof l?"a function":Mr()}(l);throw new qn(gn.INVALID_ARGUMENT,`Expected type '${r.name}', but it was: ${o}`)}}return l}class Qd{constructor(r){var o,h;if(void 0===r.host){if(void 0!==r.ssl)throw new qn(gn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=r.host,this.ssl=null===(o=r.ssl)||void 0===o||o;if(this.credentials=r.credentials,this.ignoreUndefinedProperties=!!r.ignoreUndefinedProperties,this.localCache=r.localCache,void 0===r.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==r.cacheSizeBytes&&r.cacheSizeBytes<1048576)throw new qn(gn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=r.cacheSizeBytes}(function FI(l,r,o,h){if(!0===r&&!0===h)throw new qn(gn.INVALID_ARGUMENT,`${l} and ${o} cannot be used together.`)})("experimentalForceLongPolling",r.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",r.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!r.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==r.experimentalAutoDetectLongPolling&&!r.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=N1(null!==(h=r.experimentalLongPollingOptions)&&void 0!==h?h:{}),function(x){if(void 0!==x.timeoutSeconds){if(isNaN(x.timeoutSeconds))throw new qn(gn.INVALID_ARGUMENT,`invalid long polling timeout: ${x.timeoutSeconds} (must not be NaN)`);if(x.timeoutSeconds<5)throw new qn(gn.INVALID_ARGUMENT,`invalid long polling timeout: ${x.timeoutSeconds} (minimum allowed value is 5)`);if(x.timeoutSeconds>30)throw new qn(gn.INVALID_ARGUMENT,`invalid long polling timeout: ${x.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!r.useFetchStreams}isEqual(r){return this.host===r.host&&this.ssl===r.ssl&&this.credentials===r.credentials&&this.cacheSizeBytes===r.cacheSizeBytes&&this.experimentalForceLongPolling===r.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===r.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===r.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===r.ignoreUndefinedProperties&&this.useFetchStreams===r.useFetchStreams}}class ay{constructor(r,o,h,m){this._authCredentials=r,this._appCheckCredentials=o,this._databaseId=h,this._app=m,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new qn(gn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(r){if(this._settingsFrozen)throw new qn(gn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qd(r),void 0!==r.credentials&&(this._authCredentials=function(h){if(!h)return new FS;switch(h.type){case"firstParty":return new Mv(h.sessionIndex||"0",h.iamToken||null,h.authTokenFactory||null);case"provider":return h.client;default:throw new qn(gn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(r.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(o){const h=NI.get(o);h&&(jn("ComponentProvider","Removing Datastore"),NI.delete(o),h.terminate())}(this),Promise.resolve()}}function jh(l,r,o,h={}){var m;const x=(l=uo(l,ay))._getSettings(),T=`${r}:${o}`;if("firestore.googleapis.com"!==x.host&&x.host!==T&&function ba(l,...r){if(mu.logLevel<=ti.WARN){const o=r.map(wa);mu.warn(`Firestore (${Sv}): ${l}`,...o)}}("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),l._setSettings(Object.assign(Object.assign({},x),{host:T,ssl:!1})),h.mockUserToken){let k,U;if("string"==typeof h.mockUserToken)k=h.mockUserToken,U=Ba.MOCK_USER;else{k=function rr(l,r){if(l.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const h=r||"demo-project",m=l.iat||0,x=l.sub||l.user_id;if(!x)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const T=Object.assign({iss:`https://securetoken.google.com/${h}`,aud:h,iat:m,exp:m+3600,auth_time:m,sub:x,user_id:x,firebase:{sign_in_provider:"custom",identities:{}}},l);return[mt(JSON.stringify({alg:"none",type:"JWT"})),mt(JSON.stringify(T)),""].join(".")}(h.mockUserToken,null===(m=l._app)||void 0===m?void 0:m.options.projectId);const te=h.mockUserToken.sub||h.mockUserToken.user_id;if(!te)throw new qn(gn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");U=new Ba(te)}l._authCredentials=new BS(new mE(k,U))}}class N0{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new T1(this,"async_queue_retry"),this.iu=()=>{const o=Qf();o&&jn("AsyncQueue","Visibility state changed to "+o.visibilityState),this.zo.Qo()};const r=Qf();r&&"function"==typeof r.addEventListener&&r.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(r){this.enqueue(r)}enqueueAndForgetEvenWhileRestricted(r){this.su(),this.ou(r)}enterRestrictedMode(r){if(!this.Za){this.Za=!0,this.nu=r||!1;const o=Qf();o&&"function"==typeof o.removeEventListener&&o.removeEventListener("visibilitychange",this.iu)}}enqueue(r){if(this.su(),this.Za)return new Promise(()=>{});const o=new Ma;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(r().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(r){this.enqueueAndForget(()=>(this.Ya.push(r),this._u()))}_u(){var r=this;return(0,ze.Z)(function*(){if(0!==r.Ya.length){try{yield r.Ya[0](),r.Ya.shift(),r.zo.reset()}catch(o){if(!Rr(o))throw o;jn("AsyncQueue","Operation failed with retryable error: "+o)}r.Ya.length>0&&r.zo.ko(()=>r._u())}})()}ou(r){const o=this.Ja.then(()=>(this.tu=!0,r().catch(h=>{throw this.eu=h,this.tu=!1,Wo("INTERNAL UNHANDLED ERROR: ",function(T){let k=T.message||"";return T.stack&&(k=T.stack.includes(T.message)?T.stack:T.message+"\n"+T.stack),k}(h)),h}).then(h=>(this.tu=!1,h))));return this.Ja=o,o}enqueueAfterDelay(r,o,h){this.su(),this.ru.indexOf(r)>-1&&(o=0);const m=Mm.createAndSchedule(this,r,o,h,x=>this.au(x));return this.Xa.push(m),m}su(){this.eu&&Mr()}verifyOperationInProgress(){}uu(){var r=this;return(0,ze.Z)(function*(){let o;do{o=r.Ja,yield o}while(o!==r.Ja)})()}cu(r){for(const o of this.Xa)if(o.timerId===r)return!0;return!1}lu(r){return this.uu().then(()=>{this.Xa.sort((o,h)=>o.targetTimeMs-h.targetTimeMs);for(const o of this.Xa)if(o.skipDelay(),"all"!==r&&o.timerId===r)break;return this.uu()})}hu(r){this.ru.push(r)}au(r){const o=this.Xa.indexOf(r);this.Xa.splice(o,1)}}class Zs extends ay{constructor(r,o,h,m){super(r,o,h,m),this.type="firestore",this._queue=new N0,this._persistenceKey=(null==m?void 0:m.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||function mM(l){var r,o,h;const m=l._freezeSettings(),x=(U=(null===(r=l._app)||void 0===r?void 0:r.options.appId)||"",new LA(l._databaseId,U,l._persistenceKey,(fe=m).host,fe.ssl,fe.experimentalForceLongPolling,fe.experimentalAutoDetectLongPolling,N1(fe.experimentalLongPollingOptions),fe.useFetchStreams));var U,fe;l._firestoreClient=new Jn(l._authCredentials,l._appCheckCredentials,l._queue,x),null!==(o=m.localCache)&&void 0!==o&&o._offlineComponentProvider&&null!==(h=m.localCache)&&void 0!==h&&h._onlineComponentProvider&&(l._firestoreClient._uninitializedComponentsProvider={_offlineKind:m.localCache.kind,_offline:m.localCache._offlineComponentProvider,_online:m.localCache._onlineComponentProvider})}(this),this._firestoreClient.terminate()}}function VM(l,r){const h="string"==typeof l?l:r||"(default)",m=function ea(l,r){const o=l.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),l.container.getProvider(r)}("object"==typeof l?l:oc(),"firestore").getImmediate({identifier:h});if(!m._initialized){const x=(l=>{const r=(l=>{var r,o;return null===(o=null===(r=Xe())||void 0===r?void 0:r.emulatorHosts)||void 0===o?void 0:o[l]})(l);if(!r)return;const o=r.lastIndexOf(":");if(o<=0||o+1===r.length)throw new Error(`Invalid host ${r} with no separate hostname and port!`);const h=parseInt(r.substring(o+1),10);return"["===r[0]?[r.substring(1,o-1),h]:[r.substring(0,o),h]})("firestore");x&&jh(m,...x)}return m}!function(r,o=!0){Sv=Rl,Us(new es("firestore",(h,{instanceIdentifier:m,options:x})=>{const T=h.getProvider("app").getImmediate(),k=new Zs(new zo(h.getProvider("auth-internal")),new TA(h.getProvider("app-check-internal")),function(te,fe){if(!Object.prototype.hasOwnProperty.apply(te.options,["projectId"]))throw new qn(gn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sh(te.options.projectId,fe)}(T,m),T);return x=Object.assign({useFetchStreams:o},x),k._setSettings(x),k},"PUBLIC").setMultipleInstances(!0)),is(EA,"4.4.0",r),is(EA,"4.4.0","esm2017")}();class al{constructor(r){return r}}const sp="firestore",AD=new he.OlP("angularfire2.firestore-instances");function ZR(l){return(r,o)=>{const h=r.runOutsideAngular(()=>l(o));return new al(h)}}const KR={provide:class j1{constructor(){return Bo(sp)}},deps:[[new he.FiY,AD]]},XR={provide:al,useFactory:function PM(l,r){const o=function Vt(l,r,o){if(r){if(1===r.length)return r[0];const x=r.filter(T=>T.app===o);if(1===x.length)return x[0]}return o.container.getProvider(l).getImmediate({optional:!0})}(sp,l,r);return o&&new al(o)},deps:[[new he.FiY,AD],lp]};let QR=(()=>{var l;class r{constructor(){is("angularfire",ja.full,"fst")}}return l=r,Pt(r,"\u0275fac",function(h){return new(h||l)}),Pt(r,"\u0275mod",he.oAB({type:l})),Pt(r,"\u0275inj",he.cJS({providers:[XR,KR]})),r})();function JR(l,...r){return{ngModule:QR,providers:[{provide:AD,useFactory:ZR(l),multi:!0,deps:[he.R0b,he.zs3,sd,$0,[new he.FiY,lu],[new he.FiY,wu],...r]}]}}const eP=U0(VM,!0),OM_firebase={projectId:"avisos-devas-pwa",appId:"1:248933475067:web:5ed05d11b01a494de0865e",storageBucket:"avisos-devas-pwa.appspot.com",apiKey:"AIzaSyBlnbQvIAkCV14g5EN2r4auPP2qTxN6mno",authDomain:"avisos-devas-pwa.firebaseapp.com",messagingSenderId:"248933475067"};var pR=ae(4911),tP=ae(8504),mR=ae(2438),kM=ae(2096),gR=ae(5211),LM=ae(8645),_R=ae(2420);const WC=new Ia.y(_R.Z);var nP=ae(7537),NM=ae(4829),rP=ae(6232),yR=ae(9940),iP=ae(2459);function vR(...l){const r=(0,yR.yG)(l),o=(0,yR._6)(l,1/0),h=l;return h.length?1===h.length?(0,NM.Xf)(h[0]):(0,nP.J)(o)((0,iP.D)(h,r)):rP.E}var qC=ae(7398),CD=ae(2181),lM=ae(4664),oP=ae(3168),xR=ae(4674),bR=ae(9360);const aP={connector:()=>new LM.x};function wR(l,r=aP){const{connector:o}=r;return(0,bR.e)((h,m)=>{const x=o();(0,NM.Xf)(l(function sP(l){return new Ia.y(r=>l.subscribe(r))}(x))).subscribe(m),m.add(h.subscribe(x))})}var G1=ae(8180),uP=ae(8251),hP=ae(975),fP=ae(1631);function ER(l,r){return r?o=>(0,gR.z)(r.pipe((0,G1.q)(1),function dP(){return(0,bR.e)((l,r)=>{l.subscribe((0,uP.x)(r,_R.Z))})}()),o.pipe(ER(l))):(0,fP.z)((o,h)=>(0,NM.Xf)(l(o,h)).pipe((0,G1.q)(1),(0,hP.h)(o)))}var pP=ae(4825);const SD="Service workers are disabled or not supported by this browser";class cM{constructor(r){if(this.serviceWorker=r,r){const h=(0,mR.R)(r,"controllerchange").pipe((0,qC.U)(()=>r.controller)),m=(0,pR.P)(()=>(0,kM.of)(r.controller)),x=(0,gR.z)(m,h);this.worker=x.pipe((0,CD.h)(fe=>!!fe)),this.registration=this.worker.pipe((0,lM.w)(()=>r.getRegistration()));const te=(0,mR.R)(r,"message").pipe((0,qC.U)(fe=>fe.data)).pipe((0,CD.h)(fe=>fe&&fe.type)).pipe(function cP(l){return l?r=>wR(l)(r):r=>function lP(l,r){const o=(0,xR.m)(l)?l:()=>l;return(0,xR.m)(r)?wR(r,{connector:o}):h=>new oP.c(h,o)}(new LM.x)(r)}());te.connect(),this.events=te}else this.worker=this.events=this.registration=function gP(l){return(0,pR.P)(()=>(0,tP._)(new Error(l)))}(SD)}postMessage(r,o){return this.worker.pipe((0,G1.q)(1),(0,hi.b)(h=>{h.postMessage({action:r,...o})})).toPromise().then(()=>{})}postMessageWithOperation(r,o,h){const m=this.waitForOperationCompleted(h),x=this.postMessage(r,o);return Promise.all([x,m]).then(([,T])=>T)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(r){let o;return o="string"==typeof r?h=>h.type===r:h=>r.includes(h.type),this.events.pipe((0,CD.h)(o))}nextEventOfType(r){return this.eventsOfType(r).pipe((0,G1.q)(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe((0,CD.h)(o=>o.nonce===r),(0,G1.q)(1),(0,qC.U)(o=>{if(void 0!==o.result)return o.result;throw new Error(o.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let IR=(()=>{var l;class r{get isEnabled(){return this.sw.isEnabled}constructor(h){if(this.sw=h,this.pushManager=null,this.subscriptionChanges=new LM.x,!h.isEnabled)return this.messages=WC,this.notificationClicks=WC,void(this.subscription=WC);this.messages=this.sw.eventsOfType("PUSH").pipe((0,qC.U)(x=>x.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe((0,qC.U)(x=>x.data)),this.pushManager=this.sw.registration.pipe((0,qC.U)(x=>x.pushManager));const m=this.pushManager.pipe((0,lM.w)(x=>x.getSubscription()));this.subscription=vR(m,this.subscriptionChanges)}requestSubscription(h){if(!this.sw.isEnabled||null===this.pushManager)return Promise.reject(new Error(SD));const m={userVisibleOnly:!0};let x=this.decodeBase64(h.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),T=new Uint8Array(new ArrayBuffer(x.length));for(let k=0;k<x.length;k++)T[k]=x.charCodeAt(k);return m.applicationServerKey=T,this.pushManager.pipe((0,lM.w)(k=>k.subscribe(m)),(0,G1.q)(1)).toPromise().then(k=>(this.subscriptionChanges.next(k),k))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe((0,G1.q)(1),(0,lM.w)(m=>{if(null===m)throw new Error("Not subscribed to push notifications.");return m.unsubscribe().then(x=>{if(!x)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(SD))}decodeBase64(h){return atob(h)}}return(l=r).\u0275fac=function(h){return new(h||l)(he.LFG(cM))},l.\u0275prov=he.Yz7({token:l,factory:l.\u0275fac}),r})(),TR=(()=>{var l;class r{get isEnabled(){return this.sw.isEnabled}constructor(h){if(this.sw=h,!h.isEnabled)return this.versionUpdates=WC,void(this.unrecoverable=WC);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(SD));const h=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:h},h)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(SD));const h=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:h},h)}}return(l=r).\u0275fac=function(h){return new(h||l)(he.LFG(cM))},l.\u0275prov=he.Yz7({token:l,factory:l.\u0275fac}),r})();const AR=new he.OlP("NGSW_REGISTER_SCRIPT");function _P(l,r,o,h){return()=>{if(!(0,wt.NF)(h)||!("serviceWorker"in navigator)||!1===o.enabled)return;let m;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof o.registrationStrategy)m=o.registrationStrategy();else{const[T,...k]=(o.registrationStrategy||"registerWhenStable:30000").split(":");switch(T){case"registerImmediately":m=(0,kM.of)(null);break;case"registerWithDelay":m=CR(+k[0]||0);break;case"registerWhenStable":m=k[0]?vR(SR(l),CR(+k[0])):SR(l);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${o.registrationStrategy}`)}}l.get(he.R0b).runOutsideAngular(()=>m.pipe((0,G1.q)(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:o.scope}).catch(T=>console.error("Service worker registration failed with:",T))))}}function CR(l){return(0,kM.of)(null).pipe(function mP(l,r=wc.z){const o=(0,pP.H)(l,r);return ER(()=>o)}(l))}function SR(l){return l.get(he.z2F).isStable.pipe((0,CD.h)(o=>o))}function yP(l,r){return new cM((0,wt.NF)(r)&&!1!==l.enabled?navigator.serviceWorker:void 0)}class FM{}function vP(l,r={}){return(0,he.MR2)([IR,TR,{provide:AR,useValue:l},{provide:FM,useValue:r},{provide:cM,useFactory:yP,deps:[FM,he.Lbi]},{provide:he.ip1,useFactory:_P,deps:[he.zs3,AR,FM,he.Lbi],multi:!0}])}let xP=(()=>{var l;class r{static register(h,m={}){return{ngModule:r,providers:[vP(h,m)]}}}return(l=r).\u0275fac=function(h){return new(h||l)},l.\u0275mod=he.oAB({type:l}),l.\u0275inj=he.cJS({providers:[IR,TR]}),r})(),bP=(()=>{var l;class r{}return(l=r).\u0275fac=function(h){return new(h||l)},l.\u0275mod=he.oAB({type:l,bootstrap:[Be]}),l.\u0275inj=he.cJS({providers:[{provide:at.wN,useClass:Ie.r4}],imports:[E.b2,ge.Pc.forRoot(),Le,gt.forRoot(),V(()=>Ne(OM_firebase)),JR(()=>eP()),xP.register("ngsw-worker.js",{enabled:!(0,he.X6Q)(),registrationStrategy:"registerWhenStable:30000"})]}),r})();var wP=ae(2574),EP=ae.n(wP);(0,he.G48)(),EP().accessToken="pk.eyJ1IjoiZGF2aWZlcm0iLCJhIjoiY2szbGU4djBlMHBvNTNjcXhzb2FrZ2R0dSJ9.8oj6g4g_U0OTe2QcX-1tPg",E.q6().bootstrapModule(bP).catch(l=>console.log(l))},9422:ur=>{ur.exports=function he(at,Ie,ge){function Ve(ze,wt){if(!Ie[ze]){if(!at[ze]){if(Le)return Le(ze,!0);var vt=new Error("Cannot find module '"+ze+"'");throw vt.code="MODULE_NOT_FOUND",vt}var Mt=Ie[ze]={exports:{}};at[ze][0].call(Mt.exports,function(xt){return Ve(at[ze][1][xt]||xt)},Mt,Mt.exports,he,at,Ie,ge)}return Ie[ze].exports}for(var Le=void 0,Be=0;Be<ge.length;Be++)Ve(ge[Be]);return Ve}({1:[function(he,at,Ie){(function(ge){"use strict";var Le,Ve=ge.MutationObserver||ge.WebKitMutationObserver;if(Ve){var Be=0,ze=new Ve(xt),wt=ge.document.createTextNode("");ze.observe(wt,{characterData:!0}),Le=function(){wt.data=Be=++Be%2}}else if(!ge.setImmediate&&typeof ge.MessageChannel<"u"){var Ue=new ge.MessageChannel;Ue.port1.onmessage=xt,Le=function(){Ue.port2.postMessage(0)}}else Le="document"in ge&&"onreadystatechange"in ge.document.createElement("script")?function(){var Jt=ge.document.createElement("script");Jt.onreadystatechange=function(){xt(),Jt.onreadystatechange=null,Jt.parentNode.removeChild(Jt),Jt=null},ge.document.documentElement.appendChild(Jt)}:function(){setTimeout(xt,0)};var vt,Mt=[];function xt(){vt=!0;for(var Jt,Ot,Rt=Mt.length;Rt;){for(Ot=Mt,Mt=[],Jt=-1;++Jt<Rt;)Ot[Jt]();Rt=Mt.length}vt=!1}at.exports=function gt(Jt){1===Mt.push(Jt)&&!vt&&Le()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(he,at,Ie){"use strict";var ge=he(1);function Ve(){}var Le={},Be=["REJECTED"],ze=["FULFILLED"],wt=["PENDING"];function Ue(lt){if("function"!=typeof lt)throw new TypeError("resolver must be a function");this.state=wt,this.queue=[],this.outcome=void 0,lt!==Ve&&gt(this,lt)}function vt(lt,me,st){this.promise=lt,"function"==typeof me&&(this.onFulfilled=me,this.callFulfilled=this.otherCallFulfilled),"function"==typeof st&&(this.onRejected=st,this.callRejected=this.otherCallRejected)}function Mt(lt,me,st){ge(function(){var Ft;try{Ft=me(st)}catch(Te){return Le.reject(lt,Te)}Ft===lt?Le.reject(lt,new TypeError("Cannot resolve promise with itself")):Le.resolve(lt,Ft)})}function xt(lt){var me=lt&&lt.then;if(lt&&("object"==typeof lt||"function"==typeof lt)&&"function"==typeof me)return function(){me.apply(lt,arguments)}}function gt(lt,me){var st=!1;function Ft(mt){st||(st=!0,Le.reject(lt,mt))}function Te(mt){st||(st=!0,Le.resolve(lt,mt))}var dt=Jt(function De(){me(Te,Ft)});"error"===dt.status&&Ft(dt.value)}function Jt(lt,me){var st={};try{st.value=lt(me),st.status="success"}catch(Ft){st.status="error",st.value=Ft}return st}at.exports=Ue,Ue.prototype.catch=function(lt){return this.then(null,lt)},Ue.prototype.then=function(lt,me){if("function"!=typeof lt&&this.state===ze||"function"!=typeof me&&this.state===Be)return this;var st=new this.constructor(Ve);return this.state!==wt?Mt(st,this.state===ze?lt:me,this.outcome):this.queue.push(new vt(st,lt,me)),st},vt.prototype.callFulfilled=function(lt){Le.resolve(this.promise,lt)},vt.prototype.otherCallFulfilled=function(lt){Mt(this.promise,this.onFulfilled,lt)},vt.prototype.callRejected=function(lt){Le.reject(this.promise,lt)},vt.prototype.otherCallRejected=function(lt){Mt(this.promise,this.onRejected,lt)},Le.resolve=function(lt,me){var st=Jt(xt,me);if("error"===st.status)return Le.reject(lt,st.value);var Ft=st.value;if(Ft)gt(lt,Ft);else{lt.state=ze,lt.outcome=me;for(var Te=-1,De=lt.queue.length;++Te<De;)lt.queue[Te].callFulfilled(me)}return lt},Le.reject=function(lt,me){lt.state=Be,lt.outcome=me;for(var st=-1,Ft=lt.queue.length;++st<Ft;)lt.queue[st].callRejected(me);return lt},Ue.resolve=function Ot(lt){return lt instanceof this?lt:Le.resolve(new this(Ve),lt)},Ue.reject=function Rt(lt){var me=new this(Ve);return Le.reject(me,lt)},Ue.all=function Pt(lt){var me=this;if("[object Array]"!==Object.prototype.toString.call(lt))return this.reject(new TypeError("must be an array"));var st=lt.length,Ft=!1;if(!st)return this.resolve([]);for(var Te=new Array(st),De=0,dt=-1,mt=new this(Ve);++dt<st;)Gt(lt[dt],dt);return mt;function Gt(en,on){me.resolve(en).then(function Un(nr){Te[on]=nr,++De===st&&!Ft&&(Ft=!0,Le.resolve(mt,Te))},function(nr){Ft||(Ft=!0,Le.reject(mt,nr))})}},Ue.race=function hn(lt){var me=this;if("[object Array]"!==Object.prototype.toString.call(lt))return this.reject(new TypeError("must be an array"));var st=lt.length,Ft=!1;if(!st)return this.resolve([]);for(var Te=-1,De=new this(Ve);++Te<st;)me.resolve(lt[Te]).then(function(Gt){Ft||(Ft=!0,Le.resolve(De,Gt))},function(Gt){Ft||(Ft=!0,Le.reject(De,Gt))});return De}},{1:1}],3:[function(he,at,Ie){(function(ge){"use strict";"function"!=typeof ge.Promise&&(ge.Promise=he(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(he,at,Ie){"use strict";var ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Se){return typeof Se}:function(Se){return Se&&"function"==typeof Symbol&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se};var Be=function Le(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}();function wt(Se,Et){Se=Se||[],Et=Et||{};try{return new Blob(Se,Et)}catch(Z){if("TypeError"!==Z.name)throw Z;for(var re=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),ne=0;ne<Se.length;ne+=1)re.append(Se[ne]);return re.getBlob(Et.type)}}typeof Promise>"u"&&he(3);var Ue=Promise;function vt(Se,Et){Et&&Se.then(function(Ze){Et(null,Ze)},function(Ze){Et(Ze)})}function Mt(Se,Et,Ze){"function"==typeof Et&&Se.then(Et),"function"==typeof Ze&&Se.catch(Ze)}function xt(Se){return"string"!=typeof Se&&(console.warn(Se+" used as a key, but it is not a string."),Se=String(Se)),Se}function gt(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var Jt="local-forage-detect-blob-support",Ot=void 0,Rt={},Pt=Object.prototype.toString,hn="readonly",lt="readwrite";function me(Se){for(var Et=Se.length,Ze=new ArrayBuffer(Et),re=new Uint8Array(Ze),ne=0;ne<Et;ne++)re[ne]=Se.charCodeAt(ne);return Ze}function Ft(Se){return"boolean"==typeof Ot?Ue.resolve(Ot):function st(Se){return new Ue(function(Et){var Ze=Se.transaction(Jt,lt),re=wt([""]);Ze.objectStore(Jt).put(re,"key"),Ze.onabort=function(ne){ne.preventDefault(),ne.stopPropagation(),Et(!1)},Ze.oncomplete=function(){var ne=navigator.userAgent.match(/Chrome\/(\d+)/),Z=navigator.userAgent.match(/Edge\//);Et(Z||!ne||parseInt(ne[1],10)>=43)}}).catch(function(){return!1})}(Se).then(function(Et){return Ot=Et})}function Te(Se){var Et=Rt[Se.name],Ze={};Ze.promise=new Ue(function(re,ne){Ze.resolve=re,Ze.reject=ne}),Et.deferredOperations.push(Ze),Et.dbReady=Et.dbReady?Et.dbReady.then(function(){return Ze.promise}):Ze.promise}function De(Se){var Ze=Rt[Se.name].deferredOperations.pop();if(Ze)return Ze.resolve(),Ze.promise}function dt(Se,Et){var re=Rt[Se.name].deferredOperations.pop();if(re)return re.reject(Et),re.promise}function mt(Se,Et){return new Ue(function(Ze,re){if(Rt[Se.name]=Rt[Se.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},Se.db){if(!Et)return Ze(Se.db);Te(Se),Se.db.close()}var ne=[Se.name];Et&&ne.push(Se.version);var Z=Be.open.apply(Be,ne);Et&&(Z.onupgradeneeded=function(_e){var We=Z.result;try{We.createObjectStore(Se.storeName),_e.oldVersion<=1&&We.createObjectStore(Jt)}catch(Ct){if("ConstraintError"!==Ct.name)throw Ct;console.warn('The database "'+Se.name+'" has been upgraded from version '+_e.oldVersion+" to version "+_e.newVersion+', but the storage "'+Se.storeName+'" already exists.')}}),Z.onerror=function(_e){_e.preventDefault(),re(Z.error)},Z.onsuccess=function(){var _e=Z.result;_e.onversionchange=function(We){We.target.close()},Ze(_e),De(Se)}})}function Gt(Se){return mt(Se,!1)}function en(Se){return mt(Se,!0)}function on(Se,Et){if(!Se.db)return!0;var Ze=!Se.db.objectStoreNames.contains(Se.storeName),ne=Se.version>Se.db.version;if(Se.version<Se.db.version&&(Se.version!==Et&&console.warn('The database "'+Se.name+"\" can't be downgraded from version "+Se.db.version+" to version "+Se.version+"."),Se.version=Se.db.version),ne||Ze){if(Ze){var Z=Se.db.version+1;Z>Se.version&&(Se.version=Z)}return!0}return!1}function nr(Se){return wt([me(atob(Se.data))],{type:Se.type})}function _n(Se){return Se&&Se.__local_forage_encoded_blob}function sn(Se){var Et=this,Ze=Et._initReady().then(function(){var re=Rt[Et._dbInfo.name];if(re&&re.dbReady)return re.dbReady});return Mt(Ze,Se,Se),Ze}function Xe(Se,Et,Ze,re){void 0===re&&(re=1);try{var ne=Se.db.transaction(Se.storeName,Et);Ze(null,ne)}catch(Z){if(re>0&&(!Se.db||"InvalidStateError"===Z.name||"NotFoundError"===Z.name))return Ue.resolve().then(function(){if(!Se.db||"NotFoundError"===Z.name&&!Se.db.objectStoreNames.contains(Se.storeName)&&Se.version<=Se.db.version)return Se.db&&(Se.version=Se.db.version+1),en(Se)}).then(function(){return function yt(Se){Te(Se);for(var Et=Rt[Se.name],Ze=Et.forages,re=0;re<Ze.length;re++){var ne=Ze[re];ne._dbInfo.db&&(ne._dbInfo.db.close(),ne._dbInfo.db=null)}return Se.db=null,Gt(Se).then(function(Z){return Se.db=Z,on(Se)?en(Se):Z}).then(function(Z){Se.db=Et.db=Z;for(var _e=0;_e<Ze.length;_e++)Ze[_e]._dbInfo.db=Z}).catch(function(Z){throw dt(Se,Z),Z})}(Se).then(function(){Xe(Se,Et,Ze,re-1)})}).catch(Ze);Ze(Z)}}var qe={_driver:"asyncStorage",_initStorage:function Ye(Se){var Et=this,Ze={db:null};if(Se)for(var re in Se)Ze[re]=Se[re];var ne=Rt[Ze.name];ne||(Rt[Ze.name]=ne={forages:[],db:null,dbReady:null,deferredOperations:[]}),ne.forages.push(Et),Et._initReady||(Et._initReady=Et.ready,Et.ready=sn);var Z=[];function _e(){return Ue.resolve()}for(var We=0;We<ne.forages.length;We++){var Ct=ne.forages[We];Ct!==Et&&Z.push(Ct._initReady().catch(_e))}var Qt=ne.forages.slice(0);return Ue.all(Z).then(function(){return Ze.db=ne.db,Gt(Ze)}).then(function(q){return Ze.db=q,on(Ze,Et._defaultConfig.version)?en(Ze):q}).then(function(q){Ze.db=ne.db=q,Et._dbInfo=Ze;for(var ce=0;ce<Qt.length;ce++){var Pe=Qt[ce];Pe!==Et&&(Pe._dbInfo.db=Ze.db,Pe._dbInfo.version=Ze.version)}})},_support:function ze(){try{if(!Be||!Be.open)return!1;var Se=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),Et="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!Se||Et)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}(),iterate:function rn(Se,Et){var Ze=this,re=new Ue(function(ne,Z){Ze.ready().then(function(){Xe(Ze._dbInfo,hn,function(_e,We){if(_e)return Z(_e);try{var Qt=We.objectStore(Ze._dbInfo.storeName).openCursor(),q=1;Qt.onsuccess=function(){var ce=Qt.result;if(ce){var Pe=ce.value;_n(Pe)&&(Pe=nr(Pe));var ct=Se(Pe,ce.key,q++);void 0!==ct?ne(ct):ce.continue()}else ne()},Qt.onerror=function(){Z(Qt.error)}}catch(ce){Z(ce)}})}).catch(Z)});return vt(re,Et),re},getItem:function _t(Se,Et){var Ze=this;Se=xt(Se);var re=new Ue(function(ne,Z){Ze.ready().then(function(){Xe(Ze._dbInfo,hn,function(_e,We){if(_e)return Z(_e);try{var Qt=We.objectStore(Ze._dbInfo.storeName).get(Se);Qt.onsuccess=function(){var q=Qt.result;void 0===q&&(q=null),_n(q)&&(q=nr(q)),ne(q)},Qt.onerror=function(){Z(Qt.error)}}catch(q){Z(q)}})}).catch(Z)});return vt(re,Et),re},setItem:function Gn(Se,Et,Ze){var re=this;Se=xt(Se);var ne=new Ue(function(Z,_e){var We;re.ready().then(function(){return We=re._dbInfo,"[object Blob]"===Pt.call(Et)?Ft(We.db).then(function(Ct){return Ct?Et:function Un(Se){return new Ue(function(Et,Ze){var re=new FileReader;re.onerror=Ze,re.onloadend=function(ne){var Z=btoa(ne.target.result||"");Et({__local_forage_encoded_blob:!0,data:Z,type:Se.type})},re.readAsBinaryString(Se)})}(Et)}):Et}).then(function(Ct){Xe(re._dbInfo,lt,function(Qt,q){if(Qt)return _e(Qt);try{var ce=q.objectStore(re._dbInfo.storeName);null===Ct&&(Ct=void 0);var Pe=ce.put(Ct,Se);q.oncomplete=function(){void 0===Ct&&(Ct=null),Z(Ct)},q.onabort=q.onerror=function(){_e(Pe.error?Pe.error:Pe.transaction.error)}}catch(ct){_e(ct)}})}).catch(_e)});return vt(ne,Ze),ne},removeItem:function rr(Se,Et){var Ze=this;Se=xt(Se);var re=new Ue(function(ne,Z){Ze.ready().then(function(){Xe(Ze._dbInfo,lt,function(_e,We){if(_e)return Z(_e);try{var Qt=We.objectStore(Ze._dbInfo.storeName).delete(Se);We.oncomplete=function(){ne()},We.onerror=function(){Z(Qt.error)},We.onabort=function(){Z(Qt.error?Qt.error:Qt.transaction.error)}}catch(q){Z(q)}})}).catch(Z)});return vt(re,Et),re},clear:function Hn(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){Xe(Et._dbInfo,lt,function(Z,_e){if(Z)return ne(Z);try{var Ct=_e.objectStore(Et._dbInfo.storeName).clear();_e.oncomplete=function(){re()},_e.onabort=_e.onerror=function(){ne(Ct.error?Ct.error:Ct.transaction.error)}}catch(Qt){ne(Qt)}})}).catch(ne)});return vt(Ze,Se),Ze},length:function mr(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){Xe(Et._dbInfo,hn,function(Z,_e){if(Z)return ne(Z);try{var Ct=_e.objectStore(Et._dbInfo.storeName).count();Ct.onsuccess=function(){re(Ct.result)},Ct.onerror=function(){ne(Ct.error)}}catch(Qt){ne(Qt)}})}).catch(ne)});return vt(Ze,Se),Ze},key:function gr(Se,Et){var Ze=this,re=new Ue(function(ne,Z){Se<0?ne(null):Ze.ready().then(function(){Xe(Ze._dbInfo,hn,function(_e,We){if(_e)return Z(_e);try{var Ct=We.objectStore(Ze._dbInfo.storeName),Qt=!1,q=Ct.openKeyCursor();q.onsuccess=function(){var ce=q.result;ce?0===Se||Qt?ne(ce.key):(Qt=!0,ce.advance(Se)):ne(null)},q.onerror=function(){Z(q.error)}}catch(ce){Z(ce)}})}).catch(Z)});return vt(re,Et),re},keys:function ei(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){Xe(Et._dbInfo,hn,function(Z,_e){if(Z)return ne(Z);try{var Ct=_e.objectStore(Et._dbInfo.storeName).openKeyCursor(),Qt=[];Ct.onsuccess=function(){var q=Ct.result;q?(Qt.push(q.key),q.continue()):re(Qt)},Ct.onerror=function(){ne(Ct.error)}}catch(q){ne(q)}})}).catch(ne)});return vt(Ze,Se),Ze},dropInstance:function An(Se,Et){Et=gt.apply(this,arguments);var ne,Ze=this.config();return(Se="function"!=typeof Se&&Se||{}).name||(Se.name=Se.name||Ze.name,Se.storeName=Se.storeName||Ze.storeName),vt(ne=Se.name?(Se.name===Ze.name&&this._dbInfo.db?Ue.resolve(this._dbInfo.db):Gt(Se).then(function(We){var Ct=Rt[Se.name],Qt=Ct.forages;Ct.db=We;for(var q=0;q<Qt.length;q++)Qt[q]._dbInfo.db=We;return We})).then(Se.storeName?function(We){if(We.objectStoreNames.contains(Se.storeName)){var Ct=We.version+1;Te(Se);var Qt=Rt[Se.name],q=Qt.forages;We.close();for(var ce=0;ce<q.length;ce++){var Pe=q[ce];Pe._dbInfo.db=null,Pe._dbInfo.version=Ct}return new Ue(function($t,bt){var fn=Be.open(Se.name,Ct);fn.onerror=function(bn){fn.result.close(),bt(bn)},fn.onupgradeneeded=function(){fn.result.deleteObjectStore(Se.storeName)},fn.onsuccess=function(){var bn=fn.result;bn.close(),$t(bn)}}).then(function($t){Qt.db=$t;for(var bt=0;bt<q.length;bt++){var fn=q[bt];fn._dbInfo.db=$t,De(fn._dbInfo)}}).catch(function($t){throw(dt(Se,$t)||Ue.resolve()).catch(function(){}),$t})}}:function(We){Te(Se);var Ct=Rt[Se.name],Qt=Ct.forages;We.close();for(var q=0;q<Qt.length;q++)Qt[q]._dbInfo.db=null;return new Ue(function(ct,$t){var bt=Be.deleteDatabase(Se.name);bt.onerror=function(){var fn=bt.result;fn&&fn.close(),$t(bt.error)},bt.onblocked=function(){console.warn('dropInstance blocked for database "'+Se.name+'" until all open connections are closed')},bt.onsuccess=function(){var fn=bt.result;fn&&fn.close(),ct(fn)}}).then(function(ct){Ct.db=ct;for(var $t=0;$t<Qt.length;$t++)De(Qt[$t]._dbInfo)}).catch(function(ct){throw(dt(Se,ct)||Ue.resolve()).catch(function(){}),ct})}):Ue.reject("Invalid arguments"),Et),ne}};var ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bt=/^~~local_forage_type~([^~]+)~/,zt="__lfsc__:",In="arbf",Xt="blob",ri=Object.prototype.toString;function Ui(Se){var re,Z,_e,We,Ct,Et=.75*Se.length,Ze=Se.length,ne=0;"="===Se[Se.length-1]&&(Et--,"="===Se[Se.length-2]&&Et--);var Qt=new ArrayBuffer(Et),q=new Uint8Array(Qt);for(re=0;re<Ze;re+=4)Z=ye.indexOf(Se[re]),_e=ye.indexOf(Se[re+1]),We=ye.indexOf(Se[re+2]),Ct=ye.indexOf(Se[re+3]),q[ne++]=Z<<2|_e>>4,q[ne++]=(15&_e)<<4|We>>2,q[ne++]=(3&We)<<6|63&Ct;return Qt}function fr(Se){var re,Et=new Uint8Array(Se),Ze="";for(re=0;re<Et.length;re+=3)Ze+=ye[Et[re]>>2],Ze+=ye[(3&Et[re])<<4|Et[re+1]>>4],Ze+=ye[(15&Et[re+1])<<2|Et[re+2]>>6],Ze+=ye[63&Et[re+2]];return Et.length%3==2?Ze=Ze.substring(0,Ze.length-1)+"=":Et.length%3==1&&(Ze=Ze.substring(0,Ze.length-2)+"=="),Ze}var Tr={serialize:function io(Se,Et){var Ze="";if(Se&&(Ze=ri.call(Se)),Se&&("[object ArrayBuffer]"===Ze||Se.buffer&&"[object ArrayBuffer]"===ri.call(Se.buffer))){var re,ne=zt;Se instanceof ArrayBuffer?(re=Se,ne+=In):(re=Se.buffer,"[object Int8Array]"===Ze?ne+="si08":"[object Uint8Array]"===Ze?ne+="ui08":"[object Uint8ClampedArray]"===Ze?ne+="uic8":"[object Int16Array]"===Ze?ne+="si16":"[object Uint16Array]"===Ze?ne+="ur16":"[object Int32Array]"===Ze?ne+="si32":"[object Uint32Array]"===Ze?ne+="ui32":"[object Float32Array]"===Ze?ne+="fl32":"[object Float64Array]"===Ze?ne+="fl64":Et(new Error("Failed to get type for BinaryArray"))),Et(ne+fr(re))}else if("[object Blob]"===Ze){var Z=new FileReader;Z.onload=function(){var _e="~~local_forage_type~"+Se.type+"~"+fr(this.result);Et(zt+Xt+_e)},Z.readAsArrayBuffer(Se)}else try{Et(JSON.stringify(Se))}catch(_e){console.error("Couldn't convert value into a JSON string: ",Se),Et(null,_e)}},deserialize:function Io(Se){if(Se.substring(0,9)!==zt)return JSON.parse(Se);var re,Et=Se.substring(13),Ze=Se.substring(9,13);if(Ze===Xt&&Bt.test(Et)){var ne=Et.match(Bt);re=ne[1],Et=Et.substring(ne[0].length)}var Z=Ui(Et);switch(Ze){case In:return Z;case Xt:return wt([Z],{type:re});case"si08":return new Int8Array(Z);case"ui08":return new Uint8Array(Z);case"uic8":return new Uint8ClampedArray(Z);case"si16":return new Int16Array(Z);case"ur16":return new Uint16Array(Z);case"si32":return new Int32Array(Z);case"ui32":return new Uint32Array(Z);case"fl32":return new Float32Array(Z);case"fl64":return new Float64Array(Z);default:throw new Error("Unkown type: "+Ze)}},stringToBuffer:Ui,bufferToString:fr};function Gr(Se,Et,Ze,re){Se.executeSql("CREATE TABLE IF NOT EXISTS "+Et.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],Ze,re)}function Ht(Se,Et,Ze,re,ne,Z){Se.executeSql(Ze,re,ne,function(_e,We){We.code===We.SYNTAX_ERR?_e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[Et.storeName],function(Ct,Qt){Qt.rows.length?Z(Ct,We):Gr(Ct,Et,function(){Ct.executeSql(Ze,re,ne,Z)},Z)},Z):Z(_e,We)},Z)}function vn(Se,Et,Ze,re){var ne=this;Se=xt(Se);var Z=new Ue(function(_e,We){ne.ready().then(function(){void 0===Et&&(Et=null);var Ct=Et,Qt=ne._dbInfo;Qt.serializer.serialize(Et,function(q,ce){ce?We(ce):Qt.db.transaction(function(Pe){Ht(Pe,Qt,"INSERT OR REPLACE INTO "+Qt.storeName+" (key, value) VALUES (?, ?)",[Se,q],function(){_e(Ct)},function(ct,$t){We($t)})},function(Pe){if(Pe.code===Pe.QUOTA_ERR){if(re>0)return void _e(vn.apply(ne,[Se,Ct,Ze,re-1]));We(Pe)}})})}).catch(We)});return vt(Z,Ze),Z}var qt={_driver:"webSQLStorage",_initStorage:function Mo(Se){var Et=this,Ze={db:null};if(Se)for(var re in Se)Ze[re]="string"!=typeof Se[re]?Se[re].toString():Se[re];var ne=new Ue(function(Z,_e){try{Ze.db=openDatabase(Ze.name,String(Ze.version),Ze.description,Ze.size)}catch(We){return _e(We)}Ze.db.transaction(function(We){Gr(We,Ze,function(){Et._dbInfo=Ze,Z()},function(Ct,Qt){_e(Qt)})},_e)});return Ze.serializer=Tr,ne},_support:function ue(){return"function"==typeof openDatabase}(),iterate:function yn(Se,Et){var Ze=this,re=new Ue(function(ne,Z){Ze.ready().then(function(){var _e=Ze._dbInfo;_e.db.transaction(function(We){Ht(We,_e,"SELECT * FROM "+_e.storeName,[],function(Ct,Qt){for(var q=Qt.rows,ce=q.length,Pe=0;Pe<ce;Pe++){var ct=q.item(Pe),$t=ct.value;if($t&&($t=_e.serializer.deserialize($t)),void 0!==($t=Se($t,ct.key,Pe+1)))return void ne($t)}ne()},function(Ct,Qt){Z(Qt)})})}).catch(Z)});return vt(re,Et),re},getItem:function an(Se,Et){var Ze=this;Se=xt(Se);var re=new Ue(function(ne,Z){Ze.ready().then(function(){var _e=Ze._dbInfo;_e.db.transaction(function(We){Ht(We,_e,"SELECT * FROM "+_e.storeName+" WHERE key = ? LIMIT 1",[Se],function(Ct,Qt){var q=Qt.rows.length?Qt.rows.item(0).value:null;q&&(q=_e.serializer.deserialize(q)),ne(q)},function(Ct,Qt){Z(Qt)})})}).catch(Z)});return vt(re,Et),re},setItem:function En(Se,Et,Ze){return vn.apply(this,[Se,Et,Ze,1])},removeItem:function xn(Se,Et){var Ze=this;Se=xt(Se);var re=new Ue(function(ne,Z){Ze.ready().then(function(){var _e=Ze._dbInfo;_e.db.transaction(function(We){Ht(We,_e,"DELETE FROM "+_e.storeName+" WHERE key = ?",[Se],function(){ne()},function(Ct,Qt){Z(Qt)})})}).catch(Z)});return vt(re,Et),re},clear:function Ln(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){var Z=Et._dbInfo;Z.db.transaction(function(_e){Ht(_e,Z,"DELETE FROM "+Z.storeName,[],function(){re()},function(We,Ct){ne(Ct)})})}).catch(ne)});return vt(Ze,Se),Ze},length:function ht(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){var Z=Et._dbInfo;Z.db.transaction(function(_e){Ht(_e,Z,"SELECT COUNT(key) as c FROM "+Z.storeName,[],function(We,Ct){var Qt=Ct.rows.item(0).c;re(Qt)},function(We,Ct){ne(Ct)})})}).catch(ne)});return vt(Ze,Se),Ze},key:function Ke(Se,Et){var Ze=this,re=new Ue(function(ne,Z){Ze.ready().then(function(){var _e=Ze._dbInfo;_e.db.transaction(function(We){Ht(We,_e,"SELECT key FROM "+_e.storeName+" WHERE id = ? LIMIT 1",[Se+1],function(Ct,Qt){var q=Qt.rows.length?Qt.rows.item(0).key:null;ne(q)},function(Ct,Qt){Z(Qt)})})}).catch(Z)});return vt(re,Et),re},keys:function ot(Se){var Et=this,Ze=new Ue(function(re,ne){Et.ready().then(function(){var Z=Et._dbInfo;Z.db.transaction(function(_e){Ht(_e,Z,"SELECT key FROM "+Z.storeName,[],function(We,Ct){for(var Qt=[],q=0;q<Ct.rows.length;q++)Qt.push(Ct.rows.item(q).key);re(Qt)},function(We,Ct){ne(Ct)})})}).catch(ne)});return vt(Ze,Se),Ze},dropInstance:function Nt(Se,Et){Et=gt.apply(this,arguments);var Ze=this.config();(Se="function"!=typeof Se&&Se||{}).name||(Se.name=Se.name||Ze.name,Se.storeName=Se.storeName||Ze.storeName);var ne,re=this;return vt(ne=Se.name?new Ue(function(Z){var _e;_e=Se.name===Ze.name?re._dbInfo.db:openDatabase(Se.name,"","",0),Z(Se.storeName?{db:_e,storeNames:[Se.storeName]}:function rt(Se){return new Ue(function(Et,Ze){Se.transaction(function(re){re.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(ne,Z){for(var _e=[],We=0;We<Z.rows.length;We++)_e.push(Z.rows.item(We).name);Et({db:Se,storeNames:_e})},function(ne,Z){Ze(Z)})},function(re){Ze(re)})})}(_e))}).then(function(Z){return new Ue(function(_e,We){Z.db.transaction(function(Ct){function Qt(ct){return new Ue(function($t,bt){Ct.executeSql("DROP TABLE IF EXISTS "+ct,[],function(){$t()},function(fn,bn){bt(bn)})})}for(var q=[],ce=0,Pe=Z.storeNames.length;ce<Pe;ce++)q.push(Qt(Z.storeNames[ce]));Ue.all(q).then(function(){_e()}).catch(function(ct){We(ct)})},function(Ct){We(Ct)})})}):Ue.reject("Invalid arguments"),Et),ne}};function cr(Se,Et){var Ze=Se.name+"/";return Se.storeName!==Et.storeName&&(Ze+=Se.storeName+"/"),Ze}function ii(){return!function Sr(){var Se="_localforage_support_test";try{return localStorage.setItem(Se,!0),localStorage.removeItem(Se),!1}catch{return!0}}()||localStorage.length>0}var ts={_driver:"localStorageWrapper",_initStorage:function ji(Se){var Ze={};if(Se)for(var re in Se)Ze[re]=Se[re];return Ze.keyPrefix=cr(Se,this._defaultConfig),ii()?(this._dbInfo=Ze,Ze.serializer=Tr,Ue.resolve()):Ue.reject()},_support:function Rn(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}(),iterate:function Oo(Se,Et){var Ze=this,re=Ze.ready().then(function(){for(var ne=Ze._dbInfo,Z=ne.keyPrefix,_e=Z.length,We=localStorage.length,Ct=1,Qt=0;Qt<We;Qt++){var q=localStorage.key(Qt);if(0===q.indexOf(Z)){var ce=localStorage.getItem(q);if(ce&&(ce=ne.serializer.deserialize(ce)),void 0!==(ce=Se(ce,q.substring(_e),Ct++)))return ce}}});return vt(re,Et),re},getItem:function dr(Se,Et){var Ze=this;Se=xt(Se);var re=Ze.ready().then(function(){var ne=Ze._dbInfo,Z=localStorage.getItem(ne.keyPrefix+Se);return Z&&(Z=ne.serializer.deserialize(Z)),Z});return vt(re,Et),re},setItem:function ko(Se,Et,Ze){var re=this;Se=xt(Se);var ne=re.ready().then(function(){void 0===Et&&(Et=null);var Z=Et;return new Ue(function(_e,We){var Ct=re._dbInfo;Ct.serializer.serialize(Et,function(Qt,q){if(q)We(q);else try{localStorage.setItem(Ct.keyPrefix+Se,Qt),_e(Z)}catch(ce){("QuotaExceededError"===ce.name||"NS_ERROR_DOM_QUOTA_REACHED"===ce.name)&&We(ce),We(ce)}})})});return vt(ne,Ze),ne},removeItem:function Ei(Se,Et){var Ze=this;Se=xt(Se);var re=Ze.ready().then(function(){localStorage.removeItem(Ze._dbInfo.keyPrefix+Se)});return vt(re,Et),re},clear:function wi(Se){var Et=this,Ze=Et.ready().then(function(){for(var re=Et._dbInfo.keyPrefix,ne=localStorage.length-1;ne>=0;ne--){var Z=localStorage.key(ne);0===Z.indexOf(re)&&localStorage.removeItem(Z)}});return vt(Ze,Se),Ze},length:function cs(Se){var Ze=this.keys().then(function(re){return re.length});return vt(Ze,Se),Ze},key:function ho(Se,Et){var Ze=this,re=Ze.ready().then(function(){var Z,ne=Ze._dbInfo;try{Z=localStorage.key(Se)}catch{Z=null}return Z&&(Z=Z.substring(ne.keyPrefix.length)),Z});return vt(re,Et),re},keys:function vs(Se){var Et=this,Ze=Et.ready().then(function(){for(var re=Et._dbInfo,ne=localStorage.length,Z=[],_e=0;_e<ne;_e++){var We=localStorage.key(_e);0===We.indexOf(re.keyPrefix)&&Z.push(We.substring(re.keyPrefix.length))}return Z});return vt(Ze,Se),Ze},dropInstance:function es(Se,Et){if(Et=gt.apply(this,arguments),!(Se="function"!=typeof Se&&Se||{}).name){var Ze=this.config();Se.name=Se.name||Ze.name,Se.storeName=Se.storeName||Ze.storeName}var ne,re=this;return vt(ne=Se.name?new Ue(function(Z){Z(Se.storeName?cr(Se,re._defaultConfig):Se.name+"/")}).then(function(Z){for(var _e=localStorage.length-1;_e>=0;_e--){var We=localStorage.key(_e);0===We.indexOf(Z)&&localStorage.removeItem(We)}}):Ue.reject("Invalid arguments"),Et),ne}},fo=function(Et,Ze){return Et===Ze||"number"==typeof Et&&"number"==typeof Ze&&isNaN(Et)&&isNaN(Ze)},us=function(Et,Ze){for(var re=Et.length,ne=0;ne<re;){if(fo(Et[ne],Ze))return!0;ne++}return!1},Fs=Array.isArray||function(Se){return"[object Array]"===Object.prototype.toString.call(Se)},ns={},po={},ti={INDEXEDDB:qe,WEBSQL:qt,LOCALSTORAGE:ts},ds=[ti.INDEXEDDB._driver,ti.WEBSQL._driver,ti.LOCALSTORAGE._driver],Qi=["dropInstance"],pi=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Qi),xs={description:"",driver:ds.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Wi(Se,Et){Se[Et]=function(){var Ze=arguments;return Se.ready().then(function(){return Se[Et].apply(Se,Ze)})}}function Br(){for(var Se=1;Se<arguments.length;Se++){var Et=arguments[Se];if(Et)for(var Ze in Et)Et.hasOwnProperty(Ze)&&(arguments[0][Ze]=Fs(Et[Ze])?Et[Ze].slice():Et[Ze])}return arguments[0]}var Bs=function(){function Se(Et){for(var Ze in function Ve(Se,Et){if(!(Se instanceof Et))throw new TypeError("Cannot call a class as a function")}(this,Se),ti)if(ti.hasOwnProperty(Ze)){var re=ti[Ze],ne=re._driver;this[Ze]=ne,ns[ne]||this.defineDriver(re)}this._defaultConfig=Br({},xs),this._config=Br({},this._defaultConfig,Et),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return Se.prototype.config=function(Ze){if("object"===(typeof Ze>"u"?"undefined":ge(Ze))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var re in Ze){if("storeName"===re&&(Ze[re]=Ze[re].replace(/\W/g,"_")),"version"===re&&"number"!=typeof Ze[re])return new Error("Database version must be a number.");this._config[re]=Ze[re]}return!("driver"in Ze)||!Ze.driver||this.setDriver(this._config.driver)}return"string"==typeof Ze?this._config[Ze]:this._config},Se.prototype.defineDriver=function(Ze,re,ne){var Z=new Ue(function(_e,We){try{var Ct=Ze._driver,Qt=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!Ze._driver)return void We(Qt);for(var q=pi.concat("_initStorage"),ce=0,Pe=q.length;ce<Pe;ce++){var ct=q[ce];if((!us(Qi,ct)||Ze[ct])&&"function"!=typeof Ze[ct])return void We(Qt)}!function(){for(var Fn=function(ut){return function(){var Sn=new Error("Method "+ut+" is not implemented by the current driver"),Ji=Ue.reject(Sn);return vt(Ji,arguments[arguments.length-1]),Ji}},Pn=0,kt=Qi.length;Pn<kt;Pn++){var wn=Qi[Pn];Ze[wn]||(Ze[wn]=Fn(wn))}}();var fn=function(Fn){ns[Ct]&&console.info("Redefining LocalForage driver: "+Ct),ns[Ct]=Ze,po[Ct]=Fn,_e()};"_support"in Ze?Ze._support&&"function"==typeof Ze._support?Ze._support().then(fn,We):fn(!!Ze._support):fn(!0)}catch(bn){We(bn)}});return Mt(Z,re,ne),Z},Se.prototype.driver=function(){return this._driver||null},Se.prototype.getDriver=function(Ze,re,ne){var Z=ns[Ze]?Ue.resolve(ns[Ze]):Ue.reject(new Error("Driver not found."));return Mt(Z,re,ne),Z},Se.prototype.getSerializer=function(Ze){var re=Ue.resolve(Tr);return Mt(re,Ze),re},Se.prototype.ready=function(Ze){var re=this,ne=re._driverSet.then(function(){return null===re._ready&&(re._ready=re._initDriver()),re._ready});return Mt(ne,Ze,Ze),ne},Se.prototype.setDriver=function(Ze,re,ne){var Z=this;Fs(Ze)||(Ze=[Ze]);var _e=this._getSupportedDrivers(Ze);function We(){Z._config.driver=Z.driver()}function Ct(ce){return Z._extend(ce),We(),Z._ready=Z._initStorage(Z._config),Z._ready}var q=null!==this._driverSet?this._driverSet.catch(function(){return Ue.resolve()}):Ue.resolve();return this._driverSet=q.then(function(){var ce=_e[0];return Z._dbInfo=null,Z._ready=null,Z.getDriver(ce).then(function(Pe){Z._driver=Pe._driver,We(),Z._wrapLibraryMethodsWithReady(),Z._initDriver=function Qt(ce){return function(){var Pe=0;return function ct(){for(;Pe<ce.length;){var $t=ce[Pe];return Pe++,Z._dbInfo=null,Z._ready=null,Z.getDriver($t).then(Ct).catch(ct)}We();var bt=new Error("No available storage method found.");return Z._driverSet=Ue.reject(bt),Z._driverSet}()}}(_e)})}).catch(function(){We();var ce=new Error("No available storage method found.");return Z._driverSet=Ue.reject(ce),Z._driverSet}),Mt(this._driverSet,re,ne),this._driverSet},Se.prototype.supports=function(Ze){return!!po[Ze]},Se.prototype._extend=function(Ze){Br(this,Ze)},Se.prototype._getSupportedDrivers=function(Ze){for(var re=[],ne=0,Z=Ze.length;ne<Z;ne++){var _e=Ze[ne];this.supports(_e)&&re.push(_e)}return re},Se.prototype._wrapLibraryMethodsWithReady=function(){for(var Ze=0,re=pi.length;Ze<re;Ze++)Wi(this,pi[Ze])},Se.prototype.createInstance=function(Ze){return new Se(Ze)},Se}(),Vs=new Bs;at.exports=Vs},{3:3}]},{},[4])(4)},2574:function(ur){ur.exports=function(){"use strict";var Kt,ae,E;function he(Ie,ge){if(Kt)if(ae){var Ve="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Kt+")(sharedChunk); ("+ae+")(sharedChunk); self.onerror = null;",Le={};Kt(Le),E=ge(Le),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(E.workerUrl=window.URL.createObjectURL(new Blob([Ve],{type:"text/javascript"})))}else ae=ge;else Kt=ge}return he(0,function(Ie){var ge=typeof self<"u"?self:{},Ve="3.0.1";let Le;const Be={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Le){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Le=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Le=t}}return Le},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Be.API_URL)return null;try{const t=new URL(Be.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},ze={supported:!1,testSupport:function(t){!vt&&Ue&&(Mt?xt(t):wt=t)}};let wt,Ue,vt=!1,Mt=!1;function xt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ue),t.isContextLost())return;ze.supported=!0}catch{}t.deleteTexture(e),vt=!0}ge.document&&(Ue=ge.document.createElement("img"),Ue.onload=function(){wt&&xt(wt),wt=null,Mt=!0},Ue.onerror=function(){vt=!0,wt=null},Ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gt="01";function Jt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ot=Rt;function Rt(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}Rt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<e)return n;var c=this.sampleCurveDerivativeX(n);if(Math.abs(c)<1e-6)break;n-=s/c}var d=0,f=1;for(n=t,i=0;i<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<e));i++)t>s?d=n:f=n,n=.5*(f-d)+d;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Pt=Jt(Ot),hn=lt;function lt(t,e){this.x=t,this.y=e}lt.prototype={clone:function(){return new lt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),s=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},lt.convert=function(t){return t instanceof lt?t:Array.isArray(t)?new lt(t[0],t[1]):t};var me=Jt(hn);function st(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!st(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!st(t[n],e[n]))return!1;return!0}return t===e}const Ft=Math.PI/180,Te=180/Math.PI;function De(t){return t*Ft}function dt(t){return t*Te}const mt=[[0,0],[1,0],[1,1],[0,1]];function Gt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function en(t){let e=1/0,n=1/0,i=-1/0,s=-1/0;for(const c of t)e=Math.min(e,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),s=Math.max(s,c.y);return{min:new me(e,n),max:new me(i,s)}}function on(t,e,n=0,i=!0){const s=new me(n,n),c=t.sub(s),d=e.add(s),f=[c,new me(d.x,c.y),d,new me(c.x,d.y)];return i&&f.push(c.clone()),f}function Un(t,e,n,i){const s=new Pt(t,e,n,i);return function(c){return s.solve(c)}}const nr=Un(.25,.1,.25,1);function _n(t,e,n){return Math.min(n,Math.max(e,t))}function sn(t,e,n){return(n=_n((n-t)/(e-t),0,1))*n*(3-2*n)}function yt(t,e,n){const i=n-e,s=((t-e)%i+i)%i+e;return s===e?n:s}function Xe(t,e,n){if(!t.length)return n(null,[]);let i=t.length;const s=new Array(t.length);let c=null;t.forEach((d,f)=>{e(d,(_,y)=>{_&&(c=_),s[f]=y,0==--i&&n(c,s)})})}function tt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ye(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function _t(t,e){const n={};for(let i=0;i<e.length;i++){const s=e[i];s in t&&(n[s]=t[s])}return n}let rn=1;function Gn(){return rn++}function rr(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Hn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function mr(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function gr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function ei(t,e){return-1!==t.indexOf(e,t.length-e.length)}function An(t,e,n){const i={};for(const s in t)i[s]=e.call(n||this,t[s],s,t);return i}function qe(t,e,n){const i={};for(const s in t)e.call(n||this,t[s],s,t)&&(i[s]=t[s]);return i}function ue(t){return Array.isArray(t)?t.map(ue):"object"==typeof t&&t?An(t,ue):t}const ye={};function Me(t){ye[t]||(typeof console<"u"&&console.warn(t),ye[t]=!0)}function Bt(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function zt(t){let e=0;for(let n,i,s=0,c=t.length,d=c-1;s<c;d=s++)n=t[s],i=t[d],e+=(i.x-n.x)*(n.y+i.y);return e}function nn([t,e,n]){const i=De(e+90),s=De(n);return{x:t*Math.cos(i)*Math.sin(s),y:t*Math.sin(i)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:n}}function In(t,e,n){const i=Math.sqrt(t*t+e*e+n*n),s=i>0?Math.acos(n/i)*Te:0;let c=0!==t||0!==e?Math.atan2(-e,-t)*Te+90:0;return c<0&&(c+=360),[i,c,s]}function Xt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,s,c)=>{const d=s||c;return e[i]=!d||d.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let cn=null;function Dn(){return!!ge.document.fullscreenElement||!!ge.document.webkitFullscreenElement}function ir(t){try{const e=ge[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function bi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Mi(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function Nn(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function Kr(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const Lr="mapbox-tiles";let Ui,fr,qi=500,ri=50;function io(){try{return ge.caches}catch{}}function Io(){io()&&!Ui&&(Ui=ge.caches.open(Lr))}function Tr(t){const e=t.indexOf("?");if(e<0)return t;const i=function(s){const c=s.indexOf("?");return c>0?s.slice(c+1).split("&"):[]}(t).filter(s=>{const c=s.split("=");return"language"===c[0]||"worldview"===c[0]});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Gr=1/0;function Mo(t){Gr++,Gr>ri&&(t.getActor().send("enforceCacheSizeLimit",qi),Gr=0)}const Ht={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Ht);class an extends Error{constructor(e,n,i){401===n&&cr(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const yn=Xt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ge.location.protocol?ge.parent:ge).location.href,vn=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(yn())&&!/^\w+:/.test(n))){if(ge.fetch&&ge.Request&&ge.AbortController&&ge.Request.prototype.hasOwnProperty("signal"))return function(i,s){const c=new ge.AbortController,d=new ge.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:yn(),referrerPolicy:i.referrerPolicy,signal:c.signal});let f=!1,_=!1;const y=(v=d.url).indexOf("sku=")>0&&cr(v);var v;"json"===i.type&&d.headers.set("Accept","application/json");const w=(C,S,M)=>{if(_)return;if(C&&"SecurityError"!==C.message&&Me(C.toString()),S&&M)return I(S);const P=Date.now();ge.fetch(d).then(R=>{if(R.ok){const z=y?R.clone():null;return I(R,z,P)}return s(new an(R.statusText,R.status,i.url))}).catch(R=>{"AbortError"!==R.name&&s(new Error(`${R.message} ${i.url}`))})},I=(C,S,M)=>{("arrayBuffer"===i.type?C.arrayBuffer():"json"===i.type?C.json():C.text()).then(P=>{_||(S&&M&&function(R,z,G){if(Io(),!Ui)return;const H={status:z.status,statusText:z.statusText,headers:new ge.Headers};z.headers.forEach((oe,pe)=>H.headers.set(pe,oe));const j=Zn(z.headers.get("Cache-Control")||"");if(j["no-store"])return;j["max-age"]&&H.headers.set("Expires",new Date(G+1e3*j["max-age"]).toUTCString());const W=H.headers.get("Expires");W&&(new Date(W).getTime()-G<42e4||function(oe,pe){if(void 0===fr)try{new Response(new ReadableStream),fr=!0}catch{fr=!1}fr?pe(oe.body):oe.blob().then(pe)}(z,oe=>{const pe=new ge.Response(oe,H);Io(),Ui&&Ui.then(ve=>ve.put(Tr(R.url),pe)).catch(ve=>Me(ve.message))}))}(d,S,M),f=!0,s(null,P,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(P=>{_||s(new Error(P.message))})};return y?function(C,S){if(Io(),!Ui)return S(null);const M=Tr(C.url);Ui.then(P=>{P.match(M).then(R=>{const z=function(G){if(!G)return!1;const H=new Date(G.headers.get("Expires")||0),j=Zn(G.headers.get("Cache-Control")||"");return H>Date.now()&&!j["no-cache"]}(R);P.delete(M),z&&P.put(M,R.clone()),S(null,R,z)}).catch(S)}).catch(S)}(d,w):w(null,null),{cancel:()=>{_=!0,f||c.abort()}}}(t,e);if(Xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,s){const c=new ge.XMLHttpRequest;c.open(i.method||"GET",i.url,!0),"arrayBuffer"===i.type&&(c.responseType="arraybuffer");for(const d in i.headers)c.setRequestHeader(d,i.headers[d]);return"json"===i.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===i.credentials,c.onerror=()=>{s(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let d=c.response;if("json"===i.type)try{d=JSON.parse(c.response)}catch(f){return s(f)}s(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else s(new an(c.statusText,c.status,i.url))},c.send(i.body),{cancel:()=>c.abort()}}(t,e)},En=function(t,e){return vn(Ye(t,{type:"json"}),e)},xn=function(t,e){return vn(Ye(t,{type:"arrayBuffer"}),e)};function Ln(t){const e=ge.document.createElement("a");return e.href=t,e.protocol===ge.document.location.protocol&&e.host===ge.document.location.host}const ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ke,ot;Ke=[],ot=0;const rt=function(t,e){if(ze.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ot>=Be.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ke.push(c),c}ot++;let n=!1;const i=()=>{if(!n)for(n=!0,ot--;Ke.length&&ot<Be.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Ke.shift(),{requestParameters:d,callback:f,cancelled:_}=c;_||(c.cancel=rt(d,f).cancel)}},s=xn(t,(c,d,f,_)=>{i(),c?e(c):d&&(ge.createImageBitmap?function(y,v){const w=new ge.Blob([new Uint8Array(y)],{type:"image/png"});ge.createImageBitmap(w).then(I=>{v(null,I)}).catch(I=>{v(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(y,v)=>e(y,v,f,_)):function(y,v){const w=new ge.Image,I=ge.URL;w.onload=()=>{v(null,w),I.revokeObjectURL(w.src),w.onload=null,ge.requestAnimationFrame(()=>{w.src=ht})},w.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new ge.Blob([new Uint8Array(y)],{type:"image/png"});w.src=y.byteLength?I.createObjectURL(C):ht}(d,(y,v)=>e(y,v,f,_)))});return{cancel:()=>{s.cancel(),i()}}},Nt="NO_ACCESS_TOKEN";class qt{constructor(e,n,i){this._transformRequestFn=e,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let n="";for(let i=0;i<10;i++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}normalizeStyleURL(e,n){if(!Rn(e))return e;const i=dr(e);return i.params.push(`sdk=js-${Ve}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(e,n){if(!Rn(e))return e;const i=dr(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(e,n){if(!Rn(e))return e;const i=dr(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(e,n,i,s){if(!Rn(e))return e;const c=dr(e);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),i&&c.params.push(`language=${i}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||n)}normalizeSpriteURL(e,n,i,s){const c=dr(e);return Rn(e)?(c.path=`/styles/v1${c.path}/sprite${n}${i}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${n}${i}`,Oo(c))}normalizeTileURL(e,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Rn(e))return e;const s=dr(e);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||i&&"raster"!==s.authority&&512===i?"@2x":""}${ze.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Be.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Be.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const f of d){const _=f.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||Be.ACCESS_TOKEN;return Be.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(e,n){const i=dr(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${Be.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${Be.TILE_URL_VERSION}/`,"")}`;let c=i.params;return n&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(e,n){const i=!!n&&Rn(n),s=[];for(const c of e.tiles||[])cr(c)?s.push(this.canonicalizeTileURL(c,i)):s.push(c);return s}_makeAPIURL(e,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=dr(Be.API_URL);if(e.protocol=s.protocol,e.authority=s.authority,"http"===e.protocol){const c=e.params.indexOf("secure");c>=0&&e.params.splice(c,1)}if("/"!==s.path&&(e.path=`${s.path}${e.path}`),!Be.REQUIRE_ACCESS_TOKEN)return Oo(e);if(n=n||Be.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(c=>-1===c.indexOf("access_token")),e.params.push(`access_token=${n||""}`),Oo(e)}}function Rn(t){return 0===t.indexOf("mapbox:")}function cr(t){return Be.API_URL_REGEX.test(t)}function Sr(t){return Be.API_CDN_URL_REGEX.test(t)}function ii(t){return Be.API_STYLE_REGEX.test(t)&&!ji(t)}function ji(t){return Be.API_SPRITE_REGEX.test(t)}const wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dr(t){const e=t.match(wi);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Oo(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const ho="mapbox.eventData";function vs(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ge.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class cs{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=vs(Be.ACCESS_TOKEN);let i="";return i=n&&n.u?ge.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(+("0x"+c)))):Be.ACCESS_TOKEN||"",e?`${ho}.${e}:${i}`:`${ho}:${i}`}fetchEventData(){const e=ir("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const s=ge.localStorage.getItem(n);s&&(this.eventData=JSON.parse(s));const c=ge.localStorage.getItem(i);c&&(this.anonId=c)}catch{Me("Unable to read from LocalStorage")}}saveEventData(){const e=ir("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{ge.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&ge.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Me("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,s){if(!Be.EVENTS_URL)return;const c=dr(Be.EVENTS_URL);c.params.push(`access_token=${s||Be.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},f=n?Ye(d,n):d,_={url:Oo(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};var v;this.pendingRequest=(v=y=>{this.pendingRequest=null,i(y),this.saveEventData(),this.processRequests(s)},vn(Ye(_,{method:"POST"}),v))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Ei=new class extends cs{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Be.EVENTS_URL&&Be.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Rn(n)||cr(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=vs(Be.ACCESS_TOKEN),n=e?e.u:Be.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;mr(this.anonId)||(this.anonId=rr(),i=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(s),f=(s-this.eventData.lastSuccess)/864e5;i=i||f>=1||f<-1||c.getDate()!==d.getDate()}else i=!0;i?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ve,skuId:gt,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},t):this.processRequests()}},ko=Ei.postTurnstileEvent.bind(Ei),es=new class extends cs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,Be.EVENTS_URL&&(n||Be.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),mr(this.anonId)||(this.anonId=rr()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ve,skuId:gt,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},ts=es.postMapLoadEvent.bind(es),fo=new class extends cs{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Be.EVENTS_URL&&(t||Be.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),i=function(s){const c=ge.performance.getEntriesByType("resource"),d=ge.performance.getEntriesByType("mark"),f=function(I){const C={};if(I)for(const S in I)if("other"!==S)for(const M of I[S]){const P=`${S}ResolveRangeMin`,R=`${S}ResolveRangeMax`,z=`${S}RequestCount`,G=`${S}RequestCachedCount`;C[P]=Math.min(C[P]||1/0,M.startTime),C[R]=Math.max(C[R]||-1/0,M.responseEnd);const H=j=>{void 0===C[j]&&(C[j]=0),++C[j]};void 0!==M.transferSize&&0===M.transferSize&&H(G),H(z)}return C}(function(I,C){const S={};if(I)for(const M of I){const P=C(M);void 0===S[P]&&(S[P]=[]),S[P].push(M)}return S}(c,pi)),_=ge.devicePixelRatio,y=ge.navigator.connection||ge.navigator.mozConnection||ge.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},w=(I,C,S)=>{null!=S&&I.push({name:C,value:S.toString()})};for(const I in f)w(v.counters,I,f[I]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(w(v.counters,"interactionRangeMin",s.interactionRange[0]),w(v.counters,"interactionRangeMax",s.interactionRange[1])),d)for(const I of Object.keys(ds)){const C=ds[I],S=d.find(M=>M.name===C);S&&w(v.counters,C,S.startTime)}return w(v.counters,"visibilityHidden",s.visibilityHidden),w(v.attributes,"style",function(I){if(I)for(const C of I){const S=C.name.split("?")[0];if(ii(S)){const M=S.split("/").slice(-2);if(2===M.length)return`mapbox://styles/${M[0]}/${M[1]}`}}}(c)),w(v.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),w(v.attributes,"fogEnabled",s.fogEnabled?"true":"false"),w(v.attributes,"projection",s.projection),w(v.attributes,"zoom",s.zoom),w(v.metadata,"devicePixelRatio",_),w(v.metadata,"connectionEffectiveType",y?y.effectiveType:void 0),w(v.metadata,"navigatorUserAgent",ge.navigator.userAgent),w(v.metadata,"screenWidth",ge.screen.width),w(v.metadata,"screenHeight",ge.screen.height),w(v.metadata,"windowWidth",ge.innerWidth),w(v.metadata,"windowHeight",ge.innerHeight),w(v.metadata,"mapWidth",s.width/_),w(v.metadata,"mapHeight",s.height/_),w(v.metadata,"webglRenderer",s.renderer),w(v.metadata,"webglVendor",s.vendor),w(v.metadata,"sdkVersion",Ve),w(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(n);for(const s of i.metadata);for(const s of i.counters);for(const s of i.attributes);this.postEvent(e,i,()=>{},t)}},us=fo.postPerformanceEvent.bind(fo),Fs=new class extends cs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!Be.API_URL||!Be.SESSION_PATH)return;const s=dr(Be.API_URL+Be.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${i||Be.ACCESS_TOKEN||""}`);const c={url:Oo(s),headers:{"Content-Type":"text/plain"}};var f;this.pendingRequest=(f=d=>{this.pendingRequest=null,n(d),this.saveEventData(),this.processRequests(i)},vn(Ye(c,{method:"GET"}),f))}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,Be.SESSION_PATH&&Be.API_URL&&(n||Be.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},ns=Fs.getSessionAPI.bind(Fs),po=new Set;function ti(t,e){e?po.add(t):po.delete(t)}const ds={create:"create",load:"load",fullLoad:"fullLoad"},Qi={mark(t){ge.performance.mark(t)},measure(t,e,n){ge.performance.measure(t,e,n)}};function pi(t){const e=t.name.split("?")[0];return Sr(e)&&e.includes("mapbox-gl.js")?"javascript":Sr(e)&&e.includes("mapbox-gl.css")?"css":Be.API_FONTS_REGEX.test(e)?"fontRange":ji(e)?"sprite":ii(e)?"style":Be.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const xs=ge.performance;function Wi(t){const e=t?t.url.toString():void 0;return xs.getEntriesByName(e)}var Br=Bs;function Bs(t){return e=t,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,s,c=new Blob([""],{type:"text/javascript"}),d=URL.createObjectURL(c);try{s=new Worker(d),i=!0}catch{i=!1}return s&&s.terminate(),URL.revokeObjectURL(d),i}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var i=document.createElement("canvas");i.width=i.height=1;var s=i.getContext("2d");if(!s)return!1;var c=s.getImageData(0,0,1,1);return c&&c.width===i.width}()||(void 0===Vs[n=e&&e.failIfMajorPerformanceCaveat]&&(Vs[n]=function(i){var s,d,f,_,c=(d=i,f=document.createElement("canvas"),(_=Object.create(Bs.webGLContextAttributes)).failIfMajorPerformanceCaveat=d,f.getContext("webgl",_)||f.getContext("experimental-webgl",_));if(!c)return!1;try{s=c.createShader(c.VERTEX_SHADER)}catch{return!1}return!(!s||c.isContextLost())&&(c.shaderSource(s,"void main() {}"),c.compileShader(s),!0===c.getShaderParameter(s,c.COMPILE_STATUS))}(n)),!Vs[n]||document.documentMode));var e,n}var Vs={};let Se,Et,Ze,re;Bs.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ne={now:()=>void 0!==Ze?Ze:ge.performance.now(),setNow(t){Ze=t},restoreNow(){Ze=void 0},frame(t){const e=ge.requestAnimationFrame(t);return{cancel:()=>ge.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:i}=t;re||(re=ge.document.createElement("canvas"));const s=re.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(n>re.width||i>re.height)&&(re.width=n,re.height=i),s.clearRect(-e,-e,n+2*e,i+2*e),s.drawImage(t,0,0,n,i),s.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(Se||(Se=ge.document.createElement("a")),Se.href=t,Se.href),get devicePixelRatio(){return ge.devicePixelRatio},get prefersReducedMotion(){return!!ge.matchMedia&&(null==Et&&(Et=ge.matchMedia("(prefers-reduced-motion: reduce)")),Et.matches)}};function Z(t,e,n){const i=ge.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}function _e(t,e,n){const i=ge.document.createElementNS("http://www.w3.org/2000/svg",t);for(const s of Object.keys(e))i.setAttributeNS(null,s,e[s]);return n&&n.appendChild(i),i}const We=ge.document&&ge.document.documentElement.style,Ct=We&&void 0!==We.userSelect?"userSelect":"WebkitUserSelect";let Qt;function q(){We&&Ct&&(Qt=We[Ct],We[Ct]="none")}function ce(){We&&Ct&&(We[Ct]=Qt)}function Pe(t){t.preventDefault(),t.stopPropagation(),ge.removeEventListener("click",Pe,!0)}function ct(){ge.addEventListener("click",Pe,!0),ge.setTimeout(()=>{ge.removeEventListener("click",Pe,!0)},0)}function $t(t,e){const n=t.getBoundingClientRect();return bn(t,n,e)}function bt(t,e){const n=t.getBoundingClientRect(),i=[];for(let s=0;s<e.length;s++)i.push(bn(t,n,e[s]));return i}function fn(t){return void 0!==ge.InstallTrigger&&2===t.button&&t.ctrlKey&&ge.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function bn(t,e,n){const i=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new me((n.clientX-e.left)*i,(n.clientY-e.top)*i)}function Fn(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Pn(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class kt{constructor(e,n={}){Ye(this,n),this.type=e}}class wn extends kt{constructor(e,n={}){super("error",Ye({error:e},n))}}class Kn{on(e,n){return this._listeners=this._listeners||{},Fn(e,n,this._listeners),this}off(e,n){return Pn(e,n,this._listeners),Pn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Fn(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){"string"==typeof e&&(e=new kt(e,n||{}));const i=e.type;if(this.listens(i)){e.target=this;const s=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const f of s)f.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const f of c)Pn(i,f,this._oneTimeListeners),f.call(this,e);const d=this._eventedParent;d&&(Ye(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof wn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Sn{constructor(e,n,i,s){this.message=(e?`${e}: `:"")+i,s&&(this.identifier=s),null!=n&&n.__line__&&(this.line=n.__line__)}}class Ji extends Sn{}function N(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function be(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function K(t){if(Array.isArray(t))return t.map(K);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=K(t[n]);return e}return be(t)}class Fe extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Lt=Fe;class Hr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[i,s]of n)this.bindings[i]=s}concat(e){return new Hr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var $o=Hr;const zs={kind:"null"},Wn={kind:"number"},Yr={kind:"string"},ui={kind:"boolean"},rs={kind:"color"},Ks={kind:"object"},br={kind:"value"},Hl={kind:"collator"},$a={kind:"formatted"},rc={kind:"resolvedImage"};function Js(t,e){return{kind:"array",itemType:t,N:e}}function go(t){if("array"===t.kind){const e=go(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const td=[zs,Wn,Yr,ui,rs,$a,Ks,Js(br),rc];function xc(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!xc(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of td)if(!xc(n,e))return null}return`Expected ${go(t)} but found ${go(e)} instead.`}function qc(t,e){return e.some(n=>n.kind===t.kind)}function Wl(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var eh,Yc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ea(t){return(t=Math.round(t))<0?0:t>255?255:t}function Gh(t){return Ea("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function ic(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Zc(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{eh={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Yc)return Yc[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),s=n.indexOf(")");if(-1!==i&&s+1===n.length){var c=n.substr(0,i),d=n.substr(i+1,s-(i+1)).split(","),f=1;switch(c){case"rgba":if(4!==d.length)return null;f=ic(d.pop());case"rgb":return 3!==d.length?null:[Gh(d[0]),Gh(d[1]),Gh(d[2]),f];case"hsla":if(4!==d.length)return null;f=ic(d.pop());case"hsl":if(3!==d.length)return null;var _=(parseFloat(d[0])%360+360)%360/360,y=ic(d[1]),v=ic(d[2]),w=v<=.5?v*(y+1):v+y-v*y,I=2*v-w;return[Ea(255*Zc(I,w,_+1/3)),Ea(255*Zc(I,w,_)),Ea(255*Zc(I,w,_-1/3)),f];default:return null}}return null}}catch{}class hs{constructor(e,n,i,s=1){this.r=e,this.g=n,this.b=i,this.a=s}static parse(e){if(!e)return;if(e instanceof hs)return e;if("string"!=typeof e)return;const n=eh(e);return n?new hs(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,i,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${s})`}toArray(){const{r:e,g:n,b:i,a:s}=this;return 0===s?[0,0,0,0]:[255*e/s,255*n/s,255*i/s,s]}toArray01(){const{r:e,g:n,b:i,a:s}=this;return 0===s?[0,0,0,0]:[e/s,n/s,i/s,s]}toArray01Scaled(e){const{r:n,g:i,b:s,a:c}=this;return 0===c?[0,0,0]:[n/c*e,i/c*e,s/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:i,a:s}=this;return[e,n,i,s]}toArray01Linear(){const{r:e,g:n,b:i,a:s}=this;return 0===s?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(n/s,2.2),Math.pow(i/s,2.2),s]}}hs.black=new hs(0,0,0,1),hs.white=new hs(1,1,1,1),hs.transparent=new hs(0,0,0,0),hs.red=new hs(1,0,0,1),hs.blue=new hs(0,0,1,1);var Ur=hs;class nd{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ml{constructor(e,n,i,s,c){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=s,this.textColor=c}}class Us{constructor(e){this.sections=e}static fromString(e){return new Us([new Ml(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof Us?e:Us.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}}class ea{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new ea({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function dy(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bc(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Ur||t instanceof nd||t instanceof Us||t instanceof ea)return!0;if(Array.isArray(t)){for(const e of t)if(!bc(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!bc(t[e]))return!1;return!0}return!1}function bs(t){if(null===t)return zs;if("string"==typeof t)return Yr;if("boolean"==typeof t)return ui;if("number"==typeof t)return Wn;if(t instanceof Ur)return rs;if(t instanceof nd)return Hl;if(t instanceof Us)return $a;if(t instanceof ea)return rc;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const s=bs(i);if(n){if(n===s)continue;n=br;break}n=s}return Js(n||br,e)}return Ks}function Oa(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Ur||t instanceof Us||t instanceof ea?t.toString():JSON.stringify(t)}class ql{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bc(e[1]))return n.error("invalid value");const i=e[1];let s=bs(i);const c=n.expectedType;return"array"!==s.kind||0!==s.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(s=c),new ql(s,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ur?["rgba"].concat(this.value.toArray()):this.value instanceof Us?this.value.serialize():this.value}}var Rl=ql,fs=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const oc={string:Yr,number:Wn,boolean:ui,object:Ks};class di{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,s=1;const c=e[0];if("array"===c){let f,_;if(e.length>2){const y=e[1];if("string"!=typeof y||!(y in oc)||"object"===y)return n.error('The item type argument of "array" must be one of string, number, boolean',1);f=oc[y],s++}else f=br;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);_=e[2],s++}i=Js(f,_)}else i=oc[c];const d=[];for(;s<e.length;s++){const f=n.parse(e[s],s,br);if(!f)return null;d.push(f)}return new di(i,d)}evaluate(e){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(e);if(!xc(this.type,bs(i)))return i;if(n===this.args.length-1)throw new fs(`Expected value to be of type ${go(this.type)}, but found ${go(bs(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){n.push(i.kind);const s=e.N;("number"==typeof s||this.args.length>1)&&n.push(s)}}return n.concat(this.args.map(i=>i.serialize()))}}var Lo=di;class No{constructor(e){this.type=$a,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const s=[];let c=!1;for(let d=1;d<=e.length-1;++d){const f=e[d];if(c&&"object"==typeof f&&!Array.isArray(f)){c=!1;let _=null;if(f["font-scale"]&&(_=n.parse(f["font-scale"],1,Wn),!_))return null;let y=null;if(f["text-font"]&&(y=n.parse(f["text-font"],1,Js(Yr)),!y))return null;let v=null;if(f["text-color"]&&(v=n.parse(f["text-color"],1,rs),!v))return null;const w=s[s.length-1];w.scale=_,w.font=y,w.textColor=v}else{const _=n.parse(e[d],1,br);if(!_)return null;const y=_.type.kind;if("string"!==y&&"value"!==y&&"null"!==y&&"resolvedImage"!==y)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,s.push({content:_,scale:null,font:null,textColor:null})}}return new No(s)}evaluate(e){return new Us(this.sections.map(n=>{const i=n.content.evaluate(e);return bs(i)===rc?new Ml("",i,null,null,null):new Ml(Oa(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class is{constructor(e,n){this.type=rc,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const i=n.parse(e[1],1,Yr);if(!i)return n.error("No image name provided.");if(2===e.length)return new is(i);const s=n.parse(e[2],1,Yr);return s?new is(i,s):n.error("Secondary image variant is not a string.")}evaluate(e){const n=ea.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function oi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Hh={"to-boolean":ui,"to-color":rs,"to-number":Wn,"to-string":Yr};class th{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[0],s=[];let c=zs;if("to-array"===i){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);c=Js(n.expectedType.itemType,d)}else{if(!(d>0&&bc(e[1][0])))return null;c=Js(bs(e[1][0]),d)}for(let f=0;f<d;f++){const _=e[1][f];let y;if("array"===oi(_))y=n.parse(_,void 0,c.itemType);else{const v=oi(_);if(v!==c.itemType.kind)return n.error(`Expected ${c.itemType.kind} but found ${v}.`);y=n.registry.literal.parse(["literal",void 0===_?null:_],n)}if(!y)return null;s.push(y)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return n.error("Expected one argument.");c=Hh[i];for(let d=1;d<e.length;d++){const f=n.parse(e[d],d,br);if(!f)return null;s.push(f)}}return new th(c,s)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let n,i;for(const s of this.args){if(n=s.evaluate(e),i=null,n instanceof Ur)return n;if("string"==typeof n){const c=e.parseColor(n);if(c)return c}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:dy(n[0],n[1],n[2],n[3]),!i))return new Ur(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new fs(i||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const i of this.args){if(n=i.evaluate(e),null===n)return 0;const s=Number(n);if(!isNaN(s))return s}throw new fs(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Us.fromString(Oa(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ea.fromString(Oa(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(n=>n.evaluate(e)):Oa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new No([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new is(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var cl=th;const rd=["Unknown","Point","LineString","Polygon"];var id=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?rd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Ur.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class eo{constructor(e,n,i,s){this.name=e,this.type=n,this._evaluate=i,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const i=e[0],s=eo.definitions[i];if(!s)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(s)?s[0]:s.type,d=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,f=d.filter(([y])=>!Array.isArray(y)||y.length===e.length-1);let _=null;for(const[y,v]of f){_=new Ii(n.registry,n.path,null,n.scope,void 0,n.options);const w=[];let I=!1;for(let C=1;C<e.length;C++){const S=e[C],M=Array.isArray(y)?y[C-1]:y.type,P=_.parse(S,1+w.length,M);if(!P){I=!0;break}w.push(P)}if(!I)if(Array.isArray(y)&&y.length!==w.length)_.error(`Expected ${y.length} arguments, but found ${w.length} instead.`);else{for(let C=0;C<w.length;C++){const S=Array.isArray(y)?y[C]:y.type,M=w[C];_.concat(C+1).checkSubtype(S,M.type)}if(0===_.errors.length)return new eo(i,c,v,w)}}if(1===f.length)n.errors.push(..._.errors);else{const y=(f.length?f:d).map(([w])=>{return I=w,Array.isArray(I)?`(${I.map(go).join(", ")})`:`(${go(I.type)}...)`;var I}).join(" | "),v=[];for(let w=1;w<e.length;w++){const I=n.parse(e[w],1+v.length);if(!I)return null;v.push(go(I.type))}n.error(`Expected arguments of type ${y}, but found (${v.join(", ")}) instead.`)}return null}static register(e,n){eo.definitions=n;for(const i in n)e[i]=eo}}var Qn=eo;class $r{constructor(e,n,i){this.type=Hl,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const s=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ui);if(!s)return null;const c=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ui);if(!c)return null;let d=null;return i.locale&&(d=n.parse(i.locale,1,Yr),!d)?null:new $r(s,c,d)}evaluate(e){return new nd(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var jo={exports:{}};jo.exports=function(){function t(i,s,c,d,f){for(;d>c;){if(d-c>600){var _=d-c+1,y=s-c+1,v=Math.log(_),w=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*w*(_-w)/_)*(y-_/2<0?-1:1);t(i,s,Math.max(c,Math.floor(s-y*w/_+I)),Math.min(d,Math.floor(s+(_-y)*w/_+I)),f)}var C=i[s],S=c,M=d;for(e(i,c,s),f(i[d],C)>0&&e(i,c,d);S<M;){for(e(i,S,M),S++,M--;f(i[S],C)<0;)S++;for(;f(i[M],C)>0;)M--}0===f(i[c],C)?e(i,c,M):e(i,++M,d),M<=s&&(c=M+1),s<=M&&(d=M-1)}}function e(i,s,c){var d=i[s];i[s]=i[c],i[c]=d}function n(i,s){return i<s?-1:i>s?1:0}return function(i,s,c,d,f){t(i,s,c||0,d||i.length-1,f||n)}}();var ta=Jt(jo.exports);function ws(t){let e=0;for(let n,i,s=0,c=t.length,d=c-1;s<c;d=s++)n=t[s],i=t[d],e+=(i.x-n.x)*(n.y+i.y);return e}function ka(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function sc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function _i(t,e,n){const i=t[0]-e[0],s=t[1]-e[1],c=t[0]-n[0],d=t[1]-n[1];return i*d-c*s==0&&i*c<=0&&s*d<=0}function Ps(t,e,n=!1){let i=!1;for(let f=0,_=e.length;f<_;f++){const y=e[f];for(let v=0,w=y.length,I=w-1;v<w;I=v++){const C=y[I],S=y[v];if(_i(t,C,S))return n;(c=C)[1]>(s=t)[1]!=(d=S)[1]>s[1]&&s[0]<(d[0]-c[0])*(s[1]-c[1])/(d[1]-c[1])+c[0]&&(i=!i)}}var s,c,d;return i}function se(t,e,n,i){const s=i[0]-n[0],c=i[1]-n[1],d=(t[0]-n[0])*c-s*(t[1]-n[1]),f=(e[0]-n[0])*c-s*(e[1]-n[1]);return d>0&&f<0||d<0&&f>0}function Y(t,e,n,i){return(s=[i[0]-n[0],i[1]-n[1]])[0]*(c=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*c[0]!=0&&!(!se(t,e,n,i)||!se(n,i,t,e));var s,c}const Re=8192;function le(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(n*s*Re),Math.round(i*s*Re)]}function Ge(t,e){for(let n=0;n<e.length;n++)if(Ps(t,e[n]))return!0;return!1}function Mn(t,e,n){for(const i of n)for(let s=0,c=i.length,d=c-1;s<c;d=s++)if(Y(t,e,i[d],i[s]))return!0;return!1}function Nr(t,e){for(let n=0;n<t.length;++n)if(!Ps(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Mn(t[n],t[n+1],e))return!1;return!0}function Fo(t,e){for(let n=0;n<e.length;n++)if(Nr(t,e[n]))return!0;return!1}function as(t,e,n){const i=[];for(let s=0;s<t.length;s++){const c=[];for(let d=0;d<t[s].length;d++){const f=le(t[s][d],n);ka(e,f),c.push(f)}i.push(c)}return i}function ul(t,e,n){const i=[];for(let s=0;s<t.length;s++){const c=as(t[s],e,n);i.push(c)}return i}function dl(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const s=.5*i;let c=t[0]-n[0]>s?-i:n[0]-t[0]>s?i:0;0===c&&(c=t[0]-n[2]>s?-i:n[2]-t[0]>s?i:0),t[0]+=c}ka(e,t)}function Pl(t,e,n,i){const s=Math.pow(2,i.z)*Re,c=[i.x*Re,i.y*Re],d=[];if(!t)return d;for(const f of t)for(const _ of f){const y=[_.x+c[0],_.y+c[1]];dl(y,e,n,s),d.push(y)}return d}function wc(t,e,n,i){const s=Math.pow(2,i.z)*Re,c=[i.x*Re,i.y*Re],d=[];if(!t)return d;for(const _ of t){const y=[];for(const v of _){const w=[v.x+c[0],v.y+c[1]];ka(e,w),y.push(w)}d.push(y)}if(e[2]-e[0]<=s/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const _ of d)for(const y of _)dl(y,e,n,s)}var f;return d}class Ia{constructor(e,n){this.type=ui,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bc(e[1])){const i=e[1];if("FeatureCollection"===i.type)for(let s=0;s<i.features.length;++s){const c=i.features[s].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new Ia(i,i.features[s].geometry)}else if("Feature"===i.type){const s=i.geometry.type;if("Polygon"===s||"MultiPolygon"===s)return new Ia(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Ia(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,i){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(!d)return!1;if("Polygon"===i.type){const f=as(i.coordinates,c,d),_=Pl(n.geometry(),s,c,d);if(!sc(s,c))return!1;for(const y of _)if(!Ps(y,f))return!1}if("MultiPolygon"===i.type){const f=ul(i.coordinates,c,d),_=Pl(n.geometry(),s,c,d);if(!sc(s,c))return!1;for(const y of _)if(!Ge(y,f))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,i){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(!d)return!1;if("Polygon"===i.type){const f=as(i.coordinates,c,d),_=wc(n.geometry(),s,c,d);if(!sc(s,c))return!1;for(const y of _)if(!Nr(y,f))return!1}if("MultiPolygon"===i.type){const f=ul(i.coordinates,c,d),_=wc(n.geometry(),s,c,d);if(!sc(s,c))return!1;for(const y of _)if(!Fo(y,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var hi=Ia,Wh={exports:{}};Wh.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),i=Math.PI/180,s=function(y,v){if(void 0===y)throw new Error("No latitude given.");if(v&&!t[v])throw new Error("Unknown unit "+v+". Use one of: "+Object.keys(t).join(", "));var w=6378.137*i*(v?t[v]:1),I=Math.cos(y*i),C=1/(1-n*(1-I*I)),S=Math.sqrt(C);this.kx=w*S*I,this.ky=w*S*C*(1-n)},c={units:{configurable:!0}};function d(y,v){return y[0]===v[0]&&y[1]===v[1]}function f(y,v,w){var I=_(v[0]-y[0]);return[y[0]+I*w,y[1]+(v[1]-y[1])*w]}function _(y){for(;y<-180;)y+=360;for(;y>180;)y-=360;return y}return s.fromTile=function(y,v,w){var I=Math.PI*(1-2*(y+.5)/Math.pow(2,v)),C=Math.atan(.5*(Math.exp(I)-Math.exp(-I)))/i;return new s(C,w)},c.units.get=function(){return t},s.prototype.distance=function(y,v){var w=_(y[0]-v[0])*this.kx,I=(y[1]-v[1])*this.ky;return Math.sqrt(w*w+I*I)},s.prototype.bearing=function(y,v){var w=_(v[0]-y[0])*this.kx;return Math.atan2(w,(v[1]-y[1])*this.ky)/i},s.prototype.destination=function(y,v,w){var I=w*i;return this.offset(y,Math.sin(I)*v,Math.cos(I)*v)},s.prototype.offset=function(y,v,w){return[y[0]+v/this.kx,y[1]+w/this.ky]},s.prototype.lineDistance=function(y){for(var v=0,w=0;w<y.length-1;w++)v+=this.distance(y[w],y[w+1]);return v},s.prototype.area=function(y){for(var v=0,w=0;w<y.length;w++)for(var I=y[w],C=0,S=I.length,M=S-1;C<S;M=C++)v+=_(I[C][0]-I[M][0])*(I[C][1]+I[M][1])*(w?-1:1);return Math.abs(v)/2*this.kx*this.ky},s.prototype.along=function(y,v){var w=0;if(v<=0)return y[0];for(var I=0;I<y.length-1;I++){var C=y[I],S=y[I+1],M=this.distance(C,S);if((w+=M)>v)return f(C,S,(v-(w-M))/M)}return y[y.length-1]},s.prototype.pointToSegmentDistance=function(y,v,w){var I=v[0],C=v[1],S=_(w[0]-I)*this.kx,M=(w[1]-C)*this.ky,P=0;return 0===S&&0===M||((P=(_(y[0]-I)*this.kx*S+(y[1]-C)*this.ky*M)/(S*S+M*M))>1?(I=w[0],C=w[1]):P>0&&(I+=S/this.kx*P,C+=M/this.ky*P)),S=_(y[0]-I)*this.kx,M=(y[1]-C)*this.ky,Math.sqrt(S*S+M*M)},s.prototype.pointOnLine=function(y,v){for(var w,I,C,S,M=1/0,P=0;P<y.length-1;P++){var R=y[P][0],z=y[P][1],G=_(y[P+1][0]-R)*this.kx,H=(y[P+1][1]-z)*this.ky,j=0;0===G&&0===H||((j=(_(v[0]-R)*this.kx*G+(v[1]-z)*this.ky*H)/(G*G+H*H))>1?(R=y[P+1][0],z=y[P+1][1]):j>0&&(R+=G/this.kx*j,z+=H/this.ky*j));var W=(G=_(v[0]-R)*this.kx)*G+(H=(v[1]-z)*this.ky)*H;W<M&&(M=W,w=R,I=z,C=P,S=j)}return{point:[w,I],index:C,t:Math.max(0,Math.min(1,S))}},s.prototype.lineSlice=function(y,v,w){var I=this.pointOnLine(w,y),C=this.pointOnLine(w,v);if(I.index>C.index||I.index===C.index&&I.t>C.t){var S=I;I=C,C=S}var M=[I.point],P=I.index+1,R=C.index;!d(w[P],M[0])&&P<=R&&M.push(w[P]);for(var z=P+1;z<=R;z++)M.push(w[z]);return d(w[R],C.point)||M.push(C.point),M},s.prototype.lineSliceAlong=function(y,v,w){for(var I=0,C=[],S=0;S<w.length-1;S++){var M=w[S],P=w[S+1],R=this.distance(M,P);if((I+=R)>y&&0===C.length&&C.push(f(M,P,(y-(I-R))/R)),I>=v)return C.push(f(M,P,(v-(I-R))/R)),C;I>y&&C.push(P)}return C},s.prototype.bufferPoint=function(y,v){var w=v/this.ky,I=v/this.kx;return[y[0]-I,y[1]-w,y[0]+I,y[1]+w]},s.prototype.bufferBBox=function(y,v){var w=v/this.ky,I=v/this.kx;return[y[0]-I,y[1]-w,y[2]+I,y[3]+w]},s.prototype.insideBBox=function(y,v){return _(y[0]-v[0])>=0&&_(y[0]-v[2])<=0&&y[1]>=v[1]&&y[1]<=v[3]},Object.defineProperties(s,c),s}();var Kc=Jt(Wh.exports),ja={exports:{}};ja.exports=function(){var t=function(n,i){if(void 0===n&&(n=[]),void 0===i&&(i=e),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function e(n,i){return n<i?-1:n>i?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var i=this.data,s=this.compare,c=i[n];n>0;){var d=n-1>>1,f=i[d];if(s(c,f)>=0)break;i[n]=f,n=d}i[n]=c},t.prototype._down=function(n){for(var i=this.data,s=this.compare,c=this.length>>1,d=i[n];n<c;){var f=1+(n<<1),_=i[f],y=f+1;if(y<this.length&&s(i[y],_)<0&&(f=y,_=i[y]),s(_,d)>=0)break;i[n]=_,n=f}i[n]=d},t}();var Xc=Jt(ja.exports),Vt=8192;function Bo(t,e){return e.dist-t.dist}const wu=100,na=50;function ps(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function od(t){return t[1]-t[0]+1}function Ta(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function sd(t,e){if(t[0]>t[1])return[null,null];const n=od(t);if(e){if(2===n)return[t,null];const i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function ms(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!Ta(e,t.length))return n;for(let i=e[0];i<=e[1];++i)ka(n,t[i]);return n}function nh(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)ka(e,t[n][i]);return e}function hl(t,e,n){if(ps(t)||ps(e))return NaN;let i=0,s=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),n.distance([0,0],[i,s])}function hy(t,e){const n=Math.pow(2,e.z);return[(s=(t.x/Vt+e.x)/n,360*s-180),(i=(t.y/Vt+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,s}function Lm(t,e){const n=[];for(let i=0;i<t.length;++i)n.push(hy(t[i],e));return n}function ap(t,e,n){const i=n.pointOnLine(e,t).point;return n.distance(t,i)}function fy(t,e,n,i,s){const c=n.slice(i[0],i[1]+1);let d=1/0;for(let f=e[0];f<=e[1];++f)if(0===(d=Math.min(d,ap(t[f],c,s))))return 0;return d}function Eu(t,e,n,i,s){const c=Math.min(s.pointToSegmentDistance(t,n,i),s.pointToSegmentDistance(e,n,i)),d=Math.min(s.pointToSegmentDistance(n,t,e),s.pointToSegmentDistance(i,t,e));return Math.min(c,d)}function U0(t,e,n,i,s){if(!Ta(e,t.length)||!Ta(i,n.length))return NaN;let c=1/0;for(let d=e[0];d<e[1];++d)for(let f=i[0];f<i[1];++f){if(Y(t[d],t[d+1],n[f],n[f+1]))return 0;c=Math.min(c,Eu(t[d],t[d+1],n[f],n[f+1],s))}return c}function lp(t,e,n,i,s){if(!Ta(e,t.length)||!Ta(i,n.length))return NaN;let c=1/0;for(let d=e[0];d<=e[1];++d)for(let f=i[0];f<=i[1];++f)if(0===(c=Math.min(c,s.distance(t[d],n[f]))))return c;return c}function $0(t,e,n){if(Ps(t,e,!0))return 0;let i=1/0;for(const s of e){const c=s.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[c-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(t,s[c-1],s[0])))||0===(i=Math.min(i,ap(t,s,n))))return i}return i}function JI(t,e,n,i){if(!Ta(e,t.length))return NaN;for(let c=e[0];c<=e[1];++c)if(Ps(t[c],n,!0))return 0;let s=1/0;for(let c=e[0];c<e[1];++c)for(const d of n)for(let f=0,_=d.length,y=_-1;f<_;y=f++){if(Y(t[c],t[c+1],d[y],d[f]))return 0;s=Math.min(s,Eu(t[c],t[c+1],d[y],d[f],i))}return s}function j0(t,e){for(const n of t)for(let i=0;i<=n.length-1;++i)if(Ps(n[i],e,!0))return!0;return!1}function py(t,e,n,i=1/0){const s=nh(t),c=nh(e);if(i!==1/0&&hl(s,c,n)>=i)return i;if(sc(s,c)){if(j0(t,e))return 0}else if(j0(e,t))return 0;let d=i;for(const f of t)for(let _=0,y=f.length,v=y-1;_<y;v=_++)for(const w of e)for(let I=0,C=w.length,S=C-1;I<C;S=I++){if(Y(f[v],f[_],w[S],w[I]))return 0;d=Math.min(d,Eu(f[v],f[_],w[S],w[I],n))}return d}function Nm(t,e,n,i,s,c,d){if(null===c||null===d)return;const f=hl(ms(i,c),ms(s,d),n);f<e&&t.push({dist:f,range1:c,range2:d})}function H1(t,e,n,i,s=1/0){let c=Math.min(i.distance(t[0],n[0][0]),s);if(0===c)return c;const d=new Xc([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Bo),f=e?na:wu,_=nh(n);for(;d.length;){const y=d.pop();if(y.dist>=c)continue;const v=y.range1;if(od(v)<=f){if(!Ta(v,t.length))return NaN;if(e){const w=JI(t,v,n,i);if(0===(c=Math.min(c,w)))return c}else for(let w=v[0];w<=v[1];++w){const I=$0(t[w],n,i);if(0===(c=Math.min(c,I)))return c}}else{const w=sd(v,e);if(null!==w[0]){const I=hl(ms(t,w[0]),_,i);I<c&&d.push({dist:I,range1:w[0],range2:[0,0]})}if(null!==w[1]){const I=hl(ms(t,w[1]),_,i);I<c&&d.push({dist:I,range1:w[1],range2:[0,0]})}}}return c}function rh(t,e,n,i,s,c=1/0){let d=Math.min(c,s.distance(t[0],n[0]));if(0===d)return d;const f=new Xc([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Bo),_=e?na:wu,y=i?na:wu;for(;f.length;){const v=f.pop();if(v.dist>=d)continue;const w=v.range1,I=v.range2;if(od(w)<=_&&od(I)<=y){if(!Ta(w,t.length)||!Ta(I,n.length))return NaN;if(e&&i?d=Math.min(d,U0(t,w,n,I,s)):e||i?e&&!i?d=Math.min(d,fy(n,I,t,w,s)):!e&&i&&(d=Math.min(d,fy(t,w,n,I,s))):d=Math.min(d,lp(t,w,n,I,s)),0===d)return d}else{const C=sd(w,e),S=sd(I,i);Nm(f,d,s,t,n,C[0],S[0]),Nm(f,d,s,t,n,C[0],S[1]),Nm(f,d,s,t,n,C[1],S[0]),Nm(f,d,s,t,n,C[1],S[1])}}return d}function G0(t,e,n,i,s=1/0){let c=s;const d=ms(t,[0,t.length-1]);for(const f of n)if(!(c!==1/0&&hl(d,ms(f,[0,f.length-1]),i)>=c)&&(c=Math.min(c,rh(t,e,f,!0,i,c)),0===c))return c;return c}function V(t,e,n,i,s=1/0){let c=s;const d=ms(t,[0,t.length-1]);for(const f of n){if(c!==1/0&&hl(d,nh(f),i)>=c)continue;const _=H1(t,e,f,i,c);if(isNaN(_))return _;if(0===(c=Math.min(c,_)))return c}return c}function ie(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Qe{constructor(e,n){this.type=Wn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(bc(e[1])){const i=e[1];if("FeatureCollection"===i.type){for(let s=0;s<i.features.length;++s)if(ie(i.features[s].geometry.type))return new Qe(i,i.features[s].geometry)}else if("Feature"===i.type){if(ie(i.geometry.type))return new Qe(i,i.geometry)}else if(ie(i.type))return new Qe(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),i=e.canonicalID();if(null!=n&&null!=i){if("Point"===e.geometryType())return function(s,c,d){const f=[];for(const y of s)for(const v of y)f.push(hy(v,c));const _=new Kc(f[0][1],"meters");return"Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type?rh(f,!1,"Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,_):"MultiLineString"===d.type?G0(f,!1,d.coordinates,_):"Polygon"===d.type||"MultiPolygon"===d.type?V(f,!1,"Polygon"===d.type?[d.coordinates]:d.coordinates,_):null}(n,i,this.geometries);if("LineString"===e.geometryType())return function(s,c,d){const f=[];for(const y of s){const v=[];for(const w of y)v.push(hy(w,c));f.push(v)}const _=new Kc(f[0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return G0("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,f,_);if("MultiLineString"===d.type){let y=1/0;for(let v=0;v<d.coordinates.length;v++){const w=G0(d.coordinates[v],!0,f,_,y);if(isNaN(w))return w;if(0===(y=Math.min(y,w)))return y}return y}if("Polygon"===d.type||"MultiPolygon"===d.type){let y=1/0;for(let v=0;v<f.length;v++){const w=V(f[v],!0,"Polygon"===d.type?[d.coordinates]:d.coordinates,_,y);if(isNaN(w))return w;if(0===(y=Math.min(y,w)))return y}return y}return null}(n,i,this.geometries);if("Polygon"===e.geometryType())return function(s,c,d){const f=[];for(const y of function(v,w){const I=v.length;if(I<=1)return[v];const C=[];let S,M;for(let P=0;P<I;P++){const R=ws(v[P]);0!==R&&(v[P].area=Math.abs(R),void 0===M&&(M=R<0),M===R<0?(S&&C.push(S),S=[v[P]]):S.push(v[P]))}return S&&C.push(S),C}(s)){const v=[];for(let w=0;w<y.length;++w)v.push(Lm(y[w],c));f.push(v)}const _=new Kc(f[0][0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return V("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,f,_);if("MultiLineString"===d.type){let y=1/0;for(let v=0;v<d.coordinates.length;v++){const w=V(d.coordinates[v],!0,f,_,y);if(isNaN(w))return w;if(0===(y=Math.min(y,w)))return y}return y}return"Polygon"===d.type||"MultiPolygon"===d.type?function(y,v,w){let I=1/0;for(const C of y)for(const S of v){const M=py(C,S,w,I);if(isNaN(M))return M;if(0===(I=Math.min(I,M)))return I}return I}("Polygon"===d.type?[d.coordinates]:d.coordinates,f,_):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var ee=Qe;function Ne(t){if(t instanceof Qn&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof hi||t instanceof ee)return!1;let e=!0;return t.eachChild(n=>{e&&!Ne(n)&&(e=!1)}),e}function pt(t){if(t instanceof Qn&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!pt(n)&&(e=!1)}),e}function Cn(t){if(t instanceof Qn&&"config"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Cn(n)&&(e=!1)}),e}function er(t,e){if(t instanceof Qn&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!er(i,e)&&(n=!1)}),n}class yi{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const i=e[1];return n.scope.has(i)?new yi(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Yi=yi;class to{constructor(e,n=[],i,s=new $o,c=[],d){this.registry=e,this.path=n,this.key=n.map(f=>`[${f}]`).join(""),this.scope=s,this.errors=c,this.expectedType=i,this.options=d}parse(e,n,i,s,c={}){return n||i?this.concat(n,i,s)._parse(e,c):this._parse(e,c)}_parse(e,n){function i(s,c,d){return"assert"===d?new Lo(c,[s]):"coerce"===d?new cl(c,[s]):s}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s="string"==typeof e[0]?this.registry[e[0]]:void 0;if(s){let c=s.parse(e,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,f=c.type;if("string"!==d.kind&&"number"!==d.kind&&"boolean"!==d.kind&&"object"!==d.kind&&"array"!==d.kind||"value"!==f.kind)if("color"!==d.kind&&"formatted"!==d.kind&&"resolvedImage"!==d.kind||"value"!==f.kind&&"string"!==f.kind){if(this.checkSubtype(d,f))return null}else c=i(c,d,n.typeAnnotation||"coerce");else c=i(c,d,n.typeAnnotation||"assert")}if(!(c instanceof Rl)&&"resolvedImage"!==c.type.kind&&_o(c)){const d=new id(this.options);try{c=new Rl(c.type,c.evaluate(d))}catch(f){return this.error(f.message),null}}return c}return cl.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){const s="number"==typeof e?this.path.concat(e):this.path,c=i?this.scope.concat(i):this.scope;return new to(this.registry,s,n||null,c,this.errors,this.options)}error(e,...n){const i=`${this.key}${n.map(s=>`[${s}]`).join("")}`;this.errors.push(new Lt(i,e))}checkSubtype(e,n){const i=xc(e,n);return i&&this.error(i),i}}var Ii=to;function _o(t){if(t instanceof Yi)return _o(t.boundExpression);if(t instanceof Qn&&"error"===t.name||t instanceof Qn&&"config"===t.name||t instanceof $r||t instanceof hi||t instanceof ee)return!1;const e=t instanceof cl||t instanceof Lo;let n=!0;return t.eachChild(i=>{n=e?n&&_o(i):n&&i instanceof Rl}),!!n&&Ne(t)&&er(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function oo(t,e){const n=t.length-1;let i,s,c=0,d=n,f=0;for(;c<=d;)if(f=Math.floor((c+d)/2),i=t[f],s=t[f+1],i<=e){if(f===n||e<s)return f;c=f+1}else{if(!(i>e))throw new fs("Input is not a number.");d=f-1}return 0}class $s{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[s,c]of i)this.labels.push(s),this.outputs.push(c)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(e[1],1,Wn);if(!i)return null;const s=[];let c=null;n.expectedType&&"value"!==n.expectedType.kind&&(c=n.expectedType);for(let d=1;d<e.length;d+=2){const f=1===d?-1/0:e[d],_=e[d+1],y=d,v=d+1;if("number"!=typeof f)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(s.length&&s[s.length-1][0]>=f)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const w=n.parse(_,v,c);if(!w)return null;c=c||w.type,s.push([f,w])}return new $s(c,i,s)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const s=this.input.evaluate(e);if(s<=n[0])return i[0].evaluate(e);const c=n.length;return s>=n[c-1]?i[c-1].evaluate(e):i[oo(n,s)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ol=$s;function Er(t,e,n){return t*(1-n)+e*n}function Yl(t,e,n){return t.map((i,s)=>Er(i,e[s],n))}var kl=Object.freeze({__proto__:null,array:Yl,color:function(t,e,n){return new Ur(Er(t.r,e.r,n),Er(t.g,e.g,n),Er(t.b,e.b,n),Er(t.a,e.a,n))},number:Er});const Qc=4/29,Ll=6/29,Aa=3*Ll*Ll,Iu=Ll*Ll*Ll,Yo=Math.PI/180,ad=180/Math.PI;function Tu(t){return t>Iu?Math.pow(t,1/3):t/Aa+Qc}function tr(t){return t>Ll?t*t*t:Aa*(t-Qc)}function ac(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ca(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function lc(t){const e=Ca(t.r),n=Ca(t.g),i=Ca(t.b),s=Tu((.4124564*e+.3575761*n+.1804375*i)/.95047),c=Tu((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*c-16,a:500*(s-c),b:200*(c-Tu((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function Ha(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*tr(e),n=.95047*tr(n),i=1.08883*tr(i),new Ur(ac(3.2404542*n-1.5371385*e-.4985314*i),ac(-.969266*n+1.8760108*e+.041556*i),ac(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function H0(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const ih={forward:lc,reverse:Ha,interpolate:function(t,e,n){return{l:Er(t.l,e.l,n),a:Er(t.a,e.a,n),b:Er(t.b,e.b,n),alpha:Er(t.alpha,e.alpha,n)}}},Wa={forward:function(t){const{l:e,a:n,b:i}=lc(t),s=Math.atan2(i,n)*ad;return{h:s<0?s+360:s,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Yo,n=t.c;return Ha({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:H0(t.h,e.h,n),c:Er(t.c,e.c,n),l:Er(t.l,e.l,n),alpha:Er(t.alpha,e.alpha,n)}}};var fl=Object.freeze({__proto__:null,hcl:Wa,lab:ih});class oh{constructor(e,n,i,s,c){this.type=e,this.operator=n,this.interpolation=i,this.input=s,this.labels=[],this.outputs=[];for(const[d,f]of c)this.labels.push(d),this.outputs.push(f)}static interpolationFactor(e,n,i,s){let c=0;if("exponential"===e.name)c=sh(n,e.base,i,s);else if("linear"===e.name)c=sh(n,1,i,s);else if("cubic-bezier"===e.name){const d=e.controlPoints;c=new Pt(d[0],d[1],d[2],d[3]).solve(sh(n,1,i,s))}return c}static parse(e,n){let[i,s,c,...d]=e;if(!Array.isArray(s)||0===s.length)return n.error("Expected an interpolation type expression.",1);if("linear"===s[0])s={name:"linear"};else if("exponential"===s[0]){const y=s[1];if("number"!=typeof y)return n.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:y}}else{if("cubic-bezier"!==s[0])return n.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const y=s.slice(1);if(4!==y.length||y.some(v=>"number"!=typeof v||v<0||v>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(c=n.parse(c,2,Wn),!c)return null;const f=[];let _=null;"interpolate-hcl"===i||"interpolate-lab"===i?_=rs:n.expectedType&&"value"!==n.expectedType.kind&&(_=n.expectedType);for(let y=0;y<d.length;y+=2){const v=d[y],w=d[y+1],I=y+3,C=y+4;if("number"!=typeof v)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=v)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const S=n.parse(w,C,_);if(!S)return null;_=_||S.type,f.push([v,S])}return"number"===_.kind||"color"===_.kind||"array"===_.kind&&"number"===_.itemType.kind&&"number"==typeof _.N?new oh(_,i,s,c,f):n.error(`Type ${go(_)} is not interpolatable.`)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const s=this.input.evaluate(e);if(s<=n[0])return i[0].evaluate(e);const c=n.length;if(s>=n[c-1])return i[c-1].evaluate(e);const d=oo(n,s),f=oh.interpolationFactor(this.interpolation,s,n[d],n[d+1]),_=i[d].evaluate(e),y=i[d+1].evaluate(e);return"interpolate"===this.operator?kl[this.type.kind.toLowerCase()](_,y,f):"interpolate-hcl"===this.operator?Wa.reverse(Wa.interpolate(Wa.forward(_),Wa.forward(y),f)):ih.reverse(ih.interpolate(ih.forward(_),ih.forward(y),f))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function sh(t,e,n,i){const s=i-n,c=t-n;return 0===s?0:1===e?c/s:(Math.pow(e,c)-1)/(Math.pow(e,s)-1)}var Ec=oh;class Fm{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null;const s=n.expectedType;s&&"value"!==s.kind&&(i=s);const c=[];for(const f of e.slice(1)){const _=n.parse(f,1+c.length,i,void 0,{typeAnnotation:"omit"});if(!_)return null;i=i||_.type,c.push(_)}const d=s&&c.some(f=>xc(s,f.type));return new Fm(d?br:i,c)}evaluate(e){let n,i=null,s=0;for(const c of this.args){if(s++,i=c.evaluate(e),i&&i instanceof ea&&!i.available&&(n||(n=i),i=null,s===this.args.length))return n;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Go=Fm;class Ro{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if("string"!=typeof d)return n.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return n.error("Variable names must contain only alphanumeric characters or '_'.",c);const f=n.parse(e[c+1],c+1);if(!f)return null;i.push([d,f])}const s=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return s?new Ro(i,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}var qh=Ro;class Yh{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,Wn),s=n.parse(e[2],2,Js(n.expectedType||br));return i&&s?new Yh(s.type.itemType,i,s):null}evaluate(e){const n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new fs(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new fs(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new fs(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var mi=Yh;class Zl{constructor(e,n){this.type=ui,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,br),s=n.parse(e[2],2,br);return i&&s?qc(i.type,[ui,Yr,Wn,zs,br])?new Zl(i,s):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${go(i.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Wl(n,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${go(bs(n))} instead.`);if(!Wl(i,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${go(bs(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var W1=Zl;class Zh{constructor(e,n,i){this.type=Wn,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,br),s=n.parse(e[2],2,br);if(!i||!s)return null;if(!qc(i.type,[ui,Yr,Wn,zs,br]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${go(i.type)} instead`);if(4===e.length){const c=n.parse(e[3],3,Wn);return c?new Zh(i,s,c):null}return new Zh(i,s)}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Wl(n,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${go(bs(n))} instead.`);if(!Wl(i,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${go(bs(i))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return i.indexOf(n,s)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Jc=Zh;class my{constructor(e,n,i,s,c,d){this.inputType=e,this.type=n,this.input=i,this.cases=s,this.outputs=c,this.otherwise=d}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const c={},d=[];for(let y=2;y<e.length-1;y+=2){let v=e[y];const w=e[y+1];Array.isArray(v)||(v=[v]);const I=n.concat(y);if(0===v.length)return I.error("Expected at least one branch label.");for(const S of v){if("number"!=typeof S&&"string"!=typeof S)return I.error("Branch labels must be numbers or strings.");if("number"==typeof S&&Math.abs(S)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof S&&Math.floor(S)!==S)return I.error("Numeric branch labels must be integer values.");if(i){if(I.checkSubtype(i,bs(S)))return null}else i=bs(S);if(void 0!==c[String(S)])return I.error("Branch labels must be unique.");c[String(S)]=d.length}const C=n.parse(w,y,s);if(!C)return null;s=s||C.type,d.push(C)}const f=n.parse(e[1],1,br);if(!f)return null;const _=n.parse(e[e.length-1],e.length-1,s);return _?"value"!==f.type.kind&&n.concat(1).checkSubtype(i,f.type)?null:new my(i,s,f,c,d,_):null}evaluate(e){const n=this.input.evaluate(e);return(bs(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],s={};for(const d of n){const f=s[this.cases[d]];void 0===f?(s[this.cases[d]]=i.length,i.push([this.cases[d],[d]])):i[f][1].push(d)}const c=d=>"number"===this.inputType.kind?Number(d):d;for(const[d,f]of i)e.push(1===f.length?c(f[0]):f.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var cp=my;class ld{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const s=[];for(let d=1;d<e.length-1;d+=2){const f=n.parse(e[d],d,ui);if(!f)return null;const _=n.parse(e[d+1],d+1,i);if(!_)return null;s.push([f,_]),i=i||_.type}const c=n.parse(e[e.length-1],e.length-1,i);return c?new ld(i,s,c):null}evaluate(e){for(const[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var q1=ld;class Kh{constructor(e,n,i,s){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,br),s=n.parse(e[2],2,Wn);if(!i||!s)return null;if(!qc(i.type,[Js(br),Yr,br]))return n.error(`Expected first argument to be of type array or string, but found ${go(i.type)} instead`);if(4===e.length){const c=n.parse(e[3],3,Wn);return c?new Kh(i.type,i,s,c):null}return new Kh(i.type,i,s)}evaluate(e){const n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Wl(n,["string","array"]))throw new fs(`Expected first argument to be of type array or string, but found ${go(bs(n))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return n.slice(i,s)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var W0=Kh;function Xh(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gy(t,e,n,i){return 0===i.compare(e,n)}function Tn(t,e,n){const i="=="!==t&&"!="!==t;return class DR{constructor(c,d,f){this.type=ui,this.lhs=c,this.rhs=d,this.collator=f,this.hasUntypedArgument="value"===c.type.kind||"value"===d.type.kind}static parse(c,d){if(3!==c.length&&4!==c.length)return d.error("Expected two or three arguments.");const f=c[0];let _=d.parse(c[1],1,br);if(!_)return null;if(!Xh(f,_.type))return d.concat(1).error(`"${f}" comparisons are not supported for type '${go(_.type)}'.`);let y=d.parse(c[2],2,br);if(!y)return null;if(!Xh(f,y.type))return d.concat(2).error(`"${f}" comparisons are not supported for type '${go(y.type)}'.`);if(_.type.kind!==y.type.kind&&"value"!==_.type.kind&&"value"!==y.type.kind)return d.error(`Cannot compare types '${go(_.type)}' and '${go(y.type)}'.`);i&&("value"===_.type.kind&&"value"!==y.type.kind?_=new Lo(y.type,[_]):"value"!==_.type.kind&&"value"===y.type.kind&&(y=new Lo(_.type,[y])));let v=null;if(4===c.length){if("string"!==_.type.kind&&"string"!==y.type.kind&&"value"!==_.type.kind&&"value"!==y.type.kind)return d.error("Cannot use collator to compare non-string types.");if(v=d.parse(c[3],3,Hl),!v)return null}return new DR(_,y,v)}evaluate(c){const d=this.lhs.evaluate(c),f=this.rhs.evaluate(c);if(i&&this.hasUntypedArgument){const _=bs(d),y=bs(f);if(_.kind!==y.kind||"string"!==_.kind&&"number"!==_.kind)throw new fs(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${_.kind}, ${y.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const _=bs(d),y=bs(f);if("string"!==_.kind||"string"!==y.kind)return e(c,d,f)}return this.collator?n(c,d,f,this.collator.evaluate(c)):e(c,d,f)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const yo=Tn("==",function(t,e,n){return e===n},gy),up=Tn("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!gy(0,e,n,i)}),q0=Tn("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),Ho=Tn(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),Y1=Tn("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),Qh=Tn(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class qa{constructor(e,n,i,s,c,d){this.type=Yr,this.number=e,this.locale=n,this.currency=i,this.unit=s,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,Wn);if(!i)return null;const s=e[2];if("object"!=typeof s||Array.isArray(s))return n.error("NumberFormat options argument must be an object.");let c=null;if(s.locale&&(c=n.parse(s.locale,1,Yr),!c))return null;let d=null;if(s.currency&&(d=n.parse(s.currency,1,Yr),!d))return null;let f=null;if(s.unit&&(f=n.parse(s.unit,1,Yr),!f))return null;let _=null;if(s["min-fraction-digits"]&&(_=n.parse(s["min-fraction-digits"],1,Wn),!_))return null;let y=null;return s["max-fraction-digits"]&&(y=n.parse(s["max-fraction-digits"],1,Wn),!y)?null:new qa(i,c,d,f,_,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Bm{constructor(e){this.type=Wn,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=n.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${go(i.type)} instead.`):new Bm(i):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new fs(`Expected value to be of type string or array, but found ${go(bs(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Vm(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const dp={"==":yo,"!=":up,">":Ho,"<":q0,">=":Qh,"<=":Y1,array:Lo,at:mi,boolean:Lo,case:q1,coalesce:Go,collator:$r,format:No,image:is,in:W1,"index-of":Jc,interpolate:Ec,"interpolate-hcl":Ec,"interpolate-lab":Ec,length:Bm,let:qh,literal:Rl,match:cp,number:Lo,"number-format":qa,object:Lo,slice:W0,step:Ol,string:Lo,"to-boolean":cl,"to-color":cl,"to-number":cl,"to-string":cl,var:Yi,within:hi,distance:ee};function _y(t,[e,n,i,s]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const c=s?s.evaluate(t):1,d=dy(e,n,i,c);if(d)throw new fs(d);return new Ur(e/255*c,n/255*c,i/255*c,c)}function Jh(t,[e,n,i,s]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const c=s?s.evaluate(t):1,d=(v=n,w=i,I=c,"number"==typeof(y=e)&&y>=0&&y<=360?"number"==typeof v&&v>=0&&v<=100&&"number"==typeof w&&w>=0&&w<=100?void 0===I||"number"==typeof I&&I>=0&&I<=1?null:`Invalid hsla value [${[y,v,w,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof I?[y,v,w,I]:[y,v,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof I?[y,v,w,I]:[y,v,w]).join(", ")}]: 'h' must be between 0 and 360.`);var y,v,w,I;if(d)throw new fs(d);const f=`hsla(${e}, ${n}%, ${i}%, ${c})`,_=Ur.parse(f);if(!_)throw new fs(`Failed to parse HSLA color: ${f}`);return _}function Ya(t,e){return t in e}function ua(t,e){const n=e[t];return void 0===n?null:n}function hp(t,e,n){n.length&&(e+=`\x1f${n}`);const i=t.getConfig(e);return i?i.evaluate(t):null}function Za(t){return{type:t}}Qn.register(dp,{error:[{kind:"error"},[Yr],(t,[e])=>{throw new fs(e.evaluate(t))}],typeof:[Yr,[br],(t,[e])=>go(bs(e.evaluate(t)))],"to-rgba":[Js(Wn,4),[rs],(t,[e])=>e.evaluate(t).toArray()],rgb:[rs,[Wn,Wn,Wn],_y],rgba:[rs,[Wn,Wn,Wn,Wn],_y],hsl:[rs,[Wn,Wn,Wn],Jh],hsla:[rs,[Wn,Wn,Wn,Wn],Jh],has:{type:ui,overloads:[[[Yr],(t,[e])=>Ya(e.evaluate(t),t.properties())],[[Yr,Ks],(t,[e,n])=>Ya(e.evaluate(t),n.evaluate(t))]]},get:{type:br,overloads:[[[Yr],(t,[e])=>ua(e.evaluate(t),t.properties())],[[Yr,Ks],(t,[e,n])=>ua(e.evaluate(t),n.evaluate(t))]]},config:{type:br,overloads:[[[Yr],(t,[e])=>hp(t,e.evaluate(t),"")],[[Yr,Yr],(t,[e,n])=>hp(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[br,[Yr],(t,[e])=>ua(e.evaluate(t),t.featureState||{})],properties:[Ks,[],t=>t.properties()],"geometry-type":[Yr,[],t=>t.geometryType()],id:[br,[],t=>t.id()],zoom:[Wn,[],t=>t.globals.zoom],pitch:[Wn,[],t=>t.globals.pitch||0],"distance-from-center":[Wn,[],t=>t.distanceFromCenter()],"measure-light":[Wn,[Yr],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Wn,[],t=>t.globals.heatmapDensity||0],"line-progress":[Wn,[],t=>t.globals.lineProgress||0],"raster-value":[Wn,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Wn,[],t=>t.globals.skyRadialProgress||0],accumulated:[br,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Wn,Za(Wn),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[Wn,Za(Wn),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:Wn,overloads:[[[Wn,Wn],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Wn],(t,[e])=>-e.evaluate(t)]]},"/":[Wn,[Wn,Wn],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Wn,[Wn,Wn],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Wn,[],()=>Math.LN2],pi:[Wn,[],()=>Math.PI],e:[Wn,[],()=>Math.E],"^":[Wn,[Wn,Wn],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Wn,[Wn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Wn,[Wn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Wn,[Wn],(t,[e])=>Math.log(e.evaluate(t))],log2:[Wn,[Wn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Wn,[Wn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Wn,[Wn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Wn,[Wn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Wn,[Wn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Wn,[Wn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Wn,[Wn],(t,[e])=>Math.atan(e.evaluate(t))],min:[Wn,Za(Wn),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Wn,Za(Wn),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Wn,[Wn],(t,[e])=>Math.abs(e.evaluate(t))],round:[Wn,[Wn],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Wn,[Wn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Wn,[Wn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ui,[Yr,br],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ui,[br],(t,[e])=>t.id()===e.value],"filter-type-==":[ui,[Yr],(t,[e])=>t.geometryType()===e.value],"filter-<":[ui,[Yr,br],(t,[e,n])=>{const i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i<s}],"filter-id-<":[ui,[br],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[ui,[Yr,br],(t,[e,n])=>{const i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i>s}],"filter-id->":[ui,[br],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[ui,[Yr,br],(t,[e,n])=>{const i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i<=s}],"filter-id-<=":[ui,[br],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[ui,[Yr,br],(t,[e,n])=>{const i=t.properties()[e.value],s=n.value;return typeof i==typeof s&&i>=s}],"filter-id->=":[ui,[br],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[ui,[br],(t,[e])=>e.value in t.properties()],"filter-has-id":[ui,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ui,[Js(Yr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ui,[Js(br)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ui,[Yr,Js(br)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ui,[Yr,Js(br)],(t,[e,n])=>function(i,s,c,d){for(;c<=d;){const f=c+d>>1;if(s[f]===i)return!0;s[f]>i?d=f-1:c=f+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Za(ui),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Za(ui),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ui,[ui],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ui,[Yr],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Yr,[Yr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Yr,[Yr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Yr,Za(br),(t,e)=>e.map(n=>Oa(n.evaluate(t))).join("")],"resolved-locale":[Yr,[Hl],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Wn,[Wn,Wn,br],(t,e)=>{const[n,i,s]=e.map(d=>d.evaluate(t));if(n>i||n===i)return n;let c;if("string"==typeof s)c=function(d){let f=0;if(0===d.length)return f;for(let _=0;_<d.length;_++)f=(f<<5)-f+d.charCodeAt(_),f&=f;return f}(s);else{if("number"!=typeof s)throw new fs(`Invalid seed input: ${s}`);c=s}return n+Vm(c)()*(i-n)}]});var Kl=dp;function zm(t){return{result:"success",value:t}}function cc(t){return{result:"error",value:t}}function yy(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ef(t){return"data-driven"===t["property-type"]}function fp(t){return yy(t.expression,"measure-light")}function Um(t){return yy(t.expression,"zoom")}function vy(t){return!!t.expression&&t.expression.interpolated}function pp(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function L(t){return t}function $(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],s=i||!(i||void 0!==t.property),c=t.type||(vy(e)?"exponential":"interval");if(n&&((t=N({},t)).stops&&(t.stops=t.stops.map(y=>[y[0],Ur.parse(y[1])])),t.default=Ur.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!fl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,f,_;if("exponential"===c)d=Ee;else if("interval"===c)d=Q;else if("categorical"===c){d=B,f=Object.create(null);for(const y of t.stops)f[y[0]]=y[1];_=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);d=je}if(i){const y={},v=[];for(let C=0;C<t.stops.length;C++){const S=t.stops[C],M=S[0].zoom;void 0===y[M]&&(y[M]={zoom:M,type:t.type,property:t.property,default:t.default,stops:[]},v.push(M)),y[M].stops.push([S[0].value,S[1]])}const w=[];for(const C of v)w.push([y[C].zoom,$(y[C],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Ec.interpolationFactor.bind(void 0,I),zoomStops:w.map(C=>C[0]),evaluate:({zoom:C},S)=>Ee({stops:w,base:t.base},e,C).evaluate(C,S)}}if(s){const y="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:Ec.interpolationFactor.bind(void 0,y),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>d(t,e,v,f,_)}}return{kind:"source",evaluate(y,v){const w=v&&v.properties?v.properties[t.property]:void 0;return void 0===w?X(t.default,e.default):d(t,e,w,f,_)}}}function X(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function B(t,e,n,i,s){return X(typeof n===s?i[n]:void 0,t.default,e.default)}function Q(t,e,n){if("number"!==oi(n))return X(t.default,e.default);const i=t.stops.length;if(1===i||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const s=oo(t.stops.map(c=>c[0]),n);return t.stops[s][1]}function Ee(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==oi(n))return X(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const c=oo(t.stops.map(v=>v[0]),n),d=function(v,w,I,C){const S=C-I,M=v-I;return 0===S?0:1===w?M/S:(Math.pow(w,M)-1)/(Math.pow(w,S)-1)}(n,i,t.stops[c][0],t.stops[c+1][0]),f=t.stops[c][1],_=t.stops[c+1][1];let y=kl[e.type]||L;if(t.colorSpace&&"rgb"!==t.colorSpace){const v=fl[t.colorSpace];y=(w,I)=>v.reverse(v.interpolate(v.forward(w),v.forward(I),d))}return"function"==typeof f.evaluate?{evaluate(...v){const w=f.evaluate.apply(void 0,v),I=_.evaluate.apply(void 0,v);if(void 0!==w&&void 0!==I)return y(w,I,d)}}:y(f,_,d)}function je(t,e,n){return"color"===e.type?n=Ur.parse(n):"formatted"===e.type?n=Us.fromString(n.toString()):"resolvedImage"===e.type?n=ea.fromString(n.toString()):oi(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),X(n,t.default,e.default)}class jt{constructor(e,n,i){var s;this.expression=e,this._warningHistory={},this._evaluator=new id(i),this._defaultValue=n?"color"===(s=n).type&&(pp(s.default)||Array.isArray(s.default))?new Ur(0,0,0,0):"color"===s.type?Ur.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,i,s,c,d,f,_){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=_||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,s,c,d,f,_){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=_||null;try{const y=this.expression.evaluate(this._evaluator);if(null==y||"number"==typeof y&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new fs(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Bn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Kl}function Zt(t,e,n){const i=new Ii(Kl,[],e?function(c){const d={color:rs,string:Yr,number:Wn,enum:Yr,boolean:ui,formatted:$a,resolvedImage:rc};return"array"===c.type?Js(d[c.value]||br,c.length):d[c.type]}(e):void 0,void 0,void 0,n),s=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?zm(new jt(s,e,n)):cc(i.errors)}class ar{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!pt(n.expression),this.isConfigDependent=!Cn(n.expression)}evaluateWithoutErrorHandling(e,n,i,s,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,s,c,d)}evaluate(e,n,i,s,c,d){return this._styleExpression.evaluate(e,n,i,s,c,d)}}class _r{constructor(e,n,i,s,c){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent="camera"!==e&&!pt(n.expression),this.isLightConstant=c,this.isConfigDependent=!Cn(n.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,n,i,s,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,s,c,d)}evaluate(e,n,i,s,c,d){return this._styleExpression.evaluate(e,n,i,s,c,d)}interpolationFactor(e,n,i){return this.interpolationType?Ec.interpolationFactor(this.interpolationType,e,n,i):0}}function os(t,e,n){if("error"===(t=Zt(t,e,n)).result)return t;const i=t.value.expression,s=Ne(i);if(!s&&!ef(e))return cc([new Lt("","data expressions not supported")]);const c=er(i,["zoom","pitch","distance-from-center"]);if(!c&&!Um(e))return cc([new Lt("","zoom expressions not supported")]);const d=er(i,["measure-light"]);if(!d&&!fp(e))return cc([new Lt("","measure-light expression not supported")]);const f=e.expression&&e.expression.relaxZoomRestriction,_=js(i);return _||c||f?_ instanceof Lt?cc([_]):_ instanceof Ec&&!vy(e)?cc([new Lt("",'"interpolate" expressions cannot be used with this property')]):zm(_?new _r(s?"camera":"composite",t.value,_.labels,_ instanceof Ec?_.interpolation:void 0,d):new ar(s?"constant":"source",t.value,d)):cc([new Lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mo{constructor(e,n){this._parameters=e,this._specification=n,N(this,$(this._parameters,this._specification))}static deserialize(e){return new mo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function js(t){let e=null;if(t instanceof qh)e=js(t.result);else if(t instanceof Go){for(const n of t.args)if(e=js(n),e)break}else(t instanceof Ol||t instanceof Ec)&&t.input instanceof Qn&&"zoom"===t.input.name&&(e=t);return e instanceof Lt||t.eachChild(n=>{const i=js(n);i instanceof Lt?e=i:e&&i&&e!==i&&(e=new Lt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function da(t){const e=t.key,n=t.value,i=t.valueSpec||{},s=t.objectElementValidators||{},c=t.style,d=t.styleSpec;let f=[];const _=oi(n);if("object"!==_)return[new Sn(e,n,`object expected, ${_} found`)];for(const y in n){const v=y.split(".")[0];let w;s[v]?w=s[v]:i[v]?w=fa:s["*"]?w=s["*"]:i["*"]&&(w=fa),w?f=f.concat(w({key:(e&&`${e}.`)+y,value:n[y],valueSpec:i[v]||i["*"],style:c,styleSpec:d,object:n,objectKey:y},n)):f.push(new Ji(e,n[y],`unknown property "${y}"`))}for(const y in i)s[y]||i[y].required&&void 0===i[y].default&&void 0===n[y]&&f.push(new Sn(e,n,`missing required property "${y}"`));return f}function cd(t){const e=t.value,n=t.valueSpec,i=t.style,s=t.styleSpec,c=t.key,d=t.arrayElementValidator||fa;if("array"!==oi(e))return[new Sn(c,e,`array expected, ${oi(e)} found`)];if(n.length&&e.length!==n.length)return[new Sn(c,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Sn(c,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let f={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};s.$version<7&&(f.function=n.function),"object"===oi(n.value)&&(f=n.value);let _=[];for(let y=0;y<e.length;y++)_=_.concat(d({array:e,arrayIndex:y,value:e[y],valueSpec:f,style:i,styleSpec:s,key:`${c}[${y}]`},!0));return _}function ud(t){const e=t.key,n=t.value,i=t.valueSpec;let s=oi(n);if("number"===s&&n!=n&&(s="NaN"),"number"!==s)return[new Sn(e,n,`number expected, ${s} found`)];if("minimum"in i){let c=i.minimum;if("array"===oi(i.minimum)&&(c=i.minimum[t.arrayIndex]),n<c)return[new Sn(e,n,`${n} is less than the minimum value ${c}`)]}if("maximum"in i){let c=i.maximum;if("array"===oi(i.maximum)&&(c=i.maximum[t.arrayIndex]),n>c)return[new Sn(e,n,`${n} is greater than the maximum value ${c}`)]}return[]}function eu(t){const e=t.valueSpec,n=be(t.value.type);let i,s,c,d={};const f="categorical"!==n&&void 0===t.value.property,_=!f,y="array"===oi(t.value.stops)&&"array"===oi(t.value.stops[0])&&"object"===oi(t.value.stops[0][0]),v=da({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(C){if("identity"===n)return[new Sn(C.key,C.value,'identity function may not have a "stops" property')];let S=[];const M=C.value;return S=S.concat(cd({key:C.key,value:M,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:w})),"array"===oi(M)&&0===M.length&&S.push(new Sn(C.key,M,"array must have at least one stop")),S},default:function(C){return fa({key:C.key,value:C.value,valueSpec:e,style:C.style,styleSpec:C.styleSpec})}}});return"identity"===n&&f&&v.push(new Sn(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||v.push(new Sn(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!vy(t.valueSpec)&&v.push(new Sn(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(_&&!ef(t.valueSpec)?v.push(new Sn(t.key,t.value,"property functions not supported")):f&&!Um(t.valueSpec)&&v.push(new Sn(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!y||void 0!==t.value.property||v.push(new Sn(t.key,t.value,'"property" property is required')),v;function w(C){let S=[];const M=C.value,P=C.key;if("array"!==oi(M))return[new Sn(P,M,`array expected, ${oi(M)} found`)];if(2!==M.length)return[new Sn(P,M,`array length 2 expected, length ${M.length} found`)];if(y){if("object"!==oi(M[0]))return[new Sn(P,M,`object expected, ${oi(M[0])} found`)];if(void 0===M[0].zoom)return[new Sn(P,M,"object stop key must have zoom")];if(void 0===M[0].value)return[new Sn(P,M,"object stop key must have value")];const R=be(M[0].zoom);if("number"!=typeof R)return[new Sn(P,M[0].zoom,"stop zoom values must be numbers")];if(c&&c>R)return[new Sn(P,M[0].zoom,"stop zoom values must appear in ascending order")];R!==c&&(c=R,s=void 0,d={}),S=S.concat(da({key:`${P}[0]`,value:M[0],valueSpec:{zoom:{}},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{zoom:ud,value:I}}))}else S=S.concat(I({key:`${P}[0]`,value:M[0],valueSpec:{},style:C.style,styleSpec:C.styleSpec},M));return Bn(K(M[1]))?S.concat([new Sn(`${P}[1]`,M[1],"expressions are not allowed in function stops.")]):S.concat(fa({key:`${P}[1]`,value:M[1],valueSpec:e,style:C.style,styleSpec:C.styleSpec}))}function I(C,S){const M=oi(C.value),P=be(C.value),R=null!==C.value?C.value:S;if(i){if(M!==i)return[new Sn(C.key,R,`${M} stop domain type must match previous stop domain type ${i}`)]}else i=M;if("number"!==M&&"string"!==M&&"boolean"!==M&&"number"!=typeof P&&"string"!=typeof P&&"boolean"!=typeof P)return[new Sn(C.key,R,"stop domain value must be a number, string, or boolean")];if("number"!==M&&"categorical"!==n){let z=`number expected, ${M} found`;return ef(e)&&void 0===n&&(z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Sn(C.key,R,z)]}return"categorical"!==n||"number"!==M||"number"==typeof P&&isFinite(P)&&Math.floor(P)===P?"categorical"!==n&&"number"===M&&"number"==typeof P&&"number"==typeof s&&void 0!==s&&P<s?[new Sn(C.key,R,"stop domain values must appear in ascending order")]:(s=P,"categorical"===n&&P in d?[new Sn(C.key,R,"stop domain values must be unique")]:(d[P]=!0,[])):[new Sn(C.key,R,`integer expected, found ${String(P)}`)]}}function ha(t){const e=("property"===t.expressionContext?os:Zt)(K(t.value),t.valueSpec);if("error"===e.result)return e.value.map(i=>new Sn(`${t.key}${i.key}`,t.value,i.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Sn(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!pt(n))return[new Sn(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return mp(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!er(n,["zoom","feature-state"]))return[new Sn(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ne(n))return[new Sn(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mp(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const s of e.valueSpec.expression.parameters)n.delete(s);if(0===n.size)return[];const i=[];return t instanceof Qn&&n.has(t.name)?[new Sn(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(s=>{i.push(...mp(s,e))}),i)}function tu(t){const e=t.key,n=t.value,i=t.valueSpec,s=[];return Array.isArray(i.values)?-1===i.values.indexOf(be(n))&&s.push(new Sn(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(be(n))&&s.push(new Sn(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),s}function $m(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!$m(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function jm(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$m(t)||(t=Z0(t));const n=t;let i=!0;try{i=function(y){if(!tf(y))return y;let v=K(y);return eT(v),v=Y0(v),v}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const s=ut[`filter_${e}`],c=Zt(i,s);let d=null;if("error"===c.result)throw new Error(c.value.map(y=>`${y.key}: ${y.message}`).join(", "));d=(y,v,w)=>c.value.evaluate(y,v,{},w);let f=null,_=null;if(i!==n){const y=Zt(n,s);if("error"===y.result)throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));f=(v,w,I,C,S)=>y.value.evaluate(v,w,{},I,void 0,void 0,C,S),_=!Ne(y.value.expression)}return{filter:d,dynamicFilter:f||void 0,needGeometry:nf(i),needFeature:!!_}}function Y0(t){if(!Array.isArray(t))return t;const e=function(n){if(YC.has(n[0]))for(let i=1;i<n.length;i++)if(tf(n[i]))return!0;return n}(t);return!0===e?e:e.map(n=>Y0(n))}function eT(t){let e=!1;const n=[];if("case"===t[0]){for(let i=1;i<t.length-1;i+=2)e=e||tf(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||tf(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||tf(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)eT(t[i])}function tf(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(tf(t[n]))return!0;return!1}const YC=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gm(t,e){return t<e?-1:t>e?1:0}function nf(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(nf(t[e]))return!0;return!1}function Z0(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?xy(t[1],t[2],"=="):"!="===e?by(xy(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?xy(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Z0))):"all"===e?["all"].concat(t.slice(1).map(Z0)):"none"===e?["all"].concat(t.slice(1).map(Z0).map(by)):"in"===e?tT(t[1],t.slice(2)):"!in"===e?by(tT(t[1],t.slice(2))):"has"===e?ra(t[1]):"!has"!==e||by(ra(t[1]));var n}function xy(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function tT(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Gm)]]:["filter-in-small",t,["literal",e]]}}function ra(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function by(t){return["!",t]}function nT(t){return $m(K(t.value))?ha(N({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Z1(t)}function Z1(t){const e=t.value,n=t.key;if("array"!==oi(e))return[new Sn(n,e,`array expected, ${oi(e)} found`)];const i=t.styleSpec;let s,c=[];if(e.length<1)return[new Sn(n,e,"filter array must have at least 1 element")];switch(c=c.concat(tu({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),be(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===be(e[1])&&c.push(new Sn(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&c.push(new Sn(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=oi(e[1]),"string"!==s&&c.push(new Sn(`${n}[1]`,e[1],`string expected, ${s} found`)));for(let d=2;d<e.length;d++)s=oi(e[d]),"$type"===be(e[1])?c=c.concat(tu({key:`${n}[${d}]`,value:e[d],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&c.push(new Sn(`${n}[${d}]`,e[d],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)c=c.concat(Z1({key:`${n}[${d}]`,value:e[d],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=oi(e[1]),2!==e.length?c.push(new Sn(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==s&&c.push(new Sn(`${n}[1]`,e[1],`string expected, ${s} found`))}return c}function wy(t,e){const n=t.key,i=t.style,s=t.layer,c=t.styleSpec,d=t.value,f=t.objectKey,_=c[`${e}_${t.layerType}`];if(!_)return[];const y=f.match(/^(.*)-transition$/);if("paint"===e&&y&&_[y[1]]&&_[y[1]].transition)return fa({key:n,value:d,valueSpec:c.transition,style:i,styleSpec:c});const v=t.valueSpec||_[f];if(!v)return[new Ji(n,d,`unknown property "${f}"`)];let w;if("string"===oi(d)&&ef(v)&&!v.tokens&&(w=/^{([^}]+)}$/.exec(d))){const C=`\`{ "type": "identity", "property": ${w?JSON.stringify(w[1]):'"_"'} }\``;return[new Sn(n,d,`"${f}" does not support interpolation syntax\nUse an identity property function instead: ${C}.`)]}const I=[];if("symbol"===t.layerType)"text-field"!==f||!i||i.glyphs||i.imports||I.push(new Sn(n,d,'use of "text-field" requires a style "glyphs" property')),"text-font"===f&&pp(K(d))&&"identity"===be(d.type)&&I.push(new Sn(n,d,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===e&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&ef(v)&&(fp(v)||Um(v))){const C=os(K(d),v),S=C.value.expression||C.value._styleExpression.expression;S&&!er(S,["measure-light"])&&I.push(new Sn(n,d,`${f} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return I.concat(fa({key:t.key,value:d,valueSpec:v,style:i,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:f}))}function Hm(t){return wy(t,"paint")}function rT(t){return wy(t,"layout")}function Wm(t){let e=[];const n=t.value,i=t.key,s=t.style,c=t.styleSpec;n.type||n.ref||e.push(new Sn(i,n,'either "type" or "ref" is required'));let d=be(n.type);const f=be(n.ref);if(n.id){const _=be(n.id);for(let y=0;y<t.arrayIndex;y++){const v=s.layers[y];be(v.id)===_&&e.push(new Sn(i,n.id,`duplicate layer id "${n.id}", previously used at line ${v.id.__line__}`))}}if("ref"in n){let _;["type","source","source-layer","filter","layout"].forEach(y=>{y in n&&e.push(new Sn(i,n[y],`"${y}" is prohibited for ref layers`))}),s.layers.forEach(y=>{be(y.id)===f&&(_=y)}),_?_.ref?e.push(new Sn(i,n.ref,"ref cannot reference another ref layer")):d=be(_.type):"string"==typeof f&&e.push(new Sn(i,n.ref,`ref layer "${f}" not found`))}else if("background"!==d&&"sky"!==d&&"slot"!==d)if(n.source){const _=s.sources&&s.sources[n.source],y=_&&be(_.type);_?"vector"===y&&"raster"===d?e.push(new Sn(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===y&&"raster"!==d?e.push(new Sn(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==y||n["source-layer"]?"raster-dem"===y&&"hillshade"!==d?e.push(new Sn(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==d||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===y&&_.lineMetrics||e.push(new Sn(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Sn(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Sn(i,n.source,`source "${n.source}" not found`))}else e.push(new Sn(i,n,'missing required property "source"'));return e=e.concat(da({key:i,value:n,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fa({key:`${i}.type`,value:n.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:_=>nT(N({layerType:d},_)),layout:_=>da({layer:n,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":y=>rT(N({layerType:d},y))}}),paint:_=>da({layer:n,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":y=>Hm(N({layerType:d,layer:n},y))}})}})),e}function ah(t){const e=t.value,n=t.key,i=oi(e);return"string"!==i?[new Sn(n,e,`string expected, ${i} found`)]:[]}const qm={promoteId:function({key:t,value:e}){if("string"===oi(e))return ah({key:t,value:e});{const n=[];for(const i in e)n.push(...ah({key:`${t}.${i}`,value:e[i]}));return n}}};function K1(t){const e=t.value,n=t.key,i=t.styleSpec,s=t.style;if(!e.type)return[new Sn(n,e,'"type" is required')];const c=be(e.type);let d;switch(c){case"vector":case"raster":case"raster-dem":return d=da({key:n,value:e,valueSpec:i[`source_${c.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:qm}),d;case"geojson":if(d=da({key:n,value:e,valueSpec:i.source_geojson,style:s,styleSpec:i,objectElementValidators:qm}),e.cluster)for(const f in e.clusterProperties){const[_,y]=e.clusterProperties[f],v="string"==typeof _?[_,["accumulated"],["get",f]]:_;d.push(...ha({key:`${n}.${f}.map`,value:y,expressionContext:"cluster-map"})),d.push(...ha({key:`${n}.${f}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return d;case"video":return da({key:n,value:e,valueSpec:i.source_video,style:s,styleSpec:i});case"image":return da({key:n,value:e,valueSpec:i.source_image,style:s,styleSpec:i});case"canvas":return[new Sn(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tu({key:`${n}.type`,value:e.type,valueSpec:{values:Ym(i)},style:s,styleSpec:i})}}function Ym(t){return t.source.reduce((e,n)=>{const i=t[n];return"enum"===i.type.type&&(e=e.concat(Object.keys(i.type.values))),e},[])}function Ey(t){const e=t.value;let n=[];if(!e)return n;const i=oi(e);return"string"!==i?(n=n.concat([new Sn(t.key,e,`string expected, "${i}" found`)]),n):(function(s){const c=-1===s.indexOf("://");try{return new URL(s,c?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new Sn(t.key,e,`invalid url "${e}"`)])),n)}function iT(t){const e=t.value,n=t.styleSpec,i=n.light,s=t.style;let c=[];const d=oi(e);if(void 0===e)return c;if("object"!==d)return c=c.concat([new Sn("light",e,`object expected, ${d} found`)]),c;for(const f in e){const _=f.match(/^(.*)-transition$/);c=c.concat(_&&i[_[1]]&&i[_[1]].transition?fa({key:f,value:e[f],valueSpec:n.transition,style:s,styleSpec:n}):i[f]?fa({key:f,value:e[f],valueSpec:i[f],style:s,styleSpec:n}):[new Sn(f,e[f],`unknown property "${f}"`)])}return c}function Ic(t){const e=t.value;let n=[];if(!e)return n;const i=oi(e);if("object"!==i)return n=n.concat([new Sn("light-3d",e,`object expected, ${i} found`)]),n;const s=t.styleSpec,c=s["light-3d"],d=t.key,f=t.style,_=t.style.lights;for(const w of["type","id"])if(!(w in e))return n=n.concat([new Sn("light-3d",e,`missing property ${w} on light`)]),n;if(e.type&&_)for(let w=0;w<t.arrayIndex;w++){const I=be(e.type),C=_[w];be(C.type)===I&&n.push(new Sn(d,e.id,`duplicate light type "${e.type}", previously defined at line ${C.id.__line__}`))}const y=`properties_light_${e.type}`;if(!(y in s))return n=n.concat([new Sn("light-3d",e,`Invalid light type ${e.type}`)]),n;const v=s[y];for(const w in e)if("properties"===w){const I=e[w],C=oi(I);if("object"!==C)return n=n.concat([new Sn("properties",I,`object expected, ${C} found`)]),n;for(const S in I)n=n.concat(v[S]?fa({key:S,value:I[S],valueSpec:v[S],style:f,styleSpec:s}):[new Ji(t.key,I[S],`unknown property "${S}"`)])}else{const I=w.match(/^(.*)-transition$/);n=n.concat(I&&c[I[1]]&&c[I[1]].transition?fa({key:w,value:e[w],valueSpec:s.transition,style:f,styleSpec:s}):c[w]?fa({key:w,value:e[w],valueSpec:c[w],style:f,styleSpec:s}):[new Ji(w,e[w],`unknown property "${w}"`)])}return n}function oT(t){const e=t.value,n=t.key,i=t.style,s=t.styleSpec,c=s.terrain;let d=[];const f=oi(e);if(void 0===e)return d;if("object"!==f)return d=d.concat([new Sn("terrain",e,`object expected, ${f} found`)]),d;for(const _ in e){const y=_.match(/^(.*)-transition$/);d=d.concat(y&&c[y[1]]&&c[y[1]].transition?fa({key:_,value:e[_],valueSpec:s.transition,style:i,styleSpec:s}):c[_]?fa({key:_,value:e[_],valueSpec:c[_],style:i,styleSpec:s}):[new Ji(_,e[_],`unknown property "${_}"`)])}if(e.source){const _=i.sources&&i.sources[e.source],y=_&&be(_.type);_?"raster-dem"!==y&&d.push(new Sn(n,e.source,`terrain cannot be used with a source of type ${String(y)}, it only be used with a "raster-dem" source type`)):d.push(new Sn(n,e.source,`source "${e.source}" not found`))}else d.push(new Sn(n,e,'terrain is missing required property "source"'));return d}function Iy(t){const e=t.value,n=t.style,i=t.styleSpec,s=i.fog;let c=[];const d=oi(e);if(void 0===e)return c;if("object"!==d)return c=c.concat([new Sn("fog",e,`object expected, ${d} found`)]),c;for(const f in e){const _=f.match(/^(.*)-transition$/);c=c.concat(_&&s[_[1]]&&s[_[1]].transition?fa({key:f,value:e[f],valueSpec:i.transition,style:n,styleSpec:i}):s[f]?fa({key:f,value:e[f],valueSpec:s[f],style:n,styleSpec:i}):[new Ji(f,e[f],`unknown property "${f}"`)])}return c}const K0={"*":()=>[],array:cd,boolean:function(t){const e=t.value,n=t.key,i=oi(e);return"boolean"!==i?[new Sn(n,e,`boolean expected, ${i} found`)]:[]},number:ud,color:function(t){const e=t.key,n=t.value,i=oi(n);return"string"!==i?[new Sn(e,n,`color expected, ${i} found`)]:null===eh(n)?[new Sn(e,n,`color expected, "${n}" found`)]:[]},enum:tu,filter:nT,function:eu,layer:Wm,object:da,source:K1,model:Ey,light:iT,"light-3d":Ic,terrain:oT,fog:Iy,string:ah,formatted:function(t){return 0===ah(t).length?[]:ha(t)},resolvedImage:function(t){return 0===ah(t).length?[]:ha(t)},projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,s=t.style;let c=[];const d=oi(e);if("object"===d)for(const f in e)c=c.concat(fa({key:f,value:e[f],valueSpec:i[f],style:s,styleSpec:n}));else"string"!==d&&(c=c.concat([new Sn("projection",e,`object or string expected, ${d} found`)]));return c},import:function(t){const{value:e,styleSpec:n}=t,{data:i,...s}=e;Object.defineProperty(s,"__line__",{value:e.__line__,enumerable:!1});let c=da(N({},t,{value:s,valueSpec:n.import}));return""===be(s.id)&&c.push(new Sn(`${t.key}.id`,s,"import id can't be an empty string")),i&&(c=c.concat(Ty(i,n,{key:`${t.key}.data`}))),c}};function fa(t,e=!1){const n=t.value,i=t.valueSpec,s=t.styleSpec;if(i.expression&&pp(be(n)))return eu(t);if(i.expression&&Bn(K(n)))return ha(t);if(i.type&&K0[i.type]){const c=K0[i.type](t);return!0===e&&c.length>0&&"array"===oi(t.value)?ha(t):c}return da(N({},t,{valueSpec:i.type?s[i.type]:i}))}function X0(t){const e=t.value,n=t.key,i=ah(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Sn(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Sn(n,e,'"glyphs" url must include a "{range}" token'))),i}function Ty(t,e=ut,n={}){return fa({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:X0,"*":()=>[]}})}function Zm(t,e=ut){return Ka(Ty(t,e))}const ZC=t=>Ka(K1(t)),X1=t=>Ka(iT(t)),Q0=t=>Ka(Ic(t)),sT=t=>Ka(oT(t)),Q1=t=>Ka(Iy(t)),J0=t=>Ka(Wm(t)),Au=t=>Ka(nT(t)),KC=t=>Ka(Hm(t)),ex=t=>Ka(rT(t)),aT=t=>Ka(Ey(t));function Ka(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function nu(t,e){let n=!1;if(e&&e.length)for(const i of e)i instanceof Ji?Me(i.message):(t.fire(new wn(new Error(i.message))),n=!0);return n}var pa=Tc,rf=3;function Tc(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(n=s[2]);for(var c=0;c<this.d*this.d;c++){var d=s[rf+c],f=s[rf+c+1];i.push(d===f?null:s.subarray(d,f))}var _=s[rf+i.length+1];this.keys=s.subarray(s[rf+i.length],_),this.bboxes=s.subarray(_),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var y=0;y<this.d*this.d;y++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var v=n/e*t;this.min=-v,this.max=t+v}Tc.prototype.insert=function(t,e,n,i,s){this._forEachCell(e,n,i,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(s)},Tc.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Tc.prototype._insertCell=function(t,e,n,i,s,c){this.cells[s].push(c)},Tc.prototype.query=function(t,e,n,i,s){var c=this.min,d=this.max;if(t<=c&&e<=c&&d<=n&&d<=i&&!s)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(t,e,n,i,this._queryCell,f,{},s),f},Tc.prototype._queryCell=function(t,e,n,i,s,c,d,f){var _=this.cells[s];if(null!==_)for(var y=this.keys,v=this.bboxes,w=0;w<_.length;w++){var I=_[w];if(void 0===d[I]){var C=4*I;(f?f(v[C+0],v[C+1],v[C+2],v[C+3]):t<=v[C+2]&&e<=v[C+3]&&n>=v[C+0]&&i>=v[C+1])?(d[I]=!0,c.push(y[I])):d[I]=!1}}},Tc.prototype._forEachCell=function(t,e,n,i,s,c,d,f){for(var _=this._convertToCellCoord(t),y=this._convertToCellCoord(e),v=this._convertToCellCoord(n),w=this._convertToCellCoord(i),I=_;I<=v;I++)for(var C=y;C<=w;C++){var S=this.d*C+I;if((!f||f(this._convertFromCellCoord(I),this._convertFromCellCoord(C),this._convertFromCellCoord(I+1),this._convertFromCellCoord(C+1)))&&s.call(this,t,e,n,i,S,c,d,f))return}},Tc.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Tc.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Tc.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=rf+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var s=new Int32Array(e+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var c=e,d=0;d<t.length;d++){var f=t[d];s[rf+d]=c,s.set(f,c),c+=f.length}return s[rf+t.length]=c,s.set(this.keys,c),s[rf+t.length+1]=c+=this.keys.length,s.set(this.bboxes,c),c+=this.bboxes.length,s.buffer};var sf=Jt(pa);const Km={};function lr(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Km[e]={klass:t,omit:n.omit||[]}}lr(Object,"Object"),sf.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},sf.deserialize=function(t){return new sf(t.buffer)},Object.defineProperty(sf,"name",{value:"Grid"}),lr(sf,"Grid"),lr(Ur,"Color"),lr(Error,"Error"),lr(an,"AJAXError"),lr(ea,"ResolvedImage"),lr(mo,"StylePropertyFunction"),lr(jt,"StyleExpression",{omit:["_evaluator"]}),lr(_r,"ZoomDependentExpression"),lr(ar,"ZoomConstantExpression"),lr(Qn,"CompoundExpression",{omit:["_evaluate"]});for(const t in Kl)Km[Kl[t]._classRegistryKey]||lr(Kl[t],`Expression${t}`);function Xm(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function gp(t){return ge.ImageBitmap&&t instanceof ge.ImageBitmap}function Ac(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Xm(t)||gp(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ge.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(Ac(i,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[i,s]of t.entries())n[i]=Ac(s);return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const s=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const c in t)t.hasOwnProperty(c)&&(Km[i].omit.indexOf(c)>=0||(s[c]=Ac(t[c],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(s.$name=i),s}throw new Error("can't serialize object of type "+typeof t)}function Cu(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Xm(t)||gp(t)||ArrayBuffer.isView(t)||t instanceof ge.ImageData)return t;if(Array.isArray(t))return t.map(Cu);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const s=new Map;for(const c of Object.keys(t))"$name"!==c&&s.set(c,Cu(t[c]));return s}const{klass:n}=Km[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const s of Object.keys(t))"$name"!==s&&(i[s]=Cu(t[s]));return i}throw new Error("can't deserialize object of type "+typeof t)}const pr={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ay(t){for(const e of t)if(Su(e.charCodeAt(0)))return!0;return!1}function af(t){for(const e of t)if(!lT(e.charCodeAt(0)))return!1;return!0}function lT(t){return!(pr.Arabic(t)||pr["Arabic Supplement"](t)||pr["Arabic Extended-A"](t)||pr["Arabic Presentation Forms-A"](t)||pr["Arabic Presentation Forms-B"](t))}function Su(t){return!(746!==t&&747!==t&&(t<4352||!(pr["Bopomofo Extended"](t)||pr.Bopomofo(t)||pr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||pr["CJK Compatibility Ideographs"](t)||pr["CJK Compatibility"](t)||pr["CJK Radicals Supplement"](t)||pr["CJK Strokes"](t)||!(!pr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||pr["CJK Unified Ideographs Extension A"](t)||pr["CJK Unified Ideographs"](t)||pr["Enclosed CJK Letters and Months"](t)||pr["Hangul Compatibility Jamo"](t)||pr["Hangul Jamo Extended-A"](t)||pr["Hangul Jamo Extended-B"](t)||pr["Hangul Jamo"](t)||pr["Hangul Syllables"](t)||pr.Hiragana(t)||pr["Ideographic Description Characters"](t)||pr.Kanbun(t)||pr["Kangxi Radicals"](t)||pr["Katakana Phonetic Extensions"](t)||pr.Katakana(t)&&12540!==t||!(!pr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!pr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||pr["Unified Canadian Aboriginal Syllabics"](t)||pr["Unified Canadian Aboriginal Syllabics Extended"](t)||pr["Vertical Forms"](t)||pr["Yijing Hexagram Symbols"](t)||pr["Yi Syllables"](t)||pr["Yi Radicals"](t))))}function J1(t){return!(Su(t)||(e=t,pr["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||pr["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||pr["Letterlike Symbols"](e)||pr["Number Forms"](e)||pr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||pr["Control Pictures"](e)&&9251!==e||pr["Optical Character Recognition"](e)||pr["Enclosed Alphanumerics"](e)||pr["Geometric Shapes"](e)||pr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||pr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pr["CJK Symbols and Punctuation"](e)||pr.Katakana(e)||pr["Private Use Area"](e)||pr["CJK Compatibility Forms"](e)||pr["Small Form Variants"](e)||pr["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function XC(t){return t>=1424&&t<=2303||pr["Arabic Presentation Forms-A"](t)||pr["Arabic Presentation Forms-B"](t)}function tx(t,e){return!(!e&&XC(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||pr.Khmer(t))}function MD(t){for(const e of t)if(XC(e.charCodeAt(0)))return!0;return!1}const nx="deferred",cT="loading",dd="loaded";let ew=null,Nl="unavailable",Es=null;const uT=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Nl="error"),ew&&ew(t)};function lh(){_p.fire(new kt("pluginStateChange",{pluginStatus:Nl,pluginURL:Es}))}const _p=new Kn,Fl=function(){return Nl},yp=function(){if(Nl!==nx||!Es)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Nl=cT,lh(),Es&&xn({url:Es},t=>{t?uT(t):(Nl=dd,lh())})},Bl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Nl===dd||null!=Bl.applyArabicShaping,isLoading:()=>Nl===cT,setState(t){Nl=t.pluginStatus,Es=t.pluginURL},isParsed:()=>null!=Bl.applyArabicShaping&&null!=Bl.processBidirectionalText&&null!=Bl.processStyledBidirectionalText,getPluginURL:()=>Es};class Vo{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(const s of n)if(!tx(s.charCodeAt(0),i))return!1;return!0}(e,Bl.isLoaded())}}class ch{constructor(e,n,i){this.property=e,this.value=n,this.expression=function(s,c,d){if(pp(s))return new mo(s,c);if(Bn(s)||Array.isArray(s)&&s.length>0){const f=os(s,c,d);if("error"===f.result)throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===c.type&&(f=Ur.parse(s)),{kind:"constant",isConfigDependent:!1,evaluate:()=>f}}}(void 0===n?e.specification.default:n,e.specification,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class Du{constructor(e,n){this.property=e,this.value=new ch(e,void 0,n)}transitioned(e,n){return new Qm(this.property,this.value,n,Ye({},e.transition,this.transition),e.now)}untransitioned(){return new Qm(this.property,this.value,null,{},0)}}class rx{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return ue(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Du(this._values[e].property,this._options)),this._values[e].value=new ch(this._values[e].property,null===n?void 0:ue(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const i=this._properties.properties;if(e)for(const s in e){const c=e[s];if(ei(s,"-transition")){const d=s.slice(0,-11);i[d]&&this.setTransition(d,c)}else i[s]&&this.setValue(s,c)}}getTransition(e){return ue(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Du(this._values[e].property)),this._values[e].transition=ue(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i);const s=this.getTransition(n);void 0!==s&&(e[`${n}-transition`]=s)}return e}transitioned(e,n){const i=new RD(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].transitioned(e,n._values[s]);return i}untransitioned(){const e=new RD(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Qm{constructor(e,n,i,s,c){const d=s.delay||0,f=s.duration||0;c=c||0,this.property=e,this.value=n,this.begin=c+d,this.end=this.begin+f,e.specification.transition&&(s.delay||s.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){const s=e.now||0,c=this.value.possiblyEvaluate(e,n,i),d=this.prior;if(d){if(s>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(s<this.begin)return d.possiblyEvaluate(e,n,i);{const f=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,n,i),c,Gt(f))}}return c}}class RD{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){const s=new hd(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,n,i);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ru{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return ue(this._values[e].value)}setValue(e,n){this._values[e]=new ch(this._values[e].property,null===n?void 0:ue(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){const s=new hd(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,n,i);return s}}class vp{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,i,s){return this.property.evaluate(this.value,this.parameters,e,n,i,s)}}class hd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class On{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){const s=kl[this.specification.type];return s?s(e,n,i):e}}class Ir{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,s){return new vp(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},i,s)}:e.expression,n)}interpolate(e,n,i){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new vp(this,{kind:"constant",value:void 0},e.parameters);const s=kl[this.specification.type];return s?new vp(this,{kind:"constant",value:s(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,s,c,d){return"constant"===e.kind?e.value:e.evaluate(n,i,s,c,d)}}class xp{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,s){return!!e.expression.evaluate(n,null,{},i,s)}interpolate(){return!1}}class gs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Vo(0,{});for(const i in e){const s=e[i];s.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new ch(s,void 0),d=this.defaultTransitionablePropertyValues[i]=new Du(s);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate(n)}}}function Xa(t,e){return e?`${t}\x1f${e}`:t}function Cy(t){const e=t.indexOf("\x1f");return e>=0?t.slice(0,e):t}lr(Ir,"DataDrivenProperty"),lr(On,"DataConstantProperty"),lr(xp,"ColorRampProperty");const Cc="-transition";class uc extends Kn{constructor(e,n,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=i,e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new ru(n.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new rx(n.paint,i);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hd(n.paint)}}setScope(e){this.scope=e,this.fqid=Xa(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,i={}){if(null!=n&&this._validate(ex,`layers.${this.id}.layout.${e}`,e,n,i))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=n);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ei(e,Cc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,i={}){if(null!=n&&this._validate(KC,`layers.${this.id}.paint.${e}`,e,n,i))return!1;const s=this._transitionablePaint,c=s._properties.properties;if(ei(e,Cc)){const I=e.slice(0,-11);return c[I]&&s.setTransition(I,n||void 0),!1}if(!c[e])return!1;const d=s._values[e],f=d.value.isDataDriven(),_=d.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const y=s._values[e].value,v=y.isDataDriven(),w=ei(e,"pattern")||"line-dasharray"===e;return v||f||w||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return qe({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(void 0===e||"layout"===n&&!Object.keys(e).length||"paint"===n&&!Object.keys(e).length))}_validate(e,n,i,s,c={}){return(!c||!1!==c.validate)&&nu(this,e.call(Zm,{key:n,layerType:this.type,objectKey:i,value:s,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof vp&&ef(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=jm(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class dT{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const n=e.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(e.id)}removeLayer(e){const n=e.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][e.id]=e,this._updatedLayers[n].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const n in this._updatedLayers)e[n]=e[n]||{},e[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)e[n]=e[n]||{},e[n].removedIds=Object.keys(this._removedLayers[n]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const Jm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bp{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class To{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gi(t,e=1){let n=0,i=0;return{members:t.map(s=>{const c=Jm[s.type].BYTES_PER_ELEMENT,d=n=ix(n,Math.max(e,c)),f=s.components||1;return i=Math.max(i,c),n+=c*f,{name:s.name,type:s.type,components:f,offset:d}}),size:ix(n,Math.max(i,e)),alignment:e}}function ix(t,e){return Math.ceil(t/e)*e}class Vl extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const s=2*e;return this.int16[s+0]=n,this.int16[s+1]=i,e}}Vl.prototype.bytesPerElement=4,lr(Vl,"StructArrayLayout2i4");class wp extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){const c=3*e;return this.int16[c+0]=n,this.int16[c+1]=i,this.int16[c+2]=s,e}}wp.prototype.bytesPerElement=6,lr(wp,"StructArrayLayout3i6");class Mu extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s)}emplace(e,n,i,s,c){const d=4*e;return this.int16[d+0]=n,this.int16[d+1]=i,this.int16[d+2]=s,this.int16[d+3]=c,e}}Mu.prototype.bytesPerElement=8,lr(Mu,"StructArrayLayout4i8");class uh extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,s,c)}emplace(e,n,i,s,c,d){const f=5*e;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=s,this.int16[f+3]=c,this.int16[f+4]=d,e}}uh.prototype.bytesPerElement=10,lr(uh,"StructArrayLayout5i10");class eg extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,i,s,c,d,f)}emplace(e,n,i,s,c,d,f,_){const y=6*e,v=12*e,w=3*e;return this.int16[y+0]=n,this.int16[y+1]=i,this.uint8[v+4]=s,this.uint8[v+5]=c,this.uint8[v+6]=d,this.uint8[v+7]=f,this.float32[w+2]=_,e}}eg.prototype.bytesPerElement=12,lr(eg,"StructArrayLayout2i4ub1f12");class dh extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s)}emplace(e,n,i,s,c){const d=4*e;return this.float32[d+0]=n,this.float32[d+1]=i,this.float32[d+2]=s,this.float32[d+3]=c,e}}dh.prototype.bytesPerElement=16,lr(dh,"StructArrayLayout4f16");class fd extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,s,c)}emplace(e,n,i,s,c,d){const f=6*e,_=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=i,this.uint16[f+2]=s,this.uint16[f+3]=c,this.float32[_+2]=d,e}}fd.prototype.bytesPerElement=12,lr(fd,"StructArrayLayout4ui1f12");class pd extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s)}emplace(e,n,i,s,c){const d=4*e;return this.uint16[d+0]=n,this.uint16[d+1]=i,this.uint16[d+2]=s,this.uint16[d+3]=c,e}}pd.prototype.bytesPerElement=8,lr(pd,"StructArrayLayout4ui8");class md extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,s,c,d)}emplace(e,n,i,s,c,d,f){const _=6*e;return this.int16[_+0]=n,this.int16[_+1]=i,this.int16[_+2]=s,this.int16[_+3]=c,this.int16[_+4]=d,this.int16[_+5]=f,e}}md.prototype.bytesPerElement=12,lr(md,"StructArrayLayout6i12");class Sy extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f,_,y,v,w,I){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,i,s,c,d,f,_,y,v,w,I)}emplace(e,n,i,s,c,d,f,_,y,v,w,I,C){const S=12*e;return this.int16[S+0]=n,this.int16[S+1]=i,this.int16[S+2]=s,this.int16[S+3]=c,this.uint16[S+4]=d,this.uint16[S+5]=f,this.uint16[S+6]=_,this.uint16[S+7]=y,this.int16[S+8]=v,this.int16[S+9]=w,this.int16[S+10]=I,this.int16[S+11]=C,e}}Sy.prototype.bytesPerElement=24,lr(Sy,"StructArrayLayout4i4ui4i24");class ox extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,s,c,d)}emplace(e,n,i,s,c,d,f){const _=10*e,y=5*e;return this.int16[_+0]=n,this.int16[_+1]=i,this.int16[_+2]=s,this.float32[y+2]=c,this.float32[y+3]=d,this.float32[y+4]=f,e}}ox.prototype.bytesPerElement=20,lr(ox,"StructArrayLayout3i3f20");class sx extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}sx.prototype.bytesPerElement=4,lr(sx,"StructArrayLayout1ul4");class gd extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const s=2*e;return this.uint16[s+0]=n,this.uint16[s+1]=i,e}}gd.prototype.bytesPerElement=4,lr(gd,"StructArrayLayout2ui4");class hT extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f,_,y,v,w,I,C){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,i,s,c,d,f,_,y,v,w,I,C)}emplace(e,n,i,s,c,d,f,_,y,v,w,I,C,S){const M=20*e,P=10*e;return this.int16[M+0]=n,this.int16[M+1]=i,this.int16[M+2]=s,this.int16[M+3]=c,this.int16[M+4]=d,this.float32[P+3]=f,this.float32[P+4]=_,this.float32[P+5]=y,this.float32[P+6]=v,this.int16[M+14]=w,this.uint32[P+8]=I,this.uint16[M+18]=C,this.uint16[M+19]=S,e}}hT.prototype.bytesPerElement=40,lr(hT,"StructArrayLayout5i4f1i1ul2ui40");class tg extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,i,s,c,d,f)}emplace(e,n,i,s,c,d,f,_){const y=8*e;return this.int16[y+0]=n,this.int16[y+1]=i,this.int16[y+2]=s,this.int16[y+4]=c,this.int16[y+5]=d,this.int16[y+6]=f,this.int16[y+7]=_,e}}tg.prototype.bytesPerElement=16,lr(tg,"StructArrayLayout3i2i2i16");class tw extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,s,c)}emplace(e,n,i,s,c,d){const f=4*e,_=8*e;return this.float32[f+0]=n,this.float32[f+1]=i,this.float32[f+2]=s,this.int16[_+6]=c,this.int16[_+7]=d,e}}tw.prototype.bytesPerElement=16,lr(tw,"StructArrayLayout2f1f2i16");class Dy extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s)}emplace(e,n,i,s,c){const d=12*e,f=3*e;return this.uint8[d+0]=n,this.uint8[d+1]=i,this.float32[f+1]=s,this.float32[f+2]=c,e}}Dy.prototype.bytesPerElement=12,lr(Dy,"StructArrayLayout2ub2f12");class Sc extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){const c=3*e;return this.float32[c+0]=n,this.float32[c+1]=i,this.float32[c+2]=s,e}}Sc.prototype.bytesPerElement=12,lr(Sc,"StructArrayLayout3f12");class Is extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,n,i)}emplace(e,n,i,s){const c=3*e;return this.uint16[c+0]=n,this.uint16[c+1]=i,this.uint16[c+2]=s,e}}Is.prototype.bytesPerElement=6,lr(Is,"StructArrayLayout3ui6");class Ep extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j){const W=this.length;return this.resize(W+1),this.emplace(W,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j)}emplace(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j,W){const oe=30*e,pe=15*e,ve=60*e;return this.int16[oe+0]=n,this.int16[oe+1]=i,this.int16[oe+2]=s,this.float32[pe+2]=c,this.float32[pe+3]=d,this.uint16[oe+8]=f,this.uint16[oe+9]=_,this.uint32[pe+5]=y,this.uint32[pe+6]=v,this.uint32[pe+7]=w,this.uint16[oe+16]=I,this.uint16[oe+17]=C,this.uint16[oe+18]=S,this.float32[pe+10]=M,this.float32[pe+11]=P,this.uint8[ve+48]=R,this.uint8[ve+49]=z,this.uint8[ve+50]=G,this.uint32[pe+13]=H,this.int16[oe+28]=j,this.uint8[ve+58]=W,e}}Ep.prototype.bytesPerElement=60,lr(Ep,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class lf extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j,W,oe,pe,ve,xe,ke,Ae,$e,Ce,nt,ft){const It=this.length;return this.resize(It+1),this.emplace(It,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j,W,oe,pe,ve,xe,ke,Ae,$e,Ce,nt,ft)}emplace(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j,W,oe,pe,ve,xe,ke,Ae,$e,Ce,nt,ft,It){const et=20*e,it=40*e,St=80*e;return this.float32[et+0]=n,this.float32[et+1]=i,this.int16[it+4]=s,this.int16[it+5]=c,this.int16[it+6]=d,this.int16[it+7]=f,this.int16[it+8]=_,this.int16[it+9]=y,this.int16[it+10]=v,this.int16[it+11]=w,this.int16[it+12]=I,this.uint16[it+13]=C,this.uint16[it+14]=S,this.uint16[it+15]=M,this.uint16[it+16]=P,this.uint16[it+17]=R,this.uint16[it+18]=z,this.uint16[it+19]=G,this.uint16[it+20]=H,this.uint16[it+21]=j,this.uint16[it+22]=W,this.uint16[it+23]=oe,this.uint16[it+24]=pe,this.uint16[it+25]=ve,this.uint16[it+26]=xe,this.uint16[it+27]=ke,this.uint32[et+14]=Ae,this.float32[et+15]=$e,this.float32[et+16]=Ce,this.float32[et+17]=nt,this.float32[et+18]=ft,this.uint8[St+76]=It,e}}lf.prototype.bytesPerElement=80,lr(lf,"StructArrayLayout2f9i15ui1ul4f1ub80");class hh extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}hh.prototype.bytesPerElement=4,lr(hh,"StructArrayLayout1f4");class _d extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,s,c)}emplace(e,n,i,s,c,d){const f=5*e;return this.float32[f+0]=n,this.float32[f+1]=i,this.float32[f+2]=s,this.float32[f+3]=c,this.float32[f+4]=d,e}}_d.prototype.bytesPerElement=20,lr(_d,"StructArrayLayout5f20");class ng extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,i,s,c,d,f)}emplace(e,n,i,s,c,d,f,_){const y=7*e;return this.float32[y+0]=n,this.float32[y+1]=i,this.float32[y+2]=s,this.float32[y+3]=c,this.float32[y+4]=d,this.float32[y+5]=f,this.float32[y+6]=_,e}}ng.prototype.bytesPerElement=28,lr(ng,"StructArrayLayout7f28");class rg extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,i,s)}emplace(e,n,i,s,c){const d=6*e;return this.uint32[3*e+0]=n,this.uint16[d+2]=i,this.uint16[d+3]=s,this.uint16[d+4]=c,e}}rg.prototype.bytesPerElement=12,lr(rg,"StructArrayLayout1ul3ui12");class Ip extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ip.prototype.bytesPerElement=2,lr(Ip,"StructArrayLayout1ui2");class ig extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const s=2*e;return this.float32[s+0]=n,this.float32[s+1]=i,e}}ig.prototype.bytesPerElement=8,lr(ig,"StructArrayLayout2f8");class ax extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P)}emplace(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R){const z=16*e;return this.float32[z+0]=n,this.float32[z+1]=i,this.float32[z+2]=s,this.float32[z+3]=c,this.float32[z+4]=d,this.float32[z+5]=f,this.float32[z+6]=_,this.float32[z+7]=y,this.float32[z+8]=v,this.float32[z+9]=w,this.float32[z+10]=I,this.float32[z+11]=C,this.float32[z+12]=S,this.float32[z+13]=M,this.float32[z+14]=P,this.float32[z+15]=R,e}}ax.prototype.bytesPerElement=64,lr(ax,"StructArrayLayout16f64");class og extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,s,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,i,s,c,d,f)}emplace(e,n,i,s,c,d,f,_){const y=10*e,v=5*e;return this.uint16[y+0]=n,this.uint16[y+1]=i,this.uint16[y+2]=s,this.uint16[y+3]=c,this.float32[v+2]=d,this.float32[v+3]=f,this.float32[v+4]=_,e}}og.prototype.bytesPerElement=20,lr(og,"StructArrayLayout4ui3f20");class lx extends To{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}lx.prototype.bytesPerElement=1,lr(lx,"StructArrayLayout1ub1");class My extends bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}My.prototype.size=40;class cx extends hT{get(e){return new My(this,e)}}lr(cx,"CollisionBoxArray");class yd extends bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}yd.prototype.size=60;class QC extends Ep{get(e){return new yd(this,e)}}lr(QC,"PlacedSymbolArray");class sg extends bp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}sg.prototype.size=80;class ux extends lf{get(e){return new sg(this,e)}}lr(ux,"SymbolInstanceArray");class dx extends hh{getoffsetX(e){return this.float32[1*e+0]}}lr(dx,"GlyphOffsetArray");class nw extends Vl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}lr(nw,"SymbolLineVertexArray");class hx extends bp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hx.prototype.size=12;class Dc extends rg{get(e){return new hx(this,e)}}lr(Dc,"FeatureIndexArray");class ag extends gd{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}lr(ag,"FillExtrusionCentroidArray");const fT=Gi([{name:"a_pos",components:2,type:"Int16"}],4),rw=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class so{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,s){let c=this.segments[this.segments.length-1];return e>so.MAX_VERTEX_ARRAY_LENGTH&&Me(`Max vertices per segment is ${so.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>so.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==s)&&(c={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==s&&(c.sortKey=s),this.segments.push(c)),c}prepareSegment(e,n,i,s){return this._prepareSegment(e,n.length,i.length,s)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,s){return new so([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:s,vaos:{},sortKey:0}])}}function Ry(t,e){return 256*(t=_n(Math.floor(t),0,255))+_n(Math.floor(e),0,255)}so.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lr(so,"SegmentVector");const Py=Gi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),iw=Gi([{name:"a_dash",components:4,type:"Uint16"}]);var ow={exports:{}},pT={exports:function(e,n){var i,s,c,d,f,_,y,v;for(s=e.length-(i=3&e.length),c=n,f=3432918353,_=461845907,v=0;v<s;)y=255&e.charCodeAt(v)|(255&e.charCodeAt(++v))<<8|(255&e.charCodeAt(++v))<<16|(255&e.charCodeAt(++v))<<24,++v,c=27492+(65535&(d=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,i){case 3:y^=(255&e.charCodeAt(v+2))<<16;case 2:y^=(255&e.charCodeAt(v+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&e.charCodeAt(v)))*f+(((y>>>16)*f&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}.exports,px={exports:{}};px.exports=function(e,n){for(var i,s=e.length,c=n^s,d=0;s>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var mx=pT,gx=px.exports;ow.exports=mx,ow.exports.murmur3=mx,ow.exports.murmur2=gx;var mT=Jt(ow.exports);class Tp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,s){this.ids.push(gT(e)),this.positions.push(n,i,s)}eachPosition(e,n){const i=gT(e);let s=0,c=this.ids.length-1;for(;s<c;){const d=s+c>>1;this.ids[d]>=i?c=d:s=d+1}for(;this.ids[s]===i;)n(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,n){const i=new Float64Array(e.ids),s=new Uint32Array(e.positions);return _T(i,s,0,i.length-1),n&&(n.add(i.buffer),n.add(s.buffer)),{ids:i,positions:s}}static deserialize(e){const n=new Tp;let i;n.ids=e.ids,n.positions=e.positions;for(const s of n.ids)s!==i&&n.uniqueIds.push(s),i=s;return n.indexed=!0,n}}function gT(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:mT(String(t))}function _T(t,e,n,i){for(;n<i;){const s=t[n+i>>1];let c=n-1,d=i+1;for(;;){do{c++}while(t[c]<s);do{d--}while(t[d]>s);if(c>=d)break;lg(t,c,d),lg(e,3*c,3*d),lg(e,3*c+1,3*d+1),lg(e,3*c+2,3*d+2)}d-n<i-d?(_T(t,e,n,d),n=d+1):(_T(t,e,d+1,i),i=d)}}function lg(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}lr(Tp,"FeaturePositionMap");class Ru{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class gi extends Ru{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class kn extends Ru{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ti extends Ru{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class ni extends Ru{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Os extends Ru{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class cf extends Ru{constructor(e){super(e),this.current=Ur.transparent}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const uf=new Float32Array(16);class Xr extends Ru{constructor(e){super(e),this.current=uf}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const JC=new Float32Array(9);class Oy extends Ru{constructor(e){super(e),this.current=JC}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}const PD=new Float32Array(4);class ky extends Ru{constructor(e){super(e),this.current=PD}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Ly(t){return[Ry(255*t.r,255*t.g),Ry(255*t.b,255*t.a)]}class Ny{constructor(e,n,i){this.value=e,this.uniformNames=n.map(s=>`u_${s}`),this.type=i}setUniform(e,n,i,s,c){n.set(e,c,s.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new cf(e):new kn(e)}}class iu{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,s,c){const d="u_pattern"===c||"u_dash"===c?this.pattern:"u_pixel_ratio"===c?this.pixelRatio:null;d&&n.set(e,c,d)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new Os(e):new kn(e)}}class fh{constructor(e,n,i,s){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,n,i,s,c,d,f){const _=this.paintVertexArray.length,y=this.expression.evaluate(new Vo(0,{brightness:d}),n,{},c,s,f);this.paintVertexArray.resize(e),this._setPaintValue(_,e,y)}updatePaintArray(e,n,i,s,c,d,f){const _=this.expression.evaluate({zoom:0,brightness:f},i,s,void 0,c);this._setPaintValue(e,n,_)}_setPaintValue(e,n,i){if("color"===this.type){const s=Ly(i);for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,s[0],s[1])}else{for(let s=e;s<n;s++)this.paintVertexArray.emplace(s,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vd{constructor(e,n,i,s,c,d){this.expression=e,this.uniformNames=n.map(f=>`u_${f}_t`),this.type=i,this.useIntegerZoom=s,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,n,i,s,c,d,f){const _=this.expression.evaluate(new Vo(this.zoom,{brightness:d}),n,{},c,s,f),y=this.expression.evaluate(new Vo(this.zoom+1,{brightness:d}),n,{},c,s,f),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,_,y)}updatePaintArray(e,n,i,s,c,d,f){const _=this.expression.evaluate({zoom:this.zoom,brightness:f},i,s,void 0,c),y=this.expression.evaluate({zoom:this.zoom+1,brightness:f},i,s,void 0,c);this._setPaintValue(e,n,_,y)}_setPaintValue(e,n,i,s){if("color"===this.type){const c=Ly(i),d=Ly(s);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c[0],c[1],d[0],d[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,i,s);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,s,c){const d=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,f=_n(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);n.set(e,c,f)}getBinding(e,n){return new kn(e)}}class df{constructor(e,n,i,s,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=("array"===i?iw:Py).members;for(let d=0;d<n.length;++d);this.paintVertexArray=new s}populatePaintArray(e,n,i){const s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(s,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,s,c,d,f){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],d)}_setPaintValues(e,n,i,s){if(!s||!i)return;const c=s[i];if(!c)return;const{tl:d,br:f,pixelRatio:_}=c;for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,d[0],d[1],f[0],f[1],_)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hf{constructor(e,n,i=(()=>!0)){this.binders={},this._buffers=[];const s=[];for(const c in e.paint._values){const d=e.paint.get(c);if(!i(c)||!(d instanceof vp&&ef(d.property.specification)))continue;const f=Ap(c,e.type),_=d.value,y=d.property.specification.type,v=!!d.property.useIntegerZoom,w="line-dasharray"===c||c.endsWith("pattern"),I="line-dasharray"===c&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==_.kind||I)if("source"===_.kind||I||w){const C=vT(c,y,"source");this.binders[c]=w?new df(_,f,y,C,e.id):new fh(_,f,y,C),s.push(`/a_${c}`)}else{const C=vT(c,y,"composite");this.binders[c]=new vd(_,f,y,v,n,C),s.push(`/z_${c}`)}else this.binders[c]=w?new iu(_.value,f):new Ny(_.value,f,y),s.push(`/u_${c}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof fh||n instanceof vd?n.maxValue:0}populatePaintArrays(e,n,i,s,c,d,f){for(const _ in this.binders){const y=this.binders[_];(y instanceof fh||y instanceof vd||y instanceof df)&&y.populatePaintArray(e,n,i,s,c,d,f)}}setConstantPatternPositions(e){for(const n in this.binders){const i=this.binders[n];i instanceof iu&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,s,c,d,f,_){let y=!1;const v=Object.keys(e),w=0!==v.length,I=w?v:n.uniqueIds;for(const C in this.binders){const S=this.binders[C];if((S instanceof fh||S instanceof vd||S instanceof df)&&(!0===S.expression.isStateDependent||!1===S.expression.isLightConstant)){const M=c.paint.get(C);S.expression=M.value;for(const P of I){const R=e[P.toString()];n.eachPosition(P,(z,G,H)=>{const j=s.feature(z);S.updatePaintArray(G,H,j,R,d,f,_)})}if(!w)for(const P of i.uniqueIds){const R=e[P.toString()];i.eachPosition(P,(z,G,H)=>{const j=s.feature(z);S.updatePaintArray(G,H,j,R,d,f,_)})}y=!0}}return y}defines(){const e=[];for(const n in this.binders){const i=this.binders[n];(i instanceof Ny||i instanceof iu)&&e.push(...i.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof fh||i instanceof vd||i instanceof df)for(let s=0;s<i.paintVertexAttributes.length;s++)e.push(i.paintVertexAttributes[s].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Ny||i instanceof iu||i instanceof vd)for(const s of i.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ny||s instanceof iu||s instanceof vd)for(const c of s.uniformNames)n.push({name:c,property:i,binding:s.getBinding(e,c)})}return n}setUniforms(e,n,i,s,c){for(const{name:d,property:f,binding:_}of i)this.binders[f].setUniform(e,_,c,s.get(f),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof fh||n instanceof vd||n instanceof df)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const i=this.binders[n];(i instanceof fh||i instanceof vd||i instanceof df)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof fh||n instanceof vd||n instanceof df)&&n.destroy()}}}class cg{constructor(e,n,i=(()=>!0)){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new hf(s,n,i);this.needsUpload=!1,this._featureMap=new Tp,this._featureMapWithoutIds=new Tp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,s,c,d,f,_){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,n,s,c,d,f,_);void 0!==n.id?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,s,c,d){for(const f of i)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,f,s,c,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const yT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ap(t,e){return yT[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const sw={"line-pattern":{source:fd,composite:fd},"fill-pattern":{source:fd,composite:fd},"fill-extrusion-pattern":{source:fd,composite:fd},"line-dasharray":{source:pd,composite:pd}},OD={color:{source:ig,composite:dh},number:{source:hh,composite:ig}};function vT(t,e,n){const i=sw[t];return i&&i[n]||OD[e][n]}lr(Ny,"ConstantBinder"),lr(iu,"PatternConstantBinder"),lr(fh,"SourceExpressionBinder"),lr(df,"PatternCompositeBinder"),lr(vd,"CompositeExpressionBinder"),lr(hf,"ProgramConfiguration",{omit:["_buffers"]}),lr(cg,"ProgramConfigurationSet");class Mc{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof kr?new kr(e.lng,e.lat):kr.convert(e),this}setSouthWest(e){return this._sw=e instanceof kr?new kr(e.lng,e.lat):kr.convert(e),this}extend(e){const n=this._sw,i=this._ne;let s,c;if(e instanceof kr)s=e,c=e;else{if(!(e instanceof Mc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Mc.convert(e)):this.extend(kr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(kr.convert(e)):this;if(s=e._sw,c=e._ne,!s||!c)return this}return n||i?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),i.lng=Math.max(c.lng,i.lng),i.lat=Math.max(c.lat,i.lat)):(this._sw=new kr(s.lng,s.lat),this._ne=new kr(c.lng,c.lat)),this}getCenter(){return new kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kr(this.getWest(),this.getNorth())}getSouthEast(){return new kr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:i}=kr.convert(e);let s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&s}static convert(e){return!e||e instanceof Mc?e:new Mc(e)}}var ma={},Ts={};Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.setMatrixArrayType=function(t){Ts.ARRAY_TYPE=Pu=t},Ts.toRadian=function(t){return t*eS},Ts.equals=function(t,e){return Math.abs(t-e)<=dc*Math.max(1,Math.abs(t),Math.abs(e))},Ts.RANDOM=Ts.ARRAY_TYPE=Ts.EPSILON=void 0;var dc=1e-6;Ts.EPSILON=dc;var Pu=typeof Float32Array<"u"?Float32Array:Array;Ts.ARRAY_TYPE=Pu;var Fy=Math.random;Ts.RANDOM=Fy;var eS=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ao={};function ug(t){return(ug="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(ao,"__esModule",{value:!0}),ao.create=function(){var t=new dg.ARRAY_TYPE(4);return dg.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},ao.clone=function(t){var e=new dg.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ao.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ao.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},ao.fromValues=function(t,e,n,i){var s=new dg.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},ao.set=function(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t},ao.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},ao.invert=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n*c-s*i;return d?(t[0]=c*(d=1/d),t[1]=-i*d,t[2]=-s*d,t[3]=n*d,t):null},ao.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},ao.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},ao.multiply=xT,ao.rotate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=Math.sin(n),_=Math.cos(n);return t[0]=i*_+c*f,t[1]=s*_+d*f,t[2]=i*-f+c*_,t[3]=s*-f+d*_,t},ao.scale=function(t,e,n){var i=e[1],s=e[2],c=e[3],d=n[0],f=n[1];return t[0]=e[0]*d,t[1]=i*d,t[2]=s*f,t[3]=c*f,t},ao.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},ao.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},ao.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ao.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},ao.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},ao.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},ao.subtract=tS,ao.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ao.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=e[0],f=e[1],_=e[2],y=e[3];return Math.abs(n-d)<=dg.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-f)<=dg.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-_)<=dg.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-y)<=dg.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},ao.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ao.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},ao.sub=ao.mul=void 0;var dg=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==ug(t)&&"function"!=typeof t)return{default:t};var n=_x(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function _x(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(_x=function(i){return i?n:e})(t)}function xT(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=n[0],_=n[1],y=n[2],v=n[3];return t[0]=i*f+c*_,t[1]=s*f+d*_,t[2]=i*y+c*v,t[3]=s*y+d*v,t}function tS(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}ao.mul=xT,ao.sub=tS;var Zo={};function nS(t){return(nS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Zo,"__esModule",{value:!0}),Zo.create=function(){var t=new ou.ARRAY_TYPE(6);return ou.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Zo.clone=function(t){var e=new ou.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Zo.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Zo.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Zo.fromValues=function(t,e,n,i,s,c){var d=new ou.ARRAY_TYPE(6);return d[0]=t,d[1]=e,d[2]=n,d[3]=i,d[4]=s,d[5]=c,d},Zo.set=function(t,e,n,i,s,c,d){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=c,t[5]=d,t},Zo.invert=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=n*c-i*s;return _?(t[0]=c*(_=1/_),t[1]=-i*_,t[2]=-s*_,t[3]=n*_,t[4]=(s*f-c*d)*_,t[5]=(i*d-n*f)*_,t):null},Zo.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Zo.multiply=rS,Zo.rotate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=Math.sin(n),v=Math.cos(n);return t[0]=i*v+c*y,t[1]=s*v+d*y,t[2]=i*-y+c*v,t[3]=s*-y+d*v,t[4]=f,t[5]=_,t},Zo.scale=function(t,e,n){var i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=n[0],y=n[1];return t[0]=e[0]*_,t[1]=i*_,t[2]=s*y,t[3]=c*y,t[4]=d,t[5]=f,t},Zo.translate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=n[0],v=n[1];return t[0]=i,t[1]=s,t[2]=c,t[3]=d,t[4]=i*y+c*v+f,t[5]=s*y+d*v+_,t},Zo.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},Zo.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Zo.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Zo.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Zo.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Zo.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Zo.subtract=yx,Zo.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Zo.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},Zo.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Zo.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=t[4],f=t[5],_=e[0],y=e[1],v=e[2],w=e[3],I=e[4],C=e[5];return Math.abs(n-_)<=ou.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-y)<=ou.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(s-v)<=ou.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-w)<=ou.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(d-I)<=ou.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-C)<=ou.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))},Zo.sub=Zo.mul=void 0;var ou=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==nS(t)&&"function"!=typeof t)return{default:t};var n=kD(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function kD(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(kD=function(i){return i?n:e})(t)}function rS(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=n[0],v=n[1],w=n[2],I=n[3],C=n[4],S=n[5];return t[0]=i*y+c*v,t[1]=s*y+d*v,t[2]=i*w+c*I,t[3]=s*w+d*I,t[4]=i*C+c*S+f,t[5]=s*C+d*S+_,t}function yx(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Zo.mul=rS,Zo.sub=yx;var lo={};function ga(t){return(ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(lo,"__esModule",{value:!0}),lo.create=function(){var t=new su.ARRAY_TYPE(9);return su.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},lo.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},lo.clone=function(t){var e=new su.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},lo.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},lo.fromValues=function(t,e,n,i,s,c,d,f,_){var y=new su.ARRAY_TYPE(9);return y[0]=t,y[1]=e,y[2]=n,y[3]=i,y[4]=s,y[5]=c,y[6]=d,y[7]=f,y[8]=_,y},lo.set=function(t,e,n,i,s,c,d,f,_,y){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=c,t[5]=d,t[6]=f,t[7]=_,t[8]=y,t},lo.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lo.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},lo.invert=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=e[6],y=e[7],v=e[8],w=v*d-f*y,I=-v*c+f*_,C=y*c-d*_,S=n*w+i*I+s*C;return S?(t[0]=w*(S=1/S),t[1]=(-v*i+s*y)*S,t[2]=(f*i-s*d)*S,t[3]=I*S,t[4]=(v*n-s*_)*S,t[5]=(-f*n+s*c)*S,t[6]=C*S,t[7]=(-y*n+i*_)*S,t[8]=(d*n-i*c)*S,t):null},lo.adjoint=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=e[6],y=e[7],v=e[8];return t[0]=d*v-f*y,t[1]=s*y-i*v,t[2]=i*f-s*d,t[3]=f*_-c*v,t[4]=n*v-s*_,t[5]=s*c-n*f,t[6]=c*y-d*_,t[7]=i*_-n*y,t[8]=n*d-i*c,t},lo.determinant=function(t){var e=t[3],n=t[4],i=t[5],s=t[6],c=t[7],d=t[8];return t[0]*(d*n-i*c)+t[1]*(-d*e+i*s)+t[2]*(c*e-n*s)},lo.multiply=LD,lo.translate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=e[8],I=n[0],C=n[1];return t[0]=i,t[1]=s,t[2]=c,t[3]=d,t[4]=f,t[5]=_,t[6]=I*i+C*d+y,t[7]=I*s+C*f+v,t[8]=I*c+C*_+w,t},lo.rotate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=e[8],I=Math.sin(n),C=Math.cos(n);return t[0]=C*i+I*d,t[1]=C*s+I*f,t[2]=C*c+I*_,t[3]=C*d-I*i,t[4]=C*f-I*s,t[5]=C*_-I*c,t[6]=y,t[7]=v,t[8]=w,t},lo.scale=function(t,e,n){var i=n[0],s=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},lo.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},lo.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lo.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},lo.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},lo.fromQuat=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n+n,f=i+i,_=s+s,y=n*d,v=i*d,w=i*f,I=s*d,C=s*f,S=s*_,M=c*d,P=c*f,R=c*_;return t[0]=1-w-S,t[3]=v-R,t[6]=I+P,t[1]=v+R,t[4]=1-y-S,t[7]=C-M,t[2]=I-P,t[5]=C+M,t[8]=1-y-w,t},lo.normalFromMat4=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=e[6],y=e[7],v=e[8],w=e[9],I=e[10],C=e[11],S=e[12],M=e[13],P=e[14],R=e[15],z=n*f-i*d,G=n*_-s*d,H=n*y-c*d,j=i*_-s*f,W=i*y-c*f,oe=s*y-c*_,pe=v*M-w*S,ve=v*P-I*S,xe=v*R-C*S,ke=w*P-I*M,Ae=w*R-C*M,$e=I*R-C*P,Ce=z*$e-G*Ae+H*ke+j*xe-W*ve+oe*pe;return Ce?(t[0]=(f*$e-_*Ae+y*ke)*(Ce=1/Ce),t[1]=(_*xe-d*$e-y*ve)*Ce,t[2]=(d*Ae-f*xe+y*pe)*Ce,t[3]=(s*Ae-i*$e-c*ke)*Ce,t[4]=(n*$e-s*xe+c*ve)*Ce,t[5]=(i*xe-n*Ae-c*pe)*Ce,t[6]=(M*oe-P*W+R*j)*Ce,t[7]=(P*H-S*oe-R*G)*Ce,t[8]=(S*W-M*H+R*z)*Ce,t):null},lo.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},lo.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},lo.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},lo.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},lo.subtract=aw,lo.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},lo.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},lo.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},lo.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=t[4],f=t[5],_=t[6],y=t[7],v=t[8],w=e[0],I=e[1],C=e[2],S=e[3],M=e[4],P=e[5],R=e[6],z=e[7],G=e[8];return Math.abs(n-w)<=su.EPSILON*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(i-I)<=su.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(s-C)<=su.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-S)<=su.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-M)<=su.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(f-P)<=su.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(_-R)<=su.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(y-z)<=su.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(v-G)<=su.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))},lo.sub=lo.mul=void 0;var su=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==ga(t)&&"function"!=typeof t)return{default:t};var n=By(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function By(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(By=function(i){return i?n:e})(t)}function LD(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=e[8],I=n[0],C=n[1],S=n[2],M=n[3],P=n[4],R=n[5],z=n[6],G=n[7],H=n[8];return t[0]=I*i+C*d+S*y,t[1]=I*s+C*f+S*v,t[2]=I*c+C*_+S*w,t[3]=M*i+P*d+R*y,t[4]=M*s+P*f+R*v,t[5]=M*c+P*_+R*w,t[6]=z*i+G*d+H*y,t[7]=z*s+G*f+H*v,t[8]=z*c+G*_+H*w,t}function aw(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}lo.mul=LD,lo.sub=aw;var fi={};function iS(t){return(iS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(fi,"__esModule",{value:!0}),fi.create=function(){var t=new _s.ARRAY_TYPE(16);return _s.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},fi.clone=function(t){var e=new _s.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fi.fromValues=function(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M){var P=new _s.ARRAY_TYPE(16);return P[0]=t,P[1]=e,P[2]=n,P[3]=i,P[4]=s,P[5]=c,P[6]=d,P[7]=f,P[8]=_,P[9]=y,P[10]=v,P[11]=w,P[12]=I,P[13]=C,P[14]=S,P[15]=M,P},fi.set=function(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=c,t[5]=d,t[6]=f,t[7]=_,t[8]=y,t[9]=v,t[10]=w,t[11]=I,t[12]=C,t[13]=S,t[14]=M,t[15]=P,t},fi.identity=ff,fi.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],c=e[6],d=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=s,t[13]=d,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},fi.invert=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=e[6],y=e[7],v=e[8],w=e[9],I=e[10],C=e[11],S=e[12],M=e[13],P=e[14],R=e[15],z=n*f-i*d,G=n*_-s*d,H=n*y-c*d,j=i*_-s*f,W=i*y-c*f,oe=s*y-c*_,pe=v*M-w*S,ve=v*P-I*S,xe=v*R-C*S,ke=w*P-I*M,Ae=w*R-C*M,$e=I*R-C*P,Ce=z*$e-G*Ae+H*ke+j*xe-W*ve+oe*pe;return Ce?(t[0]=(f*$e-_*Ae+y*ke)*(Ce=1/Ce),t[1]=(s*Ae-i*$e-c*ke)*Ce,t[2]=(M*oe-P*W+R*j)*Ce,t[3]=(I*W-w*oe-C*j)*Ce,t[4]=(_*xe-d*$e-y*ve)*Ce,t[5]=(n*$e-s*xe+c*ve)*Ce,t[6]=(P*H-S*oe-R*G)*Ce,t[7]=(v*oe-I*H+C*G)*Ce,t[8]=(d*Ae-f*xe+y*pe)*Ce,t[9]=(i*xe-n*Ae-c*pe)*Ce,t[10]=(S*W-M*H+R*z)*Ce,t[11]=(w*H-v*W-C*z)*Ce,t[12]=(f*ve-d*ke-_*pe)*Ce,t[13]=(n*ke-i*ve+s*pe)*Ce,t[14]=(M*G-S*j-P*z)*Ce,t[15]=(v*j-w*G+I*z)*Ce,t):null},fi.adjoint=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=e[4],f=e[5],_=e[6],y=e[7],v=e[8],w=e[9],I=e[10],C=e[11],S=e[12],M=e[13],P=e[14],R=e[15];return t[0]=f*(I*R-C*P)-w*(_*R-y*P)+M*(_*C-y*I),t[1]=-(i*(I*R-C*P)-w*(s*R-c*P)+M*(s*C-c*I)),t[2]=i*(_*R-y*P)-f*(s*R-c*P)+M*(s*y-c*_),t[3]=-(i*(_*C-y*I)-f*(s*C-c*I)+w*(s*y-c*_)),t[4]=-(d*(I*R-C*P)-v*(_*R-y*P)+S*(_*C-y*I)),t[5]=n*(I*R-C*P)-v*(s*R-c*P)+S*(s*C-c*I),t[6]=-(n*(_*R-y*P)-d*(s*R-c*P)+S*(s*y-c*_)),t[7]=n*(_*C-y*I)-d*(s*C-c*I)+v*(s*y-c*_),t[8]=d*(w*R-C*M)-v*(f*R-y*M)+S*(f*C-y*w),t[9]=-(n*(w*R-C*M)-v*(i*R-c*M)+S*(i*C-c*w)),t[10]=n*(f*R-y*M)-d*(i*R-c*M)+S*(i*y-c*f),t[11]=-(n*(f*C-y*w)-d*(i*C-c*w)+v*(i*y-c*f)),t[12]=-(d*(w*P-I*M)-v*(f*P-_*M)+S*(f*I-_*w)),t[13]=n*(w*P-I*M)-v*(i*P-s*M)+S*(i*I-s*w),t[14]=-(n*(f*P-_*M)-d*(i*P-s*M)+S*(i*_-s*f)),t[15]=n*(f*I-_*w)-d*(i*I-s*w)+v*(i*_-s*f),t},fi.determinant=function(t){var e=t[0],n=t[1],i=t[2],s=t[3],c=t[4],d=t[5],f=t[6],_=t[7],y=t[8],v=t[9],w=t[10],I=t[11],C=t[12],S=t[13],M=t[14],P=t[15];return(e*d-n*c)*(w*P-I*M)-(e*f-i*c)*(v*P-I*S)+(e*_-s*c)*(v*M-w*S)+(n*f-i*d)*(y*P-I*C)-(n*_-s*d)*(y*M-w*C)+(i*_-s*f)*(y*S-v*C)},fi.multiply=hg,fi.translate=function(t,e,n){var i,s,c,d,f,_,y,v,w,I,C,S,M=n[0],P=n[1],R=n[2];return e===t?(t[12]=e[0]*M+e[4]*P+e[8]*R+e[12],t[13]=e[1]*M+e[5]*P+e[9]*R+e[13],t[14]=e[2]*M+e[6]*P+e[10]*R+e[14],t[15]=e[3]*M+e[7]*P+e[11]*R+e[15]):(s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=e[8],I=e[9],C=e[10],S=e[11],t[0]=i=e[0],t[1]=s,t[2]=c,t[3]=d,t[4]=f,t[5]=_,t[6]=y,t[7]=v,t[8]=w,t[9]=I,t[10]=C,t[11]=S,t[12]=i*M+f*P+w*R+e[12],t[13]=s*M+_*P+I*R+e[13],t[14]=c*M+y*P+C*R+e[14],t[15]=d*M+v*P+S*R+e[15]),t},fi.scale=function(t,e,n){var i=n[0],s=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fi.rotate=function(t,e,n,i){var s,c,d,f,_,y,v,w,I,C,S,M,P,R,z,G,H,j,W,oe,pe,ve,xe,ke,Ae=i[0],$e=i[1],Ce=i[2],nt=Math.hypot(Ae,$e,Ce);return nt<_s.EPSILON?null:(Ae*=nt=1/nt,$e*=nt,Ce*=nt,s=Math.sin(n),c=Math.cos(n),_=e[1],y=e[2],v=e[3],I=e[5],C=e[6],S=e[7],P=e[9],R=e[10],z=e[11],W=Ae*$e*(d=1-c)-Ce*s,oe=$e*$e*d+c,pe=Ce*$e*d+Ae*s,ve=Ae*Ce*d+$e*s,xe=$e*Ce*d-Ae*s,ke=Ce*Ce*d+c,t[0]=(f=e[0])*(G=Ae*Ae*d+c)+(w=e[4])*(H=$e*Ae*d+Ce*s)+(M=e[8])*(j=Ce*Ae*d-$e*s),t[1]=_*G+I*H+P*j,t[2]=y*G+C*H+R*j,t[3]=v*G+S*H+z*j,t[4]=f*W+w*oe+M*pe,t[5]=_*W+I*oe+P*pe,t[6]=y*W+C*oe+R*pe,t[7]=v*W+S*oe+z*pe,t[8]=f*ve+w*xe+M*ke,t[9]=_*ve+I*xe+P*ke,t[10]=y*ve+C*xe+R*ke,t[11]=v*ve+S*xe+z*ke,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},fi.rotateX=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[4],d=e[5],f=e[6],_=e[7],y=e[8],v=e[9],w=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+y*i,t[5]=d*s+v*i,t[6]=f*s+w*i,t[7]=_*s+I*i,t[8]=y*s-c*i,t[9]=v*s-d*i,t[10]=w*s-f*i,t[11]=I*s-_*i,t},fi.rotateY=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],f=e[2],_=e[3],y=e[8],v=e[9],w=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-y*i,t[1]=d*s-v*i,t[2]=f*s-w*i,t[3]=_*s-I*i,t[8]=c*i+y*s,t[9]=d*i+v*s,t[10]=f*i+w*s,t[11]=_*i+I*s,t},fi.rotateZ=function(t,e,n){var i=Math.sin(n),s=Math.cos(n),c=e[0],d=e[1],f=e[2],_=e[3],y=e[4],v=e[5],w=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+y*i,t[1]=d*s+v*i,t[2]=f*s+w*i,t[3]=_*s+I*i,t[4]=y*s-c*i,t[5]=v*s-d*i,t[6]=w*s-f*i,t[7]=I*s-_*i,t},fi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fi.fromRotation=function(t,e,n){var i,s,c,d=n[0],f=n[1],_=n[2],y=Math.hypot(d,f,_);return y<_s.EPSILON?null:(d*=y=1/y,f*=y,_*=y,i=Math.sin(e),s=Math.cos(e),t[0]=d*d*(c=1-s)+s,t[1]=f*d*c+_*i,t[2]=_*d*c-f*i,t[3]=0,t[4]=d*f*c-_*i,t[5]=f*f*c+s,t[6]=_*f*c+d*i,t[7]=0,t[8]=d*_*c+f*i,t[9]=f*_*c-d*i,t[10]=_*_*c+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fi.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fi.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fi.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fi.fromRotationTranslation=Cp,fi.fromQuat2=function(t,e){var n=new _s.ARRAY_TYPE(3),i=-e[0],s=-e[1],c=-e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=i*i+s*s+c*c+d*d;return w>0?(n[0]=2*(f*d+v*i+_*c-y*s)/w,n[1]=2*(_*d+v*s+y*i-f*c)/w,n[2]=2*(y*d+v*c+f*s-_*i)/w):(n[0]=2*(f*d+v*i+_*c-y*s),n[1]=2*(_*d+v*s+y*i-f*c),n[2]=2*(y*d+v*c+f*s-_*i)),Cp(t,e,n),t},fi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},fi.getScaling=Vy,fi.getRotation=function(t,e){var n=new _s.ARRAY_TYPE(3);Vy(n,e);var i=1/n[0],s=1/n[1],c=1/n[2],d=e[0]*i,f=e[1]*s,_=e[2]*c,y=e[4]*i,v=e[5]*s,w=e[6]*c,I=e[8]*i,C=e[9]*s,S=e[10]*c,M=d+v+S,P=0;return M>0?(P=2*Math.sqrt(M+1),t[3]=.25*P,t[0]=(w-C)/P,t[1]=(I-_)/P,t[2]=(f-y)/P):d>v&&d>S?(P=2*Math.sqrt(1+d-v-S),t[3]=(w-C)/P,t[0]=.25*P,t[1]=(f+y)/P,t[2]=(I+_)/P):v>S?(P=2*Math.sqrt(1+v-d-S),t[3]=(I-_)/P,t[0]=(f+y)/P,t[1]=.25*P,t[2]=(w+C)/P):(P=2*Math.sqrt(1+S-d-v),t[3]=(f-y)/P,t[0]=(I+_)/P,t[1]=(w+C)/P,t[2]=.25*P),t},fi.fromRotationTranslationScale=function(t,e,n,i){var s=e[0],c=e[1],d=e[2],f=e[3],_=s+s,y=c+c,v=d+d,w=s*_,I=s*y,C=s*v,S=c*y,M=c*v,P=d*v,R=f*_,z=f*y,G=f*v,H=i[0],j=i[1],W=i[2];return t[0]=(1-(S+P))*H,t[1]=(I+G)*H,t[2]=(C-z)*H,t[3]=0,t[4]=(I-G)*j,t[5]=(1-(w+P))*j,t[6]=(M+R)*j,t[7]=0,t[8]=(C+z)*W,t[9]=(M-R)*W,t[10]=(1-(w+S))*W,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fi.fromRotationTranslationScaleOrigin=function(t,e,n,i,s){var c=e[0],d=e[1],f=e[2],_=e[3],y=c+c,v=d+d,w=f+f,I=c*y,C=c*v,S=c*w,M=d*v,P=d*w,R=f*w,z=_*y,G=_*v,H=_*w,j=i[0],W=i[1],oe=i[2],pe=s[0],ve=s[1],xe=s[2],ke=(1-(M+R))*j,Ae=(C+H)*j,$e=(S-G)*j,Ce=(C-H)*W,nt=(1-(I+R))*W,ft=(P+z)*W,It=(S+G)*oe,et=(P-z)*oe,it=(1-(I+M))*oe;return t[0]=ke,t[1]=Ae,t[2]=$e,t[3]=0,t[4]=Ce,t[5]=nt,t[6]=ft,t[7]=0,t[8]=It,t[9]=et,t[10]=it,t[11]=0,t[12]=n[0]+pe-(ke*pe+Ce*ve+It*xe),t[13]=n[1]+ve-(Ae*pe+nt*ve+et*xe),t[14]=n[2]+xe-($e*pe+ft*ve+it*xe),t[15]=1,t},fi.fromQuat=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n+n,f=i+i,_=s+s,y=n*d,v=i*d,w=i*f,I=s*d,C=s*f,S=s*_,M=c*d,P=c*f,R=c*_;return t[0]=1-w-S,t[1]=v+R,t[2]=I-P,t[3]=0,t[4]=v-R,t[5]=1-y-S,t[6]=C+M,t[7]=0,t[8]=I+P,t[9]=C-M,t[10]=1-y-w,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fi.frustum=function(t,e,n,i,s,c,d){var f=1/(n-e),_=1/(s-i),y=1/(c-d);return t[0]=2*c*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*c*_,t[6]=0,t[7]=0,t[8]=(n+e)*f,t[9]=(s+i)*_,t[10]=(d+c)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*y,t[15]=0,t},fi.perspectiveNO=lw,fi.perspectiveZO=function(t,e,n,i,s){var c,d=1/Math.tan(e/2);return t[0]=d/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=s*(c=1/(i-s)),t[14]=s*i*c):(t[10]=-1,t[14]=-i),t},fi.perspectiveFromFieldOfView=function(t,e,n,i){var s=Math.tan(e.upDegrees*Math.PI/180),c=Math.tan(e.downDegrees*Math.PI/180),d=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),_=2/(d+f),y=2/(s+c);return t[0]=_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=-(d-f)*_*.5,t[9]=(s-c)*y*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},fi.orthoNO=fg,fi.orthoZO=function(t,e,n,i,s,c,d){var f=1/(e-n),_=1/(i-s),y=1/(c-d);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=y,t[11]=0,t[12]=(e+n)*f,t[13]=(s+i)*_,t[14]=c*y,t[15]=1,t},fi.lookAt=function(t,e,n,i){var s,c,d,f,_,y,v,w,I,C,S=e[0],M=e[1],P=e[2],R=i[0],z=i[1],G=i[2],H=n[0],j=n[1],W=n[2];return Math.abs(S-H)<_s.EPSILON&&Math.abs(M-j)<_s.EPSILON&&Math.abs(P-W)<_s.EPSILON?ff(t):(v=S-H,w=M-j,I=P-W,s=z*(I*=C=1/Math.hypot(v,w,I))-G*(w*=C),c=G*(v*=C)-R*I,d=R*w-z*v,(C=Math.hypot(s,c,d))?(s*=C=1/C,c*=C,d*=C):(s=0,c=0,d=0),f=w*d-I*c,_=I*s-v*d,y=v*c-w*s,(C=Math.hypot(f,_,y))?(f*=C=1/C,_*=C,y*=C):(f=0,_=0,y=0),t[0]=s,t[1]=f,t[2]=v,t[3]=0,t[4]=c,t[5]=_,t[6]=w,t[7]=0,t[8]=d,t[9]=y,t[10]=I,t[11]=0,t[12]=-(s*S+c*M+d*P),t[13]=-(f*S+_*M+y*P),t[14]=-(v*S+w*M+I*P),t[15]=1,t)},fi.targetTo=function(t,e,n,i){var s=e[0],c=e[1],d=e[2],f=i[0],_=i[1],y=i[2],v=s-n[0],w=c-n[1],I=d-n[2],C=v*v+w*w+I*I;C>0&&(v*=C=1/Math.sqrt(C),w*=C,I*=C);var S=_*I-y*w,M=y*v-f*I,P=f*w-_*v;return(C=S*S+M*M+P*P)>0&&(S*=C=1/Math.sqrt(C),M*=C,P*=C),t[0]=S,t[1]=M,t[2]=P,t[3]=0,t[4]=w*P-I*M,t[5]=I*S-v*P,t[6]=v*M-w*S,t[7]=0,t[8]=v,t[9]=w,t[10]=I,t[11]=0,t[12]=s,t[13]=c,t[14]=d,t[15]=1,t},fi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},fi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},fi.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},fi.subtract=oS,fi.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},fi.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},fi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},fi.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=t[4],f=t[5],_=t[6],y=t[7],v=t[8],w=t[9],I=t[10],C=t[11],S=t[12],M=t[13],P=t[14],R=t[15],z=e[0],G=e[1],H=e[2],j=e[3],W=e[4],oe=e[5],pe=e[6],ve=e[7],xe=e[8],ke=e[9],Ae=e[10],$e=e[11],Ce=e[12],nt=e[13],ft=e[14],It=e[15];return Math.abs(n-z)<=_s.EPSILON*Math.max(1,Math.abs(n),Math.abs(z))&&Math.abs(i-G)<=_s.EPSILON*Math.max(1,Math.abs(i),Math.abs(G))&&Math.abs(s-H)<=_s.EPSILON*Math.max(1,Math.abs(s),Math.abs(H))&&Math.abs(c-j)<=_s.EPSILON*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(d-W)<=_s.EPSILON*Math.max(1,Math.abs(d),Math.abs(W))&&Math.abs(f-oe)<=_s.EPSILON*Math.max(1,Math.abs(f),Math.abs(oe))&&Math.abs(_-pe)<=_s.EPSILON*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(y-ve)<=_s.EPSILON*Math.max(1,Math.abs(y),Math.abs(ve))&&Math.abs(v-xe)<=_s.EPSILON*Math.max(1,Math.abs(v),Math.abs(xe))&&Math.abs(w-ke)<=_s.EPSILON*Math.max(1,Math.abs(w),Math.abs(ke))&&Math.abs(I-Ae)<=_s.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ae))&&Math.abs(C-$e)<=_s.EPSILON*Math.max(1,Math.abs(C),Math.abs($e))&&Math.abs(S-Ce)<=_s.EPSILON*Math.max(1,Math.abs(S),Math.abs(Ce))&&Math.abs(M-nt)<=_s.EPSILON*Math.max(1,Math.abs(M),Math.abs(nt))&&Math.abs(P-ft)<=_s.EPSILON*Math.max(1,Math.abs(P),Math.abs(ft))&&Math.abs(R-It)<=_s.EPSILON*Math.max(1,Math.abs(R),Math.abs(It))},fi.sub=fi.mul=fi.ortho=fi.perspective=void 0;var _s=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==iS(t)&&"function"!=typeof t)return{default:t};var n=bT(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function bT(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(bT=function(i){return i?n:e})(t)}function ff(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hg(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=e[8],I=e[9],C=e[10],S=e[11],M=e[12],P=e[13],R=e[14],z=e[15],G=n[0],H=n[1],j=n[2],W=n[3];return t[0]=G*i+H*f+j*w+W*M,t[1]=G*s+H*_+j*I+W*P,t[2]=G*c+H*y+j*C+W*R,t[3]=G*d+H*v+j*S+W*z,t[4]=(G=n[4])*i+(H=n[5])*f+(j=n[6])*w+(W=n[7])*M,t[5]=G*s+H*_+j*I+W*P,t[6]=G*c+H*y+j*C+W*R,t[7]=G*d+H*v+j*S+W*z,t[8]=(G=n[8])*i+(H=n[9])*f+(j=n[10])*w+(W=n[11])*M,t[9]=G*s+H*_+j*I+W*P,t[10]=G*c+H*y+j*C+W*R,t[11]=G*d+H*v+j*S+W*z,t[12]=(G=n[12])*i+(H=n[13])*f+(j=n[14])*w+(W=n[15])*M,t[13]=G*s+H*_+j*I+W*P,t[14]=G*c+H*y+j*C+W*R,t[15]=G*d+H*v+j*S+W*z,t}function Cp(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=i+i,_=s+s,y=c+c,v=i*f,w=i*_,I=i*y,C=s*_,S=s*y,M=c*y,P=d*f,R=d*_,z=d*y;return t[0]=1-(C+M),t[1]=w+z,t[2]=I-R,t[3]=0,t[4]=w-z,t[5]=1-(v+M),t[6]=S+P,t[7]=0,t[8]=I+R,t[9]=S-P,t[10]=1-(v+C),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Vy(t,e){var n=e[4],i=e[5],s=e[6],c=e[8],d=e[9],f=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,s),t[2]=Math.hypot(c,d,f),t}function lw(t,e,n,i,s){var c,d=1/Math.tan(e/2);return t[0]=d/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=(s+i)*(c=1/(i-s)),t[14]=2*s*i*c):(t[10]=-1,t[14]=-2*i),t}function fg(t,e,n,i,s,c,d){var f=1/(e-n),_=1/(i-s),y=1/(c-d);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+n)*f,t[13]=(s+i)*_,t[14]=(d+c)*y,t[15]=1,t}function oS(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}fi.perspective=lw,fi.ortho=fg,fi.mul=hg,fi.sub=oS;var Wr={},si={};function pf(t){return(pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(si,"__esModule",{value:!0}),si.create=sS,si.clone=function(t){var e=new Ou.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},si.length=aS,si.fromValues=function(t,e,n){var i=new Ou.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},si.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},si.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},si.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},si.subtract=wT,si.multiply=cw,si.divide=xx,si.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},si.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},si.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},si.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},si.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},si.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},si.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},si.distance=ET,si.squaredDistance=IT,si.squaredLength=TT,si.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},si.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},si.normalize=function(t,e){var n=e[0],i=e[1],s=e[2],c=n*n+i*i+s*s;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},si.dot=pg,si.cross=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[0],f=n[1],_=n[2];return t[0]=s*_-c*f,t[1]=c*d-i*_,t[2]=i*f-s*d,t},si.lerp=function(t,e,n,i){var s=e[0],c=e[1],d=e[2];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t[2]=d+i*(n[2]-d),t},si.hermite=function(t,e,n,i,s,c){var d=c*c,f=d*(2*c-3)+1,_=d*(c-2)+c,y=d*(c-1),v=d*(3-2*c);return t[0]=e[0]*f+n[0]*_+i[0]*y+s[0]*v,t[1]=e[1]*f+n[1]*_+i[1]*y+s[1]*v,t[2]=e[2]*f+n[2]*_+i[2]*y+s[2]*v,t},si.bezier=function(t,e,n,i,s,c){var d=1-c,f=d*d,_=c*c,y=f*d,v=3*c*f,w=3*_*d,I=_*c;return t[0]=e[0]*y+n[0]*v+i[0]*w+s[0]*I,t[1]=e[1]*y+n[1]*v+i[1]*w+s[1]*I,t[2]=e[2]*y+n[2]*v+i[2]*w+s[2]*I,t},si.random=function(t,e){e=e||1;var n=2*Ou.RANDOM()*Math.PI,i=2*Ou.RANDOM()-1,s=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=i*e,t},si.transformMat4=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[3]*i+n[7]*s+n[11]*c+n[15];return t[0]=(n[0]*i+n[4]*s+n[8]*c+n[12])/(d=d||1),t[1]=(n[1]*i+n[5]*s+n[9]*c+n[13])/d,t[2]=(n[2]*i+n[6]*s+n[10]*c+n[14])/d,t},si.transformMat3=function(t,e,n){var i=e[0],s=e[1],c=e[2];return t[0]=i*n[0]+s*n[3]+c*n[6],t[1]=i*n[1]+s*n[4]+c*n[7],t[2]=i*n[2]+s*n[5]+c*n[8],t},si.transformQuat=function(t,e,n){var i=n[0],s=n[1],c=n[2],d=e[0],f=e[1],_=e[2],y=s*_-c*f,v=c*d-i*_,w=i*f-s*d,I=s*w-c*v,C=c*y-i*w,S=i*v-s*y,M=2*n[3];return v*=M,w*=M,C*=2,S*=2,t[0]=d+(y*=M)+(I*=2),t[1]=f+v+C,t[2]=_+w+S,t},si.rotateX=function(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0],c[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),c[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},si.rotateY=function(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),c[1]=s[1],c[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},si.rotateZ=function(t,e,n,i){var s=[],c=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],c[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),c[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),c[2]=s[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},si.angle=function(t,e){var n=t[0],i=t[1],s=t[2],c=e[0],d=e[1],f=e[2],_=Math.sqrt(n*n+i*i+s*s)*Math.sqrt(c*c+d*d+f*f),y=_&&pg(t,e)/_;return Math.acos(Math.min(Math.max(y,-1),1))},si.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},si.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},si.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},si.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=e[0],d=e[1],f=e[2];return Math.abs(n-c)<=Ou.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-d)<=Ou.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-f)<=Ou.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},si.forEach=si.sqrLen=si.len=si.sqrDist=si.dist=si.div=si.mul=si.sub=void 0;var Ou=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==pf(t)&&"function"!=typeof t)return{default:t};var n=vx(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function vx(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(vx=function(i){return i?n:e})(t)}function sS(){var t=new Ou.ARRAY_TYPE(3);return Ou.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function aS(t){return Math.hypot(t[0],t[1],t[2])}function wT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cw(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function xx(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function ET(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function IT(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function TT(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function pg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}si.sub=wT,si.mul=cw,si.div=xx,si.dist=ET,si.sqrDist=IT,si.len=aS,si.sqrLen=TT;var ph,lS=(ph=sS(),function(t,e,n,i,s,c){var d,f;for(e||(e=3),n||(n=0),f=i?Math.min(i*e+n,t.length):t.length,d=n;d<f;d+=e)ph[0]=t[d],ph[1]=t[d+1],ph[2]=t[d+2],s(ph,ph,c),t[d]=ph[0],t[d+1]=ph[1],t[d+2]=ph[2];return t});si.forEach=lS;var jr={};function Sp(t){return(Sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(jr,"__esModule",{value:!0}),jr.create=pl,jr.clone=function(t){var e=new Rc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},jr.fromValues=function(t,e,n,i){var s=new Rc.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},jr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},jr.set=function(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t},jr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},jr.subtract=mg,jr.multiply=uw,jr.divide=wx,jr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},jr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},jr.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},jr.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},jr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},jr.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},jr.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},jr.distance=AT,jr.squaredDistance=CT,jr.length=ST,jr.squaredLength=zy,jr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},jr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},jr.normalize=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n*n+i*i+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=n*d,t[1]=i*d,t[2]=s*d,t[3]=c*d,t},jr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},jr.cross=function(t,e,n,i){var s=n[0]*i[1]-n[1]*i[0],c=n[0]*i[2]-n[2]*i[0],d=n[0]*i[3]-n[3]*i[0],f=n[1]*i[2]-n[2]*i[1],_=n[1]*i[3]-n[3]*i[1],y=n[2]*i[3]-n[3]*i[2],v=e[0],w=e[1],I=e[2],C=e[3];return t[0]=w*y-I*_+C*f,t[1]=-v*y+I*d-C*c,t[2]=v*_-w*d+C*s,t[3]=-v*f+w*c-I*s,t},jr.lerp=function(t,e,n,i){var s=e[0],c=e[1],d=e[2],f=e[3];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t[2]=d+i*(n[2]-d),t[3]=f+i*(n[3]-f),t},jr.random=function(t,e){var n,i,s,c,d,f;e=e||1;do{d=(n=2*Rc.RANDOM()-1)*n+(i=2*Rc.RANDOM()-1)*i}while(d>=1);do{f=(s=2*Rc.RANDOM()-1)*s+(c=2*Rc.RANDOM()-1)*c}while(f>=1);var _=Math.sqrt((1-d)/f);return t[0]=e*n,t[1]=e*i,t[2]=e*s*_,t[3]=e*c*_,t},jr.transformMat4=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*c+n[12]*d,t[1]=n[1]*i+n[5]*s+n[9]*c+n[13]*d,t[2]=n[2]*i+n[6]*s+n[10]*c+n[14]*d,t[3]=n[3]*i+n[7]*s+n[11]*c+n[15]*d,t},jr.transformQuat=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=n[0],f=n[1],_=n[2],y=n[3],v=y*i+f*c-_*s,w=y*s+_*i-d*c,I=y*c+d*s-f*i,C=-d*i-f*s-_*c;return t[0]=v*y+C*-d+w*-_-I*-f,t[1]=w*y+C*-f+I*-d-v*-_,t[2]=I*y+C*-_+v*-f-w*-d,t[3]=e[3],t},jr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},jr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},jr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},jr.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=e[0],f=e[1],_=e[2],y=e[3];return Math.abs(n-d)<=Rc.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-f)<=Rc.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-_)<=Rc.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-y)<=Rc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},jr.forEach=jr.sqrLen=jr.len=jr.sqrDist=jr.dist=jr.div=jr.mul=jr.sub=void 0;var Rc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Sp(t)&&"function"!=typeof t)return{default:t};var n=bx(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function bx(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(bx=function(i){return i?n:e})(t)}function pl(){var t=new Rc.ARRAY_TYPE(4);return Rc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function uw(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function wx(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function AT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function CT(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],c=e[3]-t[3];return n*n+i*i+s*s+c*c}function ST(t){return Math.hypot(t[0],t[1],t[2],t[3])}function zy(t){var e=t[0],n=t[1],i=t[2],s=t[3];return e*e+n*n+i*i+s*s}jr.sub=mg,jr.mul=uw,jr.div=wx,jr.dist=AT,jr.sqrDist=CT,jr.len=ST,jr.sqrLen=zy;var ND=function(){var t=pl();return function(e,n,i,s,c,d){var f,_;for(n||(n=4),i||(i=0),_=s?Math.min(s*n+i,e.length):e.length,f=i;f<_;f+=n)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],c(t,t,d),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}();function gg(t){return(gg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}jr.forEach=ND,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.create=DT,Wr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Wr.setAxisAngle=Ix,Wr.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>_g.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},Wr.getAngle=function(t,e){var n=yg(t,e);return Math.acos(2*n*n-1)},Wr.multiply=MT,Wr.rotateX=function(t,e,n){n*=.5;var i=e[0],s=e[1],c=e[2],d=e[3],f=Math.sin(n),_=Math.cos(n);return t[0]=i*_+d*f,t[1]=s*_+c*f,t[2]=c*_-s*f,t[3]=d*_-i*f,t},Wr.rotateY=function(t,e,n){n*=.5;var i=e[0],s=e[1],c=e[2],d=e[3],f=Math.sin(n),_=Math.cos(n);return t[0]=i*_-c*f,t[1]=s*_+d*f,t[2]=c*_+i*f,t[3]=d*_-s*f,t},Wr.rotateZ=function(t,e,n){n*=.5;var i=e[0],s=e[1],c=e[2],d=e[3],f=Math.sin(n),_=Math.cos(n);return t[0]=i*_+s*f,t[1]=s*_-i*f,t[2]=c*_+d*f,t[3]=d*_-c*f,t},Wr.calculateW=function(t,e){var n=e[0],i=e[1],s=e[2];return t[0]=n,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-s*s)),t},Wr.exp=mh,Wr.ln=Uy,Wr.pow=function(t,e,n){return Uy(t,e),hw(t,t,n),mh(t,t),t},Wr.slerp=gh,Wr.random=function(t){var e=_g.RANDOM(),n=_g.RANDOM(),i=_g.RANDOM(),s=Math.sqrt(1-e),c=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=c*Math.sin(2*Math.PI*i),t[3]=c*Math.cos(2*Math.PI*i),t},Wr.invert=function(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=n*n+i*i+s*s+c*c,f=d?1/d:0;return t[0]=-n*f,t[1]=-i*f,t[2]=-s*f,t[3]=c*f,t},Wr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Wr.fromMat3=$y,Wr.fromEuler=function(t,e,n,i){var s=.5*Math.PI/180;e*=s,n*=s,i*=s;var c=Math.sin(e),d=Math.cos(e),f=Math.sin(n),_=Math.cos(n),y=Math.sin(i),v=Math.cos(i);return t[0]=c*_*v-d*f*y,t[1]=d*f*v+c*_*y,t[2]=d*_*y-c*f*v,t[3]=d*_*v+c*f*y,t},Wr.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Wr.setAxes=Wr.sqlerp=Wr.rotationTo=Wr.equals=Wr.exactEquals=Wr.normalize=Wr.sqrLen=Wr.squaredLength=Wr.len=Wr.length=Wr.lerp=Wr.dot=Wr.scale=Wr.mul=Wr.add=Wr.set=Wr.copy=Wr.fromValues=Wr.clone=void 0;var _g=bd(Ts),dw=bd(lo),xd=bd(si),ml=bd(jr);function Ex(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Ex=function(i){return i?n:e})(t)}function bd(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==gg(t)&&"function"!=typeof t)return{default:t};var n=Ex(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}function DT(){var t=new _g.ARRAY_TYPE(4);return _g.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ix(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function MT(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=n[0],_=n[1],y=n[2],v=n[3];return t[0]=i*v+d*f+s*y-c*_,t[1]=s*v+d*_+c*f-i*y,t[2]=c*v+d*y+i*_-s*f,t[3]=d*v-i*f-s*_-c*y,t}function mh(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=Math.sqrt(n*n+i*i+s*s),f=Math.exp(c),_=d>0?f*Math.sin(d)/d:0;return t[0]=n*_,t[1]=i*_,t[2]=s*_,t[3]=f*Math.cos(d),t}function Uy(t,e){var n=e[0],i=e[1],s=e[2],c=e[3],d=Math.sqrt(n*n+i*i+s*s),f=d>0?Math.atan2(d,c)/d:0;return t[0]=n*f,t[1]=i*f,t[2]=s*f,t[3]=.5*Math.log(n*n+i*i+s*s+c*c),t}function gh(t,e,n,i){var s,c,d,f,_,y=e[0],v=e[1],w=e[2],I=e[3],C=n[0],S=n[1],M=n[2],P=n[3];return(c=y*C+v*S+w*M+I*P)<0&&(c=-c,C=-C,S=-S,M=-M,P=-P),1-c>_g.EPSILON?(s=Math.acos(c),d=Math.sin(s),f=Math.sin((1-i)*s)/d,_=Math.sin(i*s)/d):(f=1-i,_=i),t[0]=f*y+_*C,t[1]=f*v+_*S,t[2]=f*w+_*M,t[3]=f*I+_*P,t}function $y(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var c=(s+1)%3,d=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*c+c]-e[3*d+d]+1),t[s]=.5*n,t[3]=(e[3*c+d]-e[3*d+c])*(n=.5/n),t[c]=(e[3*c+s]+e[3*s+c])*n,t[d]=(e[3*d+s]+e[3*s+d])*n}return t}Wr.clone=ml.clone,Wr.fromValues=ml.fromValues,Wr.copy=ml.copy,Wr.set=ml.set,Wr.add=ml.add,Wr.mul=MT;var hw=ml.scale;Wr.scale=hw;var yg=ml.dot;Wr.dot=yg,Wr.lerp=ml.lerp;var Tx=ml.length;Wr.length=Tx,Wr.len=Tx;var cS=ml.squaredLength;Wr.squaredLength=cS,Wr.sqrLen=cS;var RT=ml.normalize;Wr.normalize=RT,Wr.exactEquals=ml.exactEquals,Wr.equals=ml.equals;var Pc,uS,Ax,FD=(Pc=xd.create(),uS=xd.fromValues(1,0,0),Ax=xd.fromValues(0,1,0),function(t,e,n){var i=xd.dot(e,n);return i<-.999999?(xd.cross(Pc,uS,e),xd.len(Pc)<1e-6&&xd.cross(Pc,Ax,e),xd.normalize(Pc,Pc),Ix(t,Pc,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(xd.cross(Pc,e,n),t[0]=Pc[0],t[1]=Pc[1],t[2]=Pc[2],t[3]=1+i,RT(t,t))});Wr.rotationTo=FD;var vg,_h,Cx=(vg=DT(),_h=DT(),function(t,e,n,i,s,c){return gh(vg,e,s,c),gh(_h,n,i,c),gh(t,vg,_h,2*c*(1-c)),t});Wr.sqlerp=Cx;var gl,dS=(gl=dw.create(),function(t,e,n,i){return gl[0]=n[0],gl[3]=n[1],gl[6]=n[2],gl[1]=i[0],gl[4]=i[1],gl[7]=i[2],gl[2]=-e[0],gl[5]=-e[1],gl[8]=-e[2],RT(t,$y(t,gl))});Wr.setAxes=dS;var Si={};function Dp(t){return(Dp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Si,"__esModule",{value:!0}),Si.create=function(){var t=new Qa.ARRAY_TYPE(8);return Qa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Si.clone=function(t){var e=new Qa.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Si.fromValues=function(t,e,n,i,s,c,d,f){var _=new Qa.ARRAY_TYPE(8);return _[0]=t,_[1]=e,_[2]=n,_[3]=i,_[4]=s,_[5]=c,_[6]=d,_[7]=f,_},Si.fromRotationTranslationValues=function(t,e,n,i,s,c,d){var f=new Qa.ARRAY_TYPE(8);f[0]=t,f[1]=e,f[2]=n,f[3]=i;var _=.5*s,y=.5*c,v=.5*d;return f[4]=_*i+y*n-v*e,f[5]=y*i+v*t-_*n,f[6]=v*i+_*e-y*t,f[7]=-_*t-y*e-v*n,f},Si.fromRotationTranslation=OT,Si.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Si.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Si.fromMat4=function(t,e){var n=_l.create();PT.getRotation(n,e);var i=new Qa.ARRAY_TYPE(3);return PT.getTranslation(i,e),OT(t,n,i),t},Si.copy=Dx,Si.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Si.set=function(t,e,n,i,s,c,d,f,_){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=c,t[5]=d,t[6]=f,t[7]=_,t},Si.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Si.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Si.getTranslation=function(t,e){var n=e[4],i=e[5],s=e[6],c=e[7],d=-e[0],f=-e[1],_=-e[2],y=e[3];return t[0]=2*(n*y+c*d+i*_-s*f),t[1]=2*(i*y+c*f+s*d-n*_),t[2]=2*(s*y+c*_+n*f-i*d),t},Si.translate=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=.5*n[0],_=.5*n[1],y=.5*n[2],v=e[4],w=e[5],I=e[6],C=e[7];return t[0]=i,t[1]=s,t[2]=c,t[3]=d,t[4]=d*f+s*y-c*_+v,t[5]=d*_+c*f-i*y+w,t[6]=d*y+i*_-s*f+I,t[7]=-i*f-s*_-c*y+C,t},Si.rotateX=function(t,e,n){var i=-e[0],s=-e[1],c=-e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=f*d+v*i+_*c-y*s,I=_*d+v*s+y*i-f*c,C=y*d+v*c+f*s-_*i,S=v*d-f*i-_*s-y*c;return _l.rotateX(t,e,n),t[4]=w*(d=t[3])+S*(i=t[0])+I*(c=t[2])-C*(s=t[1]),t[5]=I*d+S*s+C*i-w*c,t[6]=C*d+S*c+w*s-I*i,t[7]=S*d-w*i-I*s-C*c,t},Si.rotateY=function(t,e,n){var i=-e[0],s=-e[1],c=-e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=f*d+v*i+_*c-y*s,I=_*d+v*s+y*i-f*c,C=y*d+v*c+f*s-_*i,S=v*d-f*i-_*s-y*c;return _l.rotateY(t,e,n),t[4]=w*(d=t[3])+S*(i=t[0])+I*(c=t[2])-C*(s=t[1]),t[5]=I*d+S*s+C*i-w*c,t[6]=C*d+S*c+w*s-I*i,t[7]=S*d-w*i-I*s-C*c,t},Si.rotateZ=function(t,e,n){var i=-e[0],s=-e[1],c=-e[2],d=e[3],f=e[4],_=e[5],y=e[6],v=e[7],w=f*d+v*i+_*c-y*s,I=_*d+v*s+y*i-f*c,C=y*d+v*c+f*s-_*i,S=v*d-f*i-_*s-y*c;return _l.rotateZ(t,e,n),t[4]=w*(d=t[3])+S*(i=t[0])+I*(c=t[2])-C*(s=t[1]),t[5]=I*d+S*s+C*i-w*c,t[6]=C*d+S*c+w*s-I*i,t[7]=S*d-w*i-I*s-C*c,t},Si.rotateByQuatAppend=function(t,e,n){var i=n[0],s=n[1],c=n[2],d=n[3],f=e[0],_=e[1],y=e[2],v=e[3];return t[0]=f*d+v*i+_*c-y*s,t[1]=_*d+v*s+y*i-f*c,t[2]=y*d+v*c+f*s-_*i,t[3]=v*d-f*i-_*s-y*c,t[4]=(f=e[4])*d+(v=e[7])*i+(_=e[5])*c-(y=e[6])*s,t[5]=_*d+v*s+y*i-f*c,t[6]=y*d+v*c+f*s-_*i,t[7]=v*d-f*i-_*s-y*c,t},Si.rotateByQuatPrepend=function(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=n[0],_=n[1],y=n[2],v=n[3];return t[0]=i*v+d*f+s*y-c*_,t[1]=s*v+d*_+c*f-i*y,t[2]=c*v+d*y+i*_-s*f,t[3]=d*v-i*f-s*_-c*y,t[4]=i*(v=n[7])+d*(f=n[4])+s*(y=n[6])-c*(_=n[5]),t[5]=s*v+d*_+c*f-i*y,t[6]=c*v+d*y+i*_-s*f,t[7]=d*v-i*f-s*_-c*y,t},Si.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<Qa.EPSILON)return Dx(t,e);var s=Math.hypot(n[0],n[1],n[2]);i*=.5;var c=Math.sin(i),d=c*n[0]/s,f=c*n[1]/s,_=c*n[2]/s,y=Math.cos(i),v=e[0],w=e[1],I=e[2],C=e[3];t[0]=v*y+C*d+w*_-I*f,t[1]=w*y+C*f+I*d-v*_,t[2]=I*y+C*_+v*f-w*d,t[3]=C*y-v*d-w*f-I*_;var S=e[4],M=e[5],P=e[6],R=e[7];return t[4]=S*y+R*d+M*_-P*f,t[5]=M*y+R*f+P*d-S*_,t[6]=P*y+R*_+S*f-M*d,t[7]=R*y-S*d-M*f-P*_,t},Si.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Si.multiply=kT,Si.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Si.lerp=function(t,e,n,i){var s=1-i;return jy(e,n)<0&&(i=-i),t[0]=e[0]*s+n[0]*i,t[1]=e[1]*s+n[1]*i,t[2]=e[2]*s+n[2]*i,t[3]=e[3]*s+n[3]*i,t[4]=e[4]*s+n[4]*i,t[5]=e[5]*s+n[5]*i,t[6]=e[6]*s+n[6]*i,t[7]=e[7]*s+n[7]*i,t},Si.invert=function(t,e){var n=Gy(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Si.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Si.normalize=function(t,e){var n=Gy(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,s=e[1]/n,c=e[2]/n,d=e[3]/n,f=e[4],_=e[5],y=e[6],v=e[7],w=i*f+s*_+c*y+d*v;t[0]=i,t[1]=s,t[2]=c,t[3]=d,t[4]=(f-i*w)/n,t[5]=(_-s*w)/n,t[6]=(y-c*w)/n,t[7]=(v-d*w)/n}return t},Si.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Si.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Si.equals=function(t,e){var n=t[0],i=t[1],s=t[2],c=t[3],d=t[4],f=t[5],_=t[6],y=t[7],v=e[0],w=e[1],I=e[2],C=e[3],S=e[4],M=e[5],P=e[6],R=e[7];return Math.abs(n-v)<=Qa.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-w)<=Qa.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-I)<=Qa.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(c-C)<=Qa.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-S)<=Qa.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(f-M)<=Qa.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(_-P)<=Qa.EPSILON*Math.max(1,Math.abs(_),Math.abs(P))&&Math.abs(y-R)<=Qa.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))},Si.sqrLen=Si.squaredLength=Si.len=Si.length=Si.dot=Si.mul=Si.setReal=Si.getReal=void 0;var Qa=Sx(Ts),_l=Sx(Wr),PT=Sx(fi);function fw(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(fw=function(i){return i?n:e})(t)}function Sx(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Dp(t)&&"function"!=typeof t)return{default:t};var n=fw(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}function OT(t,e,n){var i=.5*n[0],s=.5*n[1],c=.5*n[2],d=e[0],f=e[1],_=e[2],y=e[3];return t[0]=d,t[1]=f,t[2]=_,t[3]=y,t[4]=i*y+s*_-c*f,t[5]=s*y+c*d-i*_,t[6]=c*y+i*f-s*d,t[7]=-i*d-s*f-c*_,t}function Dx(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function kT(t,e,n){var i=e[0],s=e[1],c=e[2],d=e[3],f=n[4],_=n[5],y=n[6],v=n[7],w=e[4],I=e[5],C=e[6],S=e[7],M=n[0],P=n[1],R=n[2],z=n[3];return t[0]=i*z+d*M+s*R-c*P,t[1]=s*z+d*P+c*M-i*R,t[2]=c*z+d*R+i*P-s*M,t[3]=d*z-i*M-s*P-c*R,t[4]=i*v+d*f+s*y-c*_+w*z+S*M+I*R-C*P,t[5]=s*v+d*_+c*f-i*y+I*z+S*P+C*M-w*R,t[6]=c*v+d*y+i*_-s*f+C*z+S*R+w*P-I*M,t[7]=d*v-i*f-s*_-c*y+S*z-w*M-I*P-C*R,t}Si.getReal=_l.copy,Si.setReal=_l.copy,Si.mul=kT;var jy=_l.dot;Si.dot=jy;var LT=_l.length;Si.length=LT,Si.len=LT;var Gy=_l.squaredLength;Si.squaredLength=Gy,Si.sqrLen=Gy;var ai={};function pw(t){return(pw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=NT,ai.clone=function(t){var e=new wd.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ai.fromValues=function(t,e){var n=new wd.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},ai.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ai.set=function(t,e,n){return t[0]=e,t[1]=n,t},ai.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},ai.subtract=xg,ai.multiply=bg,ai.divide=Hy,ai.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ai.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ai.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},ai.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},ai.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ai.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},ai.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},ai.distance=Wy,ai.squaredDistance=gf,ai.length=FT,ai.squaredLength=mw,ai.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ai.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ai.normalize=function(t,e){var n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},ai.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ai.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},ai.lerp=function(t,e,n,i){var s=e[0],c=e[1];return t[0]=s+i*(n[0]-s),t[1]=c+i*(n[1]-c),t},ai.random=function(t,e){e=e||1;var n=2*wd.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},ai.transformMat2=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t},ai.transformMat2d=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s+n[4],t[1]=n[1]*i+n[3]*s+n[5],t},ai.transformMat3=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[3]*s+n[6],t[1]=n[1]*i+n[4]*s+n[7],t},ai.transformMat4=function(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t},ai.rotate=function(t,e,n,i){var s=e[0]-n[0],c=e[1]-n[1],d=Math.sin(i),f=Math.cos(i);return t[0]=s*f-c*d+n[0],t[1]=s*d+c*f+n[1],t},ai.angle=function(t,e){var n=t[0],i=t[1],s=e[0],c=e[1],d=Math.sqrt(n*n+i*i)*Math.sqrt(s*s+c*c);return Math.acos(Math.min(Math.max(d&&(n*s+i*c)/d,-1),1))},ai.zero=function(t){return t[0]=0,t[1]=0,t},ai.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ai.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ai.equals=function(t,e){var n=t[0],i=t[1],s=e[0],c=e[1];return Math.abs(n-s)<=wd.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-c)<=wd.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},ai.forEach=ai.sqrLen=ai.sqrDist=ai.dist=ai.div=ai.mul=ai.sub=ai.len=void 0;var wd=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==pw(t)&&"function"!=typeof t)return{default:t};var n=mf(void 0);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}(Ts);function mf(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(mf=function(i){return i?n:e})(t)}function NT(){var t=new wd.ARRAY_TYPE(2);return wd.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function xg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function bg(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Hy(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Wy(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function gf(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function FT(t){return Math.hypot(t[0],t[1])}function mw(t){var e=t[0],n=t[1];return e*e+n*n}ai.len=FT,ai.sub=xg,ai.mul=bg,ai.div=Hy,ai.dist=Wy,ai.sqrDist=gf,ai.sqrLen=mw;var BT=function(){var t=NT();return function(e,n,i,s,c,d){var f,_;for(n||(n=2),i||(i=0),_=s?Math.min(s*n+i,e.length):e.length,f=i;f<_;f+=n)t[0]=e[f],t[1]=e[f+1],c(t,t,d),e[f]=t[0],e[f+1]=t[1];return e}}();function Mx(t){return(Mx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}ai.forEach=BT,Object.defineProperty(ma,"__esModule",{value:!0});var no=ma.vec4=He=ma.vec3=ma.vec2=ma.quat2=ia=ma.quat=Dt=ma.mat4=yl=ma.mat3=ma.mat2d=yh=ma.mat2=ma.glMatrix=void 0,VT=Ed(Ts);ma.glMatrix=VT;var Rx=Ed(ao),yh=ma.mat2=Rx,gw=Ed(Zo);ma.mat2d=gw;var wg=Ed(lo),yl=ma.mat3=wg,hS=Ed(fi),Dt=ma.mat4=hS,zT=Ed(Wr),ia=ma.quat=zT,Eg=Ed(Si);ma.quat2=Eg;var UT=Ed(ai);ma.vec2=UT;var $T=Ed(si),He=ma.vec3=$T,jT=Ed(jr);function GT(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(GT=function(i){return i?n:e})(t)}function Ed(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Mx(t)&&"function"!=typeof t)return{default:t};var n=GT(e);if(n&&n.has(t))return n.get(t);var i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if("default"!==c&&Object.prototype.hasOwnProperty.call(t,c)){var d=s?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(i,c,d):i[c]=t[c]}return i.default=t,n&&n.set(t,i),i}no=ma.vec4=jT;const fS=Gi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Px}=fS,Ox=Gi([{name:"a_pos_3",components:3,type:"Int16"}]);var Xl=Gi([{name:"a_pos",type:"Int16",components:2}]),Ig={};!function(n){function i(c,d,f){var _=s(256*c,256*(d=Math.pow(2,f)-d-1),f),y=s(256*(c+1),256*(d+1),f);return _[0]+","+_[1]+","+y[0]+","+y[1]}function s(c,d,f){var _=2*Math.PI*6378137/256/Math.pow(2,f);return[c*_-2*Math.PI*6378137/2,d*_-2*Math.PI*6378137/2]}n.getURL=function(c,d,f,_,y,v){return v=v||{},c+"?"+["bbox="+i(f,_,y),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+d].join("&")},n.getTileBBox=i,n.getMercCoords=s,Object.defineProperty(n,"__esModule",{value:!0})}(Ig);var pS=Ig;class vh{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=kx(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const i=pS.getTileBBox(this.x,this.y,this.z),s=function(c,d,f){let _,y="";for(let v=c;v>0;v--)_=1<<v-1,y+=(d&_?1:0)+(f&_?2:0);return y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class HT{constructor(e,n){this.wrap=e,this.canonical=n,this.key=kx(e,n.z,n.z,n.x,n.y)}}class Bi{constructor(e,n,i,s,c){this.overscaledZ=e,this.wrap=n,this.canonical=new vh(i,+s,+c),this.key=0===n&&e===i?this.canonical.key:kx(n,e,i,s,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Bi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bi(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return kx(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return kx(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,i=2*this.canonical.x,s=2*this.canonical.y;return[new Bi(n,this.wrap,n,i,s),new Bi(n,this.wrap,n,i+1,s),new Bi(n,this.wrap,n,i,s+1),new Bi(n,this.wrap,n,i+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new HT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function kx(t,e,n,i,s){const c=1<<Math.min(n,22);let d=c*(s%c)+i%c;return t&&n<22&&(d+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*d+n)+(e-n)}const mS=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Bi(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Bi(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Bi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new Bi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];lr(vh,"CanonicalTileID"),lr(Bi,"OverscaledTileID",{omit:["projMatrix"]});class qy{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){const s=He.dot(n,this.dir);if(Math.abs(s)<1e-6)return!1;const c=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/s;return i[0]=this.pos[0]+this.dir[0]*c,i[1]=this.pos[1]+this.dir[1]*c,i[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,n,i){if(He.equals(this.pos,e)||0===n)return i[0]=i[1]=i[2]=0,!1;const[s,c,d]=this.dir,f=this.pos[0]-e[0],_=this.pos[1]-e[1],y=this.pos[2]-e[2],v=s*s+c*c+d*d,w=2*(f*s+_*c+y*d),I=w*w-4*v*(f*f+_*_+y*y-n*n);if(I<0){const C=Math.max(-w/2,0),S=f+s*C,M=_+c*C,P=y+d*C,R=Math.hypot(S,M,P);return i[0]=S*n/R,i[1]=M*n/R,i[2]=P*n/R,!1}{const C=(-w-Math.sqrt(I))/(2*v);if(C<0){const S=Math.hypot(f,_,y);return i[0]=f*n/S,i[1]=_*n/S,i[2]=y*n/S,!1}return i[0]=f+s*C,i[1]=_+c*C,i[2]=y+d*C,!0}}}class _w{constructor(e,n,i,s,c){this.TL=e,this.TR=n,this.BR=i,this.BL=s,this.horizon=c}static fromInvProjectionMatrix(e,n,i){const s=[-1,1,1],c=[1,1,1],d=[1,-1,1],f=[-1,-1,1],_=He.transformMat4(s,s,e),y=He.transformMat4(c,c,e),v=He.transformMat4(d,d,e),w=He.transformMat4(f,f,e);return new _w(_,y,v,w,n/i)}}function Yy(t,e,n){let i=1/0,s=-1/0;const c=[];for(const d of t){He.sub(c,d,e);const f=He.dot(c,n);i=Math.min(i,f),s=Math.max(s,f)}return[i,s]}function yw(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){const s=t.planes[i];let c=0;for(let d=0;d<e.length;d++)c+=He.dot(s,e[d])+s[3]>=0;if(0===c)return 0;c!==e.length&&(n=!1)}return n?2:1}function Lx(t,e){for(const n of t.projections){const i=Yy(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function Nx(t,e){let n=0;const i=[0,0,0,0];for(let s=0;s<t.length;s++)i[0]=t[s][0],i[1]=t[s][1],i[2]=t[s][2],i[3]=1,no.dot(i,e)>=0&&n++;return n}class La{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=bo.fromPoints(this.points),this.projections=[],this.frustumEdges=[He.sub([],this.points[2],this.points[3]),He.sub([],this.points[0],this.points[3]),He.sub([],this.points[4],this.points[0]),He.sub([],this.points[5],this.points[1]),He.sub([],this.points[6],this.points[2]),He.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const s=[0,-i[2],i[1]],c=[i[2],0,-i[0]];this.projections.push({axis:s,projection:Yy(this.points,this.points[0],s)}),this.projections.push({axis:c,projection:Yy(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,n,i,s){const c=Math.pow(2,i),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=no.transformMat4([],y,e),w=1/v[3]/n*c;return no.mul(v,v,[w,w,s?1/v[3]:w,w])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=He.sub([],d[y[0]],d[y[1]]),w=He.sub([],d[y[2]],d[y[1]]),I=He.normalize([],He.cross([],v,w)),C=-He.dot(I,d[y[1]]);return I.concat(C)}),_=[];for(let y=0;y<d.length;y++)_.push([d[y][0],d[y][1],d[y][2]]);return new La(_,f)}intersectsPrecise(e,n,i){for(let s=0;s<n.length;s++)if(!Nx(e,n[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!Nx(e,this.planes[s]))return 0;for(const s of i)for(const c of this.frustumEdges){const d=He.cross([],s,c),f=He.length(d);if(0===f)continue;He.scale(d,d,1/f);const _=Yy(this.points,this.points[0],d),y=Yy(e,this.points[0],d);if(_[0]>y[1]||y[0]>_[1])return 0}return 1}}class bo{static fromPoints(e){const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const s of e)He.min(n,n,s),He.max(i,i,s);return new bo(n,i)}static fromTileIdAndHeight(e,n,i){const s=1<<e.canonical.z,c=e.canonical.x,d=e.canonical.y;return new bo([c/s,d/s,n],[(c+1)/s,(d+1)/s,i])}static applyTransform(e,n){const i=e.getCorners();for(let s=0;s<i.length;++s)He.transformMat4(i[s],i[s],n);return bo.fromPoints(i)}static projectAabbCorners(e,n){const i=e.getCorners();for(let s=0;s<i.length;++s)He.transformMat4(i[s],i[s],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=He.scale([],He.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],i=He.clone(this.min),s=He.clone(this.max);for(let c=0;c<n.length;c++)i[c]=n[c]?this.min[c]:this.center[c],s[c]=n[c]?this.center[c]:this.max[c];return s[2]=this.max[2],new bo(i,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?yw(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?yw(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Lx(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Lx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}lr(bo,"Aabb");const Tg=5,_f=6,Ja=Vt/Math.PI/2,dM=16383,Bx=[64,32,16],Ql=-Ja,vl=Ja,gS=[new bo([Ql,Ql,Ql],[vl,vl,vl]),new bo([Ql,Ql,Ql],[0,0,vl]),new bo([0,Ql,Ql],[vl,0,vl]),new bo([Ql,0,Ql],[0,vl,vl]),new bo([0,0,Ql],[vl,vl,vl])];function Vx(t){return t*Ja/yf}function vw(t,e,n,i=!0){const s=He.scale([],t._camera.position,t.worldSize),c=[e,n,1,1];no.transformMat4(c,c,t.pixelMatrixInverse),no.scale(c,c,1/c[3]);const d=He.sub([],c,s),f=He.normalize([],d),_=t.globeMatrix,y=[_[12],_[13],_[14]],v=He.sub([],y,s),w=He.length(v),I=He.normalize([],v),C=t.worldSize/(2*Math.PI),S=He.dot(I,f),M=Math.asin(C/w);if(M<Math.acos(S)){if(!i)return null;const ke=[],Ae=[];He.scale(ke,f,w/S),He.normalize(Ae,He.sub(Ae,ke,v)),He.normalize(f,He.add(f,v,He.scale(f,Ae,Math.tan(M)*w)))}const P=[];new qy(s,f).closestPointOnSphere(y,C,P);const R=He.normalize([],bi(_,0)),z=He.normalize([],bi(_,1)),G=He.normalize([],bi(_,2)),H=He.dot(R,P),j=He.dot(z,P),W=He.dot(G,P),oe=dt(Math.asin(-j/C));let pe=dt(Math.atan2(H,W));pe=t.center.lng+function(ke,Ae){const $e=(Ae-ke+180)%360-180;return $e<-180?$e+360:$e}(t.center.lng,pe);const ve=tl(pe),xe=_n(Sa(oe),0,1);return new Ri(ve,xe)}class _S{constructor(e,n,i){this.a=He.sub([],e,i),this.b=He.sub([],n,i),this.center=i;const s=He.normalize([],this.a),c=He.normalize([],this.b);this.angle=Math.acos(He.dot(s,c))}}function xw(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,s,c,d){const f=Math.sin(c);return i*(Math.sin((1-d)*c)/f)+s*(Math.sin(d*c)/f)}(t.a[e],t.b[e],t.angle,_n(n,0,1))+t.center[e]}function au(t){if(t.z<=1)return gS[t.z+2*t.y+t.x];const e=Ky(Mp(t));return bo.fromPoints(e)}function xh(t,e,n){return He.scale(t,t,1-n),He.scaleAndAdd(t,t,e,n)}function zx(t,e){const n=el(e.zoom);if(0===n)return au(t);const i=Mp(t),s=Ky(i),c=tl(i.getWest())*e.worldSize,d=tl(i.getEast())*e.worldSize,f=Sa(i.getNorth())*e.worldSize,_=Sa(i.getSouth())*e.worldSize,y=[c,f,0],v=[d,f,0],w=[c,_,0],I=[d,_,0],C=Dt.invert([],e.globeMatrix);return He.transformMat4(y,y,C),He.transformMat4(v,v,C),He.transformMat4(w,w,C),He.transformMat4(I,I,C),s[0]=xh(s[0],w,n),s[1]=xh(s[1],I,n),s[2]=xh(s[2],v,n),s[3]=xh(s[3],y,n),bo.fromPoints(s)}function Zy(t,e,n){for(const i of t)He.transformMat4(i,i,e),He.scale(i,i,n)}function WT(t,e,n,i){const s=e/t.worldSize,c=t.globeMatrix;if(n.z<=1){const ve=au(n).getCorners();return Zy(ve,c,s),bo.fromPoints(ve)}const d=Mp(n,i),f=Ky(d);Zy(f,c,s);const _=Number.MAX_VALUE,y=[-_,-_,-_],v=[_,_,_];if(d.contains(t.center)){for(const ke of f)He.min(v,v,ke),He.max(y,y,ke);y[2]=0;const ve=t.point,xe=[ve.x*s,ve.y*s,0];return He.min(v,v,xe),He.max(y,y,xe),new bo(v,y)}const w=[c[12]*s,c[13]*s,c[14]*s],I=d.getCenter(),C=_n(t.center.lat,-As,As),S=_n(I.lat,-As,As),M=tl(t.center.lng),P=Sa(C);let R=M-tl(I.lng);const z=P-Sa(S);R>.5?R-=1:R<-.5&&(R+=1);let G=0;if(Math.abs(R)>Math.abs(z))G=R>=0?1:3;else{G=z>=0?0:2;const ve=[c[4]*s,c[5]*s,c[6]*s],xe=-Math.sin(De(z>=0?d.getSouth():d.getNorth()))*Ja;He.scaleAndAdd(w,w,ve,xe)}const H=f[G],j=f[(G+1)%4],W=new _S(H,j,w),oe=[xw(W,0)||H[0],xw(W,1)||H[1],xw(W,2)||H[2]],pe=el(t.zoom);if(pe>0){const ve=function({x:ke,y:Ae,z:$e},Ce,nt,ft,It){const et=1/(1<<$e);let it=ke*et,St=it+et,Ut=Ae*et,Wt=Ut+et,ln=0;const pn=(it+St)/2-ft;return pn>.5?ln=-1:pn<-.5&&(ln=1),it=((it+ln)*Ce-(ft*=Ce))*nt+ft,St=((St+ln)*Ce-ft)*nt+ft,Ut=(Ut*Ce-(It*=Ce))*nt+It,Wt=(Wt*Ce-It)*nt+It,[[it,Wt,0],[St,Wt,0],[St,Ut,0],[it,Ut,0]]}(n,e,t._pixelsPerMercatorPixel,M,P);for(let ke=0;ke<f.length;ke++)xh(f[ke],ve[ke],pe);const xe=He.add([],ve[G],ve[(G+1)%4]);He.scale(xe,xe,.5),xh(oe,xe,pe)}for(const ve of f)He.min(v,v,ve),He.max(y,y,ve);return v[2]=Math.min(H[2],j[2]),He.min(v,v,oe),He.max(y,y,oe),new bo(v,y)}function Mp({x:t,y:e,z:n},i=!1){const s=1/(1<<n),c=new kr(Oc(t*s),e===(1<<n)-1&&i?-90:Gs((e+1)*s)),d=new kr(Oc((t+1)*s),0===e&&i?90:Gs(e*s));return new Mc(c,d)}function Ky(t){const e=De(t.getNorth()),n=De(t.getSouth()),i=Math.cos(e),s=Math.cos(n),c=Math.sin(e),d=Math.sin(n),f=t.getWest(),_=t.getEast();return[lu(s,d,f),lu(s,d,_),lu(i,c,_),lu(i,c,f)]}function lu(t,e,n,i=Ja){return n=De(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function hc(t,e,n){return lu(Math.cos(De(t)),Math.sin(De(t)),e,n)}function Rp(t,e,n,i){const s=1<<n.z,c=(t/Vt+n.x)/s;return hc(Gs((e/Vt+n.y)/s),Oc(c),i)}function Ag({min:t,max:e}){return dM/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const bw=new Float64Array(16);function Cg(t){const e=Ag(t),n=Dt.fromScaling(bw,[e,e,e]);return Dt.translate(n,n,He.negate([],t.min))}function qT(t){const e=Dt.fromTranslation(bw,t.min),n=1/Ag(t);return Dt.scale(e,e,[n,n,n])}function ww(t){const e=Vt/(2*Math.PI);return t/(2*Math.PI)/e}function yS(t,e){return Vt/(512*Math.pow(2,t))*Ag(au(e))}function YT(t,e,n,i,s){const c=ww(n),d=[t,e,-n/(2*Math.PI)],f=Dt.identity(new Float64Array(16));return Dt.translate(f,f,d),Dt.scale(f,f,[c,c,c]),Dt.rotateX(f,f,De(-s)),Dt.rotateY(f,f,De(-i)),f}function el(t){return sn(Tg,_f,t)}function BD(t,e,n){const i=Dt.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return Dt.rotateY(i,n.globeMatrix,s),Float32Array.from(i)}function Xy(t,e,n){const i=el(n.zoom),s=t.style.map._antialias,c=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===i&&!s&&!c}function VD(t,e,n,i){const s=e.getNorth(),c=e.getSouth(),d=e.getWest(),f=e.getEast(),_=1<<t.z,y=f-d,v=s-c,w=y/64,I=-v/Bx[n],C=[0,w,0,I,0,0,s,d,0];if(t.z>0){const S=180/i;yl.multiply(C,C,[S/y+1,0,0,0,S/v+1,0,-.5*S/w,.5*S/I,1])}return C[2]=_,C[5]=t.x,C[8]=t.y,C}function hM(t){const e=As-5;t=_n(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(De(t))),3);return Math.round(n*(Bx.length-1))}function zD(t){const e=[0,0,0],n=Dt.identity(new Float64Array(16));return Dt.multiply(n,t.pixelMatrix,t.globeMatrix),He.transformMat4(e,e,n),new me(e[0],e[1])}function Ux(t,e){const n=hc(e.lat,e.lng),i=function(c){const d=hc(c._center.lat,c._center.lng),f=He.fromValues(0,1,0);let _=He.cross([],f,d);const y=Dt.fromRotation([],-c.angle,d);_=He.transformMat4(_,_,y),Dt.fromRotation(y,-c._pitch,_);const v=He.normalize([],d);return He.scale(v,v,Vx(c.cameraToCenterDistance/c.pixelsPerMeter)),He.transformMat4(v,v,y),He.add([],d,v)}(t),s=He.subtract([],i,n);return He.angle(s,n)}function Ew(t,e){return Ux(t,e)>Math.PI/2*1.01}const Iw=De(85),ZT=Math.cos(Iw),Qy=Math.sin(Iw);class Tw{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,n){const i=new Vl,s=new Is,c=[],d=e+1+2,f=n[0]+1,_=n[0]+1+(1+n.length),y=(v,w,I)=>{let C=v===d-1?v-2:0===v?v:v-1;return C+=I?24575:0,[C,w]};for(let v=0;v<d;++v)i.emplaceBack(...y(v,0,!0));for(let v=0;v<f;++v)for(let w=0;w<d;++w)i.emplaceBack(...y(w,v,(0===w||w===d-1)&&!0));for(let v=0;v<n.length;++v){const w=n[v];for(let I=0;I<d;++I)i.emplaceBack(...y(I,w,!0))}for(let v=0;v<n.length;++v){const w=s.length,I=n[v]+1+2,C=new Is;for(let P=0;P<I-1;P++){const R=P===I-2,z=R?d*(_-n.length+v-P):d;for(let G=0;G<d-1;G++){const H=P*d+G;0===P||R||0===G||G===d-2?(C.emplaceBack(H+1,H,H+z),C.emplaceBack(H+z,H+z+1,H+1)):(s.emplaceBack(H+1,H,H+z),s.emplaceBack(H+z,H+z+1,H+1))}}const S=so.simpleSegment(0,w,i.length,s.length-w);for(let P=0;P<C.uint16.length;P+=3)s.emplaceBack(C.uint16[P],C.uint16[P+1],C.uint16[P+2]);const M=so.simpleSegment(0,w,i.length,s.length-w);c.push({withoutSkirts:S,withSkirts:M})}return{vertices:i,indices:s,segments:c}}_createGrid(e){const n=this._fillGridMeshWithLods(64,Bx);this._gridSegments=n.segments,this._gridBuffer=e.createVertexBuffer(n.vertices,Xl.members),this._gridIndexBuffer=e.createIndexBuffer(n.indices,!0)}_createPoles(e){const n=new Is;for(let f=0;f<=64;f++)n.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=e.createIndexBuffer(n,!0);const i=new _d,s=new _d,c=new _d,d=new _d;this._poleSegments=[];for(let f=0,_=0;f<Tg;f++){const y=360/(1<<f);i.emplaceBack(0,-Ja,0,.5,0),s.emplaceBack(0,-Ja,0,.5,1),c.emplaceBack(0,-Ja,0,.5,.5),d.emplaceBack(0,-Ja,0,.5,.5);for(let v=0;v<=64;v++){let w=v/64,I=0;const C=Er(0,y,w),[S,M,P]=lu(ZT,Qy,C,Ja);i.emplaceBack(S,M,P,w,I),s.emplaceBack(S,M,P,w,1-I);const R=De(C);w=.5+.5*Math.sin(R),I=.5+.5*Math.cos(R),c.emplaceBack(S,M,P,w,I),d.emplaceBack(S,M,P,w,1-I)}this._poleSegments.push(so.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Px,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(s,Px,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(c,Px,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(d,Px,!1)}getGridBuffers(e,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const yf=6371008.8,Pp=2*Math.PI*yf;class ku{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ku(yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,i=this.lat*n,s=e.lat*n,c=Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos((e.lng-this.lng)*n);return yf*Math.acos(Math.min(c,1))}toBounds(e=0){const n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Mc(new ku(this.lng-i,this.lat-n),new ku(this.lng+i,this.lat+n))}toEcef(e){const n=Vx(e);return hc(this.lat,this.lng,Ja+n)}static convert(e){if(e instanceof ku)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ku(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ku(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var kr=ku;const KT=0,Aw=25.5;function Op(t){return Pp*Math.cos(t*Math.PI/180)}function tl(t){return(180+t)/360}function Sa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Zi(t,e){return t/Op(e)}function Oc(t){return 360*t-180}function Gs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function vS(t,e){return t*Op(Gs(e))}const As=85.051129;function Cw(t){return Math.cos(De(_n(t,-As,As)))}function vf(t,e){const n=_n(e,KT,Aw),i=Math.pow(2,n);return Cw(t)*Pp/(512*i)}function XT(t){return 1/Math.cos(t*Math.PI/180)}function $x(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/Vt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Vt/(1<<t.z)}class Ri{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){const i=kr.convert(e);return new Ri(tl(i.lng),Sa(i.lat),Zi(n,i.lat))}toLngLat(){return new kr(Oc(this.x),Gs(this.y))}toAltitude(){return vS(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Pp*XT(Gs(this.y))}}function QT(t,e,n,i,s,c,d,f,_){const y=(e+i)/2,v=(n+s)/2,w=new me(y,v);f(w),function(I,C,S,M,P,R){const z=S-P,G=M-R;return Math.abs((M-C)*z-(S-I)*G)/Math.hypot(z,G)}(w.x,w.y,c.x,c.y,d.x,d.y)>=_?(QT(t,e,n,y,v,c,w,f,_),QT(t,y,v,i,s,w,d,f,_)):t.push(d)}function jx(t,e,n){let i=t[0],s=i.x,c=i.y;e(i);const d=[i];for(let f=1;f<t.length;f++){const _=t[f],{x:y,y:v}=_;e(_),QT(d,s,c,y,v,i,_,e,n),s=y,c=v,i=_}return d}function Gx(t,e,n,i){if(i(e,n)){const s=e.add(n)._mult(.5);Gx(t,e,s,i),Gx(t,s,n,i)}else t.push(n)}function UD(t,e){let n=t[0];const i=[n];for(let s=1;s<t.length;s++){const c=t[s];Gx(i,n,c,e),n=c}return i}const Sw=Math.pow(2,14)-1,Dw=-Sw-1;function Mw(t,e){const n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=_n(n,Dw,Sw),t.y=_n(i,Dw,Sw),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&Me("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function bh(t,e,n){const i=t.loadGeometry(),s=t.extent,c=Vt/s;if(e&&n&&n.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:f,x:_,y,projection:v}=n,w=I=>{const C=Oc((e.x+I.x/s)/d),S=Gs((e.y+I.y/s)/d),M=v.project(C,S);I.x=(M.x*f-_)*s,I.y=(M.y*f-y)*s};for(let I=0;I<i.length;I++)if(1!==t.type)i[I]=jx(i[I],w,1);else{const C=[];for(const S of i[I])S.x<0||S.x>=s||S.y<0||S.y>=s||(w(S),C.push(S));i[I]=C}}for(const d of i)for(const f of d)Mw(f,c);return i}function xf(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?bh(t):[]}}function Rw(t,e,n,i,s){t.emplaceBack(2*e+(i+1)/2,2*n+(s+1)/2)}function Hx(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class xS{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vl,this.indexArray=new Is,this.segments=new so,this.programConfigurations=new cg(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,s){const c=this.layers[0],d=[];let f=null;"circle"===c.type&&(f=c.layout.get("circle-sort-key"));for(const{feature:y,id:v,index:w,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,S=xf(y,C);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),S,i))continue;const M=f?f.evaluate(S,{},i):void 0,P={id:v,properties:y.properties,type:y.type,sourceLayerIndex:I,index:w,geometry:C?S.geometry:bh(y,i,s),patterns:{},sortKey:M};d.push(P)}f&&d.sort((y,v)=>y.sortKey-v.sortKey);let _=null;"globe"===s.projection.name&&(this.globeExtVertexArray=new md,_=s.projection);for(const y of d){const{geometry:v,index:w,sourceLayerIndex:I}=y,C=e[w].feature;this.addFeature(y,v,w,n.availableImages,i,_,n.brightness),n.featureIndex.insert(C,v,w,I,this.index)}}update(e,n,i,s,c){const d=0!==Object.keys(e).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,i,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,s,c,d,f){for(const _ of n)for(const y of _){const v=y.x,w=y.y;if(v<0||v>=Vt||w<0||w>=Vt)continue;if(d){const S=d.projectTilePoint(v,w,c),M=d.upVector(c,v,w),P=this.globeExtVertexArray;Hx(P,S,M),Hx(P,S,M),Hx(P,S,M),Hx(P,S,M)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=I.vertexLength;Rw(this.layoutVertexArray,v,w,-1,-1),Rw(this.layoutVertexArray,v,w,1,-1),Rw(this.layoutVertexArray,v,w,1,1),Rw(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},s,c,f)}}function bS(t,e){for(let n=0;n<t.length;n++)if(kp(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(kp(t,e[n]))return!0;return!!Sg(t,e)}function Pw(t,e,n){return!!kp(t,e)||!!Ow(e,t,n)}function wS(t,e){if(1===t.length)return IS(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let s=0;s<i.length;s++)if(kp(t,i[s]))return!0}for(let n=0;n<t.length;n++)if(IS(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Sg(t,e[n]))return!0;return!1}function Jy(t,e,n){if(t.length>1){if(Sg(t,e))return!0;for(let i=0;i<e.length;i++)if(Ow(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Ow(t[i],e,n))return!0;return!1}function Sg(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],s=t[n+1];for(let c=0;c<e.length-1;c++)if($D(i,s,e[c],e[c+1]))return!0}return!1}function $D(t,e,n,i){return Bt(t,n,i)!==Bt(e,n,i)&&Bt(t,e,n)!==Bt(t,e,i)}function Ow(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let s=1;s<e.length;s++)if(ES(t,e[s-1],e[s])<i)return!0;return!1}function ES(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(s<0?e:s>1?n:n.sub(e)._mult(s)._add(e))}function IS(t,e){let n,i,s,c=!1;for(let d=0;d<t.length;d++){n=t[d];for(let f=0,_=n.length-1;f<n.length;_=f++)i=n[f],s=n[_],i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(c=!c)}return c}function kp(t,e){let n=!1;for(let i=0,s=t.length-1;i<t.length;s=i++){const c=t[i],d=t[s];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(n=!n)}return n}function kw(t,e,n,i,s){for(const d of t)if(e<=d.x&&n<=d.y&&i>=d.x&&s>=d.y)return!0;const c=[new me(e,n),new me(e,s),new me(i,s),new me(i,n)];if(t.length>2)for(const d of c)if(kp(t,d))return!0;for(let d=0;d<t.length-1;d++)if(fM(t[d],t[d+1],c))return!0;return!1}function fM(t,e,n){const i=n[0],s=n[2];if(t.x<i.x&&e.x<i.x||t.x>s.x&&e.x>s.x||t.y<i.y&&e.y<i.y||t.y>s.y&&e.y>s.y)return!1;const c=Bt(t,e,n[0]);return c!==Bt(t,e,n[1])||c!==Bt(t,e,n[2])||c!==Bt(t,e,n[3])}function Wx(t,e,n,i,s,c){let d=e.y-t.y,f=t.x-e.x;if(c=c||0){const _=d*d+f*f;if(0===_)return!0;const y=Math.sqrt(_);d/=y,f/=y}return!((n.x-t.x)*d+(n.y-t.y)*f-c<0||(i.x-t.x)*d+(i.y-t.y)*f-c<0||(s.x-t.x)*d+(s.y-t.y)*f-c<0)}function JT(t,e,n,i,s,c,d){return!(Wx(t,e,i,s,c,d)||Wx(e,n,i,s,c,d)||Wx(n,t,i,s,c,d)||Wx(i,s,t,e,n,d)||Wx(s,c,t,e,n,d)||Wx(c,i,t,e,n,d))}function zl(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Ar(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Lw(t,e,n,i,s){if(!e[0]&&!e[1])return t;const c=me.convert(e)._mult(s);"viewport"===n&&c._rotate(-i);const d=[];for(let f=0;f<t.length;f++)d.push(t[f].sub(c));return d}function Di(t,e,n,i){const s=me.convert(t)._mult(i);return"viewport"===e&&s._rotate(-n),s}lr(xS,"CircleBucket",{omit:["layers"]});const qx=new gs({"circle-sort-key":new Ir(ut.layout_circle["circle-sort-key"]),visibility:new On(ut.layout_circle.visibility)});var ev={paint:new gs({"circle-radius":new Ir(ut.paint_circle["circle-radius"]),"circle-color":new Ir(ut.paint_circle["circle-color"]),"circle-blur":new Ir(ut.paint_circle["circle-blur"]),"circle-opacity":new Ir(ut.paint_circle["circle-opacity"]),"circle-translate":new On(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new On(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ir(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ir(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ir(ut.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new On(ut.paint_circle["circle-emissive-strength"])}),layout:qx};const Nw=Dt.create(),Yx=(t,e,n,i,s,c)=>{const d=t.transform,f="globe"===d.projection.name;let _;if("map"===c.paint.get("circle-pitch-alignment"))if(f){const v=yS(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;_=Float32Array.from([v,0,0,v])}else _=d.calculatePixelsToTileUnitsMatrix(n);else _=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const y={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(d.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ne.devicePixelRatio,u_extrude_scale:_,u_inv_rot_matrix:Nw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(f){y.u_inv_rot_matrix=i,y.u_merc_center=s,y.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],y.u_zoom_transition=el(d.zoom);const v=s[0]*Vt,w=s[1]*Vt;y.u_up_dir=d.projection.upVector(new vh(0,0,0),v,w)}return y},eA=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function tA(t,e,n,i,s,c,d,f,_){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(_*=t.pixelToTileUnitsFactor);const y=t.tileID.canonical,v=n.projection.upVectorScale(y,n.center.lat,n.worldSize).metersToTile;for(const w of e)for(const I of w){const C=I.add(f),S=s&&n.elevation?n.elevation.exaggeration()*s.getElevationAt(C.x,C.y,!0):0,M=n.projection.projectTilePoint(C.x,C.y,y);if(S>0){const G=n.projection.upVector(y,C.x,C.y);M.x+=G[0]*v*S,M.y+=G[1]*v*S,M.z+=G[2]*v*S}const P=c?C:TS(M.x,M.y,M.z,i),R=c?t.tilespaceRays.map(G=>Na(G,S)):t.queryGeometry.screenGeometry,z=no.transformMat4([],[M.x,M.y,M.z,1],i);if(!d&&c?_*=z[3]/n.cameraToCenterDistance:d&&!c&&(_*=n.cameraToCenterDistance/z[3]),c){const G=Gs((I.y/Vt+y.y)/(1<<y.z));_/=n.projection.pixelsPerMeter(G,1)/Zi(1,G)}if(Pw(R,P,_))return!0}return!1}function TS(t,e,n,i){const s=no.transformMat4([],[t,e,n,1],i);return new me(s[0]/s[3],s[1]/s[3])}const xl=He.fromValues(0,0,0),tv=He.fromValues(0,0,1);function Na(t,e){const n=He.create();return xl[2]=e,t.intersectsPlane(xl,tv,n),new me(n[0],n[1])}class Id extends xS{}function nA(t,{width:e,height:n},i,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*n*i)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=s,t}function Fw(t,e,n){const{width:i,height:s}=e;i===t.width&&s===t.height||(Dg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,s)},n),t.width=i,t.height=s,t.data=e.data)}function Dg(t,e,n,i,s,c){if(0===s.width||0===s.height)return e;if(s.width>t.width||s.height>t.height||n.x>t.width-s.width||n.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||i.x>e.width-s.width||i.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const d=t.data,f=e.data;for(let _=0;_<s.height;_++){const y=((n.y+_)*t.width+n.x)*c,v=((i.y+_)*e.width+i.x)*c;for(let w=0;w<s.width*c;w++)f[v+w]=d[y+w]}return e}lr(Id,"HeatmapBucket",{omit:["layers"]});class cu{constructor(e,n){nA(this,e,1,n)}resize(e){Fw(this,new cu(e),1)}clone(){return new cu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,s,c){Dg(e,n,i,s,c,1)}}class Ki{constructor(e,n){nA(this,e,4,n)}resize(e){Fw(this,new Ki(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ki({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,s,c){Dg(e,n,i,s,c,4)}}class Bw{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}lr(cu,"AlphaImage"),lr(Ki,"RGBAImage");const Lp=new gs({visibility:new On(ut.layout_heatmap.visibility)});var Zx={paint:new gs({"heatmap-radius":new Ir(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ir(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xp(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(ut.paint_heatmap["heatmap-opacity"])}),layout:Lp};function bl(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,s=t.image||new Ki({width:n,height:i}),c=(d,f,_)=>{e[t.evaluationKey]=_;const y=t.expression.evaluate(e);y&&(s.data[d+f+0]=Math.floor(255*y.r/y.a),s.data[d+f+1]=Math.floor(255*y.g/y.a),s.data[d+f+2]=Math.floor(255*y.b/y.a),s.data[d+f+3]=Math.floor(255*y.a))};if(t.clips)for(let d=0,f=0;d<i;++d,f+=4*n)for(let _=0,y=0;_<n;_++,y+=4){const v=_/(n-1),{start:w,end:I}=t.clips[d];c(f,y,w*(1-v)+I*v)}else for(let d=0,f=0;d<n;d++,f+=4)c(0,f,d/(n-1));return s}const Kx=new gs({visibility:new On(ut.layout_hillshade.visibility)});var rA={paint:new gs({"hillshade-illumination-direction":new On(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(ut.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new On(ut.paint_hillshade["hillshade-emissive-strength"])}),layout:Kx};const AS=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mg}=AS;var Xx={exports:{}};function Rg(t,e,n){n=n||2;var i,s,c,d,f,_,y,v=e&&e.length,w=v?e[0]*n:t.length,I=Qx(t,0,w,n,!0),C=[];if(!I||I.next===I.prev)return C;if(v&&(I=function(M,P,R,z){var G,H,j,W=[];for(G=0,H=P.length;G<H;G++)(j=Qx(M,P[G]*z,G<H-1?P[G+1]*z:M.length,z,!1))===j.next&&(j.steiner=!0),W.push(SS(j));for(W.sort(tb),G=0;G<W.length;G++)R=iA(W[G],R);return R}(t,e,I,n)),t.length>80*n){i=c=t[0],s=d=t[1];for(var S=n;S<w;S+=n)(f=t[S])<i&&(i=f),(_=t[S+1])<s&&(s=_),f>c&&(c=f),_>d&&(d=_);y=0!==(y=Math.max(c-i,d-s))?32767/y:0}return bf(I,C,n,i,s,y,0),C}function Qx(t,e,n,i,s){var c,d;if(s===Fg(t,e,n,i)>0)for(c=e;c<n;c+=i)d=Ng(c,t[c],t[c+1],d);else for(c=n-i;c>=e;c-=i)d=Ng(c,t[c],t[c+1],d);return d&&kg(d,d.next)&&(wf(d),d=d.next),d}function Pg(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!kg(i,i.next)&&0!==Xs(i.prev,i,i.next))i=i.next;else{if(wf(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function bf(t,e,n,i,s,c,d){if(t){!d&&c&&function(v,w,I,C){var S=v;do{0===S.z&&(S.z=Np(S.x,S.y,w,I,C)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next}while(S!==v);S.prevZ.nextZ=null,S.prevZ=null,function(M){var P,R,z,G,H,j,W,oe,pe=1;do{for(R=M,M=null,H=null,j=0;R;){for(j++,z=R,W=0,P=0;P<pe&&(W++,z=z.nextZ);P++);for(oe=pe;W>0||oe>0&&z;)0!==W&&(0===oe||!z||R.z<=z.z)?(G=R,R=R.nextZ,W--):(G=z,z=z.nextZ,oe--),H?H.nextZ=G:M=G,G.prevZ=H,H=G;R=z}H.nextZ=null,pe*=2}while(j>1)}(S)}(t,i,s,c);for(var f,_,y=t;t.prev!==t.next;)if(f=t.prev,_=t.next,c?Jx(t,i,s,c):Td(t))e.push(f.i/n|0),e.push(t.i/n|0),e.push(_.i/n|0),wf(t),t=_.next,y=_.next;else if((t=_)===y){d?1===d?bf(t=Og(Pg(t),e,n),e,n,i,s,c,2):2===d&&eb(t,e,n,i,s,c):bf(Pg(t),e,n,i,s,c,1);break}}}function Td(t){var e=t.prev,n=t,i=t.next;if(Xs(e,n,i)>=0)return!1;for(var s=e.x,c=n.x,d=i.x,f=e.y,_=n.y,y=i.y,v=s<c?s<d?s:d:c<d?c:d,w=f<_?f<y?f:y:_<y?_:y,I=s>c?s>d?s:d:c>d?c:d,C=f>_?f>y?f:y:_>y?_:y,S=i.next;S!==e;){if(S.x>=v&&S.x<=I&&S.y>=w&&S.y<=C&&Lu(s,f,c,_,d,y,S.x,S.y)&&Xs(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function Jx(t,e,n,i){var s=t.prev,c=t,d=t.next;if(Xs(s,c,d)>=0)return!1;for(var f=s.x,_=c.x,y=d.x,v=s.y,w=c.y,I=d.y,C=f<_?f<y?f:y:_<y?_:y,S=v<w?v<I?v:I:w<I?w:I,M=f>_?f>y?f:y:_>y?_:y,P=v>w?v>I?v:I:w>I?w:I,R=Np(C,S,e,n,i),z=Np(M,P,e,n,i),G=t.prevZ,H=t.nextZ;G&&G.z>=R&&H&&H.z<=z;){if(G.x>=C&&G.x<=M&&G.y>=S&&G.y<=P&&G!==s&&G!==d&&Lu(f,v,_,w,y,I,G.x,G.y)&&Xs(G.prev,G,G.next)>=0||(G=G.prevZ,H.x>=C&&H.x<=M&&H.y>=S&&H.y<=P&&H!==s&&H!==d&&Lu(f,v,_,w,y,I,H.x,H.y)&&Xs(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;G&&G.z>=R;){if(G.x>=C&&G.x<=M&&G.y>=S&&G.y<=P&&G!==s&&G!==d&&Lu(f,v,_,w,y,I,G.x,G.y)&&Xs(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;H&&H.z<=z;){if(H.x>=C&&H.x<=M&&H.y>=S&&H.y<=P&&H!==s&&H!==d&&Lu(f,v,_,w,y,I,H.x,H.y)&&Xs(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function Og(t,e,n){var i=t;do{var s=i.prev,c=i.next.next;!kg(s,c)&&Vw(s,i,i.next,c)&&rv(s,c)&&rv(c,s)&&(e.push(s.i/n|0),e.push(i.i/n|0),e.push(c.i/n|0),wf(i),wf(i.next),i=t=c),i=i.next}while(i!==t);return Pg(i)}function eb(t,e,n,i,s,c){var d=t;do{for(var f=d.next.next;f!==d.prev;){if(d.i!==f.i&&jD(d,f)){var _=Ni(d,f);return d=Pg(d,d.next),_=Pg(_,_.next),bf(d,e,n,i,s,c,0),void bf(_,e,n,i,s,c,0)}f=f.next}d=d.next}while(d!==t)}function tb(t,e){return t.x-e.x}function iA(t,e){var n=function(s,c){var d,f=c,_=s.x,y=s.y,v=-1/0;do{if(y<=f.y&&y>=f.next.y&&f.next.y!==f.y){var w=f.x+(y-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(w<=_&&w>v&&(v=w,d=f.x<f.next.x?f:f.next,w===_))return d}f=f.next}while(f!==c);if(!d)return null;var I,C=d,S=d.x,M=d.y,P=1/0;f=d;do{_>=f.x&&f.x>=S&&_!==f.x&&Lu(y<M?_:v,y,S,M,y<M?v:_,y,f.x,f.y)&&(I=Math.abs(y-f.y)/(_-f.x),rv(f,s)&&(I<P||I===P&&(f.x>d.x||f.x===d.x&&CS(d,f)))&&(d=f,P=I)),f=f.next}while(f!==C);return d}(t,e);if(!n)return e;var i=Ni(n,t);return Pg(i,i.next),Pg(n,n.next)}function CS(t,e){return Xs(t.prev,t,e.prev)<0&&Xs(e.next,t,t.next)<0}function Np(t,e,n,i,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function SS(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Lu(t,e,n,i,s,c,d,f){return(s-d)*(e-f)>=(t-d)*(c-f)&&(t-d)*(i-f)>=(n-d)*(e-f)&&(n-d)*(c-f)>=(s-d)*(i-f)}function jD(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){var s=n;do{if(s.i!==n.i&&s.next.i!==n.i&&s.i!==i.i&&s.next.i!==i.i&&Vw(s,s.next,n,i))return!0;s=s.next}while(s!==n);return!1}(t,e)&&(rv(t,e)&&rv(e,t)&&function(n,i){var s=n,c=!1,d=(n.x+i.x)/2,f=(n.y+i.y)/2;do{s.y>f!=s.next.y>f&&s.next.y!==s.y&&d<(s.next.x-s.x)*(f-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next}while(s!==n);return c}(t,e)&&(Xs(t.prev,t,e.prev)||Xs(t,e.prev,e))||kg(t,e)&&Xs(t.prev,t,t.next)>0&&Xs(e.prev,e,e.next)>0)}function Xs(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function kg(t,e){return t.x===e.x&&t.y===e.y}function Vw(t,e,n,i){var s=Lg(Xs(t,e,n)),c=Lg(Xs(t,e,i)),d=Lg(Xs(n,i,t)),f=Lg(Xs(n,i,e));return s!==c&&d!==f||!(0!==s||!nv(t,n,e))||!(0!==c||!nv(t,i,e))||!(0!==d||!nv(n,t,i))||!(0!==f||!nv(n,e,i))}function nv(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Lg(t){return t>0?1:t<0?-1:0}function rv(t,e){return Xs(t.prev,t,t.next)<0?Xs(t,e,t.next)>=0&&Xs(t,t.prev,e)>=0:Xs(t,e,t.prev)<0||Xs(t,t.next,e)<0}function Ni(t,e){var n=new Ad(t.i,t.x,t.y),i=new Ad(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,c.next=i,i.prev=c,i}function Ng(t,e,n,i){var s=new Ad(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function wf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ad(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fg(t,e,n,i){for(var s=0,c=e,d=n-i;c<n;c+=i)s+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return s}Xx.exports=Rg,Xx.exports.default=Rg,Rg.deviation=function(t,e,n,i){var s=e&&e.length,c=Math.abs(Fg(t,0,s?e[0]*n:t.length,n));if(s)for(var d=0,f=e.length;d<f;d++)c-=Math.abs(Fg(t,e[d]*n,d<f-1?e[d+1]*n:t.length,n));var _=0;for(d=0;d<i.length;d+=3){var y=i[d]*n,v=i[d+1]*n,w=i[d+2]*n;_+=Math.abs((t[y]-t[w])*(t[v+1]-t[y+1])-(t[y]-t[v])*(t[w+1]-t[y+1]))}return 0===c&&0===_?0:Math.abs((_-c)/c)},Rg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var d=0;d<e;d++)n.vertices.push(t[s][c][d]);s>0&&n.holes.push(i+=t[s-1].length)}return n};var Bg=Jt(Xx.exports);function Fp(t,e){const n=t.length;if(n<=1)return[t];const i=[];let s,c;for(let d=0;d<n;d++){const f=zt(t[d]);0!==f&&(t[d].area=Math.abs(f),void 0===c&&(c=f<0),c===f<0?(s&&i.push(s),s=[t[d]]):s.push(t[d]))}if(s&&i.push(s),e>1)for(let d=0;d<i.length;d++)i[d].length<=e||(ta(i[d],e,1,i[d].length-1,Bp),i[d]=i[d].slice(0,e));return i}function Bp(t,e){return e.area-t.area}function iv(t,e,n){const i=n.patternDependencies;let s=!1;for(const c of e){const d=c.paint.get(`${t}-pattern`);d.isConstant()||(s=!0);const f=d.constantOr(null);f&&(s=!0,i[f]=!0)}return s}function Ef(t,e,n,i,s){const c=s.patternDependencies;for(const d of e){const f=d.paint.get(`${t}-pattern`).value;if("constant"!==f.kind){let _=f.evaluate({zoom:i},n,{},s.availableImages);_=_&&_.name?_.name:_,c[_]=!0,n.patterns[d.id]=_}}return n}class Vg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vl,this.indexArray=new Is,this.indexArray2=new gd,this.programConfigurations=new cg(e.layers,e.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,i,s){this.hasPattern=iv("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:f,id:_,index:y,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,I=xf(f,w);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),I,i))continue;const C=c?c.evaluate(I,{},i,n.availableImages):void 0,S={id:_,properties:f.properties,type:f.type,sourceLayerIndex:v,index:y,geometry:w?I.geometry:bh(f,i,s),patterns:{},sortKey:C};d.push(S)}c&&d.sort((f,_)=>f.sortKey-_.sortKey);for(const f of d){const{geometry:_,index:y,sourceLayerIndex:v}=f;if(this.hasPattern){const w=Ef("fill",this.layers,f,this.zoom,n);this.patternFeatures.push(w)}else this.addFeature(f,_,y,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[y].feature,_,y,v,this.index)}}update(e,n,i,s,c){const d=0!==Object.keys(e).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,i,s,c)}addFeatures(e,n,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,i,s,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,s,c,d=[],f){for(const _ of Fp(n,500)){let y=0;for(const M of _)y+=M.length;const v=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),w=v.vertexLength,I=[],C=[];for(const M of _){if(0===M.length)continue;M!==_[0]&&C.push(I.length/2);const P=this.segments2.prepareSegment(M.length,this.layoutVertexArray,this.indexArray2),R=P.vertexLength;this.layoutVertexArray.emplaceBack(M[0].x,M[0].y),this.indexArray2.emplaceBack(R+M.length-1,R),I.push(M[0].x),I.push(M[0].y);for(let z=1;z<M.length;z++)this.layoutVertexArray.emplaceBack(M[z].x,M[z].y),this.indexArray2.emplaceBack(R+z-1,R+z),I.push(M[z].x),I.push(M[z].y);P.vertexLength+=M.length,P.primitiveLength+=M.length}const S=Bg(I,C);for(let M=0;M<S.length;M+=3)this.indexArray.emplaceBack(w+S[M],w+S[M+1],w+S[M+2]);v.vertexLength+=y,v.primitiveLength+=S.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,c,d,s,f)}}lr(Vg,"FillBucket",{omit:["layers","patternFeatures"]});const ov=new gs({"fill-sort-key":new Ir(ut.layout_fill["fill-sort-key"]),visibility:new On(ut.layout_fill.visibility)});var nb={paint:new gs({"fill-antialias":new On(ut.paint_fill["fill-antialias"]),"fill-opacity":new Ir(ut.paint_fill["fill-opacity"]),"fill-color":new Ir(ut.paint_fill["fill-color"]),"fill-outline-color":new Ir(ut.paint_fill["fill-outline-color"]),"fill-translate":new On(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new On(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ir(ut.paint_fill["fill-pattern"]),"fill-emissive-strength":new On(ut.paint_fill["fill-emissive-strength"])}),layout:ov};const zw=Gi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),rb=Gi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),sv=Gi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Uw=Gi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nl=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:wl}=zw;var If={},$w=hn,oA=zg;function zg(t,e,n,i,s){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=s,t.readFields(DS,this,e)}function DS(t,e,n){1==t?e.id=n.readVarint():2==t?function(i,s){for(var c=i.readVarint()+i.pos;i.pos<c;){var d=s._keys[i.readVarint()],f=s._values[i.readVarint()];s.properties[d]=f}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function jw(t){for(var e,n,i=0,s=0,c=t.length,d=c-1;s<c;d=s++)i+=((n=t[d]).x-(e=t[s]).x)*(e.y+n.y);return i}zg.types=["Unknown","Point","LineString","Polygon"],zg.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,s=0,c=0,d=0,f=[];t.pos<n;){if(s<=0){var _=t.readVarint();i=7&_,s=_>>3}if(s--,1===i||2===i)c+=t.readSVarint(),d+=t.readSVarint(),1===i&&(e&&f.push(e),e=[]),e.push(new $w(c,d));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&f.push(e),f},zg.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,s=0,c=0,d=1/0,f=-1/0,_=1/0,y=-1/0;t.pos<e;){if(i<=0){var v=t.readVarint();n=7&v,i=v>>3}if(i--,1===n||2===n)(s+=t.readSVarint())<d&&(d=s),s>f&&(f=s),(c+=t.readSVarint())<_&&(_=c),c>y&&(y=c);else if(7!==n)throw new Error("unknown command "+n)}return[d,_,f,y]},zg.prototype.toGeoJSON=function(t,e,n){var i,s,c=this.extent*Math.pow(2,n),d=this.extent*t,f=this.extent*e,_=this.loadGeometry(),y=zg.types[this.type];function v(C){for(var S=0;S<C.length;S++){var M=C[S];C[S]=[360*(M.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(M.y+f)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var w=[];for(i=0;i<_.length;i++)w[i]=_[i][0];v(_=w);break;case 2:for(i=0;i<_.length;i++)v(_[i]);break;case 3:for(_=function(C){var S=C.length;if(S<=1)return[C];for(var M,P,R=[],z=0;z<S;z++){var G=jw(C[z]);0!==G&&(void 0===P&&(P=G<0),P===G<0?(M&&R.push(M),M=[C[z]]):M.push(C[z]))}return M&&R.push(M),R}(_),i=0;i<_.length;i++)for(s=0;s<_[i].length;s++)v(_[i][s])}1===_.length?_=_[0]:y="Multi"+y;var I={type:"Feature",geometry:{type:y,coordinates:_},properties:this.properties};return"id"in this&&(I.id=this.id),I};var sA=oA,aA=lA;function lA(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(El,this,e),this.length=this._features.length}function El(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(i){for(var s=null,c=i.readVarint()+i.pos;i.pos<c;){var d=i.readVarint()>>3;s=1===d?i.readString():2===d?i.readFloat():3===d?i.readDouble():4===d?i.readVarint64():5===d?i.readVarint():6===d?i.readSVarint():7===d?i.readBoolean():null}return s}(n))}lA.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sA(this._pbf,e,this.extent,this._keys,this._values)};var av=aA;function Gw(t,e,n){if(3===t){var i=new av(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var Hw=If.VectorTile=function(t,e){this.layers=t.readFields(Gw,{},e)},Ug=If.VectorTileFeature=oA;function Tf(t,e,n,i){const s=[],c=0===i?(d,f,_,y,v,w)=>{d.push(new me(w,_+(w-f)/(y-f)*(v-_)))}:(d,f,_,y,v,w)=>{d.push(new me(f+(w-_)/(v-_)*(y-f),w))};for(const d of t){const f=[];for(const _ of d){if(_.length<=2)continue;const y=[];for(let I=0;I<_.length-1;I++){const C=_[I].x,S=_[I].y,M=_[I+1].x,P=_[I+1].y,R=0===i?C:S,z=0===i?M:P;R<e?z>e&&c(y,C,S,M,P,e):R>n?z<n&&c(y,C,S,M,P,n):y.push(_[I]),z<e&&R>=e&&c(y,C,S,M,P,e),z>n&&R<=n&&c(y,C,S,M,P,n)}let v=_[_.length-1];const w=0===i?v.x:v.y;w>=e&&w<=n&&y.push(v),y.length&&(v=y[y.length-1],y[0].x===v.x&&y[0].y===v.y||y.push(y[0]),f.push(y))}f.length&&s.push(f)}return s}If.VectorTileLayer=aA;class ib{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Ww={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,n,i,s){var c,d,f=8*s-i-1,_=(1<<f)-1,y=_>>1,v=-7,w=n?s-1:0,I=n?-1:1,C=t[e+w];for(w+=I,c=C&(1<<-v)-1,C>>=-v,v+=f;v>0;c=256*c+t[e+w],w+=I,v-=8);for(d=c&(1<<-v)-1,c>>=-v,v+=i;v>0;d=256*d+t[e+w],w+=I,v-=8);if(0===c)c=1-y;else{if(c===_)return d?NaN:1/0*(C?-1:1);d+=Math.pow(2,i),c-=y}return(C?-1:1)*d*Math.pow(2,c-i)},write:function(t,e,n,i,s,c){var d,f,_,y=8*c-s-1,v=(1<<y)-1,w=v>>1,I=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,C=i?0:c-1,S=i?1:-1,M=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,d=v):(d=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-d))<1&&(d--,_*=2),(e+=d+w>=1?I/_:I*Math.pow(2,1-w))*_>=2&&(d++,_/=2),d+w>=v?(f=0,d=v):d+w>=1?(f=(e*_-1)*Math.pow(2,s),d+=w):(f=e*Math.pow(2,w-1)*Math.pow(2,s),d=0));s>=8;t[n+C]=255&f,C+=S,f/=256,s-=8);for(d=d<<s|f,y+=s;y>0;t[n+C]=255&d,C+=S,d/=256,y-=8);t[n+C-S]|=128*M}},qw=wo,lv=Ww;function wo(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}wo.Varint=0,wo.Fixed64=1,wo.Bytes=2,wo.Fixed32=5;var ob=4294967296,cv=1/ob,Yw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function uu(t){return t.type===wo.Bytes?t.readVarint()+t.pos:t.pos+1}function cA(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var s=n.pos-1;s>=t;s--)n.buf[s+i]=n.buf[s]}function jg(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Cd(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Zw(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Vp(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Kw(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function sb(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Xw(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Gg(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function uv(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Da(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Hg(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function zp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}wo.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),s=i>>3,c=this.pos;this.type=7&i,t(s,e,this),this.pos===c&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Da(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=zp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Da(this.buf,this.pos)+Da(this.buf,this.pos+4)*ob;return this.pos+=8,t},readSFixed64:function(){var t=Da(this.buf,this.pos)+zp(this.buf,this.pos+4)*ob;return this.pos+=8,t},readFloat:function(){var t=lv.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=lv.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(s,c,d){var f,_,y=d.buf;if(f=(112&(_=y[d.pos++]))>>4,_<128||(f|=(127&(_=y[d.pos++]))<<3,_<128)||(f|=(127&(_=y[d.pos++]))<<10,_<128)||(f|=(127&(_=y[d.pos++]))<<17,_<128)||(f|=(127&(_=y[d.pos++]))<<24,_<128)||(f|=(1&(_=y[d.pos++]))<<31,_<128))return function $g(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(s,f,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Yw?Yw.decode(this.buf.subarray(e,t)):function(n,i,s){for(var c="",d=i;d<s;){var f,_,y,v=n[d],w=null,I=v>239?4:v>223?3:v>191?2:1;if(d+I>s)break;1===I?v<128&&(w=v):2===I?128==(192&(f=n[d+1]))&&(w=(31&v)<<6|63&f)<=127&&(w=null):3===I?(_=n[d+2],128==(192&(f=n[d+1]))&&128==(192&_)&&((w=(15&v)<<12|(63&f)<<6|63&_)<=2047||w>=55296&&w<=57343)&&(w=null)):4===I&&(_=n[d+2],y=n[d+3],128==(192&(f=n[d+1]))&&128==(192&_)&&128==(192&y)&&((w=(15&v)<<18|(63&f)<<12|(63&_)<<6|63&y)<=65535||w>=1114112)&&(w=null)),null===w?(w=65533,I=1):w>65535&&(w-=65536,c+=String.fromCharCode(w>>>10&1023|55296),w=56320|1023&w),c+=String.fromCharCode(w),d+=I}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==wo.Bytes)return t.push(this.readVarint(e));var n=uu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==wo.Bytes)return t.push(this.readSVarint());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==wo.Bytes)return t.push(this.readBoolean());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==wo.Bytes)return t.push(this.readFloat());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==wo.Bytes)return t.push(this.readDouble());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==wo.Bytes)return t.push(this.readFixed32());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==wo.Bytes)return t.push(this.readSFixed32());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==wo.Bytes)return t.push(this.readFixed64());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==wo.Bytes)return t.push(this.readSFixed64());var e=uu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===wo.Varint)for(;this.buf[this.pos++]>127;);else if(e===wo.Bytes)this.pos=this.readVarint()+this.pos;else if(e===wo.Fixed32)this.pos+=4;else{if(e!==wo.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Hg(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Hg(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Hg(this.buf,-1&t,this.pos),Hg(this.buf,Math.floor(t*cv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Hg(this.buf,-1&t,this.pos),Hg(this.buf,Math.floor(t*cv),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,s,c,f;if(e>=0?(i=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,s=s+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),c=i,(f=n).buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,f.buf[f.pos]=127&(c>>>=7),function(c,d){var f=(7&c)<<4;d.buf[d.pos++]|=f|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(s,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,s,c){for(var d,f,_=0;_<s.length;_++){if((d=s.charCodeAt(_))>55295&&d<57344){if(!f){d>56319||_+1===s.length?(i[c++]=239,i[c++]=191,i[c++]=189):f=d;continue}if(d<56320){i[c++]=239,i[c++]=191,i[c++]=189,f=d;continue}d=f-55296<<10|d-56320|65536,f=null}else f&&(i[c++]=239,i[c++]=191,i[c++]=189,f=null);d<128?i[c++]=d:(d<2048?i[c++]=d>>6|192:(d<65536?i[c++]=d>>12|224:(i[c++]=d>>18|240,i[c++]=d>>12&63|128),i[c++]=d>>6&63|128),i[c++]=63&d|128)}return c}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&cA(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),lv.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lv.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&cA(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,wo.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,jg,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Cd,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Kw,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Zw,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Vp,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,sb,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Xw,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Gg,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,uv,e)},writeBytesField:function(t,e){this.writeTag(t,wo.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,wo.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,wo.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,wo.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,wo.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,wo.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,wo.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,wo.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,wo.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,wo.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Af=Jt(qw);const Qw=["tile","layer","source","sourceLayer","state"];class Up{constructor(e,n,i,s,c){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=s,this.properties=e.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of Qw)void 0!==this[n]&&(e[n]=this[n]);return e}}class ab{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},Ye(this.stateChanges[e][s],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const c in this.state[e])c!==s&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][s]){this.deletedStates[e][s]={};for(const c in this.state[e][s])i[c]||(this.deletedStates[e][s][c]=null)}else for(const c in i)this.deletedStates[e]&&this.deletedStates[e][s]&&null===this.deletedStates[e][s][c]&&delete this.deletedStates[e][s][c]}removeFeatureState(e,n,i){if(null===this.deletedStates[e])return;const s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==n)null!==this.deletedStates[e][s]&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][i]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][s])for(i in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][i]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){const i=String(n),s=Ye({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][n];if(null===c)return{};for(const d in c)delete s[d]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const i={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const c={};for(const d in this.stateChanges[s])this.state[s][d]||(this.state[s][d]={}),Ye(this.state[s][d],this.stateChanges[s][d]),c[d]=this.state[s][d];i[s]=c}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const c={};if(null===this.deletedStates[s])for(const d in this.state[s])c[d]={},this.state[s][d]={};else for(const d in this.deletedStates[s]){if(null===this.deletedStates[s][d])this.state[s][d]={};else if(this.state[s][d])for(const f of Object.keys(this.deletedStates[s][d]))delete this.state[s][d][f];c[d]=this.state[s][d]}i[s]=i[s]||{},Ye(i[s],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const s in e)e[s].setFeatureState(i,n)}}class Nu{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Wg(t,e,n,i){let s=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(i[d])<1e-15){if(n[d]<t[d]||n[d]>e[d])return null}else{const f=1/i[d];let _=(t[d]-n[d])*f,y=(e[d]-n[d])*f;if(_>y){const v=_;_=y,y=v}if(_>s&&(s=_),y<c&&(c=y),s>c)return null}return s}function qg(t,e,n,i,s,c,d,f,_,y,v){const w=i-t,I=s-e,C=c-n,S=d-t,M=f-e,P=_-n,R=v[1]*P-v[2]*M,z=v[2]*S-v[0]*P,G=v[0]*M-v[1]*S,H=w*R+I*z+C*G;if(Math.abs(H)<1e-15)return null;const j=1/H,W=y[0]-t,oe=y[1]-e,pe=y[2]-n,ve=(W*R+oe*z+pe*G)*j;if(ve<0||ve>1)return null;const xe=oe*C-pe*I,ke=pe*w-W*C,Ae=W*I-oe*w,$e=(v[0]*xe+v[1]*ke+v[2]*Ae)*j;return $e<0||ve+$e>1?null:(S*xe+M*ke+P*Ae)*j}function lb(t,e,n){return(t-e)/(n-e)}function Jw(t,e,n,i,s,c,d,f,_){const y=1<<n,v=c-i,w=d-s,I=(t+1)/y*v+i,C=(e+0)/y*w+s,S=(e+1)/y*w+s;f[0]=(t+0)/y*v+i,f[1]=C,_[0]=I,_[1]=S}class dv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(c){const d=Math.ceil(Math.log2(c.dim/8)),f=[];let _=Math.ceil(Math.pow(2,d));const y=1/_,v=(C,S,M,P,R)=>{const z=P?1:0,G=(C+1)*M-z,H=S*M,j=(S+1)*M-z;R[0]=C*M,R[1]=H,R[2]=G,R[3]=j};let w=new Nu(_);const I=[];for(let C=0;C<_*_;C++){v(C%_,Math.floor(C/_),y,!1,I);const S=Sd(I[0],I[1],c),M=Sd(I[2],I[1],c),P=Sd(I[2],I[3],c),R=Sd(I[0],I[3],c);w.minimums.push(Math.min(S,M,P,R)),w.maximums.push(Math.max(S,M,P,R)),w.leaves.push(1)}for(f.push(w),_/=2;_>=1;_/=2){const C=f[f.length-1];w=new Nu(_);for(let S=0;S<_*_;S++){v(S%_,Math.floor(S/_),2,!0,I);const M=C.getElevation(I[0],I[1]),P=C.getElevation(I[2],I[1]),R=C.getElevation(I[2],I[3]),z=C.getElevation(I[0],I[3]),G=C.isLeaf(I[0],I[1]),H=C.isLeaf(I[2],I[1]),j=C.isLeaf(I[2],I[3]),W=C.isLeaf(I[0],I[3]),oe=Math.min(M.min,P.min,R.min,z.min),pe=Math.max(M.max,P.max,R.max,z.max),ve=G&&H&&j&&W;w.maximums.push(pe),w.minimums.push(oe),w.leaves.push(pe-oe<=5&&ve?1:0)}f.push(w)}return f}(this.dem),i=n.length-1,s=n[i];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,s,c,d,f=1){return Wg([e,n,-100],[i,s,this.maximums[0]*f],c,d)}raycast(e,n,i,s,c,d,f=1){if(!this.nodeCount)return null;const _=this.raycastRoot(e,n,i,s,c,d,f);if(null==_)return null;const y=[],v=[],w=[],I=[],C=[{idx:0,t:_,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:S,t:M,nodex:P,nodey:R,depth:z}=C.pop();if(this.leaves[S]){Jw(P,R,z,e,n,i,s,w,I);const H=1<<z,j=(P+0)/H,W=(P+1)/H,oe=(R+0)/H,pe=(R+1)/H,ve=Sd(j,oe,this.dem)*f,xe=Sd(W,oe,this.dem)*f,ke=Sd(W,pe,this.dem)*f,Ae=Sd(j,pe,this.dem)*f,$e=qg(w[0],w[1],ve,I[0],w[1],xe,I[0],I[1],ke,c,d),Ce=qg(I[0],I[1],ke,w[0],I[1],Ae,w[0],w[1],ve,c,d),nt=Math.min(null!==$e?$e:Number.MAX_VALUE,null!==Ce?Ce:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const ft=He.scaleAndAdd([],c,d,M);if(Yg(ve,xe,Ae,ke,lb(ft[0],w[0],I[0]),lb(ft[1],w[1],I[1]))>=ft[2])return M}continue}let G=0;for(let H=0;H<this._siblingOffset.length;H++){Jw((P<<1)+this._siblingOffset[H][0],(R<<1)+this._siblingOffset[H][1],z+1,e,n,i,s,w,I),w[2]=-100,I[2]=this.maximums[this.childOffsets[S]+H]*f;const j=Wg(w,I,c,d);if(null!=j){const W=j;y[H]=W;let oe=!1;for(let pe=0;pe<G&&!oe;pe++)W>=y[v[pe]]&&(v.splice(pe,0,H),oe=!0);oe||(v[G]=H),G++}}for(let H=0;H<G;H++){const j=v[H];C.push({idx:this.childOffsets[S]+j,t:y[j],nodex:(P<<1)+this._siblingOffset[j][0],nodey:(R<<1)+this._siblingOffset[j][1],depth:z+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,s,c){if(1===e[s].isLeaf(n,i))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=s-1,f=e[d];let _=0,y=0;for(let v=0;v<this._siblingOffset.length;v++){const w=2*n+this._siblingOffset[v][0],I=2*i+this._siblingOffset[v][1],C=f.getElevation(w,I),S=f.isLeaf(w,I),M=this._addNode(C.min,C.max,S);S&&(_|=1<<v),y||(y=M)}for(let v=0;v<this._siblingOffset.length;v++)_&1<<v||this._construct(e,2*n+this._siblingOffset[v][0],2*i+this._siblingOffset[v][1],d,y+v)}}function Yg(t,e,n,i,s,c){return Er(Er(t,n,c),Er(e,i,c),s)}function Sd(t,e,n){const i=n.dim,s=_n(t*i-.5,0,i-1),c=_n(e*i-.5,0,i-1),d=Math.floor(s),f=Math.floor(c),_=Math.min(d+1,i-1),y=Math.min(f+1,i-1);return Yg(n.get(d,f),n.get(_,f),n.get(d,y),n.get(_,y),s-d,c-f)}const uA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function cb(t,e,n){return(256*t*256+256*e+n)/10-1e4}function Zg(t,e,n){return 256*t+e+n/256-32768}class Fu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,s,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return Me(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const d=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=i||"mapbox",this.borderReady=c,this._modifiedForSources={},!c){for(let _=0;_<d;_++)f[this._idx(-1,_)]=f[this._idx(0,_)],f[this._idx(d,_)]=f[this._idx(d-1,_)],f[this._idx(_,-1)]=f[this._idx(_,0)],f[this._idx(_,d)]=f[this._idx(_,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}if(s){const _=new Float32Array(n.data.buffer),y="terrarium"===this.encoding?Zg:cb;for(let v=0;v<f.length;++v){const w=4*v;_[v]=y(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this.encoding="float"}this._timestamp=ne.now()}_buildQuadTree(){this._tree=new dv(this)}get(e,n,i=!1){i&&(e=_n(e,-1,this.dim),n=_n(n,-1,this.dim));const s=this._idx(e,n);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[s];const c=4*s;return("terrarium"===this.encoding?Zg:cb)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}set(e,n,i){const s=this._idx(e,n);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const _=this.floatView[s];return this.floatView[s]=i,i-_}const c=4*s,d=("terrarium"===this.encoding?Zg:cb)(this.pixels[c],this.pixels[c+1],this.pixels[c+2]),f=Fu.pack(i,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[c]=f[0],this.pixels[c+1]=f[1],this.pixels[c+2]=f[2],i-d}static getUnpackVector(e){return uA[e]}get unpackVector(){return uA[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const i=[0,0,0,0],s=Fu.getUnpackVector(n);let c=Math.floor((e+s[3])/s[2]);return i[2]=c%256,c=Math.floor(c/256),i[1]=c%256,c=Math.floor(c/256),i[0]=c,i}getPixels(){return"float"===this.encoding?new Bw({width:this.stride,height:this.stride},this.pixels):new Ki({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=n*this.dim,c=n*this.dim+this.dim,d=i*this.dim,f=i*this.dim+this.dim;switch(n){case-1:s=c-1;break;case 1:c=s+1}switch(i){case-1:d=f-1;break;case 1:f=d+1}const _=-n*this.dim,y=-i*this.dim;for(let v=d;v<f;v++)for(let w=s;w<c;w++){const I=4*this._idx(w,v),C=4*this._idx(w+_,v+y);this.pixels[I+0]=e.pixels[C+0],this.pixels[I+1]=e.pixels[C+1],this.pixels[I+2]=e.pixels[C+2],this.pixels[I+3]=e.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}lr(Fu,"DEMData"),lr(dv,"DemMinMaxQuadTree",{omit:["dem"]});class eE{isDataAvailableAtPoint(e){const n=this._source();if(this.isUsingMockSource()||!n||e.y<0||e.y>1)return!1;const i=n.getSource().maxzoom,s=1<<i,c=Math.floor(e.x),d=Math.floor((e.x-c)*s),f=Math.floor(e.y*s),_=this.findDEMTileFor(new Bi(i,c,i,d,f));return!(!_||!_.dem)}getAtPointOrZero(e,n=0){return this.getAtPoint(e,n)||0}getAtPoint(e,n,i=!0){if(this.isUsingMockSource())return null;null==n&&(n=null);const s=this._source();if(!s||e.y<0||e.y>1)return n;const c=s.getSource().maxzoom,d=1<<c,f=Math.floor(e.x),_=e.x-f,y=new Bi(c,f,c,Math.floor(_*d),Math.floor(e.y*d)),v=this.findDEMTileFor(y);if(!v||!v.dem)return n;const w=v.dem,I=1<<v.tileID.canonical.z,C=(_*I-v.tileID.canonical.x)*w.dim,S=(e.y*I-v.tileID.canonical.y)*w.dim,M=Math.floor(C),P=Math.floor(S);return(i?this.exaggeration():1)*Er(Er(w.get(M,P),w.get(M,P+1),S-P),Er(w.get(M+1,P),w.get(M+1,P+1),S-P),C-M)}getAtTileOffset(e,n,i){const s=1<<e.canonical.z;return this.getAtPointOrZero(new Ri(e.wrap+(e.canonical.x+n/Vt)/s,(e.canonical.y+i/Vt)/s))}getAtTileOffsetFunc(e,n,i,s){return c=>{const d=this.getAtTileOffset(e,c.x,c.y),f=s.upVector(e.canonical,c.x,c.y),_=s.upVectorScale(e.canonical,n,i).metersToTile;return He.scale(f,f,d*_),f}}getForTilePoints(e,n,i,s){if(this.isUsingMockSource())return!1;const c=Bu.create(this,e,s);return!!c&&(n.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(e);if(!n||!n.dem)return null;const i=n.dem.tree,s=n.tileID,c=1<<e.canonical.z-s.canonical.z;let d=e.canonical.x/c-s.canonical.x,f=e.canonical.y/c-s.canonical.y,_=0;for(let y=0;y<e.canonical.z-s.canonical.z&&!i.leaves[_];y++){d*=2,f*=2;const v=2*Math.floor(f)+Math.floor(d);_=i.childOffsets[_]+v,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,n,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Bu{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){const s=i||e.findDEMTileFor(n);if(!s||!s.dem)return;const c=s.dem,d=s.tileID,f=1<<n.canonical.z-d.canonical.z;return new Bu(s,c.dim/Vt/f,[(n.canonical.x/f-d.canonical.x)*c.dim,(n.canonical.y/f-d.canonical.y)*c.dim])}tileCoordToPixel(e,n){const i=n*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(i);return new me(s,c)}getElevationAt(e,n,i,s){const c=e*this._scale+this._offset[0],d=n*this._scale+this._offset[1],f=Math.floor(c),_=Math.floor(d),y=this._dem;return s=!!s,i?Er(Er(y.get(f,_,s),y.get(f,_+1,s),d-_),Er(y.get(f+1,_,s),y.get(f+1,_+1,s),d-_),c-f):y.get(f,_,s)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Zi(1,e)*this._dem.stride}}class Cf{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new sf(Vt,16,0),this.featureIndexArray=new Dc,this.promoteId=n}insert(e,n,i,s,c,d=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,s,c,d);const _=this.grid;for(let y=0;y<n.length;y++){const v=n[y],w=[1/0,1/0,-1/0,-1/0];for(let I=0;I<v.length;I++){const C=v[I];w[0]=Math.min(w[0],C.x),w[1]=Math.min(w[1],C.y),w[2]=Math.max(w[2],C.x),w[3]=Math.max(w[3],C.y)}w[0]<Vt&&w[1]<Vt&&w[2]>=0&&w[3]>=0&&_.insert(f,w[0],w[1],w[2],w[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Hw(new Af(this.rawTileData)).layers,this.sourceLayerCoder=new ib(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,s){this.loadVTLayers();const c=e.params||{},d=jm(c.filter),f=e.tileResult,_=e.transform,y=f.bufferedTilespaceBounds,v=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(S,M,P,R)=>kw(f.bufferedTilespaceGeometry,S,M,P,R));v.sort(hv);let w=null;_.elevation&&v.length>0&&(w=Bu.create(_.elevation,this.tileID));const I={};let C;for(let S=0;S<v.length;S++){const M=v[S];if(M===C)continue;C=M;const P=this.featureIndexArray.get(M);let R=null;this.loadMatchingFeature(I,P,d,c.layers,c.availableImages,n,i,s,(z,G,H,j=0)=>(R||(R=bh(z,this.tileID.canonical,e.tileTransform)),G.queryIntersectsFeature(f,z,H,R,this.z,e.transform,e.pixelPosMatrix,w,j)))}return I}loadMatchingFeature(e,n,i,s,c,d,f,_,y){const{featureIndex:v,bucketIndex:w,sourceLayerIndex:I,layoutVertexArrayOffset:C}=n,S=this.bucketLayerIDs[w];if(s&&!function(z,G){for(let H=0;H<z.length;H++)if(G.indexOf(z[H])>=0)return!0;return!1}(s,S))return;const M=this.sourceLayerCoder.decode(I),P=this.vtLayers[M].feature(v);if(i.needGeometry){const z=xf(P,!0);if(!i.filter(new Vo(this.tileID.overscaledZ),z,this.tileID.canonical))return}else if(!i.filter(new Vo(this.tileID.overscaledZ),P))return;const R=this.getId(P,M);for(let z=0;z<S.length;z++){const G=S[z];if(s&&s.indexOf(G)<0)continue;const H=d[G];if(!H)continue;let j={};void 0!==R&&_&&(j=_.getState(H.sourceLayer||"_geojsonTileLayer",R));const W=Ye({},f[G]);W.paint=tE(W.paint,H.paint,P,j,c),W.layout=tE(W.layout,H.layout,P,j,c);const oe=!y||y(P,H,j,C);if(!oe)continue;const pe=new Up(P,this.z,this.x,this.y,R);pe.layer=W;let ve=e[G];void 0===ve&&(ve=e[G]=[]),ve.push({featureIndex:v,feature:pe,intersectionZ:oe})}}lookupSymbolFeatures(e,n,i,s,c,d,f,_){const y={};this.loadVTLayers();const v=jm(c);for(const w of e)this.loadMatchingFeature(y,{bucketIndex:i,sourceLayerIndex:s,featureIndex:w,layoutVertexArrayOffset:0},v,d,f,_,n);return y}loadFeature(e){const{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();const s=this.sourceLayerCoder.decode(i),c=this.vtFeatures[s];if(c[n])return c[n];const d=this.vtLayers[s].feature(n);return c[n]=d,d}hasLayer(e){for(const n of this.bucketLayerIDs)for(const i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){const s="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=s&&(i=e.properties[s]),"boolean"==typeof i&&(i=Number(i))}return i}}function tE(t,e,n,i,s){return An(t,(c,d)=>{const f=e instanceof hd?e.get(d):null;return f&&f.evaluate?f.evaluate(n,i,s):f})}function hv(t,e){return e-t}lr(Cf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const dA=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ub=Gi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),fv=Gi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kg=Gi([{name:"a_z_offset",components:1,type:"Float32"}],4),hA=Gi([{name:"a_texb",components:2,type:"Uint16"}]),db=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),MS=Gi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nE=Gi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),RS=Gi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _a=24;const Il=128;function Vu(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Vo(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:i,interpolationType:s}=n;let c=0;for(;c<i.length&&i[c]<=t;)c++;c=Math.max(0,c-1);let d=c;for(;d<i.length&&i[d]<t+1;)d++;d=Math.min(i.length-1,d);const f=i[c],_=i[d];return"composite"===n.kind?{kind:"composite",minZoom:f,maxZoom:_,interpolationType:s}:{kind:"camera",minZoom:f,maxZoom:_,minSize:n.evaluate(new Vo(f)),maxSize:n.evaluate(new Vo(_)),interpolationType:s}}}function Sf(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:s}){return"source"===t.kind?i/Il:"composite"===t.kind?Er(i/Il,s/Il,n):e}function kc(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:s,minZoom:c,maxZoom:d}=t,f=s?_n(Ec.interpolationFactor(s,e,c,d),0,1):0;"camera"===t.kind?i=Er(t.minSize,t.maxSize,f):n=f}return{uSizeT:n,uSize:i}}var fA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Il,evaluateSizeForFeature:Sf,evaluateSizeForZoom:kc,getSizeData:Vu});function Cs(t,e,n){return t.sections.forEach(i=>{i.text=function(s,c,d){const f=c.layout.get("text-transform").evaluate(d,{});return"uppercase"===f?s=s.toLocaleUpperCase():"lowercase"===f&&(s=s.toLocaleLowerCase()),Bl.applyArabicShaping&&(s=Bl.applyArabicShaping(s)),s}(i.text,e,n)}),t}const fc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function pv(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function $p(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}const du=3;function rE(t,e,n){e.glyphs=[],1===t&&n.readMessage(PS,e)}function PS(t,e,n){if(3===t){const{id:i,bitmap:s,width:c,height:d,left:f,top:_,advance:y}=n.readMessage(GD,{});e.glyphs.push({id:i,bitmap:new cu({width:c+2*du,height:d+2*du},s),metrics:{width:c,height:d,left:f,top:_,advance:y}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function GD(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}const ya=du;function iE(t){let e=0,n=0;for(const d of t)e+=d.w*d.h,n=Math.max(n,d.w);t.sort((d,f)=>f.h-d.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let s=0,c=0;for(const d of t)for(let f=i.length-1;f>=0;f--){const _=i[f];if(!(d.w>_.w||d.h>_.h)){if(d.x=_.x,d.y=_.y,c=Math.max(c,d.y+d.h),s=Math.max(s,d.x+d.w),d.w===_.w&&d.h===_.h){const y=i.pop();f<i.length&&(i[f]=y)}else d.h===_.h?(_.x+=d.w,_.w-=d.w):d.w===_.w?(_.y+=d.h,_.h-=d.h):(i.push({x:_.x+d.w,y:_.y,w:_.w-d.w,h:d.h}),_.y+=d.h,_.h-=d.h);break}}return{w:s,h:c,fill:e/(s*c)||0}}const va=1;class Dd{constructor(e,{pixelRatio:n,version:i,stretchX:s,stretchY:c,content:d}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=s,this.stretchY=c,this.content=d,this.version=i}get tl(){return[this.paddedRect.x+va,this.paddedRect.y+va]}get br(){return[this.paddedRect.x+this.paddedRect.w-va,this.paddedRect.y+this.paddedRect.h-va]}get displaySize(){return[(this.paddedRect.w-2*va)/this.pixelRatio,(this.paddedRect.h-2*va)/this.pixelRatio]}}class oE{constructor(e,n){const i={},s={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,i,c),this.addImages(n,s,c);const{w:d,h:f}=iE(c),_=new Ki({width:d||1,height:f||1});for(const y in e){const v=e[y],w=i[y].paddedRect;Ki.copy(v.data,_,{x:0,y:0},{x:w.x+va,y:w.y+va},v.data)}for(const y in n){const v=n[y],w=s[y].paddedRect,I=w.x+va,C=w.y+va,S=v.data.width,M=v.data.height;Ki.copy(v.data,_,{x:0,y:0},{x:I,y:C},v.data),Ki.copy(v.data,_,{x:0,y:M-1},{x:I,y:C-1},{width:S,height:1}),Ki.copy(v.data,_,{x:0,y:0},{x:I,y:C+M},{width:S,height:1}),Ki.copy(v.data,_,{x:S-1,y:0},{x:I-1,y:C},{width:1,height:M}),Ki.copy(v.data,_,{x:0,y:0},{x:I+S,y:C},{width:1,height:M})}this.image=_,this.iconPositions=i,this.patternPositions=s}addImages(e,n,i){for(const s in e){const c=e[s],d={x:0,y:0,w:c.data.width+2*va,h:c.data.height+2*va};i.push(d),n[s]=new Dd(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const s in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,i),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;const[s,c]=e.tl;i.update(n.data,void 0,{x:s,y:c})}}lr(Dd,"ImagePosition"),lr(oE,"ImageAtlas");const Ao={horizontal:1,vertical:2,horizontalOnly:3},hb=-17;class zu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const i=new zu;return i.scale=e||1,i.fontStack=n,i}static forImage(e){const n=new zu;return n.imageName=e,n}}class Xg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const i=new Xg;for(let s=0;s<e.sections.length;s++){const c=e.sections[s];c.image?i.addImageSection(c):i.addTextSection(c,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let s="";for(let c=0;c<n.length;c++){const d=n.charCodeAt(c+1)||null,f=n.charCodeAt(c-1)||null;s+=!i&&(d&&J1(d)&&!fc[n[c+1]]||f&&J1(f)&&!fc[n[c-1]])||!fc[n[c]]?n[c]:fc[n[c]]}return s}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&mv[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&mv[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const i=new Xg;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(zu.forText(e.scale,e.fontStack||n));const i=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(i)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(0===n.length)return void Me("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(zu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Me("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sE(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S){const M=Xg.fromFeature(t,s);w===Ao.vertical&&M.verticalizePunctuation(I);let P=[];const R=function(W,oe,pe,ve,xe,ke){if(!W)return[];const Ae=[],$e=function(It,et,it,St,Ut,Wt){let ln=0;for(let pn=0;pn<It.length();pn++){const Yt=It.getSection(pn);ln+=fb(It.getCodePoint(pn),Yt,St,Ut,et,Wt)}return ln/Math.max(1,Math.ceil(ln/it))}(W,oe,pe,ve,xe,ke),Ce=W.text.indexOf("\u200b")>=0;let nt=0;for(let It=0;It<W.length();It++){const et=W.getSection(It),it=W.getCodePoint(It);if(mv[it]||(nt+=fb(it,et,ve,xe,oe,ke)),It<W.length()-1){const St=!((ft=it)<11904||!(pr["Bopomofo Extended"](ft)||pr.Bopomofo(ft)||pr["CJK Compatibility Forms"](ft)||pr["CJK Compatibility Ideographs"](ft)||pr["CJK Compatibility"](ft)||pr["CJK Radicals Supplement"](ft)||pr["CJK Strokes"](ft)||pr["CJK Symbols and Punctuation"](ft)||pr["CJK Unified Ideographs Extension A"](ft)||pr["CJK Unified Ideographs"](ft)||pr["Enclosed CJK Letters and Months"](ft)||pr["Halfwidth and Fullwidth Forms"](ft)||pr.Hiragana(ft)||pr["Ideographic Description Characters"](ft)||pr["Kangxi Radicals"](ft)||pr["Katakana Phonetic Extensions"](ft)||pr.Katakana(ft)||pr["Vertical Forms"](ft)||pr["Yi Radicals"](ft)||pr["Yi Syllables"](ft)));(jp[it]||St||et.imageName)&&Ae.push(gv(It+1,nt,$e,Ae,aE(it,W.getCodePoint(It+1),St&&Ce),!1))}}var ft;return mb(gv(W.length(),nt,$e,Ae,0,!0))}(M,y,c,e,i,C),{processBidirectionalText:z,processStyledBidirectionalText:G}=Bl;if(z&&1===M.sections.length){const W=z(M.toString(),R);for(const oe of W){const pe=new Xg;pe.text=oe,pe.sections=M.sections;for(let ve=0;ve<oe.length;ve++)pe.sectionIndex.push(0);P.push(pe)}}else if(G){const W=G(M.text,M.sectionIndex,R);for(const oe of W){const pe=new Xg;pe.text=oe[0],pe.sectionIndex=oe[1],pe.sections=M.sections,P.push(pe)}}else P=function(W,oe){const pe=[],ve=W.text;let xe=0;for(const ke of oe)pe.push(W.substring(xe,ke)),xe=ke;return xe<ve.length&&pe.push(W.substring(xe,ve.length)),pe}(M,R);const H=[],j={positionedLines:H,text:M.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(W,oe,pe,ve,xe,ke,Ae,$e,Ce,nt,ft,It){let et=0,it=0,St=0;const Ut="right"===$e?1:"left"===$e?0:.5;let Wt=!1;for(const Jn of xe){const Yn=Jn.getSections();for(const Xn of Yn){if(Xn.imageName)continue;const yr=oe[Xn.fontStack];if(yr&&(Wt=void 0!==yr.ascender&&void 0!==yr.descender,!Wt))break}if(!Wt)break}let ln=0;for(const Jn of xe){Jn.trim();const Yn=Jn.getMaxScale(),Xn=(Yn-1)*_a,yr={positionedGlyphs:[],lineOffset:0};W.positionedLines[ln]=yr;const Fr=yr.positionedGlyphs;let Or=0;if(!Jn.length()){it+=ke,++ln;continue}let Ci=0,Zr=0;for(let Pr=0;Pr<Jn.length();Pr++){const Dr=Jn.getSection(Pr),ci=Jn.getSectionIndex(Pr),Pi=Jn.getCodePoint(Pr);let Jr=Dr.scale,Xi=null,vo=null,So=null,xo=_a,Ns=0;const Qo=!(Ce===Ao.horizontal||!ft&&!Su(Pi)||ft&&(mv[Pi]||(pn=Pi,pr.Arabic(pn)||pr["Arabic Supplement"](pn)||pr["Arabic Extended-A"](pn)||pr["Arabic Presentation Forms-A"](pn)||pr["Arabic Presentation Forms-B"](pn))));if(Dr.imageName){const qo=ve[Dr.imageName];if(!qo)continue;So=Dr.imageName,W.iconsInText=W.iconsInText||!0,vo=qo.paddedRect;const co=qo.displaySize;Jr=Jr*_a/It,Xi={width:co[0],height:co[1],left:va,top:-ya,advance:Qo?co[1]:co[0],localGlyph:!1},Ns=Wt?-Xi.height*Jr:hb+Yn*_a-co[1]*Jr,xo=Xi.advance;const la=(Qo?co[0]:co[1])*Jr-_a*Yn;la>0&&la>Or&&(Or=la)}else{const qo=pe[Dr.fontStack];if(!qo)continue;qo[Pi]&&(vo=qo[Pi]);const co=oe[Dr.fontStack];if(!co)continue;const la=co.glyphs[Pi];if(!la)continue;if(Xi=la.metrics,xo=8203!==Pi?_a:0,Wt){const jc=void 0!==co.ascender?Math.abs(co.ascender):0,Xd=void 0!==co.descender?Math.abs(co.descender):0,Gc=(jc+Xd)*Jr;Ci<Gc&&(Ci=Gc,Zr=(jc-Xd)/2*Jr),Ns=-jc*Jr}else Ns=hb+(Yn-Jr)*_a}Qo?(W.verticalizable=!0,Fr.push({glyph:Pi,imageName:So,x:et,y:it+Ns,vertical:Qo,scale:Jr,localGlyph:Xi.localGlyph,fontStack:Dr.fontStack,sectionIndex:ci,metrics:Xi,rect:vo}),et+=xo*Jr+nt):(Fr.push({glyph:Pi,imageName:So,x:et,y:it+Ns,vertical:Qo,scale:Jr,localGlyph:Xi.localGlyph,fontStack:Dr.fontStack,sectionIndex:ci,metrics:Xi,rect:vo}),et+=Xi.advance*Jr+nt)}0!==Fr.length&&(St=Math.max(et-nt,St),Wt?_v(Fr,Ut,Or,Zr,ke*Yn/2):_v(Fr,Ut,Or,0,ke/2)),et=0;const zr=ke*Yn+Or;yr.lineOffset=Math.max(Or,Xn),it+=zr,++ln}var pn;const Yt=it,{horizontalAlign:tn,verticalAlign:Vn}=Qg(Ae);(function(Jn,Yn,Xn,yr,Fr,Or){const Ci=(Yn-Xn)*Fr,Zr=-Or*yr;for(const zr of Jn)for(const Pr of zr.positionedGlyphs)Pr.x+=Ci,Pr.y+=Zr})(W.positionedLines,Ut,tn,Vn,St,Yt),W.top+=-Vn*Yt,W.bottom=W.top+Yt,W.left+=-tn*St,W.right=W.left+St,W.hasBaseline=Wt}(j,e,n,i,P,d,f,_,w,y,I,S),!function(W){for(const oe of W)if(0!==oe.positionedGlyphs.length)return!1;return!0}(H)&&j}const mv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fb(t,e,n,i,s,c){if(e.imageName){const d=i[e.imageName];return d?d.displaySize[0]*e.scale*_a/c+s:0}{const d=n[e.fontStack],f=d&&d.glyphs[t];return f?f.metrics.advance*e.scale+s:0}}function pb(t,e,n,i){const s=Math.pow(t-e,2);return i?t<e?s/2:2*s:s+Math.abs(n)*n}function aE(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function gv(t,e,n,i,s,c){let d=null,f=pb(e,n,s,c);for(const _ of i){const y=pb(e-_.x,n,s,c)+_.badness;y<=f&&(d=_,f=y)}return{index:t,x:e,priorBreak:d,badness:f}}function mb(t){return t?mb(t.priorBreak).concat(t.index):[]}function Qg(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function _v(t,e,n,i,s){if(!(e||n||i||s))return;const c=t.length-1,d=t[c],f=(d.x+d.metrics.advance*d.scale)*e;for(let _=0;_<=c;_++)t[_].x-=f,t[_].y+=n+i+s}function OS(t,e,n,i){const{horizontalAlign:s,verticalAlign:c}=Qg(i),d=n[0]-t.displaySize[0]*s,f=n[1]-t.displaySize[1]*c;return{imagePrimary:t,imageSecondary:e,top:f,bottom:f+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function pA(t,e,n,i,s,c){const d=t.imagePrimary;let f;if(d.content){const P=d.content,R=d.pixelRatio||1;f=[P[0]/R,P[1]/R,d.displaySize[0]-P[2]/R,d.displaySize[1]-P[3]/R]}const _=e.left*c,y=e.right*c;let v,w,I,C;"width"===n||"both"===n?(C=s[0]+_-i[3],w=s[0]+y+i[1]):(C=s[0]+(_+y-d.displaySize[0])/2,w=C+d.displaySize[0]);const S=e.top*c,M=e.bottom*c;return"height"===n||"both"===n?(v=s[1]+S-i[0],I=s[1]+M+i[2]):(v=s[1]+(S+M-d.displaySize[1])/2,I=v+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:v,right:w,bottom:I,left:C,collisionPadding:f}}class Uu extends me{constructor(e,n,i,s,c){super(e,n),this.angle=s,this.z=i,void 0!==c&&(this.segment=c)}clone(){return new Uu(this.x,this.y,this.z,this.angle,this.segment)}}function yv(t,e,n,i,s){if(void 0===e.segment)return!0;let c=e,d=e.segment+1,f=0;for(;f>-n/2;){if(d--,d<0)return!1;f-=t[d].dist(c),c=t[d]}f+=t[d].dist(t[d+1]),d++;const _=[];let y=0;for(;f<n/2;){const v=t[d],w=t[d+1];if(!w)return!1;let I=t[d-1].angleTo(v)-v.angleTo(w);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:f,angleDelta:I}),y+=I;f-_[0].distance>i;)y-=_.shift().angleDelta;if(y>s)return!1;d++,f+=v.dist(w)}return!0}function wh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Jg(t,e,n){return t?.6*e*n:0}function vv(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function mA(t,e,n,i,s,c){const d=Jg(n,s,c),f=vv(n,i)*c;let _=0;const y=wh(t)/2;for(let v=0;v<t.length-1;v++){const w=t[v],I=t[v+1],C=w.dist(I);if(_+C>y){const S=(y-_)/C,M=Er(w.x,I.x,S),P=Er(w.y,I.y,S),R=new Uu(M,P,0,I.angleTo(w),v);return!d||yv(t,R,f,d,e)?R:void 0}_+=C}}function xv(t,e,n,i,s,c,d,f,_){const y=Jg(i,c,d),v=vv(i,s),w=v*d,I=0===t[0].x||t[0].x===_||0===t[0].y||t[0].y===_;return e-w<e/4&&(e=w+e/4),Md(t,I?e/2*f%e:(v/2+2*c)*d*f%e,e,y,n,w,I,!1,_)}function Md(t,e,n,i,s,c,d,f,_){const y=c/2,v=wh(t);let w=0,I=e-n,C=[];for(let S=0;S<t.length-1;S++){const M=t[S],P=t[S+1],R=M.dist(P),z=P.angleTo(M);for(;I+n<w+R;){I+=n;const G=(I-w)/R,H=Er(M.x,P.x,G),j=Er(M.y,P.y,G);if(H>=0&&H<_&&j>=0&&j<_&&I-y>=0&&I+y<=v){const W=new Uu(H,j,0,z,S);i&&!yv(t,W,c,i,s)||C.push(W)}}w+=R}return f||C.length||d||(C=Md(t,w/2,n,i,s,c,d,!0,_)),C}function gA(t,e,n,i,s){const c=[];for(let d=0;d<t.length;d++){const f=t[d];let _;for(let y=0;y<f.length-1;y++){let v=f[y],w=f[y+1];v.x<e&&w.x<e||(v.x<e?v=new me(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x<e&&(w=new me(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y<n&&w.y<n||(v.y<n?v=new me(v.x+(n-v.y)/(w.y-v.y)*(w.x-v.x),n)._round():w.y<n&&(w=new me(v.x+(n-v.y)/(w.y-v.y)*(w.x-v.x),n)._round()),v.x>=i&&w.x>=i||(v.x>=i?v=new me(i,v.y+(i-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x>=i&&(w=new me(i,v.y+(i-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y>=s&&w.y>=s||(v.y>=s?v=new me(v.x+(s-v.y)/(w.y-v.y)*(w.x-v.x),s)._round():w.y>=s&&(w=new me(v.x+(s-v.y)/(w.y-v.y)*(w.x-v.x),s)._round()),_&&v.equals(_[_.length-1])||(_=[v],c.push(_)),_.push(w)))))}}return c}lr(Uu,"Anchor");const Ss=1e20;function lE(t,e,n,i,s,c,d,f,_){for(let y=e;y<e+i;y++)_A(t,n*c+y,c,s,d,f,_);for(let y=n;y<n+s;y++)_A(t,y*c+e,1,i,d,f,_)}function _A(t,e,n,i,s,c,d){c[0]=0,d[0]=-Ss,d[1]=Ss,s[0]=t[e];for(let f=1,_=0,y=0;f<i;f++){s[f]=t[e+f*n];const v=f*f;do{const w=c[_];y=(s[f]-s[w]+v-w*w)/(f-w)/2}while(y<=d[_]&&--_>-1);_++,c[_]=f,d[_]=y,d[_+1]=Ss}for(let f=0,_=0;f<i;f++){for(;d[_+1]<f;)_++;const y=c[_],v=f-y;t[e+f*n]=s[y]+v*v}}const $u=2;class e_{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){const s=[],c=this.urls[n]||Be.GLYPHS_URL;for(const d in e)for(const f of e[d])s.push({stack:d,id:f});Xe(s,({stack:d,id:f},_)=>{let y=this.entries[d];y||(y=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=y.glyphs[f];if(void 0!==v)return void _(null,{stack:d,id:f,glyph:v});if(v=this._tinySDF(y,d,f),v)return y.glyphs[f]=v,void _(null,{stack:d,id:f,glyph:v});const w=Math.floor(f/256);if(256*w>65535)return void _(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void _(null,{stack:d,id:f,glyph:v});let I=y.requests[w];I||(I=y.requests[w]=[],e_.loadGlyphRange(d,w,c,this.requestManager,(C,S)=>{if(S){y.ascender=S.ascender,y.descender=S.descender;for(const M in S.glyphs)this._doesCharSupportLocalGlyph(+M)||(y.glyphs[+M]=S.glyphs[+M]);y.ranges[w]=!0}for(const M of I)M(C,S);delete y.requests[w]})),I.push((C,S)=>{C?_(C):S&&_(null,{stack:d,id:f,glyph:S.glyphs[f]||null})})},(d,f)=>{if(d)i(d);else if(f){const _={};for(const{stack:y,id:v,glyph:w}of f)void 0===_[y]&&(_[y]={}),void 0===_[y].glyphs&&(_[y].glyphs={}),_[y].glyphs[v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},_[y].ascender=this.entries[y].ascender,_[y].descender=this.entries[y].descender;i(null,_)}})}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(pr["CJK Unified Ideographs"](e)||pr["Hangul Syllables"](e)||pr.Hiragana(e)||pr.Katakana(e)||pr["CJK Symbols and Punctuation"](e)||pr["CJK Unified Ideographs Extension A"](e)||pr["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,i){const s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(i))return;let c=e.tinySDF;if(!c){let M="400";/bold/i.test(n)?M="900":/medium/i.test(n)?M="500":/light/i.test(n)&&(M="200"),c=e.tinySDF=new e_.TinySDF({fontFamily:s,fontWeight:M,fontSize:24*$u,buffer:3*$u,radius:8*$u}),c.fontWeight=M}if(this.localGlyphs[c.fontWeight][i])return this.localGlyphs[c.fontWeight][i];const d=String.fromCodePoint(i),{data:f,width:_,height:y,glyphWidth:v,glyphHeight:w,glyphLeft:I,glyphTop:C,glyphAdvance:S}=c.draw(d);return this.localGlyphs[c.fontWeight][i]={id:i,bitmap:new cu({width:_,height:y},f),metrics:{width:v/$u,height:w/$u,left:I/$u,top:C/$u-27,advance:S/$u,localGlyph:!0}}}}e_.loadGlyphRange=function(t,e,n,i,s){const c=256*e,d=c+255,f=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${c}-${d}`),Ht.Glyphs);xn(f,(_,y)=>{if(_)s(_);else if(y){const v={},w=new Af(y).readFields(rE,{});for(const I of w.glyphs)v[I.id]=I;s(null,{glyphs:v,ascender:w.ascender,descender:w.descender})}})},e_.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;const f=this.size=t+4*e,_=this._createCanvas(f),y=this.ctx=_.getContext("2d",{willReadFrequently:!0});y.font=`${d} ${c} ${t}px ${s}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:c}=this.ctx.measureText(t),d=Math.ceil(n),f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-s))),_=Math.min(this.size-this.buffer,d+Math.ceil(i)),y=f+2*this.buffer,v=_+2*this.buffer,w=Math.max(y*v,0),I=new Uint8ClampedArray(w),C={data:I,width:y,height:v,glyphWidth:f,glyphHeight:_,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(0===f||0===_)return C;const{ctx:S,buffer:M,gridInner:P,gridOuter:R}=this;S.clearRect(M,M,f,_),S.fillText(t,M,M+d);const z=S.getImageData(M,M,f,_);R.fill(Ss,0,w),P.fill(0,0,w);for(let G=0;G<_;G++)for(let H=0;H<f;H++){const j=z.data[4*(G*f+H)+3]/255;if(0===j)continue;const W=(G+M)*y+H+M;if(1===j)R[W]=0,P[W]=Ss;else{const oe=.5-j;R[W]=oe>0?oe*oe:0,P[W]=oe<0?oe*oe:0}}lE(R,0,0,y,v,y,this.f,this.v,this.z),lE(P,M,M,f,_,y,this.f,this.v,this.z);for(let G=0;G<w;G++){const H=Math.sqrt(R[G])-Math.sqrt(P[G]);I[G]=Math.round(255-255*(H/this.radius+this.cutoff))}return C}};const Eh=va;function cE(t,e,n,i){const s=[],c=t.imagePrimary,d=c.pixelRatio,f=c.paddedRect.w-2*Eh,_=c.paddedRect.h-2*Eh,y=t.right-t.left,v=t.bottom-t.top,w=c.stretchX||[[0,f]],I=c.stretchY||[[0,_]],C=(ke,Ae)=>ke+Ae[1]-Ae[0],S=w.reduce(C,0),M=I.reduce(C,0),P=f-S,R=_-M;let z=0,G=S,H=0,j=M,W=0,oe=P,pe=0,ve=R;if(c.content&&i){const ke=c.content;z=t_(w,0,ke[0]),H=t_(I,0,ke[1]),G=t_(w,ke[0],ke[2]),j=t_(I,ke[1],ke[3]),W=ke[0]-z,pe=ke[1]-H,oe=ke[2]-ke[0]-G,ve=ke[3]-ke[1]-j}const xe=(ke,Ae,$e,Ce)=>{const nt=bv(ke.stretch-z,G,y,t.left),ft=Ul(ke.fixed-W,oe,ke.stretch,S),It=bv(Ae.stretch-H,j,v,t.top),et=Ul(Ae.fixed-pe,ve,Ae.stretch,M),it=bv($e.stretch-z,G,y,t.left),St=Ul($e.fixed-W,oe,$e.stretch,S),Ut=bv(Ce.stretch-H,j,v,t.top),Wt=Ul(Ce.fixed-pe,ve,Ce.stretch,M),ln=new me(nt,It),pn=new me(it,It),Yt=new me(it,Ut),tn=new me(nt,Ut),Vn=new me(ft/d,et/d),Jn=new me(St/d,Wt/d),Yn=e*Math.PI/180;if(Yn){const Zr=Math.sin(Yn),zr=Math.cos(Yn),Pr=[zr,-Zr,Zr,zr];ln._matMult(Pr),pn._matMult(Pr),tn._matMult(Pr),Yt._matMult(Pr)}const Xn=ke.stretch+ke.fixed,yr=$e.stretch+$e.fixed,Fr=Ae.stretch+Ae.fixed,Or=Ce.stretch+Ce.fixed,Ci=t.imageSecondary;return{tl:ln,tr:pn,bl:tn,br:Yt,texPrimary:{x:c.paddedRect.x+Eh+Xn,y:c.paddedRect.y+Eh+Fr,w:yr-Xn,h:Or-Fr},texSecondary:Ci?{x:Ci.paddedRect.x+Eh+Xn,y:Ci.paddedRect.y+Eh+Fr,w:yr-Xn,h:Or-Fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:Jn,minFontScaleX:oe/d/y,minFontScaleY:ve/d/v,isSDF:n}};if(i&&(c.stretchX||c.stretchY)){const ke=Gp(w,P,S),Ae=Gp(I,R,M);for(let $e=0;$e<ke.length-1;$e++){const Ce=ke[$e],nt=ke[$e+1];for(let ft=0;ft<Ae.length-1;ft++)s.push(xe(Ce,Ae[ft],nt,Ae[ft+1]))}}else s.push(xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:_+1}));return s}function t_(t,e,n){let i=0;for(const s of t)i+=Math.max(e,Math.min(n,s[1]))-Math.max(e,Math.min(n,s[0]));return i}function Gp(t,e,n){const i=[{fixed:-Eh,stretch:0}];for(const[s,c]of t){const d=i[i.length-1];i.push({fixed:s-d.stretch,stretch:d.stretch}),i.push({fixed:s-d.stretch,stretch:d.stretch+(c-s)})}return i.push({fixed:e+Eh,stretch:n}),i}function bv(t,e,n,i){return t/e*n+i}function Ul(t,e,n,i){return t-e*n/i}function yA(t,e,n,i){const s=e+t.positionedLines[i].lineOffset;return 0===i?n+s/2:n+(s+(e+t.positionedLines[i-1].lineOffset))/2}function kS(t,e=1,n=!1){let i=1/0,s=1/0,c=-1/0,d=-1/0;const f=t[0];for(let C=0;C<f.length;C++){const S=f[C];(!C||S.x<i)&&(i=S.x),(!C||S.y<s)&&(s=S.y),(!C||S.x>c)&&(c=S.x),(!C||S.y>d)&&(d=S.y)}const _=Math.min(c-i,d-s);let y=_/2;const v=new Xc([],vA);if(0===_)return new me(i,s);for(let C=i;C<c;C+=_)for(let S=s;S<d;S+=_)v.push(new Df(C+y,S+y,y,t));let w=function(C){let S=0,M=0,P=0;const R=C[0];for(let z=0,G=R.length,H=G-1;z<G;H=z++){const j=R[z],W=R[H],oe=j.x*W.y-W.x*j.y;M+=(j.x+W.x)*oe,P+=(j.y+W.y)*oe,S+=3*oe}return new Df(M/S,P/S,0,C)}(t),I=v.length;for(;v.length;){const C=v.pop();(C.d>w.d||!w.d)&&(w=C,n&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,I)),C.max-w.d<=e||(y=C.h/2,v.push(new Df(C.p.x-y,C.p.y-y,y,t)),v.push(new Df(C.p.x+y,C.p.y-y,y,t)),v.push(new Df(C.p.x-y,C.p.y+y,y,t)),v.push(new Df(C.p.x+y,C.p.y+y,y,t)),I+=4)}return n&&(console.log(`num probes: ${I}`),console.log(`best distance: ${w.d}`)),w.p}function vA(t,e){return e.max-t.max}class Df{constructor(e,n,i,s){this.p=new me(e,n),this.h=i,this.d=function(c,d){let f=!1,_=1/0;for(let y=0;y<d.length;y++){const v=d[y];for(let w=0,I=v.length,C=I-1;w<I;C=w++){const S=v[w],M=v[C];S.y>c.y!=M.y>c.y&&c.x<(M.x-S.x)*(c.y-S.y)/(M.y-S.y)+S.x&&(f=!f),_=Math.min(_,ES(c,S,M))}}return(f?1:-1)*Math.sqrt(_)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}const Rd=7,gb=Number.POSITIVE_INFINITY,uE=Math.sqrt(2);function Hp(t,[e,n]){let i=0,s=0;if(n===gb){e<0&&(e=0);const c=e/uE;switch(t){case"top-right":case"top-left":s=c-Rd;break;case"bottom-right":case"bottom-left":s=-c+Rd;break;case"bottom":s=-e+Rd;break;case"top":s=e-Rd}switch(t){case"top-right":case"bottom-right":i=-c;break;case"top-left":case"bottom-left":i=c;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":s=n-Rd;break;case"bottom-right":case"bottom-left":case"bottom":s=-n+Rd}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,s]}function dE(t,e,n,i,s,c,d,f,_,y,v){t.createArrays(),t.tilePixelRatio=Vt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const w=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,C={};if("composite"===t.textSizeData.kind){const{minZoom:R,maxZoom:z}=t.textSizeData;C.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Vo(R),f),I["text-size"].possiblyEvaluate(new Vo(z),f)]}if("composite"===t.iconSizeData.kind){const{minZoom:R,maxZoom:z}=t.iconSizeData;C.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Vo(R),f),I["icon-size"].possiblyEvaluate(new Vo(z),f)]}C.layoutTextSize=I["text-size"].possiblyEvaluate(new Vo(_+1),f),C.layoutIconSize=I["icon-size"].possiblyEvaluate(new Vo(_+1),f),C.textMaxSize=I["text-size"].possiblyEvaluate(new Vo(18),f);const S="map"===w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement"),M=w.get("text-size");let P=!1;for(const R of t.features)if(R.icon&&R.icon.nameSecondary){P=!0;break}for(const R of t.features){const z=w.get("text-font").evaluate(R,{},f).join(","),G=M.evaluate(R,{},f),H=C.layoutTextSize.evaluate(R,{},f),j=(C.layoutIconSize.evaluate(R,{},f),{horizontal:{},vertical:void 0}),W=R.text;let oe,pe=[0,0];if(W){const ke=W.toString(),Ae=w.get("text-letter-spacing").evaluate(R,{},f)*_a,$e=w.get("text-line-height").evaluate(R,{},f)*_a,Ce=af(ke)?Ae:0,nt=w.get("text-anchor").evaluate(R,{},f),ft=w.get("text-variable-anchor");if(!ft){const Ut=w.get("text-radial-offset").evaluate(R,{},f);pe=Ut?Hp(nt,[Ut*_a,gb]):w.get("text-offset").evaluate(R,{},f).map(Wt=>Wt*_a)}let It=S?"center":w.get("text-justify").evaluate(R,{},f);const et="point"===w.get("symbol-placement"),it=et?w.get("text-max-width").evaluate(R,{},f)*_a:1/0,St=Ut=>{t.allowVerticalPlacement&&Ay(ke)&&(j.vertical=sE(W,e,n,s,z,it,$e,nt,Ut,Ce,pe,Ao.vertical,!0,H,G))};if(!S&&ft){const Ut="auto"===It?ft.map(ln=>n_(ln)):[It];let Wt=!1;for(let ln=0;ln<Ut.length;ln++){const pn=Ut[ln];if(!j.horizontal[pn])if(Wt)j.horizontal[pn]=j.horizontal[0];else{const Yt=sE(W,e,n,s,z,it,$e,"center",pn,Ce,pe,Ao.horizontal,!1,H,G);Yt&&(j.horizontal[pn]=Yt,Wt=1===Yt.positionedLines.length)}}St("left")}else{if("auto"===It&&(It=n_(nt)),et||w.get("text-writing-mode").indexOf("horizontal")>=0||!Ay(ke)){const Ut=sE(W,e,n,s,z,it,$e,nt,It,Ce,pe,Ao.horizontal,!1,H,G);Ut&&(j.horizontal[It]=Ut)}St(et?"left":It)}}let ve=!1;if(R.icon&&R.icon.namePrimary){const ke=i[R.icon.namePrimary];ke&&(oe=OS(s[R.icon.namePrimary],R.icon.nameSecondary?s[R.icon.nameSecondary]:void 0,w.get("icon-offset").evaluate(R,{},f),w.get("icon-anchor").evaluate(R,{},f)),ve=ke.sdf,void 0===t.sdfIcons?t.sdfIcons=ke.sdf:t.sdfIcons!==ke.sdf&&Me("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ke.pixelRatio!==t.pixelRatio||0!==w.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const xe=qp(j.horizontal)||j.vertical;t.iconsInText||(t.iconsInText=!!xe&&xe.iconsInText),(xe||oe)&&HD(t,R,j,oe,i,C,H,0,pe,ve,d,f,y,v,P)}c&&t.generateCollisionDebugBuffers(_,t.collisionBoxArray)}function n_(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function HD(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S){let M=c.textMaxSize.evaluate(e,{},w);void 0===M&&(M=d);const P=t.layers[0].layout,R=P.get("icon-offset").evaluate(e,{},w),z=qp(n.horizontal)||n.vertical,G="globe"===I.name,H=_a,j=d/H,W=t.tilePixelRatio*M/H,oe=(nt=t.overscaling,t.zoom>18&&nt>2&&(nt>>=1),Math.max(Vt/(512*nt),1)*P.get("symbol-spacing")),pe=P.get("text-padding")*t.tilePixelRatio,ve=P.get("icon-padding")*t.tilePixelRatio,xe=De(P.get("text-max-angle")),ke="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),Ae="map"===P.get("icon-rotation-alignment")&&"point"!==P.get("symbol-placement"),$e=P.get("symbol-placement"),Ce=oe/2;var nt;const ft=P.get("icon-text-fit").evaluate(e,{},w),It=P.get("icon-text-fit-padding").evaluate(e,{},w),et="none"!==ft;let it;!1===t.hasAnyIconTextFit&&et&&(t.hasAnyIconTextFit=!0),i&&et&&(t.allowVerticalPlacement&&n.vertical&&(it=pA(i,n.vertical,ft,It,R,j)),z&&(i=pA(i,z,ft,It,R,j)));const St=(Ut,Wt,ln)=>{if(Wt.x<0||Wt.x>=Vt||Wt.y<0||Wt.y>=Vt)return;let pn=null;if(G){const{x:Yt,y:tn,z:Vn}=I.projectTilePoint(Wt.x,Wt.y,ln);pn={anchor:new Uu(Yt,tn,Vn,0,void 0),up:I.upVector(ln,Wt.x,Wt.y)}}!function(Yt,tn,Vn,Jn,Yn,Xn,yr,Fr,Or,Ci,Zr,zr,Pr,Dr,ci,Pi,Jr,Xi,vo,So,xo,Ns,Qo,qo,co,la,jc){const Xd=Yt.addToLineVertexArray(tn,Jn);let Gc,k0,L0,LI,N1,NI,F1,FI=0,BI=0,VI=0,rp=0,uo=-1,zI=-1;const Qd={};let ay=mT("");const jh=Vn?Vn.anchor:tn,Ua="none"!==Or.layout.get("icon-text-fit").evaluate(xo,{},co);let Jo=0,Hc=0;if(void 0===Or._unevaluatedLayout.getValue("text-radial-offset")?[Jo,Hc]=Or.layout.get("text-offset").evaluate(xo,{},co).map(Wc=>Wc*_a):(Jo=Or.layout.get("text-radial-offset").evaluate(xo,{},co)*_a,Hc=gb),Yt.allowVerticalPlacement&&Yn.vertical){const Wc=Yn.vertical;if(ci)NI=ju(Wc),Fr&&(F1=ju(Fr));else{const Sl=Or.layout.get("text-rotate").evaluate(xo,{},co)+90;L0=ks(Ci,jh,tn,Zr,zr,Pr,Wc,Dr,Sl,Pi),Fr&&(LI=ks(Ci,jh,tn,Zr,zr,Pr,Fr,Xi,Sl))}}if(Xn){const Wc=Or.layout.get("icon-rotate").evaluate(xo,{},co),Sl=cE(Xn,Wc,Qo,Ua),N0=Fr?cE(Fr,Wc,Qo,Ua):void 0;k0=ks(Ci,jh,tn,Zr,zr,Pr,Xn,Xi,Wc),FI=4*Sl.length;const B1=Yt.iconSizeData;let ip=null;"source"===B1.kind?(ip=[Il*Or.layout.get("icon-size").evaluate(xo,{},co)],ip[0]>Lc&&Me(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Wp}. Reduce your "icon-size".`)):"composite"===B1.kind&&(ip=[Il*Ns.compositeIconSizes[0].evaluate(xo,{},co),Il*Ns.compositeIconSizes[1].evaluate(xo,{},co)],(ip[0]>Lc||ip[1]>Lc)&&Me(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Wp}. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,Sl,ip,So,vo,xo,!1,Vn,tn,Xd.lineStartIndex,Xd.lineLength,-1,qo,co,la,jc),uo=Yt.icon.placedSymbolArray.length-1,N0&&(BI=4*N0.length,Yt.addSymbols(Yt.icon,N0,ip,So,vo,xo,Ao.vertical,Vn,tn,Xd.lineStartIndex,Xd.lineLength,-1,qo,co,la,jc),zI=Yt.icon.placedSymbolArray.length-1)}for(const Wc in Yn.horizontal){const Sl=Yn.horizontal[Wc];Gc||(ay=mT(Sl.text),ci?N1=ju(Sl):Gc=ks(Ci,jh,tn,Zr,zr,Pr,Sl,Dr,Or.layout.get("text-rotate").evaluate(xo,{},co),Pi));const N0=1===Sl.positionedLines.length;if(VI+=hu(Yt,Vn,tn,Sl,yr,Or,ci,xo,Pi,Xd,Yn.vertical?Ao.horizontal:Ao.horizontalOnly,N0?Object.keys(Yn.horizontal):[Wc],Qd,uo,Ns,qo,co,la),N0)break}Yn.vertical&&(rp+=hu(Yt,Vn,tn,Yn.vertical,yr,Or,ci,xo,Pi,Xd,Ao.vertical,["vertical"],Qd,zI,Ns,qo,co,la));let Om=-1;const UI=(Wc,Sl)=>Wc?Math.max(Wc,Sl):Sl;Om=UI(N1,Om),Om=UI(NI,Om),Om=UI(F1,Om);const UC=Om>-1?1:0;Yt.glyphOffsetArray.length>=Av.MAX_GLYPHS&&Me("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==xo.sortKey&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,xo.sortKey),Yt.symbolInstances.emplaceBack(tn.x,tn.y,jh.x,jh.y,jh.z,Qd.right>=0?Qd.right:-1,Qd.center>=0?Qd.center:-1,Qd.left>=0?Qd.left:-1,Qd.vertical>=0?Qd.vertical:-1,uo,zI,ay,void 0!==Gc?Gc:Yt.collisionBoxArray.length,void 0!==Gc?Gc+1:Yt.collisionBoxArray.length,void 0!==L0?L0:Yt.collisionBoxArray.length,void 0!==L0?L0+1:Yt.collisionBoxArray.length,void 0!==k0?k0:Yt.collisionBoxArray.length,void 0!==k0?k0+1:Yt.collisionBoxArray.length,LI||Yt.collisionBoxArray.length,LI?LI+1:Yt.collisionBoxArray.length,Zr,VI,rp,FI,BI,UC,0,Jo,Hc,Om,0,Ua?1:0)}(t,Wt,pn,Ut,n,i,s,it,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,pe,ke,_,0,ve,Ae,R,e,c,y,v,w,C,S)};if("line"===$e)for(const Ut of gA(e.geometry,0,0,Vt,Vt)){const Wt=xv(Ut,oe,xe,n.vertical||z,i,H,W,t.overscaling,Vt);for(const ln of Wt)z&&wv(t,z.text,Ce,ln)||St(Ut,ln,w)}else if("line-center"===$e){for(const Ut of e.geometry)if(Ut.length>1){const Wt=mA(Ut,xe,n.vertical||z,i,H,W);Wt&&St(Ut,Wt,w)}}else if("Polygon"===e.type)for(const Ut of Fp(e.geometry,0)){const Wt=kS(Ut,16);St(Ut[0],new Uu(Wt.x,Wt.y,0,0,void 0),w)}else if("LineString"===e.type)for(const Ut of e.geometry)St(Ut,new Uu(Ut[0].x,Ut[0].y,0,0,void 0),w);else if("Point"===e.type)for(const Ut of e.geometry)for(const Wt of Ut)St([Wt],new Uu(Wt.x,Wt.y,0,0,void 0),w)}const Wp=255,Lc=Wp*Il;function hu(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R){const z=function(j,W,oe,pe,ve,xe,ke,Ae){const $e=[];if(0===W.positionedLines.length)return $e;const Ce=pe.layout.get("text-rotate").evaluate(xe,{})*Math.PI/180,nt=function(St){const Ut=St[0],Wt=St[1],ln=Ut*Wt;return ln>0?[Ut,-Wt]:ln<0?[-Ut,Wt]:0===Ut?[Wt,Ut]:[Wt,-Ut]}(oe);let ft=Math.abs(W.top-W.bottom);for(const St of W.positionedLines)ft-=St.lineOffset;const It=W.positionedLines.length,et=ft/It;let it=W.top-oe[1];for(let St=0;St<It;++St){const Ut=W.positionedLines[St];it=yA(W,et,it,St);for(const Wt of Ut.positionedGlyphs){if(!Wt.rect)continue;const ln=Wt.rect||{};let pn=ya+1,Yt=!0,tn=1,Vn=0;if(Wt.imageName){const So=ke[Wt.imageName];if(!So)continue;if(So.sdf){Me("SDF images are not supported in formatted text and will be ignored.");continue}Yt=!1,tn=So.pixelRatio,pn=va/tn}const Jn=(ve||Ae)&&Wt.vertical,Yn=Wt.metrics.advance*Wt.scale/2,Xn=Wt.metrics,yr=Wt.rect;if(null===yr)continue;Ae&&W.verticalizable&&(Vn=Wt.imageName?Yn-Wt.metrics.width*Wt.scale/2:0);const Fr=ve?[Wt.x+Yn,Wt.y]:[0,0];let Or=[0,0],Ci=[0,0],Zr=!1;ve||(Jn?(Ci=[Wt.x+Yn+nt[0],Wt.y+nt[1]-Vn],Zr=!0):Or=[Wt.x+Yn+oe[0],Wt.y+oe[1]-Vn]);const zr=yr.w*Wt.scale/(tn*(Wt.localGlyph?$u:1)),Pr=yr.h*Wt.scale/(tn*(Wt.localGlyph?$u:1));let Dr,ci,Pi,Jr;if(Jn){const So=Wt.y-it,xo=new me(-Yn,Yn-So),Ns=-Math.PI/2,Qo=new me(...Ci);Dr=new me(-Yn+Or[0],Or[1]),Dr._rotateAround(Ns,xo)._add(Qo),Dr.x+=-So+Yn,Dr.y-=(Xn.left-pn)*Wt.scale;const qo=Wt.imageName?Xn.advance*Wt.scale:_a*Wt.scale,co=String.fromCodePoint(Wt.glyph);pv(co)?Dr.x+=(1-pn)*Wt.scale:$p(co)?Dr.x+=qo-Xn.height*Wt.scale+(-pn-1)*Wt.scale:Dr.x+=Wt.imageName||Xn.width+2*pn===yr.w&&Xn.height+2*pn===yr.h?(qo-Pr)/2:(qo-(Xn.height+2*pn)*Wt.scale)/2,ci=new me(Dr.x,Dr.y-zr),Pi=new me(Dr.x+Pr,Dr.y),Jr=new me(Dr.x+Pr,Dr.y-zr)}else{const So=(Xn.left-pn)*Wt.scale-Yn+Or[0],xo=(-Xn.top-pn)*Wt.scale+Or[1],Ns=So+zr,Qo=xo+Pr;Dr=new me(So,xo),ci=new me(Ns,xo),Pi=new me(So,Qo),Jr=new me(Ns,Qo)}if(Ce){let So;So=ve?new me(0,0):Zr?new me(nt[0],nt[1]):new me(oe[0],oe[1]),Dr._rotateAround(Ce,So),ci._rotateAround(Ce,So),Pi._rotateAround(Ce,So),Jr._rotateAround(Ce,So)}const Xi=new me(0,0),vo=new me(0,0);$e.push({tl:Dr,tr:ci,bl:Pi,br:Jr,texPrimary:ln,texSecondary:void 0,writingMode:W.writingMode,glyphOffset:Fr,sectionIndex:Wt.sectionIndex,isSDF:Yt,pixelOffsetTL:Xi,pixelOffsetBR:vo,minFontScaleX:0,minFontScaleY:0})}}return $e}(0,i,_,c,d,f,s,t.allowVerticalPlacement),G=t.textSizeData;let H=null;"source"===G.kind?(H=[Il*c.layout.get("text-size").evaluate(f,{},P)],H[0]>Lc&&Me(`${t.layerIds[0]}: Value for "text-size" is >= ${Wp}. Reduce your "text-size".`)):"composite"===G.kind&&(H=[Il*S.compositeTextSizes[0].evaluate(f,{},P),Il*S.compositeTextSizes[1].evaluate(f,{},P)],(H[0]>Lc||H[1]>Lc)&&Me(`${t.layerIds[0]}: Value for "text-size" is >= ${Wp}. Reduce your "text-size".`)),t.addSymbols(t.text,z,H,_,d,f,v,e,n,y.lineStartIndex,y.lineLength,C,M,P,R,!1);for(const j of w)I[j]=t.text.placedSymbolArray.length-1;return 4*z.length}function qp(t){for(const e in t)return t[e];return null}function ks(t,e,n,i,s,c,d,f,_,y){let v=d.top,w=d.bottom,I=d.left,C=d.right;const S=d.collisionPadding;if(S&&(I-=S[0],v-=S[1],C+=S[2],w+=S[3]),_){const M=new me(I,v),P=new me(C,v),R=new me(I,w),z=new me(C,w),G=De(_);let H=new me(0,0);y&&(H=new me(y[0],y[1])),M._rotateAround(G,H),P._rotateAround(G,H),R._rotateAround(G,H),z._rotateAround(G,H),I=Math.min(M.x,P.x,R.x,z.x),C=Math.max(M.x,P.x,R.x,z.x),v=Math.min(M.y,P.y,R.y,z.y),w=Math.max(M.y,P.y,R.y,z.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,I,v,C,w,f,i,s,c),t.length-1}function ju(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function wv(t,e,n,i){const s=t.compareText;if(e in s){const c=s[e];for(let d=c.length-1;d>=0;d--)if(i.dist(c[d])<n)return!0}else s[e]=[];return s[e].push(i),!1}function $l(t,e){const n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),c=Math.sin(n)*s/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),d=Math.sin(t._pitch)*c+s;return Math.min(1.01*d,s*(1/t._horizonShift))}function Pd(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),i=t.x*n,s=(t.x+1)*n,c=t.y*n,d=(t.y+1)*n,f=Oc(i),_=Oc(s),y=Gs(c),v=Gs(d),w=e.project(f,y),I=e.project(_,y),C=e.project(_,v),S=e.project(f,v);let M=Math.min(w.x,I.x,C.x,S.x),P=Math.min(w.y,I.y,C.y,S.y),R=Math.max(w.x,I.x,C.x,S.x),z=Math.max(w.y,I.y,C.y,S.y);const G=n/16;function H(W,oe,pe,ve,xe,ke){const Ae=(pe+xe)/2,$e=(ve+ke)/2,Ce=e.project(Oc(Ae),Gs($e)),nt=Math.max(0,M-Ce.x,P-Ce.y,Ce.x-R,Ce.y-z);M=Math.min(M,Ce.x),R=Math.max(R,Ce.x),P=Math.min(P,Ce.y),z=Math.max(z,Ce.y),nt>G&&(H(W,Ce,pe,ve,Ae,$e),H(Ce,oe,Ae,$e,xe,ke))}H(w,I,i,c,s,c),H(I,C,s,c,s,d),H(C,S,s,d,i,d),H(S,w,i,d,i,c),M-=G,P-=G,R+=G,z+=G;const j=1/Math.max(R-M,z-P);return{scale:j,x:M*j,y:P*j,x2:R*j,y2:z*j,projection:e}}function Mf(t,e,n,i,s,c,d,f,_){if("globe"===_.name)return WT(t,e,new vh(n,i,s),!1);const y=Pd({z:n,x:i,y:s},_);return new bo([(c+y.x/y.scale)*e,e*(y.y/y.scale),d],[(c+y.x2/y.scale)*e,e*(y.y2/y.scale),f])}function Nc(t,{x:e,y:n},i=0){return new me(((e-i)*t.scale-t.x)*Vt,(n*t.scale-t.y)*Vt)}function Rf(t,e,n=0){return He.fromValues(((e.x-n)*t.scale-t.x)*Vt,(e.y*t.scale-t.y)*Vt,vS(e.z,e.y))}const Yp=Dt.identity(new Float32Array(16));class pc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new kr(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return Zi(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return $l(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,s){const c=e.horizonLineFromTop(!1),d=new me(n,Math.max(c,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,s))}pointCoordinate3D(e,n,i){const s=new me(n,i);if(e.elevation)return e.elevation.pointCoordinate(s);{const c=this.pointCoordinate(e,s.x,s.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return Yp}createTileMatrix(e,n,i){let s,c,d;const f=i.canonical,_=Dt.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=Pd(f,this);s=1,c=y.x+i.wrap*y.scale,d=y.y,Dt.scale(_,_,[s/y.scale,s/y.scale,e.pixelsPerMeter/n])}else s=n/e.zoomScale(f.z),c=(f.x+Math.pow(2,f.z)*i.wrap)*s,d=f.y*s;return Dt.translate(_,_,[c,d,0]),Dt.scale(_,_,[s/Vt,s/Vt,1]),_}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class Zp extends pc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,i]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(De(n));this.n=(s+Math.sin(De(i)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:i,c:s,r0:c}=this,d=De(e-this.center[0]),f=De(n),_=Math.sqrt(s-2*i*Math.sin(f))/i;return{x:_*Math.sin(d*i),y:_*Math.cos(d*i)-c,z:0}}unproject(e,n){const{n:i,c:s,r0:c}=this,d=c+n;let f=Math.atan2(e,Math.abs(d))*Math.sign(d);d*i<0&&(f-=Math.PI*Math.sign(e)*Math.sign(d));const _=De(this.center[0])*i;f=yt(f,-Math.PI-_,Math.PI-_);const y=_n(dt(f/i)+this.center[0],-180,180),v=Math.asin(_n((s-(e*e+d*d)*i*i)/(2*i),-1,1)),w=_n(dt(v),-As,As);return new kr(y,w)}}const Fc=1.340264,oa=-.081106,Gu=893e-6,Kp=.003796,Od=Math.sqrt(3)/2;class xA extends pc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(Od*Math.sin(n)),s=i*i,c=s*s*s;return{x:.5*(e*Math.cos(i)/(Od*(Fc+3*oa*s+c*(7*Gu+9*Kp*s)))/Math.PI+.5),y:1-.5*(i*(Fc+oa*s+c*(Gu+Kp*s))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,s=i*i,c=s*s*s;for(let v,w,I,C=0;C<12&&(w=i*(Fc+oa*s+c*(Gu+Kp*s))-n,I=Fc+3*oa*s+c*(7*Gu+9*Kp*s),v=w/I,i=_n(i-v,-Math.PI/3,Math.PI/3),s=i*i,c=s*s*s,!(Math.abs(v)<1e-12));++C);const d=Od*e*(Fc+3*oa*s+c*(7*Gu+9*Kp*s))/Math.cos(i),f=Math.asin(Math.sin(i)/Od),_=_n(180*d/Math.PI,-180,180),y=_n(180*f/Math.PI,-As,As);return new kr(_,y)}}class fu extends pc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const i=360*(e-.5),s=_n(360*(.5-n),-As,As);return new kr(i,s)}}const Ih=Math.PI/2;function Po(t){return Math.tan((Ih+t)/2)}class bA extends pc{constructor(e){super(e),this.center=e.center||[0,30];const[n,i]=this.parallels=e.parallels||[30,30];let s=De(n),c=De(i);this.southernCenter=s+c<0,this.southernCenter&&(s=-s,c=-c);const d=Math.cos(s),f=Po(s);this.n=s===c?Math.sin(s):Math.log(d/Math.cos(c))/Math.log(Po(c)/f),this.f=d*Math.pow(Po(s),this.n)/this.n}project(e,n){n=De(n),this.southernCenter&&(n=-n),e=De(e-this.center[0]);const i=1e-6,{n:s,f:c}=this;c>0?n<-Ih+i&&(n=-Ih+i):n>Ih-i&&(n=Ih-i);const d=c/Math.pow(Po(n),s);let f=d*Math.sin(s*e),_=c-d*Math.cos(s*e);return f=.5*(f/Math.PI+.5),_=.5*(_/Math.PI+.5),{x:f,y:this.southernCenter?_:1-_,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:i,f:s}=this,c=s-n,d=Math.sign(c),f=Math.sign(i)*Math.sqrt(e*e+c*c);let _=Math.atan2(e,Math.abs(c))*d;c*i<0&&(_-=Math.PI*Math.sign(e)*d);const y=_n(dt(_/i)+this.center[0],-180,180),v=_n(dt(2*Math.atan(Math.pow(s/f,1/i))-Ih),-As,As);return new kr(y,this.southernCenter?-v:v)}}class Ev extends pc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:tl(e),y:Sa(n),z:0}}unproject(e,n){const i=Oc(e),s=Gs(n);return new kr(i,s)}}const pu=De(As);class Iv extends pc{project(e,n){const i=(n=De(n))*n,s=i*i;return{x:.5*((e=De(e))*(.8707-.131979*i+s*(s*(.003971*i-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+s*(.028874*i-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,s=25,c=0,d=i*i;do{d=i*i;const y=d*d;c=(i*(1.007226+d*(.015085+y*(.028874*d-.044475-.005916*y)))-n)/(1.007226+d*(.045255+y*(.259866*d-.311325-.005916*11*y))),i=_n(i-c,-pu,pu)}while(Math.abs(c)>1e-6&&--s>0);d=i*i;const f=_n(dt(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),_=dt(i);return new kr(f,_)}}const Hu=De(As);class r_ extends pc{project(e,n){n=De(n),e=De(e);const i=Math.cos(n),s=2/Math.PI,c=Math.acos(i*Math.cos(e/2)),d=Math.sin(c)/c,f=.5*(e*s+2*i*Math.sin(e/2)/d)||0,_=.5*(n+Math.sin(n)/d)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(_/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,s=n=(2*(1-n)-1)*Math.PI,c=25;const d=1e-6;let f=0,_=0;do{const y=Math.cos(s),v=Math.sin(s),w=2*v*y,I=v*v,C=y*y,S=Math.cos(i/2),M=Math.sin(i/2),P=2*S*M,R=M*M,z=1-C*S*S,G=z?1/z:0,H=z?Math.acos(y*S)*Math.sqrt(1/z):0,j=.5*(2*H*y*M+2*i/Math.PI)-e,W=.5*(H*v+s)-n,oe=.5*G*(C*R+H*y*S*I)+1/Math.PI,pe=G*(P*w/4-H*v*M),ve=.125*G*(w*M-H*v*C*P),xe=.5*G*(I*S+H*R*y)+.5,ke=pe*ve-xe*oe;f=(W*pe-j*xe)/ke,_=(j*ve-W*oe)/ke,i=_n(i-f,-Math.PI,Math.PI),s=_n(s-_,-Hu,Hu)}while((Math.abs(f)>d||Math.abs(_)>d)&&--c>0);return new kr(dt(i),dt(s))}}class _b extends pc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:i,cosPhi:s}=this;return{x:De(e)*s*i+.5,y:-Math.sin(De(n))/s*i+.5,z:0}}unproject(e,n){const{scale:i,cosPhi:s}=this,c=-(n-.5)/i,d=_n(dt((e-.5)/i)/s,-180,180),f=Math.asin(_n(c*s,-1,1)),_=_n(dt(f),-As,As);return new kr(d,_)}}class yb extends Ev{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){const s=Rp(e,n,i),c=Cg(au(i));return He.transformMat4(s,s,c),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,n){const i=hc(n.lat,n.lng),s=He.normalize([],i),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,d=Zi(1,0)*Vt*c;He.scaleAndAdd(i,i,s,d);const f=Dt.identity(new Float64Array(16));return Dt.multiply(f,e.pixelMatrix,e.globeMatrix),He.transformMat4(i,i,f),new me(i[0],i[1])}pixelsPerMeter(e,n){return Zi(1,0)*n}pixelSpaceConversion(e,n,i){const s=Zi(1,e)*n,c=Er(Zi(1,45)*n,s,i);return this.pixelsPerMeter(e,n)/c}createTileMatrix(e,n,i){const s=qT(au(i.canonical));return Dt.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,n){const{center:i}=e,s=Cg(au(n));return Dt.rotateY(s,s,De(i.lng)),Dt.rotateX(s,s,De(i.lat)),Dt.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,n,i,s){return vw(e,n,i,!0)||new Ri(0,0)}pointCoordinate3D(e,n,i){const s=this.pointCoordinate(e,n,i,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,n){return!vw(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(s,c){const d=s.cameraToCenterDistance,f=s._centerAltitude*c,_=s._camera,y=s._camera.forward(),v=He.add([],He.scale([],y,-d),[0,0,f]),w=s.worldSize/(2*Math.PI),I=[0,0,-w],C=s.width/s.height,S=Math.tan(s.fovAboveCenter),M=He.scale([],_.up(),S),P=He.scale([],_.right(),S*C),R=He.normalize([],He.add([],He.add([],y,M),P)),z=[];let G;if(new qy(v,R).closestPointOnSphere(I,w,z)){const H=He.add([],z,I),j=He.sub([],H,v);G=Math.cos(s.fovAboveCenter)*He.length(j)}else{const H=He.sub([],v,I),j=He.sub([],I,v);He.normalize(j,j);const W=He.length(H)-w;G=Math.sqrt(W*(W+2*w));const oe=Math.acos(G/(w+W))-Math.acos(He.dot(y,j));G*=Math.cos(oe)}return 1.01*G}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=el(e.zoom);if(i>0){const s=$l(e,Zi(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Er(n,s+c*(1-Math.cos(d)),Math.pow(i,10))}return n}upVector(e,n,i){return Rp(n,i,e,1)}upVectorScale(e){return{metersToTile:Vx(Ag(au(e)))}}}function rl(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Ev(t);case"equirectangular":return new fu(t);case"naturalEarth":return new Iv(t);case"equalEarth":return new xA(t);case"winkelTripel":return new r_(t);case"albers":return n?new _b(t):new Zp(t);case"lambertConformalConic":return n?new _b(t):new bA(t);case"globe":return new yb(t)}throw new Error(`Invalid projection name: ${t.name}`)}const mc=new gs({"symbol-placement":new On(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new On(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ir(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(ut.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new On(ut.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new On(ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ir(ut.layout_symbol["icon-size"]),"icon-text-fit":new Ir(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ir(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ir(ut.layout_symbol["icon-image"]),"icon-rotate":new Ir(ut.layout_symbol["icon-rotate"]),"icon-padding":new On(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new On(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new Ir(ut.layout_symbol["icon-offset"]),"icon-anchor":new Ir(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(ut.layout_symbol["text-rotation-alignment"]),"text-field":new Ir(ut.layout_symbol["text-field"]),"text-font":new Ir(ut.layout_symbol["text-font"]),"text-size":new Ir(ut.layout_symbol["text-size"]),"text-max-width":new Ir(ut.layout_symbol["text-max-width"]),"text-line-height":new Ir(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new Ir(ut.layout_symbol["text-letter-spacing"]),"text-justify":new Ir(ut.layout_symbol["text-justify"]),"text-radial-offset":new Ir(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(ut.layout_symbol["text-variable-anchor"]),"text-anchor":new Ir(ut.layout_symbol["text-anchor"]),"text-max-angle":new On(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new On(ut.layout_symbol["text-writing-mode"]),"text-rotate":new Ir(ut.layout_symbol["text-rotate"]),"text-padding":new On(ut.layout_symbol["text-padding"]),"text-keep-upright":new On(ut.layout_symbol["text-keep-upright"]),"text-transform":new Ir(ut.layout_symbol["text-transform"]),"text-offset":new Ir(ut.layout_symbol["text-offset"]),"text-allow-overlap":new On(ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(ut.layout_symbol["text-ignore-placement"]),"text-optional":new On(ut.layout_symbol["text-optional"]),visibility:new On(ut.layout_symbol.visibility)});var Fa={paint:new gs({"icon-opacity":new Ir(ut.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Ir(ut.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ir(ut.paint_symbol["text-emissive-strength"]),"icon-color":new Ir(ut.paint_symbol["icon-color"]),"icon-halo-color":new Ir(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ir(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ir(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new On(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(ut.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ir(ut.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ir(ut.paint_symbol["text-opacity"]),"text-color":new Ir(ut.paint_symbol["text-color"],{runtimeType:rs,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ir(ut.paint_symbol["text-halo-color"]),"text-halo-width":new Ir(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new Ir(ut.paint_symbol["text-halo-blur"]),"text-translate":new On(ut.paint_symbol["text-translate"]),"text-translate-anchor":new On(ut.paint_symbol["text-translate-anchor"])}),layout:mc};class Xp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lr(Xp,"FormatSectionOverride",{omit:["defaultValue"]});class i_ extends uc{constructor(e,n){super(e,Fa,n)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const s=[];for(const c of i)s.indexOf(c)<0&&s.push(c);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,i,s){const c=this.layout.get(e).evaluate(n,{},i,s),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Bn(d.value)||!c?c:(f=n.properties,c.replace(/{([^{}]+)}/g,(y,v)=>v in f?String(f[v]):""));var f}createBucket(e){return new Av(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Fa.paint.overridableProperties){if(!i_.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),i=new Xp(n),s=new jt(i,n.property.specification);let c=null;c="constant"===n.value.kind||"source"===n.value.kind?new ar("source",s):new _r("composite",s,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new vp(n.property,c,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&i_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const i=e.get("text-field"),s=Fa.paint.properties[n];let c=!1;const d=f=>{for(const _ of f)if(s.overrides&&s.overrides.hasOverride(_))return void(c=!0)};if("constant"===i.value.kind&&i.value.value instanceof Us)d(i.value.value.sections);else if("source"===i.value.kind){const f=y=>{c||(y instanceof Rl&&bs(y.value)===$a?d(y.value.sections):y instanceof No?d(y.sections):y.eachChild(f))},_=i.value;_._styleExpression&&f(_._styleExpression.expression)}return c}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n){return{config:new hf(this,n),overrideFog:!1}}}const vb=Ug.types,xb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Tv(t,e,n,i,s,c,d,f,_,y,v,w,I){const C=f?Math.min(Lc,Math.round(f[0])):0,S=f?Math.min(Lc,Math.round(f[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*s),c,d,(C<<1)+(_?1:0),S,16*y,16*v,256*w,256*I)}function kd(t,e,n){t.emplaceBack(e,n)}function hE(t,e,n,i,s,c,d){t.emplaceBack(e,n,i,s,c,d)}function xa(t,e,n,i,s){const c=5*e+2;t.float32[c+0]=n,t.float32[c+1]=i,t.float32[c+2]=s}function o_(t,e,n,i,s){t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s),t.emplaceBack(e,n,i,s)}function WD(t){for(const e of t.sections)if(MD(e.text))return!0;return!1}class wA{constructor(e){this.layoutVertexArray=new Sy,this.indexArray=new Is,this.programConfigurations=e,this.segments=new so,this.dynamicLayoutVertexArray=new dh,this.opacityVertexArray=new sx,this.placedSymbolArray=new QC,this.iconTransitioningVertexArray=new gd,this.globeExtVertexArray=new ox,this.zOffsetVertexArray=new hh}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,n,i,s,c){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,fv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,xb,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,hA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ub.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Kg.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}lr(wA,"SymbolBuffers");class fE{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new so,this.collisionVertexArray=new Dy,this.collisionVertexArrayExt=new Sc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,db.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,MS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}lr(fE,"CollisionBuffers");class pE{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dt.identity([]),this.placementViewportMatrix=Dt.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vu(this.zoom,n["text-size"]),this.iconSizeData=Vu(this.zoom,n["icon-size"]);const i=this.layers[0].layout,s=i.get("symbol-sort-key"),c=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==s.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(d=>Ao[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new wA(new cg(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new wA(new cg(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new dx,this.lineVertexArray=new nw,this.symbolInstances=new ux}calculateGlyphDependencies(e,n,i,s,c){for(let d=0;d<e.length;d++){const f=e.codePointAt(d);if(void 0===f)break;if(n[f]=!0,s&&c&&f<=65535){const _=fc[e.charAt(d)];_&&(n[_.charCodeAt(0)]=!0)}}}populate(e,n,i,s){const c=this.layers[0],d=c.layout,f="globe"===this.projection.name,_=d.get("text-font"),y=d.get("text-field"),v=d.get("icon-image"),w=("constant"!==y.value.kind||y.value.value instanceof Us&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),I="constant"!==v.value.kind||!!v.value.value||Object.keys(v.parameters).length>0,C=d.get("symbol-sort-key");if(this.features=[],!w&&!I)return;const S=n.iconDependencies,M=n.glyphDependencies,P=n.availableImages,R=new Vo(this.zoom);for(const{feature:z,id:G,index:H,sourceLayerIndex:j}of e){const W=c._featureFilter.needGeometry,oe=xf(z,W);if(!c._featureFilter.filter(R,oe,i))continue;if(W||(oe.geometry=bh(z,i,s)),f&&1!==z.type&&i.z<=5){const ke=oe.geometry,Ae=.98078528056,$e=(Ce,nt)=>{const ft=Rp(Ce.x,Ce.y,i,1),It=Rp(nt.x,nt.y,i,1);return He.dot(ft,It)<Ae};for(let Ce=0;Ce<ke.length;Ce++)ke[Ce]=UD(ke[Ce],$e)}let pe,ve;if(w){const ke=c.getValueAndResolveTokens("text-field",oe,i,P),Ae=Us.factory(ke);WD(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Fl()||this.hasRTLText&&Bl.isParsed())&&(pe=Cs(Ae,c,oe))}if(I){const ke=c.getValueAndResolveTokens("icon-image",oe,i,P);ve=ke instanceof ea?ke:ea.fromString(ke)}if(!pe&&!ve)continue;const xe=this.sortFeaturesByKey?C.evaluate(oe,{},i):void 0;if(this.features.push({id:G,text:pe,icon:ve,index:H,sourceLayerIndex:j,geometry:oe.geometry,properties:z.properties,type:vb[z.type],sortKey:xe}),ve&&(S[ve.namePrimary]=!0,ve.nameSecondary&&(S[ve.nameSecondary]=!0)),pe){const ke=_.evaluate(oe,{},i).join(","),Ae="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ao.vertical)>=0;for(const $e of pe.sections)if($e.image)S[$e.image.namePrimary]=!0;else{const Ce=Ay(pe.toString()),nt=$e.fontStack||ke,ft=M[nt]=M[nt]||{};this.calculateGlyphDependencies($e.text,ft,Ae,this.allowVerticalPlacement,Ce)}}}"line"===d.get("symbol-placement")&&(this.features=function(z){const G={},H={},j=[];let W=0;function oe(ke){j.push(z[ke]),W++}function pe(ke,Ae,$e){const Ce=H[ke];return delete H[ke],H[Ae]=Ce,j[Ce].geometry[0].pop(),j[Ce].geometry[0]=j[Ce].geometry[0].concat($e[0]),Ce}function ve(ke,Ae,$e){const Ce=G[Ae];return delete G[Ae],G[ke]=Ce,j[Ce].geometry[0].shift(),j[Ce].geometry[0]=$e[0].concat(j[Ce].geometry[0]),Ce}function xe(ke,Ae,$e){const Ce=$e?Ae[0][Ae[0].length-1]:Ae[0][0];return`${ke}:${Ce.x}:${Ce.y}`}for(let ke=0;ke<z.length;ke++){const Ae=z[ke],$e=Ae.geometry,Ce=Ae.text?Ae.text.toString():null;if(!Ce){oe(ke);continue}const nt=xe(Ce,$e),ft=xe(Ce,$e,!0);if(nt in H&&ft in G&&H[nt]!==G[ft]){const It=ve(nt,ft,$e),et=pe(nt,ft,j[It].geometry);delete G[nt],delete H[ft],H[xe(Ce,j[et].geometry,!0)]=et,j[It].geometry=null}else nt in H?pe(nt,ft,$e):ft in G?ve(nt,ft,$e):(oe(ke),G[nt]=W-1,H[ft]=W-1)}return j.filter(ke=>ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((z,G)=>z.sortKey-G.sortKey)}update(e,n,i,s,c){const d=0!==Object.keys(e).length;if(d&&!this.stateDependentLayers.length)return;const f=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,f,i,s,c),this.icon.programConfigurations.updatePaintArrays(e,n,f,i,s,c)}updateZOffset(){const e=(c,d,f)=>{i+=d,i>c.length&&c.resize(i);for(let _=-d;_<0;_++)c.emplace(_+i,f)},n=(c,d,f)=>{s+=d,s>c.length&&c.resize(s);for(let _=-d;_<0;_++)c.emplace(_+s,f)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,s=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:f,numVerticalGlyphVertices:_,numIconVertices:y}=d,v=d.zOffset,w=y>0;if((f>0||_>0)&&(e(this.text.zOffsetVertexArray,f,v),e(this.text.zOffsetVertexArray,_,v)),w){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:C}=d;I>=0&&n(this.icon.zOffsetVertexArray,y,v),C>=0&&n(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rl(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:s,y:c}of n)this.lineVertexArray.emplaceBack(s,c);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P){const R=e.indexArray,z=e.layoutVertexArray,G=e.globeExtVertexArray,H=e.segments.prepareSegment(4*n.length,z,R,this.canOverlap?d.sortKey:void 0),j=this.glyphOffsetArray.length,W=H.vertexLength,oe=this.allowVerticalPlacement&&f===Ao.vertical?Math.PI/2:0,pe=d.text&&d.text.sections;for(let xe=0;xe<n.length;xe++){const{tl:ke,tr:Ae,bl:$e,br:Ce,texPrimary:nt,texSecondary:ft,pixelOffsetTL:It,pixelOffsetBR:et,minFontScaleX:it,minFontScaleY:St,glyphOffset:Ut,isSDF:Wt,sectionIndex:ln}=n[xe],pn=H.vertexLength,Yt=Ut[1];if(Tv(z,y.x,y.y,ke.x,Yt+ke.y,nt.x,nt.y,i,Wt,It.x,It.y,it,St),Tv(z,y.x,y.y,Ae.x,Yt+Ae.y,nt.x+nt.w,nt.y,i,Wt,et.x,It.y,it,St),Tv(z,y.x,y.y,$e.x,Yt+$e.y,nt.x,nt.y+nt.h,i,Wt,It.x,et.y,it,St),Tv(z,y.x,y.y,Ce.x,Yt+Ce.y,nt.x+nt.w,nt.y+nt.h,i,Wt,et.x,et.y,it,St),_){const{x:tn,y:Vn,z:Jn}=_.anchor,[Yn,Xn,yr]=_.up;hE(G,tn,Vn,Jn,Yn,Xn,yr),hE(G,tn,Vn,Jn,Yn,Xn,yr),hE(G,tn,Vn,Jn,Yn,Xn,yr),hE(G,tn,Vn,Jn,Yn,Xn,yr),o_(e.dynamicLayoutVertexArray,tn,Vn,Jn,oe)}else o_(e.dynamicLayoutVertexArray,y.x,y.y,y.z,oe);if(P){const tn=ft||nt;kd(e.iconTransitioningVertexArray,tn.x,tn.y),kd(e.iconTransitioningVertexArray,tn.x+tn.w,tn.y),kd(e.iconTransitioningVertexArray,tn.x,tn.y+tn.h),kd(e.iconTransitioningVertexArray,tn.x+tn.w,tn.y+tn.h)}R.emplaceBack(pn,pn+1,pn+2),R.emplaceBack(pn+1,pn+2,pn+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),xe!==n.length-1&&ln===n[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(z.length,d,d.index,{},C,S,M,pe&&pe[ln])}const ve=_?_.anchor:y;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,y.x,y.y,j,this.glyphOffsetArray.length-j,W,v,w,y.segment,i?i[0]:0,i?i[1]:0,s[0],s[1],f,0,!1,0,I,0)}_commitLayoutVertex(e,n,i,s,c,d,f){e.emplaceBack(n,i,s,c,d,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,n,i,s,c,d,f){const _=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),y=_.vertexLength,v=f.tileAnchorX,w=f.tileAnchorY;for(let C=0;C<4;C++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,s,c,d,v,w,new me(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,s,c,d,v,w,new me(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,s,c,d,v,w,new me(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,s,c,d,v,w,new me(e.x1,e.y2)),_.vertexLength+=4;const I=i.indexArray;I.emplaceBack(y,y+1),I.emplaceBack(y+1,y+2),I.emplaceBack(y+2,y+3),I.emplaceBack(y+3,y),_.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,s,c,d){for(let f=s;f<c;f++){const _=i.get(f),y=this.getSymbolInstanceTextSize(e,d,n,f);this._addCollisionDebugVertices(_,y,this.textCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,n,i,s,c,d){for(let f=s;f<c;f++){const _=i.get(f),y=this.getSymbolInstanceIconSize(e,n,d.placedIconSymbolIndex);this._addCollisionDebugVertices(_,y,this.iconCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fE(tg,nE.members,gd),this.iconCollisionBox=new fE(tg,nE.members,gd);const i=kc(this.iconSizeData,e),s=kc(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(s,e,n,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(s,e,n,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(i,e,n,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(i,e,n,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,n,i,s){const c=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:s),d=Sf(this.textSizeData,e,c)/_a;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,n,i){const s=this.icon.placedSymbolArray.get(i),c=Sf(this.iconSizeData,e,s);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,n,i){e.emplaceBack(n,-i,-i),e.emplaceBack(n,i,-i),e.emplaceBack(n,i,i),e.emplaceBack(n,-i,i)}_updateTextDebugCollisionBoxes(e,n,i,s,c,d){for(let f=s;f<c;f++){const _=i.get(f),y=this.getSymbolInstanceTextSize(e,d,n,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,_.padding)}}_updateIconDebugCollisionBoxes(e,n,i,s,c,d){for(let f=s;f<c;f++){const _=i.get(f),y=this.getSymbolInstanceIconSize(e,n,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,_.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=kc(this.iconSizeData,e),s=kc(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(s,e,n,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(s,e,n,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(i,e,n,d.iconBoxStartIndex,d.iconBoxEndIndex,d.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,n,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,s,c,d,f,_,y){const v={};if(n<i){const{x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H,featureIndex:j}=e.get(n);v.textBox={x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H},v.textFeatureIndex=j}if(s<c){const{x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H,featureIndex:j}=e.get(s);v.verticalTextBox={x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H},v.verticalTextFeatureIndex=j}if(d<f){const{x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H,featureIndex:j}=e.get(d);v.iconBox={x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H},v.iconFeatureIndex=j}if(_<y){const{x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H,featureIndex:j}=e.get(_);v.verticalIconBox={x1:w,y1:I,x2:C,y2:S,padding:M,projectedAnchorX:P,projectedAnchorY:R,projectedAnchorZ:z,tileAnchorX:G,tileAnchorY:H},v.verticalIconFeatureIndex=j}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const i=e.placedSymbolArray.get(n),s=i.vertexStartIndex+4*i.numGlyphs;for(let c=i.vertexStartIndex;c<s;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),i=Math.cos(e),s=[],c=[],d=[];for(let f=0;f<this.symbolInstances.length;++f){d.push(f);const _=this.symbolInstances.get(f);s.push(0|Math.round(n*_.tileAnchorX+i*_.tileAnchorY)),c.push(_.featureIndex)}return d.sort((f,_)=>s[f]-s[_]||c[_]-c[f]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:f,placedIconSymbolIndex:_,verticalPlacedIconSymbolIndex:y}=i;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),c>=0&&c!==s&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==s&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}lr(pE,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),pE.MAX_GLYPHS=65535,pE.addDynamicAttributes=o_;var Av=pE;const LS=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Cv}=LS,NS=Gi([{name:"a_packed",components:4,type:"Float32"}]),{members:EA}=NS,Ba=Ug.types,Sv=Math.cos(Math.PI/180*37.5);class mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new eg,this.layoutVertexArray2=new dh,this.indexArray=new Is,this.programConfigurations=new cg(e.layers,e.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,s){this.hasPattern=iv("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:v,id:w,index:I,sourceLayerIndex:C}of e){const S=this.layers[0]._featureFilter.needGeometry,M=xf(v,S);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),M,i))continue;const P=c?c.evaluate(M,{},i):void 0,R={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:I,geometry:S?M.geometry:bh(v,i,s),patterns:{},sortKey:P};d.push(R)}c&&d.sort((v,w)=>v.sortKey-w.sortKey);const{lineAtlas:f,featureIndex:_}=n,y=this.addConstantDashes(f);for(const v of d){const{geometry:w,index:I,sourceLayerIndex:C}=v;if(y&&this.addFeatureDashes(v,f),this.hasPattern){const S=Ef("line",this.layers,v,this.zoom,n);this.patternFeatures.push(S)}else this.addFeature(v,w,I,i,f.positions,n.availableImages,n.brightness);_.insert(e[I].feature,w,I,C,this.index)}}addConstantDashes(e){let n=!1;for(const i of this.layers){const s=i.paint.get("line-dasharray").value,c=i.layout.get("line-cap").value;if("constant"!==s.kind||"constant"!==c.kind)n=!0;else{const d=c.value,f=s.value;if(!f)continue;e.addDash(f,d)}}return n}addFeatureDashes(e,n){const i=this.zoom;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===d.kind)continue;let f,_;if("constant"===c.kind){if(f=c.value,!f)continue}else f=c.evaluate({zoom:i},e);_="constant"===d.kind?d.value:d.evaluate({zoom:i},e),n.addDash(f,_),e.patterns[s.id]=n.getKey(f,_)}}update(e,n,i,s,c){const d=0!==Object.keys(e).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,i,s,c)}addFeatures(e,n,i,s,c,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,i,s,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,EA)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,s,c,d,f){const _=this.layers[0].layout,y=_.get("line-join").evaluate(e,{}),v=_.get("line-cap").evaluate(e,{}),w=_.get("line-miter-limit"),I=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of n)this.addLine(C,e,y,v,w,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,c,d,s,f)}addLine(e,n,i,s,c,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let R=0;R<e.length-1;R++)this.totalDistance+=e[R].dist(e[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f="Polygon"===Ba[n.type];let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let y=0;for(;y<_-1&&e[y].equals(e[y+1]);)y++;if(_<(f?3:2))return;"bevel"===i&&(c=1.05);const v=this.overscaling<=16?15*Vt/(512*this.overscaling):0,w=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let I,C,S,M,P;this.e1=this.e2=-1,f&&(I=e[_-2],P=e[y].sub(I)._unit()._perp());for(let R=y;R<_;R++){if(S=R===_-1?f?e[y+1]:void 0:e[R+1],S&&e[R].equals(S))continue;P&&(M=P),I&&(C=I),I=e[R],P=S?S.sub(I)._unit()._perp():M,M=M||P;let z=M.add(P);0===z.x&&0===z.y||z._unit();const G=M.x*P.x+M.y*P.y,H=z.x*P.x+z.y*P.y,j=0!==H?1/H:1/0,W=2*Math.sqrt(2-2*H),oe=H<Sv&&C&&S,pe=M.x*P.y-M.y*P.x>0;if(oe&&R>y){const ke=I.dist(C);if(ke>2*v){const Ae=I.sub(I.sub(C)._mult(v/ke)._round());this.updateDistance(C,Ae),this.addCurrentVertex(Ae,M,0,0,w),C=Ae}}const ve=C&&S;let xe=ve?i:f?"butt":s;if(ve&&"round"===xe&&(j<d?xe="miter":j<=2&&(xe="fakeround")),"miter"===xe&&j>c&&(xe="bevel"),"bevel"===xe&&(j>2&&(xe="flipbevel"),j<c&&(xe="miter")),C&&this.updateDistance(C,I),"miter"===xe)z._mult(j),this.addCurrentVertex(I,z,0,0,w);else if("flipbevel"===xe){if(j>100)z=P.mult(-1);else{const ke=j*M.add(P).mag()/M.sub(P).mag();z._perp()._mult(ke*(pe?-1:1))}this.addCurrentVertex(I,z,0,0,w),this.addCurrentVertex(I,z.mult(-1),0,0,w)}else if("bevel"===xe||"fakeround"===xe){const ke=-Math.sqrt(j*j-1),Ae=pe?ke:0,$e=pe?0:ke;if(C&&this.addCurrentVertex(I,M,Ae,$e,w),"fakeround"===xe){const Ce=Math.round(180*W/Math.PI/20);for(let nt=1;nt<Ce;nt++){let ft=nt/Ce;if(.5!==ft){const et=ft-.5;ft+=ft*et*(ft-1)*((1.0904+G*(G*(3.55645-1.43519*G)-3.2452))*et*et+(.848013+G*(.215638*G-1.06021)))}const It=P.sub(M)._mult(ft)._add(M)._unit()._mult(pe?-1:1);this.addHalfVertex(I,It.x,It.y,!1,pe,0,w)}}S&&this.addCurrentVertex(I,P,-Ae,-$e,w)}else if("butt"===xe)this.addCurrentVertex(I,z,0,0,w);else if("square"===xe){const ke=C?1:-1;C||this.addCurrentVertex(I,z,ke,ke,w),this.addCurrentVertex(I,z,0,0,w),C&&this.addCurrentVertex(I,z,ke,ke,w)}else"round"===xe&&(C&&(this.addCurrentVertex(I,M,0,0,w),this.addCurrentVertex(I,M,1,1,w,!0)),S&&(this.addCurrentVertex(I,P,-1,-1,w,!0),this.addCurrentVertex(I,P,0,0,w)));if(oe&&R<_-1){const ke=I.dist(S);if(ke>2*v){const Ae=I.add(S.sub(I)._mult(v/ke)._round());this.updateDistance(I,Ae),this.addCurrentVertex(Ae,P,0,0,w),I=Ae}}}}addCurrentVertex(e,n,i,s,c,d=!1){const f=n.y*s-n.x,_=-n.y-n.x*s;this.addHalfVertex(e,n.x+n.y*i,n.y-n.x*i,d,!1,i,c),this.addHalfVertex(e,f,_,d,!0,-s,c)}addHalfVertex({x:e,y:n},i,s,c,d,f,_){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(n<<1)+(d?1:0),Math.round(63*i)+128,Math.round(63*s)+128,1+(0===f?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),_.primitiveLength++),d?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}lr(mu,"LineBucket",{omit:["layers","patternFeatures"]});class ls{constructor(e,n,i,s){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,i){const{width:s,height:c}=e,{context:d}=this,{gl:f}=d,{HTMLImageElement:_,HTMLCanvasElement:y,HTMLVideoElement:v,ImageData:w,ImageBitmap:I}=ge;if(f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===s&&this.size[1]===c){const{x:C,y:S}=i||{x:0,y:0};if(e instanceof _||e instanceof y||e instanceof v||e instanceof w||I&&e instanceof I)f.texSubImage2D(f.TEXTURE_2D,0,C,S,f.RGBA,f.UNSIGNED_BYTE,e);else{let M=this.format,P=f.UNSIGNED_BYTE;this.format===f.R32F&&(M=f.RED,P=f.FLOAT),f.texSubImage2D(f.TEXTURE_2D,0,C,S,s,c,M,P,e.data)}}else if(this.size=[s,c],e instanceof _||e instanceof y||e instanceof v||e instanceof w||I&&e instanceof I){let C=this.format;this.format===f.R8&&(C=f.RED),f.texImage2D(f.TEXTURE_2D,0,this.format,C,f.UNSIGNED_BYTE,e)}else{let C=this.format,S=this.format,M=f.UNSIGNED_BYTE;this.format===f.DEPTH_COMPONENT&&(C=f.DEPTH_COMPONENT16,M=f.UNSIGNED_SHORT),this.format===f.R32F&&(M=f.FLOAT,S=f.RED),f.texImage2D(f.TEXTURE_2D,0,C,s,c,0,S,M,e.data)}this.useMipmap=!(!n||!n.useMipmap),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,n){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,s){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),n!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),this.wrapS=i),s!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Dv{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}}const ba=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,s=0,c=0,d=0,f=0;for(1&e?s=c=d=32:n=i=f=32;(e>>=1)>1;){const y=n+s>>1,v=i+c>>1;1&e?(s=n,c=i,n=d,i=f):(n=s,i=c,s=d,c=f),d=y,f=v}const _=4*t;ba[_+0]=n,ba[_+1]=i,ba[_+2]=s,ba[_+3]=c}const wa=new Uint16Array(2178),Mr=new Uint8Array(1089),qr=new Uint16Array(1089);function Ld(t){return 0===t?-.03125:32===t?.03125:0}var hr=Gi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const gn={type:2,extent:Vt,loadGeometry:()=>[[new me(0,0),new me(Vt+1,0),new me(Vt+1,Vt+1),new me(0,Vt+1),new me(0,0)]]};class qn{constructor(e,n,i,s,c){this.tileID=e,this.uid=Gn(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,s&&s.style&&(this._lastUpdatedBrightness=s.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<ne.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Pd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,c){const d={};if(!c)return d;for(const f of s){const _=f.layerIds.map(y=>c.getLayer(y)).filter(Boolean);if(0!==_.length){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(y=>_.filter(v=>v.id===y)[0]));for(const y of _)d[y.fqid]=f}}return d}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Av){if(this.hasSymbolBuckets=!0,!i)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Av&&c.hasRTLText){this.hasRTLText=!0,Bl.isLoading()||Bl.isLoaded()||"deferred"!==Fl()||yp();break}}this.queryPadding=0;for(const s in this.buckets){const c=this.buckets[s],d=n.style.getOwnLayer(s);if(!d)continue;const f=d.queryRadius(c);this.queryPadding=Math.max(this.queryPadding,f)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new cx}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const i in this.buckets){const s=this.buckets[i];s.uploadPending()&&s.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ls(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ls(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ls(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const s=n.style.getBrightness();(this._lastUpdatedBrightness||s)&&(this._lastUpdatedBrightness&&s&&Math.abs(this._lastUpdatedBrightness-s)<.001||(this._lastUpdatedBrightness=s,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,s,c,d,f,_){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:f,transform:d,params:c,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const s=i.loadVTLayers(),c=n?n.sourceLayer:"",d=s._geojsonTileLayer||s[c];if(!d)return;const f=jm(n&&n.filter),{z:_,x:y,y:v}=this.tileID.canonical,w={z:_,x:y,y:v};for(let I=0;I<d.length;I++){const C=d.feature(I);if(f.needGeometry){const P=xf(C,!0);if(!f.filter(new Vo(this.tileID.overscaledZ),P,this.tileID.canonical))continue}else if(!f.filter(new Vo(this.tileID.overscaledZ),C))continue;const S=i.getId(C,c),M=new Up(C,_,y,v,S);M.tile=w,e.push(M)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const i=Zn(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const i=Date.now();let s=!1;if(this.expirationTime>i)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{const c=this.expirationTime-n;c?this.expirationTime=i+Math.max(c,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),s=n.style.listImages(),c=n.style.getBrightness();for(const d in this.buckets){if(!n.style.hasLayer(d))continue;const f=this.buckets[d],_=f.layers[0].sourceLayer||"_geojsonTileLayer",y=i[_];let v={};if(e&&(v=e[_],!y||!v||0===Object.keys(v).length))continue;if(f.update(v,y,s,this.imageAtlas&&this.imageAtlas.patternPositions||{},c),f instanceof mu||f instanceof Vg){const I=n.style.getOwnSourceCache(f.layers[0].source);n._terrain&&n._terrain.enabled&&I&&f.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(I.id,this.tileID)}const w=n&&n.style&&n.style.getOwnLayer(d);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(f)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ne.now()+e}setTexture(e,n){const i=n.context,s=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ls(i,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE))}setDependencies(e,n){const i={};for(const s of n)i[s]=!0;this.dependencies[e]=i}hasDependency(e,n){for(const i of e){const s=this.dependencies[i];if(s)for(const c of n)if(s[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=bh(gn,this.tileID.canonical,this.tileTransform)[0],s=new Vl,c=new Ip;for(let d=0;d<i.length;d++){const{x:f,y:_}=i[d];s.emplaceBack(f,_),c.emplaceBack(d)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(s,Xl.members),this._tileDebugSegments=so.simpleSegment(0,0,s.length,c.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=bh(gn,this.tileID.canonical,this.tileTransform)[0];let s,c;if(this.isRaster){const d=function(f,_){const y=Pd(f,_),v=Math.pow(2,f.z);for(let P=0;P<33;P++)for(let R=0;R<33;R++){const z=Oc((f.x+(R+Ld(R))/32)/v),G=Gs((f.y+(P+Ld(P))/32)/v),H=_.project(z,G),j=33*P+R;wa[2*j+0]=Math.round((H.x*y.scale-y.x)*Vt),wa[2*j+1]=Math.round((H.y*y.scale-y.y)*Vt)}Mr.fill(0),qr.fill(0);for(let P=2045;P>=0;P--){const R=4*P,z=ba[R+0],G=ba[R+1],H=ba[R+2],j=ba[R+3],W=z+H>>1,oe=G+j>>1,pe=W+oe-G,ve=oe+z-W,xe=33*G+z,ke=33*j+H,Ae=33*oe+W,$e=Math.hypot((wa[2*xe+0]+wa[2*ke+0])/2-wa[2*Ae+0],(wa[2*xe+1]+wa[2*ke+1])/2-wa[2*Ae+1])>=16;Mr[Ae]=Mr[Ae]||($e?1:0),P<1022&&(Mr[Ae]=Mr[Ae]||Mr[33*(G+ve>>1)+(z+pe>>1)]||Mr[33*(j+ve>>1)+(H+pe>>1)])}const w=new Mu,I=new Is;let C=0;function S(P,R){const z=33*R+P;return 0===qr[z]&&(w.emplaceBack(wa[2*z+0],wa[2*z+1],P*Vt/32,R*Vt/32),qr[z]=++C),qr[z]-1}function M(P,R,z,G,H,j){const W=P+z>>1,oe=R+G>>1;if(Math.abs(P-H)+Math.abs(R-j)>1&&Mr[33*oe+W])M(H,j,P,R,W,oe),M(z,G,H,j,W,oe);else{const pe=S(P,R),ve=S(z,G),xe=S(H,j);I.emplaceBack(pe,ve,xe)}}return M(0,0,32,32,32,0),M(32,32,0,0,0,32),{vertices:w,indices:I}}(this.tileID.canonical,n);s=d.vertices,c=d.indices}else{s=new Mu,c=new Is;for(const{x:f,y:_}of i)s.emplaceBack(f,_,0,0);const d=Bg(s.int16,void 0,4);for(let f=0;f<d.length;f+=3)c.emplaceBack(d[f],d[f+1],d[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,hr.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=so.simpleSegment(0,0,s.length,c.length)}_makeGlobeTileDebugBuffers(e,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const s=this.tileID.canonical,c=Cg(zx(s,n)),d=el(n.zoom);let f;d>0&&(f=Dt.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,n,c,f,d),this._makeGlobeTileDebugTextBuffer(e,s,n,c,f,d)}_globePoint(e,n,i,s,c,d,f){let _=Rp(e,n,i);if(d){const y=1<<i.z,v=tl(s.center.lng),w=Sa(s.center.lat),I=(i.x+.5)/y-v;let C=0;I>.5?C=-1:I<-.5&&(C=1);let S=(e/Vt+i.x)/y+C,M=(n/Vt+i.y)/y;S=(S-v)*s._pixelsPerMercatorPixel+v,M=(M-w)*s._pixelsPerMercatorPixel+w;const P=[S*s.worldSize,M*s.worldSize,0];He.transformMat4(P,P,d),_=xh(_,P,f)}return He.transformMat4(_,_,c)}_makeGlobeTileDebugBorderBuffer(e,n,i,s,c,d){const f=new Vl,_=new Ip,y=new wp,v=(I,C,S,M,P)=>{const R=(S-I)/(P-1),z=(M-C)/(P-1),G=f.length;for(let H=0;H<P;H++){const j=I+H*R,W=C+H*z;f.emplaceBack(j,W);const oe=this._globePoint(j,W,n,i,s,c,d);y.emplaceBack(oe[0],oe[1],oe[2]),_.emplaceBack(G+H)}},w=Vt;v(0,0,w,0,16),v(w,0,w,w,16),v(w,w,0,w,16),v(0,w,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(f,Xl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(y,Ox.members),this._tileDebugSegments=so.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugTextBuffer(e,n,i,s,c,d){const f=Vt/4,_=new Vl,y=new Is,v=new wp,w=25;y.reserve(32),_.reserve(w),v.reserve(w);const I=(C,S)=>w*C+S;for(let C=0;C<w;C++){const S=C*f;for(let M=0;M<w;M++){const P=M*f;_.emplaceBack(P,S);const R=this._globePoint(P,S,n,i,s,c,d);v.emplaceBack(R[0],R[1],R[2])}}for(let C=0;C<4;C++)for(let S=0;S<4;S++){const M=I(C,S),P=I(C,S+1),R=I(C+1,S),z=I(C+1,S+1);y.emplaceBack(M,P,R),y.emplaceBack(R,P,z)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(y),this._tileDebugTextBuffer=e.createVertexBuffer(_,Xl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(v,Ox.members),this._tileDebugTextSegments=so.simpleSegment(0,0,w,32)}}class Ma{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){const s=e.wrapped().key;void 0===this.data[s]&&(this.data[s]=[]);const c={value:n,timeout:void 0};if(void 0!==i&&(c.timeout=setTimeout(()=>{this.remove(e,c)},i)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const i=e.wrapped().key,s=void 0===n?0:this.data[i].indexOf(n),c=this.data[i][s];return this.data[i].splice(s,1),c.timeout&&clearTimeout(c.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(c.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const i in this.data)for(const s of this.data[i])e(s.value)||n.push(s);for(const i of n)this.remove(i.value.tileID,i)}}let mE=(()=>{class t{constructor(n,i,s,c){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;const d=n.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||c||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();const FS={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class BS{constructor(e,n,i,s,c,d){this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=s,this.instanceCount=d,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||c||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let i=0;i<this.attributes.length;i++){const s=n.attributes[this.attributes[i].name];void 0!==s&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,n,i){for(let s=0;s<this.attributes.length;s++){const c=this.attributes[s],d=n.attributes[c.name];void 0!==d&&e.vertexAttribPointer(d,c.components,e[FS[c.type]],!1,this.itemSize,c.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,n,i){for(let s=0;s<this.attributes.length;s++){const c=n.attributes[this.attributes[s].name];void 0!==c&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(c,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zo{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gE extends zo{getDefault(){return Ur.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mv extends zo{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class IA extends zo{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class TA extends zo{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class qD extends zo{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class VS extends zo{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class _E extends zo{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ki extends zo{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Th extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class AA extends zo{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Hs extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class li extends zo{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class bb extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Co extends zo{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zS extends zo{getDefault(){return Ur.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ws extends zo{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Cr extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class s_ extends zo{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class yE extends zo{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Qp=class extends zo{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class US extends zo{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ah extends zo{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class $S extends zo{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Rv extends zo{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class jS extends zo{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class CA extends zo{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bc extends zo{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class SA extends zo{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class DA extends zo{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pM extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Pf extends zo{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Pv extends zo{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class dn extends Pv{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Jp extends Pv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Jl extends Pv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class vE extends Jp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Of{constructor(e,n,i,s,c){this.context=e,this.width=n,this.height=i;const d=this.framebuffer=e.gl.createFramebuffer();s&&(this.colorAttachment=new dn(e,d)),c&&(this.depthAttachmentType=c,this.depthAttachment="renderbuffer"===c?new Jp(e,d):new Jl(e,d))}destroy(){const e=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&e.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&e.deleteTexture(n)}e.deleteFramebuffer(this.framebuffer)}}class Rr{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}Rr.ReadOnly=!1,Rr.ReadWrite=!0,Rr.disabled=new Rr(519,Rr.ReadOnly,[0,1]);class Qr{constructor(e,n,i,s,c,d){this.test=e,this.ref=n,this.mask=i,this.fail=s,this.depthFail=c,this.pass=d}}Qr.disabled=new Qr({func:519,mask:0},0,0,7680,7680,7680);class Ai{constructor(e,n,i,s){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=s}}Ai.Replace=[1,0,1,0],Ai.disabled=new Ai(Ai.Replace,Ur.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,Ur.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771,1,771],Ur.transparent,[!0,!0,!0,!0]),Ai.multiply=new Ai([774,0,774,0],Ur.transparent,[!0,!0,!0,!0]);class Vr{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}Vr.disabled=new Vr(!1,1029,2305),Vr.backCCW=new Vr(!0,1029,2305),Vr.backCW=new Vr(!0,1029,2304),Vr.frontCW=new Vr(!0,1028,2304),Vr.frontCCW=new Vr(!0,1028,2305);class kf{constructor(e){this.gl=e,this.clearColor=new gE(this),this.clearDepth=new Mv(this),this.clearStencil=new IA(this),this.colorMask=new TA(this),this.depthMask=new qD(this),this.stencilMask=new VS(this),this.stencilFunc=new _E(this),this.stencilOp=new ki(this),this.stencilTest=new Th(this),this.depthRange=new AA(this),this.depthTest=new Hs(this),this.depthFunc=new li(this),this.blend=new bb(this),this.blendFunc=new Co(this),this.blendColor=new zS(this),this.blendEquation=new Ws(this),this.cullFace=new Cr(this),this.cullFaceSide=new s_(this),this.frontFace=new yE(this),this.program=new Qp(this),this.activeTexture=new US(this),this.viewport=new Ah(this),this.bindFramebuffer=new $S(this),this.bindRenderbuffer=new Rv(this),this.bindTexture=new jS(this),this.bindVertexBuffer=new CA(this),this.bindElementBuffer=new Bc(this),this.bindVertexArrayOES=new SA(this),this.pixelStoreUnpack=new DA(this),this.pixelStoreUnpackPremultiplyAlpha=new pM(this),this.pixelStoreUnpackFlipY=new Pf(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n,i){return new mE(this,e,n,i)}createVertexBuffer(e,n,i,s,c){return new BS(this,e,n,i,s,c)}createRenderbuffer(e,n,i){const s=this.gl,c=s.createRenderbuffer();return this.bindRenderbuffer.set(c),s.renderbufferStorage(s.RENDERBUFFER,e,n,i),this.bindRenderbuffer.set(null),c}createFramebuffer(e,n,i,s){return new Of(this,e,n,i,s)}clear({color:e,depth:n,stencil:i,colorMask:s}){const c=this.gl;let d=0;e&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(s||[!0,!0,!0,!0])),void 0!==n&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),c.clear(d)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){st(e.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ec extends Kn{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",s=>{"source"===s.dataType&&"metadata"===s.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===s.dataType&&"content"===s.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Ma(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ab,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return tt(this._tiles).map(e=>e.tileID).sort(bE).map(e=>e.key)}getRenderableIds(e,n){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,e,n)&&i.push(this._tiles[s]);return e?i.sort((s,c)=>{const d=s.tileID,f=c.tileID,_=new me(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),y=new me(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-f.overscaledZ||y.y-_.y||y.x-_.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(bE).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,s){if(s)if(e.state="errored",404!==s.status)this._source.fire(new wn(s,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ne.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new kt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let s=0;s<n.length;s++){const c=n[s];if(e.neighboringTiles&&e.neighboringTiles[c]){const d=this.getTileByID(c);i(e,d),i(d,e)}}function i(s,c){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let d=c.tileID.canonical.x-s.tileID.canonical.x;const f=c.tileID.canonical.y-s.tileID.canonical.y,_=Math.pow(2,s.tileID.canonical.z),y=c.tileID.key;0===d&&0===f||Math.abs(f)>1||(Math.abs(d)>1&&(1===Math.abs(d+_)?d+=_:1===Math.abs(d-_)&&(d-=_)),c.dem&&s.dem&&(s.dem.backfillBorder(c.dem,d,f),s.neighboringTiles&&s.neighboringTiles[y]&&(s.neighboringTiles[y].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,s){for(const c in this._tiles){let d=this._tiles[c];if(s[c]||!d.hasData()||d.tileID.overscaledZ<=n||d.tileID.overscaledZ>i)continue;let f=d.tileID;for(;d&&d.tileID.overscaledZ>n+1;){const y=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[y.key],d&&d.hasData()&&(f=y)}let _=f;for(;_.overscaledZ>n;)if(_=_.scaledTo(_.overscaledZ-1),e[_.key]){s[f.key]=f;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){const s=e.scaledTo(i),c=this._getLoadedTile(s);if(c)return c}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const i=Math.ceil(e.width/n)+1,s=Math.ceil(e.height/n)+1,c=Math.floor(i*s*5),d="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,f="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const i={};for(const s in this._tiles){const c=this._tiles[s];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+n),i[c.tileID.key]=c}this._tiles=i;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,n,i,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let c;if(this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(_=>new Bi(_.canonical.z,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(_=>this._source.hasTile(_)))):c=[],c.length>0&&this.castsShadows&&s&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!il(this._source.type)){const _=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),y=Math.min(_,this._source.maxzoom),v=e.extendTileCoverForShadows(c,s,y);for(const w of v)this._shadowCasterTiles[w.key]=!0,c.push(w)}const d=this._updateRetainedTiles(c);if(il(this._source.type)&&0!==c.length){const _={},y={},v=Object.keys(d);for(const I of v){const C=d[I],S=this._tiles[I];if(!S||S.fadeEndTime&&S.fadeEndTime<=ne.now())continue;const M=this.findLoadedParent(C,Math.max(C.overscaledZ-ec.maxOverzooming,this._source.minzoom));M&&(this._addTile(M.tileID),_[M.tileID.key]=M.tileID),y[I]=C}const w=c[c.length-1].overscaledZ;for(const I in this._tiles){const C=this._tiles[I];if(d[I]||!C.hasData())continue;let S=C.tileID;for(;S.overscaledZ>w;){S=S.scaledTo(S.overscaledZ-1);const M=this._tiles[S.key];if(M&&M.hasData()&&y[S.key]){d[I]=C.tileID;break}}}for(const I in _)d[I]||(this._coveredTiles[I]=!0,d[I]=_[I])}for(const _ in d)this._tiles[_].clearFadeHold();const f=function(_,y){const v=[];for(const w in _)w in y||v.push(w);return v}(this._tiles,d);for(const _ of f){const y=this._tiles[_];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+_)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const i={},s=e.reduce((y,v)=>Math.min(y,v.overscaledZ),1/0),c=e[0].overscaledZ,d=Math.max(c-ec.maxOverzooming,this._source.minzoom),f=Math.max(c+ec.maxUnderzooming,this._source.minzoom),_={};for(const y of e){const v=this._addTile(y);n[y.key]=y,v.hasData()||s<this._source.maxzoom&&(_[y.key]=y)}this._retainLoadedChildren(_,s,f,n);for(const y of e){let v=this._tiles[y.key];if(v.hasData())continue;if(y.canonical.z>=this._source.maxzoom){const I=y.children(this._source.maxzoom)[0],C=this.getTile(I);if(C&&C.hasData()){n[I.key]=I;continue}}else{const I=y.children(this._source.maxzoom);if(n[I[0].key]&&n[I[1].key]&&n[I[2].key]&&n[I[3].key])continue}let w=v.wasRequested();for(let I=y.overscaledZ-1;I>=d;--I){const C=y.scaledTo(I);if(i[C.key]||(i[C.key]=!0,v=this.getTile(C),!v&&w&&(v=this._addTile(C)),v&&(n[C.key]=C,w=v.wasRequested(),v.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let i,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){i=this._loadedParentTiles[s.key];break}n.push(s.key);const c=s.scaledTo(s.overscaledZ-1);if(i=this._getLoadedTile(c),i)break;s=c}for(const c of n)this._loadedParentTiles[c]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return!0!==n.isExtraShadowCaster||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=!!n;if(!i){const s=this.map?this.map.painter:null;n=new qn(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,s,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new kt("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){const s=[],c=this.transform;if(!c)return s;const d="globe"===c.projection.name,f=tl(c.center.lng);for(const _ in this._tiles){const y=this._tiles[_];if(i&&y.clearQueryDebugViz(),y.holdingForFade())continue;let v;if(d){const w=y.tileID.canonical;if(0===w.z){const I=[Math.abs(_n(f,...kv(w,-1))-f),Math.abs(_n(f,...kv(w,1))-f)];v=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(_n(f,...kv(w,-1))-f),Math.abs(_n(f,...kv(w,0))-f),Math.abs(_n(f,...kv(w,1))-f)];v=[I.indexOf(Math.min(...I))-1]}}else v=[0];for(const w of v){const I=e.containsTile(y,c,n,w);I&&s.push(I)}}return s}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const i=this.getRenderableIds(e,n).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}sortCoordinatesByDistance(e){const n=e.slice(),i=this.transform._camera.position,s=this.transform._camera.forward(),c={};for(const d of n){const f=1/(1<<d.canonical.z);c[d.key]=((d.canonical.x+.5)*f+d.wrap-i[0])*s[0]+((d.canonical.y+.5)*f-i[1])*s[1]-i[2]*s[2]}return n.sort((d,f)=>c[d.key]-c[f.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(il(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=ne.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){const s=this._tiles[e];s&&s.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(const i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const f=()=>{this._sourceLoaded&&(this._source.off("data",f),this._preloadTiles(e,n))};return void this._source.on("data",f)}const i=new Map,s=Array.isArray(e)?e:[e],c=this.map.painter.terrain,d=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const f of s){const _=f.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const y of _)i.set(y.key,y);this.usedForTerrain&&f.updateElevation(!1)}Xe(Array.from(i.values()),(f,_)=>{const y=new qn(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(y,v=>{"raster-dem"===this._source.type&&y.dem&&this._backfillDEM(y),_(v,y)})},n)}}function bE(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function il(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function kv(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}ec.maxOverzooming=10,ec.maxUnderzooming=3;const MA=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),gu=Gi([{name:"a_color_3f",components:3,type:"Float32"}]),a_=Gi([{name:"a_color_4f",components:4,type:"Float32"}]),tm=Gi([{name:"a_uv_2f",components:2,type:"Float32"}]),Lv=Gi([{name:"a_normal_3f",components:3,type:"Float32"}]),YD=Gi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GS=Gi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class wE{constructor(e=0,n=0,i=0,s=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=i,this.right=s}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=Er(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=Er(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=Er(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=Er(e.right,n.right,i)),this}getCenter(e,n){const i=_n((this.left+e-this.right)/2,0,e),s=_n((this.top+n-this.bottom)/2,0,n);return new me(i,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new wE(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Eb(t,e){const n=bi(t,3);Dt.fromQuat(t,e),Mi(t,3,n)}function EE(t,e){const n=ia.identity([]);return ia.rotateZ(n,n,-e),ia.rotateX(n,n,-t),n}function IE(t,e){const n=[t[0],t[1],0],i=[e[0],e[1],0];if(He.length(n)>=1e-15){const d=He.normalize([],n);He.scale(i,d,He.dot(i,d)),e[0]=i[0],e[1]=i[1]}const s=He.cross([],e,t);if(He.len(s)<1e-15)return null;const c=Math.atan2(-s[1],s[0]);return EE(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),c)}class RA{constructor(e,n){this.position=e,this.orientation=n}get position(){return this._position}set position(e){if(e){const n=e instanceof Ri?e:new Ri(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=yt(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const i=this.position,s=this._elevation?this._elevation.getAtPointOrZero(Ri.fromLngLat(e)):0,c=Ri.fromLngLat(e,s),d=[c.x-i.x,c.y-i.y,c.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=IE(d,n)}setPitchBearing(e,n){this.orientation=EE(De(e),De(-n))}}class Ib{constructor(e,n){this._transform=Dt.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){const e=this.position;return new Ri(e[0],e[1],e[2])}get position(){const e=bi(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&Mi(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||ia.identity([]),e&&Eb(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,n){this._orientation=EE(e,n),Eb(this._transform,this._orientation)}forward(){const e=bi(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=bi(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=bi(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){const i=new Float64Array(16);return Dt.invert(i,this.getWorldToCamera(e,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,n,i){const s=this.position;He.scale(s,s,-e);const c=new Float64Array(16);return Dt.fromScaling(c,[i,i,i]),Dt.translate(c,c,s),c[10]*=n,c}getWorldToCamera(e,n){const i=new Float64Array(16),s=new Float64Array(4),c=this.position;return ia.conjugate(s,this._orientation),He.scale(c,c,-e),Dt.fromQuat(i,s),Dt.translate(i,i,c),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(e,n,i,s){const c=new Float64Array(16);return Dt.perspective(c,e,n,i,s),c}getCameraToClipOrthographic(e,n,i,s,c,d){const f=new Float64Array(16);return Dt.ortho(f,e,n,i,s,c,d),f}getDistanceToElevation(e,n=!1){const i=0===e?0:Zi(e,n?Gs(this.position[1]):this.position[1]),s=this.forward();return(i-this.position[2])/s[2]}clone(){return new Ib([...this.position],[...this.orientation])}}function TE(t,e){const n=Nv(t.projection,t.zoom,t.width,t.height),i=function(c,d,f,_,y){const v=new kr(f.lng-180*Vc,f.lat),w=new kr(f.lng+180*Vc,f.lat),I=c.project(v.lng,v.lat),C=c.project(w.lng,w.lat),S=-Math.atan2(C.y-I.y,C.x-I.x),M=Ri.fromLngLat(f);M.y=_n(M.y,-1+Vc,1-Vc);const P=M.toLngLat(),R=c.project(P.lng,P.lat),z=Ri.fromLngLat(P);z.x+=Vc;const G=z.toLngLat(),H=c.project(G.lng,G.lat),j=Tb(H.x-R.x,H.y-R.y,S),W=Ri.fromLngLat(P);W.y+=Vc;const oe=W.toLngLat(),pe=c.project(oe.lng,oe.lat),ve=Tb(pe.x-R.x,pe.y-R.y,S),xe=Math.abs(j.x)/Math.abs(ve.y),ke=Dt.identity([]);Dt.rotateZ(ke,ke,-S*(1-(y?0:_)));const Ae=Dt.identity([]);return Dt.scale(Ae,Ae,[1,1-(1-xe)*_,1]),Ae[4]=-ve.x/ve.y*_,Dt.rotateZ(Ae,Ae,S),Dt.multiply(Ae,ke,Ae),Ae}(t.projection,0,t.center,n,e),s=PA(t);return Dt.scale(i,i,[s,s,1]),i}function PA(t){const e=t.projection,n=Nv(t.projection,t.zoom,t.width,t.height),i=OA(e,t.center),s=OA(e,kr.convert(e.center));return Math.pow(2,i*n+(1-n)*s)}function Nv(t,e,n,i,s=1/0){const c=t.range;if(!c)return 0;const d=Math.min(s,Math.max(n,i)),f=Math.log(d/1024)/Math.LN2;return sn(c[0]+f,c[1]+f,e)}const Vc=1/4e4;function OA(t,e){const n=_n(e.lat,-As,As),i=new kr(e.lng-180*Vc,n),s=new kr(e.lng+180*Vc,n),c=t.project(i.lng,n),d=t.project(s.lng,n),f=Ri.fromLngLat(i),_=Ri.fromLngLat(s),y=d.x-c.x,v=d.y-c.y,w=_.x-f.x,I=_.y-f.y,C=Math.sqrt((w*w+I*I)/(y*y+v*v));return Math.log(C)/Math.LN2}function Tb(t,e,n){const i=Math.cos(n),s=Math.sin(n);return{x:t*i-e*s,y:t*s+e*i}}function nm(t,e,n){return e*(Vt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}const Ch={unknown:0,flipRequired:1,flipNotRequired:2},kA=Math.tan(85*Math.PI/180);function l_(t,e,n,i,s,c,d){const f=Dt.create();if(n)if("globe"===c.name){const _=function(y,v){const{x:w,y:I}=y.point,C=YT(w,I,y.worldSize/y._pixelsPerMercatorPixel,0,0);return Dt.multiply(C,C,qT(au(v)))}(s,e);Dt.multiply(f,f,_)}else{const _=yh.invert([],d);f[0]=_[0],f[1]=_[1],f[4]=_[2],f[5]=_[3],i||Dt.rotateZ(f,f,s.angle)}else Dt.multiply(f,s.labelPlaneMatrix,t);return f}function Ab(t,e,n,i,s,c,d){const f=l_(t,e,n,i,s,c,d);return"globe"===c.name&&n||(f[2]=f[6]=f[10]=f[14]=0),f}function c_(t,e,n,i,s,c,d){if(n){if("globe"===c.name){const f=l_(t,e,n,i,s,c,d);return Dt.invert(f,f),Dt.multiply(f,t,f),f}{const f=Dt.clone(t),_=Dt.identity([]);return _[0]=d[0],_[1]=d[1],_[4]=d[2],_[5]=d[3],Dt.multiply(f,f,_),i||Dt.rotateZ(f,f,-s.angle),f}}return s.glCoordMatrix}function gc(t,e,n,i){const s=[t,e,n,1];n?no.transformMat4(s,s,i):tc(s,s,i);const c=s[3];return s[0]/=c,s[1]/=c,s[2]/=c,s}function qs(t,e){return Math.min(.5+t/e*.5,1.5)}function u_(t,e){const n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function Nd(t,e,n,i,s,c,d,f,_,y){const v=n.transform,w=i?t.textSizeData:t.iconSizeData,I=kc(w,n.transform.zoom),C="globe"===v.projection.name,S=[256/n.width*2+1,256/n.height*2+1],M=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;M.clear();let P=null;C&&(P=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const R=t.lineVertexArray,z=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,G=n.transform.width/n.transform.height;let H,j=!1;for(let W=0;W<z.length;W++){const oe=z.get(W),{numGlyphs:pe,writingMode:ve}=oe;if(ve!==Ao.vertical||j||H===Ao.horizontal||(j=!0),H=ve,(oe.hidden||ve===Ao.vertical)&&!j){_u(pe,M);continue}j=!1;const xe=new me(oe.tileAnchorX,oe.tileAnchorY);let{x:ke,y:Ae,z:$e}=v.projection.projectTilePoint(xe.x,xe.y,y.canonical);if(_){const[ln,pn,Yt]=_(xe);ke+=ln,Ae+=pn,$e+=Yt}const Ce=[ke,Ae,$e,1];if(no.transformMat4(Ce,Ce,e),!u_(Ce,S)){_u(pe,M);continue}const nt=Ce[3],ft=qs(n.transform.getCameraToCenterDistance(v.projection),nt),It=Sf(w,I,oe),et=d?It/ft:It*ft,it=gc(ke,Ae,$e,s);if(it[3]<=0){_u(pe,M);continue}let St={};const Ut=d?null:_,Wt=Fv(oe,et,!1,f,e,s,c,t.glyphOffsetArray,R,M,P,it,xe,St,G,Ut,v.projection,y,d);j=Wt.useVertical,Ut&&Wt.needsFlipping&&(St={}),(Wt.notEnoughRoom||j||Wt.needsFlipping&&Fv(oe,et,!0,f,e,s,c,t.glyphOffsetArray,R,M,P,it,xe,St,G,Ut,v.projection,y,d).notEnoughRoom)&&_u(pe,M)}i?(t.text.dynamicLayoutVertexBuffer.updateData(M),P&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(P)):(t.icon.dynamicLayoutVertexBuffer.updateData(M),P&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(P))}function d_(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M){const{lineStartIndex:P,glyphStartIndex:R,segment:z}=f,G=R+f.numGlyphs,H=P+f.lineLength,j=e.getoffsetX(R),W=e.getoffsetX(G-1),oe=rm(t*j,n,i,s,c,d,z,P,H,_,y,v,w,I,!0,C,S,M);if(!oe)return null;const pe=rm(t*W,n,i,s,c,d,z,P,H,_,y,v,w,I,!0,C,S,M);return pe?{first:oe,last:pe}:null}function ys(t,e,n,i){return t===Ao.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===Ao.vertical?i>0?{needsFlipping:!0}:null:e!==Ch.unknown&&(0===(s=n)||Math.abs(i/s)>kA)?e===Ch.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null;var s}function Fv(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z){const G=e/24,H=t.lineOffsetX*G,j=t.lineOffsetY*G,{lineStartIndex:W,glyphStartIndex:oe,numGlyphs:pe,segment:ve,writingMode:xe,flipState:ke}=t,Ae=W+t.lineLength,$e=Ce=>{if(v){const[et,it,St]=Ce.up,Ut=y.length;xa(v,Ut+0,et,it,St),xa(v,Ut+1,et,it,St),xa(v,Ut+2,et,it,St),xa(v,Ut+3,et,it,St)}const[nt,ft,It]=Ce.point;o_(y,nt,ft,It,Ce.angle)};if(pe>1){const Ce=d_(G,f,H,j,n,w,I,t,_,c,C,M,!1,P,R,z);if(!Ce)return{notEnoughRoom:!0};if(i&&!n){let[nt,ft,It]=Ce.first.point,[et,it,St]=Ce.last.point;[nt,ft]=gc(nt,ft,It,d),[et,it]=gc(et,it,St,d);const Ut=ys(xe,ke,(et-nt)*S,it-ft);if(t.flipState=Ut&&Ut.needsFlipping?Ch.flipRequired:Ch.flipNotRequired,Ut)return Ut}$e(Ce.first);for(let nt=oe+1;nt<oe+pe-1;nt++){const ft=rm(G*f.getoffsetX(nt),H,j,n,w,I,ve,W,Ae,_,c,C,M,!1,!1,P,R,z);if(!ft)return y.length-=4*(nt-oe),{notEnoughRoom:!0};$e(ft)}$e(Ce.last)}else{if(i&&!n){const nt=gc(I.x,I.y,0,s),ft=W+ve+1,It=new me(_.getx(ft),_.gety(ft)),et=gc(It.x,It.y,0,s),it=et[3]>0?et:Ko(I,It,nt,1,s,void 0,P,R.canonical),St=ys(xe,ke,(it[0]-nt[0])*S,it[1]-nt[1]);if(t.flipState=St&&St.needsFlipping?Ch.flipRequired:Ch.flipNotRequired,St)return St}const Ce=rm(G*f.getoffsetX(oe),H,j,n,w,I,ve,W,Ae,_,c,C,M,!1,!1,P,R,z);if(!Ce)return{notEnoughRoom:!0};$e(Ce)}return{}}function Va(t,e,n,i,s){const{x:c,y:d,z:f}=i.projectTilePoint(t.x,t.y,e);if(!s)return gc(c,d,f,n);const[_,y,v]=s(t);return gc(c+_,d+y,f+v,n)}function Ko(t,e,n,i,s,c,d,f){const _=Va(t.sub(e)._unit()._add(t),f,s,d,c);return He.sub(_,n,_),He.normalize(_,_),He.scaleAndAdd(_,n,_,i)}function rm(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R){const z=i?t-e:t+e;let G=z>0?1:-1,H=0;i&&(G*=-1,H=Math.PI),G<0&&(H+=Math.PI);let j=f+d+(G>0?0:1)|0,W=s,oe=s,pe=0,ve=0;const xe=Math.abs(z),ke=[],Ae=[];let $e=c,Ce=$e;const nt=()=>Ko(Ce,$e,oe,xe-pe+1,v,I,M,P.canonical);for(;pe+ve<=xe;){if(j+=G,j<f||j>=_)return null;if(oe=W,Ce=$e,ke.push(oe),C&&Ae.push(Ce),$e=new me(y.getx(j),y.gety(j)),W=w[j],!W){const pn=Va($e,P.canonical,v,M,I);W=pn[3]>0?w[j]=pn:nt()}pe+=ve,ve=He.distance(oe,W)}S&&I&&(w[j]&&(W=nt(),ve=He.distance(oe,W)),w[j]=W);const ft=(xe-pe)/ve,It=$e.sub(Ce)._mult(ft)._add(Ce),et=He.sub([],W,oe),it=He.scaleAndAdd([],oe,et,ft);let St=[0,0,1],Ut=et[0],Wt=et[1];if(R&&(St=M.upVector(P.canonical,It.x,It.y),0!==St[0]||0!==St[1]||1!==St[2])){const pn=[St[2],0,-St[0]],Yt=He.cross([],St,pn);He.normalize(pn,pn),He.normalize(Yt,Yt),Ut=He.dot(et,pn),Wt=He.dot(et,Yt)}if(n){const pn=He.cross([],St,et);He.normalize(pn,pn),He.scaleAndAdd(it,it,pn,n*G)}const ln=H+Math.atan2(Wt,Ut);return ke.push(it),C&&Ae.push(It),{point:it,angle:ln,path:ke,tilePath:Ae,up:St}}function _u(t,e){const n=e.length,i=n+4*t;e.resize(i),e.float32.fill(-1/0,4*n,4*i)}function tc(t,e,n){const i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t[3]=n[3]*i+n[7]*s+n[15],t}const Cb=(t,e,n)=>(1-n)*t+n*e,AE=t=>t*t*t*t*t;class sa{constructor(e,n,i,s,c,d,f){this.tileSize=512,this._renderWorldCopies=void 0===c||c,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==s?60:s,this.setProjection(d),this.setMaxBounds(f),this.width=0,this.height=0,this._center=new kr(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wE,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ib,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,n=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return _t(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=rl(this.projectionOptions);const i=!st(n,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=rl({name:"mercator"});const n=e!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Zi(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new me(this.width,this.height)}get bearing(){return yt(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const n=-e*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=yh.create(),yh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=_n(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=De(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let s=0,c=0;for(let d=0;d<n.length;d++){const f=new me(n[d][0]*this.width,i+n[d][1]*(this.height-i)),_=e.pointCoordinate(f);if(!_)continue;const y=1/Math.hypot(_[0]-this._camera.position[0],_[1]-this._camera.position[1]);s+=_[3]*y,c+=y}return 0===c?NaN:s/c}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*n,s=this._mercatorZfromZoom(e),c=this._mercatorZfromZoom(this._maxZoom),d=Math.max(s-i,c);this._setZoom(this._zoomFromMercatorZ(d))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let i;i=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const s=He.length(He.sub([],this._camera.position,i));return _n(this._zoomFromMercatorZ(s),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!ia.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const i=[e.position.x,e.position.y,e.position.z];He.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new RA;return n.position=new Ri(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!ia.length(e))return!1;ia.normalize(e,e);const n=He.transformQuat([],[0,0,-1],e),i=He.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;const s=IE(n,i);return!!s&&(this._camera.orientation=s,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,s=this.cameraToCenterDistance;e[2]=_n(e[2],s/i,s/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,i){this._unmodified=!1,this._edgeInsets.interpolate(e,n,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new HT(0,e)];if(this.renderWorldCopies){const i=this.pointCoordinate(new me(0,0)),s=this.pointCoordinate(new me(this.width,0)),c=this.pointCoordinate(new me(this.width,this.height)),d=this.pointCoordinate(new me(0,this.height)),f=Math.floor(Math.min(i.x,s.x,c.x,d.x)),_=Math.floor(Math.max(i.x,s.x,c.x,d.x)),y=1;for(let v=f-y;v<=_+y;v++)0!==v&&n.push(new HT(v,e))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,n,i){let s=[];if(0===n[0]&&0===n[1])return s;for(const d of e){const f=d.canonical,_=d.overscaledZ,y=d.wrap,v=1<<f.z,w=f.x+1<v,I=f.x>0,C=f.y+1<v,S=f.y>0,M=d.wrap-(I?0:1),P=d.wrap+(w?0:1),R=I?f.x-1:v-1,z=w?f.x+1:0;n[0]<0?(s.push(new Bi(_,P,f.z,z,f.y)),n[1]<0&&C&&(s.push(new Bi(_,y,f.z,f.x,f.y+1)),s.push(new Bi(_,P,f.z,z,f.y+1))),n[1]>0&&S&&(s.push(new Bi(_,y,f.z,f.x,f.y-1)),s.push(new Bi(_,P,f.z,z,f.y-1)))):n[0]>0?(s.push(new Bi(_,M,f.z,R,f.y)),n[1]<0&&C&&(s.push(new Bi(_,y,f.z,f.x,f.y+1)),s.push(new Bi(_,M,f.z,R,f.y+1))),n[1]>0&&S&&(s.push(new Bi(_,y,f.z,f.x,f.y-1)),s.push(new Bi(_,M,f.z,R,f.y-1)))):n[1]<0&&C?s.push(new Bi(_,y,f.z,f.x,f.y+1)):S&&s.push(new Bi(_,y,f.z,f.x,f.y-1))}if(s.length>1){s.sort((_,y)=>_.overscaledZ-y.overscaledZ||_.wrap-y.wrap||_.canonical.z-y.canonical.z||_.canonical.x-y.canonical.x||_.canonical.y-y.canonical.y);let d=0,f=0;for(;f<s.length;)s[f].equals(s[d])?++f:s[++d]=s[f++];s.length=d+1}const c=[];for(const d of s)s.some(f=>d.isChildOf(f))||c.push(d);return s=c.filter(d=>!e.some(f=>!!(d.overscaledZ<i&&f.isChildOf(d))||d.equals(f)||d.isChildOf(f))),s}coveringTiles(e){let n=this.coveringZoomLevel(e);const i=n,s=this.elevation&&this.elevation.exaggeration(),c=s&&!e.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const f=this.locationCoordinate(this.center),_=this.center.lat,y=1<<n,v=[y*f.x,y*f.y,0],w="globe"===this.projection.name,I=!w,C=La.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,I),S=w?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),M=y*Zi(1,this.center.lat),P=this._camera.position[2]/Zi(1,this.center.lat),R=[y*S.x,y*S.y,P*(I?1:M)],z=w||s,G=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),H=this.isLODDisabled(!0)?n:0,j=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,W=e.isTerrainDEM?-j:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?PA(this):1,pe=et=>{const St=new Ri(et.x+25e-6,et.y,et.z),Ut=new Ri(et.x,et.y+25e-6,et.z),Wt=et.toLngLat(),ln=St.toLngLat(),pn=Ut.toLngLat(),Yt=this.locationCoordinate(Wt),tn=this.locationCoordinate(ln),Vn=this.locationCoordinate(pn),Jn=Math.hypot(tn.x-Yt.x,tn.y-Yt.y),Yn=Math.hypot(Vn.x-Yt.x,Vn.y-Yt.y);return Math.sqrt(Jn*Yn)*oe/25e-6},ve=et=>{const it=j,St=W;return{aabb:Mf(this,y,0,0,0,et,St,it,this.projection),zoom:0,x:0,y:0,minZ:St,maxZ:it,wrap:et,fullyVisible:!1}},xe=[];let ke=[];const Ae=n,$e=e.reparseOverscaled?i:n,Ce=et=>et*et,nt=Ce((P-this._centerAltitude)*M),ft=et=>{if(!this._elevation||!et.tileID||!d)return;const it=this._elevation.getMinMaxForTile(et.tileID),St=et.aabb;it?(St.min[2]=it.min,St.max[2]=it.max,St.center[2]=(St.min[2]+St.max[2])/2):(et.shouldSplit=It(et),et.shouldSplit||(St.min[2]=St.max[2]=St.center[2]=this._centerAltitude))},It=et=>{if(et.zoom<H)return!0;if(et.zoom===Ae)return!1;if(null!=et.shouldSplit)return et.shouldSplit;const it=et.aabb.distanceX(R),St=et.aabb.distanceY(R);let Ut=nt,Wt=1;if(w){Ut=Ce(et.aabb.distanceZ(R));const Yt=Math.pow(2,et.zoom),tn=Gs((et.y+1)/Yt),Vn=Gs(et.y/Yt),Jn=Math.min(Math.max(_,tn),Vn),Yn=Op(Jn)/Op(_);if(Wt=Jn===_?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yn/this._mercatorScaleRatio),this.zoom<=Tg&&et.zoom===Ae-1&&Yn>=.9)return!0}else if(c&&(Ut=Ce(et.aabb.distanceZ(R)*M)),this.projection.isReprojectedInTileSpace&&i<=5){const Yt=Math.pow(2,et.zoom),tn=pe(new Ri((et.x+.5)/Yt,(et.y+.5)/Yt));Wt=tn>.85?1:tn}const ln=it*it+St*St+Ut;return ln<Ce((1<<Ae-et.zoom)*G*Wt*((Yt,tn)=>{if(tn*Ce(.707)<Yt)return 1;const Vn=Math.sqrt(tn/Yt);return Vn/(1.4144271570014144+(Math.pow(1.1,Vn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ut,nt),ln))};if(this.renderWorldCopies)for(let et=1;et<=3;et++)xe.push(ve(-et)),xe.push(ve(et));for(xe.push(ve(0));xe.length>0;){const et=xe.pop(),it=et.x,St=et.y;let Ut=et.fullyVisible;const Wt=()=>"globe"===this.projection.name&&(0===et.y||et.y===(1<<et.zoom)-1);if(!Ut){let ln=z?et.aabb.intersects(C):et.aabb.intersectsFlat(C);if(0===ln&&Wt()){const pn=new vh(et.zoom,it,St);ln=WT(this,y,pn,!0).intersects(C)}if(0===ln)continue;Ut=2===ln}if(et.zoom!==Ae&&It(et))for(let ln=0;ln<4;ln++){const pn=(it<<1)+ln%2,Yt=(St<<1)+(ln>>1),tn={aabb:d?et.aabb.quadrant(ln):Mf(this,y,et.zoom+1,pn,Yt,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:pn,y:Yt,wrap:et.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};c&&!w&&(tn.tileID=new Bi(et.zoom+1===Ae?$e:et.zoom+1,et.wrap,et.zoom+1,pn,Yt),ft(tn)),xe.push(tn)}else{const ln=et.zoom===Ae?$e:et.zoom;if(e.minzoom&&e.minzoom>ln)continue;if(!Ut){let Vn=z?et.aabb.intersectsPrecise(C):et.aabb.intersectsPreciseFlat(C);if(0===Vn&&Wt()){const Jn=new vh(et.zoom,it,St);Vn=WT(this,y,Jn,!0).intersectsPrecise(C)}if(0===Vn)continue}const pn=v[0]-(.5+it+(et.wrap<<et.zoom))*(1<<n-et.zoom),Yt=v[1]-.5-St,tn=et.tileID?et.tileID:new Bi(ln,et.wrap,et.zoom,it,St);ke.push({tileID:tn,distanceSq:pn*pn+Yt*Yt})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,it=this.horizonLineFromTop();ke=ke.filter(St=>{const Ut=[0,0,0,1],Wt=[Vt,Vt,0,1],ln=this.calculateFogTileMatrix(St.tileID.toUnwrapped());no.transformMat4(Ut,Ut,ln),no.transformMat4(Wt,Wt,ln);const pn=function(Vn,Jn,Yn){let Xn=0;for(let yr=0;yr<2;++yr)Vn[yr]>0&&(Xn+=(Vn[yr]-0)*(Vn[yr]-0)),Jn[yr]<0&&(Xn+=(0-Jn[yr])*(0-Jn[yr]));return Xn}(no.min([],Ut,Wt),no.max([],Ut,Wt));if(0===pn)return!0;let Yt=!1;const tn=this._elevation;if(tn&&pn>et&&0!==it){const Vn=this.calculateProjMatrix(St.tileID.toUnwrapped());let Jn;e.isTerrainDEM||(Jn=tn.getMinMaxForTile(St.tileID)),Jn||(Jn={min:W,max:j});const Yn=function(yr){const Fr=Math.round((yr+45+360)%360/90)%4;return mt[Fr]}(this.rotation),Xn=[Yn[0]*Vt,Yn[1]*Vt,Jn.max];He.transformMat4(Xn,Xn,Vn),Yt=(1-Xn[1])*this.height*.5<it}return pn<et||Yt})}return ke.sort((et,it)=>et.distanceSq-it.distanceSq).map(et=>et.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=_n(e.lat,-As,As),i=this.projection.project(e.lng,n);return new me(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Zi(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,n){let i,s;const c=this.centerPoint;if("globe"===this.projection.name){const f=this.worldSize;i=(n.x-c.x)/f,s=(n.y-c.y)/f}else{const f=this.pointCoordinate(n),_=this.pointCoordinate(c);i=f.x-_.x,s=f.y-_.y}const d=this.locationCoordinate(e);this.setLocation(new Ri(d.x-i,d.y-s))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,n){const i=n?Zi(n,e.lat):void 0,s=this.projection.project(e.lng,e.lat);return new Ri(s.x,s.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,n){const i=null!=n?n:this._centerAltitude,s=[e.x,e.y,0,1],c=[e.x,e.y,1,1];no.transformMat4(s,s,this.pixelMatrixInverse),no.transformMat4(c,c,this.pixelMatrixInverse);const d=c[3];no.scale(s,s,1/s[3]),no.scale(c,c,1/d);const f=s[2],_=c[2];return{p0:s,p1:c,t:f===_?0:(i-f)/(_-f)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return no.transformMat4(n,n,this.pixelMatrixInverse),no.transformMat4(i,i,this.pixelMatrixInverse),no.scale(n,n,1/n[3]),no.scale(i,i,1/i[3]),n[2]=Zi(n[2],this._center.lat)*this.worldSize,i[2]=Zi(i[2],this._center.lat)*this.worldSize,no.scale(n,n,1/this.worldSize),no.scale(i,i,1/this.worldSize),new qy([n[0],n[1],n[2]],He.normalize([],He.sub([],i,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:i,t:s}=e,c=Zi(n[2],this._center.lat),d=Zi(i[2],this._center.lat);return new Ri(Er(n[0],i[0],s)/this.worldSize,Er(n[1],i[1],s)/this.worldSize,Er(c,d,s))}pointCoordinate(e,n=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,n)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let n=this.projection.pointCoordinate3D(this,e.x,e.y);if(n)return new Ri(n[0],n[1],n[2]);let i=0,s=this.horizonLineFromTop();if(e.y>s)return this.pointCoordinate(e);const c=.02*s,d=e.clone();for(let f=0;f<10&&s-i>c;f++){d.y=Er(i,s,.66);const _=this.projection.pointCoordinate3D(this,d.x,d.y);_?(s=d.y,n=_):i=d.y}return n?new Ri(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=_f)return!this.isPointAboveHorizon(e);const n=this.pointCoordinate(e);return n.y>=0&&n.y<=1}_coordinatePoint(e,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,s=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return no.transformMat4(s,s,this.pixelMatrix),s[3]>0?new me(s[0]/s[3],s[1]/s[3]):new me(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,c=this.pointLocation3D(new me(n,e)),d=this.pointLocation3D(new me(s,e)),f=this.pointLocation3D(new me(s,i)),_=this.pointLocation3D(new me(n,i));let y=Math.min(c.lng,d.lng,f.lng,_.lng),v=Math.max(c.lng,d.lng,f.lng,_.lng),w=Math.min(c.lat,d.lat,f.lat,_.lat),I=Math.max(c.lat,d.lat,f.lat,_.lat);const C=Math.pow(2,-this.zoom)/16*270,S="globe"===this.projection.name?1:4,M=(P,R,z,G,H)=>{const j=(P+z)/2,W=(R+G)/2,oe=new me(j,W),{lng:pe,lat:ve}=this.pointLocation3D(oe),xe=Math.max(0,y-pe,w-ve,pe-v,ve-I);y=Math.min(y,pe),v=Math.max(v,pe),w=Math.min(w,ve),I=Math.max(I,ve),(H<S||xe>C)&&(M(P,R,j,W,H+1),M(j,W,z,G,H+1))};if(M(n,e,s,e,1),M(s,e,s,i,1),M(s,i,n,i,1),M(n,i,n,e,1),"globe"===this.projection.name){const[P,R]=function(z){const G=Dt.identity(new Float64Array(16));Dt.multiply(G,z.pixelMatrix,z.globeMatrix);const H=[0,Ql,0],j=[0,vl,0];return He.transformMat4(H,H,G),He.transformMat4(j,j,G),[H[0]>0&&H[0]<=z.width&&H[1]>0&&H[1]<=z.height&&!Ew(z,new kr(z.center.lat,90)),j[0]>0&&j[0]<=z.width&&j[1]>0&&j[1]<=z.height&&!Ew(z,new kr(z.center.lat,-90))]}(this);P?(I=90,v=180,y=-180):R&&(w=-90,v=180,y=-180)}return new Mc(new kr(y,w),new kr(v,I))}_getBoundsRectangular(e,n){const{top:i,left:s}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,f=new me(s,i),_=new me(d,i),y=new me(d,c),v=new me(s,c);let w=this.pointCoordinate(f,e),I=this.pointCoordinate(_,e);const C=this.pointCoordinate(y,n),S=this.pointCoordinate(v,n),M=(P,R)=>(R.y-P.y)/(R.x-P.x);return w.y>1&&I.y>=0?w=new Ri((1-S.y)/M(S,w)+S.x,1):w.y<0&&I.y<=1&&(w=new Ri(-S.y/M(S,w)+S.x,0)),I.y>1&&w.y>=0?I=new Ri((1-C.y)/M(C,I)+C.x,1):I.y<0&&w.y<=1&&(I=new Ri(-C.y/M(C,I)+C.x,0)),(new Mc).extend(this.coordinateLocation(w)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(C))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=e.visibleDemTiles.reduce((i,s)=>{if(s.dem){const c=s.dem.tree;i.min=Math.min(i.min,c.minimums[0]),i.max=Math.max(i.max,c.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*e.exaggeration(),n.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-n*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-As,this.maxLat=As,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=tl(this.minLng)*this.tileSize,this.worldMaxX=tl(this.maxLng)*this.tileSize,this.worldMinY=Sa(this.maxLat)*this.tileSize,this.worldMaxY=Sa(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,n){return this.projection.createTileMatrix(this,n,e)}calculateDistanceTileData(e){const n=e.key,i=this._distanceTileDataCache;if(i[n])return i[n];const s=e.canonical,c=1/this.height,d=this.cameraWorldSize,f=d/this.zoomScale(s.z),_=(s.x+Math.pow(2,s.z)*e.wrap)*f,y=s.y*f,v=this.point;v.x*=d/this.worldSize,v.y*=d/this.worldSize;const w=this.angle,I=Math.sin(-w),C=-Math.cos(-w);return i[n]={bearing:[I,C],center:[(v.x-_)*c,(v.y-y)*c],scale:f/Vt*c},i[n]}calculateFogTileMatrix(e){const n=e.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const s=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return Dt.multiply(s,this.worldToFogMatrix,s),i[n]=new Float32Array(s),i[n]}calculateProjMatrix(e,n=!1){const i=e.key,s=n?this._alignedProjMatrixCache:this._projMatrixCache;if(s[i])return s[i];const c=this.calculatePosMatrix(e,this.worldSize);return Dt.multiply(c,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,c),s[i]=new Float32Array(c),s[i]}calculatePixelsToTileUnitsMatrix(e){const n=e.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const s=function(c,d){const{scale:f}=c.tileTransform,_=f*Vt/(c.tileSize*Math.pow(2,d.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return yh.scale(new Float32Array(4),d.inverseAdjustmentMatrix,[_,_])}(e,this);return i[n]=s,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,n=Dt.fromScaling([],[e,e,e]);return Dt.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const n=Zi(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),s=this._camera.forward(),c=Zi(1,this._center.lat);i[2]/=c,s[2]/=c,He.normalize(s,s);const d=e.raycast(i,s,e.exaggeration());if(d){const f=He.scaleAndAdd([],i,s,d),_=new Ri(f[0],f[1],Zi(f[2],Gs(f[1]))),y=(_.z+He.length([_.x-i[0],_.y-i[1],_.z-i[2]*c]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(y),this._centerAltitude=_.toAltitude(),this._center=this.coordinateLocation(_),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const n=this._elevation,i=Zi(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(i),c=n.getAtPointOrZero(new Ri(...s)),d=this.pixelsPerMeter/this.worldSize*c,f=this._minimumHeightOverTerrain(),_=s[2]-d;if(_<=f)if(_<0||e){const y=this.locationCoordinate(this._center,this._centerAltitude),v=[s[0],s[1],y.z-s[2]],w=He.length(v);v[2]-=(f-_)/this._pixelsPerMercatorPixel;const I=He.length(v);if(0===I)return;He.scale(v,v,w/I*this._pixelsPerMercatorPixel),this._camera.position=[s[0],s[1],y.z*this._pixelsPerMercatorPixel-v[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const I=this.center;return I.lat=_n(I.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(I.lng=_n(I.lng,this.minLng,this.maxLng)),this.center=I,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:s}=this.point;let c=0,d=i,f=s;const _=this.width/2,y=this.height/2,v=this.worldMinY*this.scale,w=this.worldMaxY*this.scale;if(s-y<v&&(f=v+y),s+y>w&&(f=w-y),w-v<this.height&&(c=Math.max(c,this.height/(w-v)),f=(w+v)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const I=this.worldMinX*this.scale,C=this.worldMaxX*this.scale,S=this.worldSize/2-(I+C)/2;d=(i+S+this.worldSize)%this.worldSize-S,d-_<I&&(d=I+_),d+_>C&&(d=C-_),C-I<this.width&&(c=Math.max(c,this.width/(C-I)),d=(C+I)/2)}d===i&&f===s||(this.center=this.unproject(new me(d,f))),c&&(this.zoom+=this.scaleZoom(c)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Zi(1,this.center.lat)/Zi(1,45));const s=Nv(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,s),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const c="meters"===this.projection.zAxisUnit?i:1,d=this._camera.getWorldToCamera(this.worldSize,c);let f;const _=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(_[8]=2*-e.x/this.width,_[9]=2*e.y/this.height,this.isOrthographic){let ve=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=ve*this.aspect,ke=-xe,Ae=-ve;xe-=e.x,ke-=e.x,ve+=e.y,Ae+=e.y,f=this._camera.getCameraToClipOrthographic(ke,xe,Ae,ve,this._nearZ,this._farZ),(($e,Ce,nt,ft)=>{for(let It=0;It<16;It++)$e[It]=Cb(Ce[It],nt[It],ft)})(f,f,_,AE(this.pitch>=15?1:this.pitch/15))}else f=_;const y=Dt.mul([],_,d);let v=Dt.mul([],f,d);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),xe=Dt.identity([]);Dt.translate(xe,xe,[ve.x*this.worldSize,ve.y*this.worldSize,0]),Dt.multiply(xe,xe,TE(this)),Dt.translate(xe,xe,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),Dt.multiply(v,v,xe),Dt.multiply(y,y,xe),this.inverseAdjustmentMatrix=function(ke){const Ae=TE(ke,!0);return yh.invert([],[Ae[0],Ae[1],Ae[4],Ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=Dt.scale([],v,[this.worldSize,this.worldSize,this.worldSize/c,1]),this.projMatrix=v,this.invProjMatrix=Dt.invert(new Float64Array(16),this.projMatrix);const w=Dt.invert([],f);this.frustumCorners=_w.fromInvProjectionMatrix(w,this.horizonLineFromTop(),this.height),this.cameraFrustum=La.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const I=new Float32Array(16);Dt.identity(I),Dt.scale(I,I,[1,-1,1]),Dt.rotateX(I,I,this._pitch),Dt.rotateZ(I,I,this.angle);const C=Dt.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=Dt.clone(C);const S=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;C[8]=2*-e.x/this.width,C[9]=2*(e.y+S)/this.height,this.skyboxMatrix=Dt.multiply(I,C,I);const M=this.point,P=M.x,R=M.y,z=this.width%2/2,G=this.height%2/2,H=Math.cos(this.angle),j=Math.sin(this.angle),W=P-Math.round(P)+H*z+j*G,oe=R-Math.round(R)+H*G+j*z,pe=new Float64Array(v);if(Dt.translate(pe,pe,[W>.5?W-1:W,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=pe,v=Dt.create(),Dt.scale(v,v,[this.width/2,-this.height/2,1]),Dt.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=Dt.create(),Dt.scale(v,v,[1,-1,1]),Dt.translate(v,v,[-1,-1,0]),Dt.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=Dt.multiply(new Float64Array(16),this.labelPlaneMatrix,y),this._calcFogMatrices(),this._distanceTileDataCache={},v=Dt.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(xe){const{x:ke,y:Ae}=xe.point,{lng:$e,lat:Ce}=xe._center;return YT(ke,Ae,xe.worldSize,$e,Ce)}(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=He.transformMat4(ve,ve,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,s=1/this.height/this._pixelsPerMercatorPixel,c=[e,e,n];He.scale(c,c,s),He.scale(i,i,-1),He.multiply(i,i,c);const d=Dt.create();Dt.translate(d,d,i),Dt.scale(d,d,c),this.mercatorFogMatrix=d,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,s)}_computeCameraPosition(e){const n=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),s=this.point,c=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-e/this.worldSize*this._centerAltitude;return[s.x/this.worldSize-i[0]*c,s.y/this.worldSize-i[1]*c,e/this.worldSize*this._centerAltitude-i[2]*c]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],s=e[2];let c=1;this.projection.wrap&&(this.center=this.center.wrap()),s>0&&(c=Math.min((n-i)/s,1)),this._camera.position=He.scaleAndAdd([],this._camera.position,e,c),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:s}=this._camera.getPitchBearing(),c=Zi(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,d=this._mercatorZfromZoom(this._maxZoom)*Math.cos(De(this._maxPitch)),f=Math.max((e[2]-c)/Math.cos(i),d),_=this._zoomFromMercatorZ(f);He.scaleAndAdd(e,e,n,f),this._pitch=_n(i,De(this.minPitch),De(this.maxPitch)),this.angle=yt(s,-Math.PI,Math.PI),this._setZoom(_n(_,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Ri(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let n=0,i=_f,s=0,c=1/0;for(;i-n>1e-6&&i>n;){const d=n+.5*(i-n),f=this.tileSize*Math.pow(2,d),_=this.getCameraToCenterDistance(this.projection,d,f),y=this.scaleZoom(_/(e*this.tileSize)),v=Math.abs(d-y);v<c&&(c=v,s=d),d<y?n=d:i=d}return s}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Me("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,n){const i=Math.min(e.x,n.x),s=Math.max(e.x,n.x),c=Math.min(e.y,n.y),d=Math.max(e.y,n.y);if(c<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const f=[new me(i,c),new me(s,d),new me(i,d),new me(s,c)],_=this.renderWorldCopies?-3:0,y=this.renderWorldCopies?4:1;for(const v of f){const w=this.pointRayIntersection(v);if(w.t<0)return!0;const I=this.rayIntersectionCoordinate(w);if(I.x<_||I.y<0||I.x>y||I.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+dt(this.fovAboveCenter)>88||this.anyCornerOffEdge(new me(0,0),new me(this.width,this.height))}zoomDeltaToMovement(e,n){const i=He.length(He.sub([],this._camera.position,e)),s=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(s)}getCameraPoint(){if("globe"===this.projection.name){const e=function([n,i,s],c){const d=[n,i,s,1];no.transformMat4(d,d,c);const f=d[3]=Math.max(d[3],1e-6);return d[0]/=f,d[1]/=f,d[2]/=f,d}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new me(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new me(0,e))}}getCameraToCenterDistance(e,n=this.zoom,i=this.worldSize){const s=Nv(e,n,this.width,this.height,1024),c=e.pixelSpaceConversion(this.center.lat,i,s);let d=.5/Math.tan(.5*this._fov)*this.height*c;return this.isOrthographic&&(d=Cb(1,d,AE(this.pitch>=15?1:this.pitch/15))),d}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&Dt.multiply(e,e,this.globeMatrix),e}getFrustum(e){return La.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function CE(t,e,n){Dt.identity(t),Dt.rotateZ(t,t,De(e[2])),Dt.rotateX(t,t,De(e[0])),Dt.rotateY(t,t,De(e[1])),Dt.scale(t,t,n),Dt.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Wu(t,e,n,i,s,c,d,f){const _=[n[0]-e[0],n[1]-e[1],0],y=[i[0]-e[0],i[1]-e[1],0];if(He.length(_)<1e-12||He.length(y)<1e-12)return ia.identity(t);const v=He.cross([],_,y);He.normalize(v,v),He.subtract(y,i,e),_[2]=(c-s)*f,y[2]=(d-s)*f;const w=_;return He.cross(w,_,y),He.normalize(w,w),ia.rotationTo(t,v,w)}function Qs(t,e,n=!1){const i=el(e.zoom),s=function(c,d,f){const _=d.worldSize,y=[c[12],c[13],c[14]],v=Gs(y[1]/_),w=Oc(y[0]/_),I=Dt.identity([]),C=Zi(1,v)*_,S=Zi(1,0)*_*vf(v,d.zoom),M=1/ww(_);let P=S*M;if(f){const H=Nv(d.projection,d.zoom,d.width,d.height,1024);P=M*d.projection.pixelSpaceConversion(d.center.lat,_,H)}const R=hc(v,w);He.add(R,R,He.scale([],He.normalize([],R),C*P*y[2]));const z=function(H){const j=[H[0],H[1],H[2]];let W=[0,1,0];const oe=He.cross([],W,j);return He.cross(W,j,oe),0===He.squaredLength(W)&&(W=[0,1,0],He.cross(oe,j,W)),He.normalize(oe,oe),He.normalize(W,W),He.normalize(j,j),[oe[0],oe[1],oe[2],0,W[0],W[1],W[2],0,j[0],j[1],j[2],0,H[0],H[1],H[2],1]}(R);Dt.scale(I,I,[P,P,P*C]),Dt.translate(I,I,[-y[0],-y[1],-y[2]]);const G=Dt.multiply([],d.globeMatrix,z);return Dt.multiply(G,G,I),Dt.multiply(G,G,c),G}(t,e,n);return i>0?function(d,f,_){const y=(S,M,P)=>{const R=He.length(S),z=He.length(M),G=xh(S,M,P);return He.scale(G,G,1/He.length(G)*Er(R,z,P))},v=y([d[0],d[1],d[2]],[f[0],f[1],f[2]],_),w=y([d[4],d[5],d[6]],[f[4],f[5],f[6]],_),I=y([d[8],d[9],d[10]],[f[8],f[9],f[10]],_),C=xh([d[12],d[13],d[14]],[f[12],f[13],f[14]],_);return[v[0],v[1],v[2],0,w[0],w[1],w[2],0,I[0],I[1],I[2],0,C[0],C[1],C[2],1]}(s,function(d,f){const _=f.worldSize,y=Zi(1,0)*_*vf(f.center.lat,f.zoom)/ww(_),v=Zi(1,f.center.lat)*_,w=Dt.identity([]);return Dt.rotateY(w,w,De(f.center.lng)),Dt.rotateX(w,w,De(f.center.lat)),Dt.translate(w,w,[0,0,Ja]),Dt.scale(w,w,[y,y,y*v]),Dt.translate(w,w,[f.point.x-.5*_,f.point.y-.5*_,0]),Dt.multiply(w,w,d),Dt.multiply(w,f.globeMatrix,w)}(t,e),i):s}const Sb=[1,1,1];class Fd{constructor(e,n,i,s){this.id=e,this.position=null!=n?new kr(n[0],n[1]):new kr(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new bo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){if(Dt.multiply(e.matrix,n,e.matrix),e.meshes)for(const i of e.meshes){const s=bo.applyTransform(i.aabb,e.matrix);this.aabb.encapsulate(s)}if(e.children)for(const i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){const e=Dt.identity([]);for(const n of this.nodes)this._applyTransformations(n,e)}_positionModelOnTerrain(e,n){const i=e.elevation;if(!i)return 0;const s=bo.projectAabbCorners(this.aabb,this.matrix),c=Zi(1,this.position.lat)*e.worldSize,d=function(R,z){const G=[0,0,1],H=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const j of H){const W=R[j.corners[0]],oe=R[j.corners[1]],pe=R[j.corners[2]],ve=[oe[0]-W[0],oe[1]-W[1],z*(oe[2]-W[2])],xe=He.cross(ve,ve,[pe[0]-W[0],pe[1]-W[1],z*(pe[2]-W[2])]);He.normalize(xe,xe),j.dotProductWithUp=He.dot(xe,G)}return H.sort((j,W)=>j.dotProductWithUp-W.dotProductWithUp),H[0].corners}(s,c),f=s[d[0]],_=s[d[1]],y=s[d[2]],v=s[d[3]],w=i.getAtPointOrZero(new Ri(f[0]/e.worldSize,f[1]/e.worldSize),0),I=i.getAtPointOrZero(new Ri(_[0]/e.worldSize,_[1]/e.worldSize),0),C=i.getAtPointOrZero(new Ri(y[0]/e.worldSize,y[1]/e.worldSize),0),S=i.getAtPointOrZero(new Ri(v[0]/e.worldSize,v[1]/e.worldSize),0),M=(w+S)/2,P=(I+C)/2;return M>P?I<C?Wu(n,_,v,f,I,S,w,c):Wu(n,y,f,v,C,w,S,c):w<S?Wu(n,f,_,y,w,I,C,c):Wu(n,v,y,_,S,C,I,c),Math.max(M,P)}computeModelMatrix(e,n,i,s,c,d,f=!1){const _=e.transform,y=_.zoom,v=_.project(this.position),w=vf(this.position.lat,y),I=1/w;Dt.identity(this.matrix),Dt.translate(this.matrix,this.matrix,[v.x+s[0]*I,v.y+s[1]*I,s[2]]);let C=1,S=1;const M=_.worldSize;if(f){if("mercator"===_.projection.name){let G=0;_.elevation&&(G=_.elevation.getAtPointOrZero(new Ri(v.x/M,v.y/M),0));const H=no.transformMat4([],[v.x,v.y,G,1],_.projMatrix)[3]/_.cameraToCenterDistance;C=H,S=H*vf(_.center.lat,y)}else if("globe"===_.projection.name){const G=Qs(this.matrix,_),H=Dt.multiply([],_.projMatrix,G),j=[0,0,0,1];no.transformMat4(j,j,H);const W=j[3]/_.cameraToCenterDistance,oe=el(y),pe=_.projection.pixelsPerMeter(this.position.lat,M)*vf(this.position.lat,y),ve=_.projection.pixelsPerMeter(_.center.lat,M)*vf(_.center.lat,y);C=W/Er(pe,Cw(_.center.lat),oe),S=W*w/pe,C*=ve,S*=ve}}else C=I;Dt.scale(this.matrix,this.matrix,[C,C,S]);const P=[...this.matrix],R=this.orientation,z=[];if(CE(z,[R[0]+n[0],R[1]+n[1],R[2]+n[2]],i),Dt.multiply(this.matrix,P,z),c&&_.elevation){let G=0;const H=[];if(d&&_.elevation){G=this._positionModelOnTerrain(_,H);const j=Dt.fromQuat([],H),W=Dt.multiply([],j,z);Dt.multiply(this.matrix,P,W)}else G=_.elevation.getAtPointOrZero(new Ri(v.x/M,v.y/M),0);0!==G&&(this.matrix[14]+=G)}}upload(e){if(!this.uploaded){for(const n of this.nodes)Sh(n,e);for(const n of this.nodes)qu(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)Lf(e)}}function Bd(t,e,n=!1){t.uploaded||(t.gfxTexture=new ls(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function LA(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,MA.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Lv.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,tm.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?gu:a_).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,GS.members,!0)),t.segments=so.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const i=t.material;i.pbrMetallicRoughness.baseColorTexture&&Bd(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&Bd(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&Bd(i.normalTexture,e),i.occlusionTexture&&Bd(i.occlusionTexture,e,n),i.emissionTexture&&Bd(i.emissionTexture,e)}function Sh(t,e,n){if(t.meshes)for(const i of t.meshes)LA(i,e,n);if(t.children)for(const i of t.children)Sh(i,e,n)}function qu(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)qu(e)}function Lf(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)Lf(n)}class Dh{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Yu{constructor(){this.instancedDataArray=new ax,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class im{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,i,s){this.tileToMeter=$x(i);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:f,index:_,sourceLayerIndex:y}of e){const v=xf(d,c);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),v,i))continue;const w={id:f,sourceLayerIndex:y,index:_,geometry:c?v.geometry:bh(d,i,s),properties:d.properties,type:d.type,patterns:{}},I=this.addFeature(w,w.geometry,v);I&&n.featureIndex.insert(d,w.geometry,_,y,this.index,this.instancesPerModel[I].instancedDataArray.length)}this.lookup=null}update(e,n,i,s){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const f in e)d.idToFeaturesIndex.hasOwnProperty(f)&&this.evaluate(d.features[d.idToFeaturesIndex[f]],e[f],d,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];for(const s of i.features){const c=this.layers[0],d=s.feature,f=this.canonical,_=c.paint.get("model-rotation").evaluate(d,{},f),y=c.paint.get("model-scale").evaluate(d,{},f),v=c.paint.get("model-translation").evaluate(d,{},f);He.exactEquals(s.rotation,_)&&He.exactEquals(s.scale,y)&&He.exactEquals(s.translation,v)||(this.evaluate(s,s.featureStates,i,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,YD.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,i){const s=this.layers[0],c=s.layout.get("model-id").evaluate(i,{},this.canonical);if(!c)return Me(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new Yu);const d=this.instancesPerModel[c],f=d.instancedDataArray,_=new Dh(i,f.length);for(const y of n)for(const v of y){if(v.x<0||v.x>=Vt||v.y<0||v.y>=Vt)continue;const w=(this.lookupDim-1)/Vt,I=this.lookupDim*(v.y*w|0)+v.x*w|0;if(this.lookup){if(0!==this.lookup[I])continue;this.lookup[I]=1}this.instanceCount++;const C=f.length;f.resize(C+1),d.instancesEvaluatedElevation.push(0),f.float32[16*C]=v.x,f.float32[16*C+1]=v.y}return _.instancedDataCount=d.instancedDataArray.length-_.instancedDataOffset,_.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(_),this.evaluate(_,{},d,!1)),c}evaluate(e,n,i,s){const c=this.layers[0],d=e.feature,f=this.canonical,_=e.rotation=c.paint.get("model-rotation").evaluate(d,n,f),y=e.scale=c.paint.get("model-scale").evaluate(d,n,f),v=e.translation=c.paint.get("model-translation").evaluate(d,n,f),w=c.paint.get("model-color").evaluate(d,n,f);w.a=c.paint.get("model-color-mix-intensity").evaluate(d,n,f);const I=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,y[0]),Math.max(y[1],y[2])),CE(I,_,y);const C=Math.round(100*w.a)+w.b/1.05;for(let S=0;S<e.instancedDataCount;++S){const M=e.instancedDataOffset+S,P=16*M,R=i.instancedDataArray.float32;let z=0;s&&(z=R[P+6]-i.instancesEvaluatedElevation[M]);const G=0|R[P+1];R[P]=(0|R[P])+w.r/1.05,R[P+1]=G+w.g/1.05,R[P+2]=C,R[P+3]=1/(f.z>10?this.tileToMeter:$x(f,G)),R[P+4]=v[0],R[P+5]=v[1],R[P+6]=v[2]+z,R[P+7]=I[0],R[P+8]=I[1],R[P+9]=I[2],R[P+10]=I[4],R[P+11]=I[5],R[P+12]=I[6],R[P+13]=I[8],R[P+14]=I[9],R[P+15]=I[10],i.instancesEvaluatedElevation[M]=v[2]}}}lr(im,"ModelBucket",{omit:["layers"]}),lr(Yu,"PerModelAttributes"),lr(Dh,"ModelFeature");const Nf=new gs({visibility:new On(ut.layout_model.visibility),"model-id":new Ir(ut.layout_model["model-id"])});var SE={paint:new gs({"model-opacity":new On(ut.paint_model["model-opacity"]),"model-rotation":new Ir(ut.paint_model["model-rotation"]),"model-scale":new Ir(ut.paint_model["model-scale"]),"model-translation":new Ir(ut.paint_model["model-translation"]),"model-color":new Ir(ut.paint_model["model-color"]),"model-color-mix-intensity":new Ir(ut.paint_model["model-color-mix-intensity"]),"model-type":new On(ut.paint_model["model-type"]),"model-cast-shadows":new On(ut.paint_model["model-cast-shadows"]),"model-receive-shadows":new On(ut.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new On(ut.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ir(ut.paint_model["model-emissive-strength"]),"model-roughness":new Ir(ut.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ir(ut.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new On(ut.paint_model["model-cutoff-fade-range"])}),layout:Nf};const Ff=new Float32Array(262144),Vd=new Uint8Array(262144);function om(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,om(n));return e}const Bf=["","wall","door","roof","window","lamp","logo"];class Db{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:om(e)}}}}class Vf{constructor(e,n,i,s){this.nodes=e,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const i of n){const s=i.node;this.uploaded?this.updatePbrBuffer(s):Sh(s,e,!0)}for(const i of n)qu(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){const s=e.transform.projectionOptions,c=e.style.getBrightness(),d=this.brightness!==c;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||Ds(i.paint.get("model-color").value,d)||Ds(i.paint.get("model-color-mix-intensity").value,d)||Ds(i.paint.get("model-roughness").value,d)||Ds(i.paint.get("model-emissive-strength").value,d)||Ds(i.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=s,this.brightness=c,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),s=this.id.canonical;for(const c of i){const d=c.feature;c.evaluatedScale=n.paint.get("model-scale").evaluate(d,{},s)}}evaluate(e){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const s=i.feature,c=i.node.meshes&&i.node.meshes[0].featureData,d=i.evaluatedColor[2],f=i.evaluatedRMEA[2],_=this.id.canonical;if(i.hasTranslucentParts=!1,c){for(let y=0;y<Bf.length;y++){const v=Bf[y];v.length&&(s.properties.part=v);const w=e.paint.get("model-color").evaluate(s,{},_),I=e.paint.get("model-color-mix-intensity").evaluate(s,{},_);i.evaluatedColor[y]=[w.r,w.g,w.b,I],i.evaluatedRMEA[y][0]=e.paint.get("model-roughness").evaluate(s,{},_),i.evaluatedRMEA[y][2]=e.paint.get("model-emissive-strength").evaluate(s,{},_),i.evaluatedRMEA[y][3]=w.a,i.emissionHeightBasedParams[y]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},_),!i.hasTranslucentParts&&w.a<1&&(i.hasTranslucentParts=!0)}delete s.properties.part,Mb(i,d!==i.evaluatedColor[2]||f!==i.evaluatedRMEA[2])}i.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},_),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,s){const c=e.findDEMTileFor(i);if(c&&(c.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=Bu.create(e,i,c);if(!d)return;4&this.modelTraits&&this.updateDEM(e,d,i,s);for(const f of this.getNodesInfo()){const _=f.node;if(!_.footprint||!_.footprint.vertices||!_.footprint.vertices.length)continue;const y=_.footprint.vertices;let v=d.getElevationAt(y[0].x,y[0].y,!0,!0);for(let w=1;w<y.length;w++)v=Math.min(v,d.getElevationAt(y[w].x,y[w].y,!0,!0));_.elevation=v}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,s){let c=n._dem._modifiedForSources[s];if(void 0===c&&(n._dem._modifiedForSources[s]=[],c=n._dem._modifiedForSources[s]),c.includes(i.canonical))return;const d=n._dem.dim;c.push(i.canonical);let f=!1;for(const _ of this.getNodesInfo()){const y=_.node;if(!y.footprint||!y.footprint.grid)continue;const v=y.footprint.grid,w=n.tileCoordToPixel(v.min.x,v.min.y),I=n.tileCoordToPixel(v.max.x,v.max.y),C=Math.min(Math.min(d-I.y,w.x),Math.min(w.y,d-I.x));if(C<0)continue;const S=_n(C,2,5);let M=Math.max(0,w.x-S),P=Math.max(0,w.y-S),R=Math.min(I.x+S,d-1),z=Math.min(I.y+S,d-1);for(let W=P;W<=z;++W)for(let oe=M;oe<=R;++oe)Vd[W*d+oe]=255;let G=0,H=0;for(let W=0;W<v.cellsY;++W)for(let oe=0;oe<v.cellsX;++oe){if(!v.cells[W*v.cellsX+oe])continue;const pe=n.tileCoordToPixel(v.min.x+oe/v.xScale,v.min.y+W/v.yScale),ve=n.tileCoordToPixel(v.min.x+(oe+1)/v.xScale,v.min.y+(W+1)/v.yScale);for(let xe=pe.y;xe<=Math.min(ve.y+1,d-1);++xe)for(let ke=pe.x;ke<=Math.min(ve.x+1,d-1);++ke)255===Vd[xe*d+ke]&&(Vd[xe*d+ke]=0,G+=n.getElevationAtPixel(ke,xe),H++)}const j=G/H;M=Math.max(1,w.x-S),P=Math.max(1,w.y-S),R=Math.min(I.x+S,d-2),z=Math.min(I.y+S,d-2),f=!0;for(let W=P;W<=z;++W)for(let oe=M;oe<=R;++oe)0===Vd[W*d+oe]&&(Ff[W*d+oe]=n._dem.set(oe,W,j));for(let W=1;W<S;++W){M=Math.max(1,w.x-W),P=Math.max(1,w.y-W),R=Math.min(I.x+W,d-2),z=Math.min(I.y+W,d-2);for(let oe=P;oe<=z;++oe)for(let pe=M;pe<=R;++pe){const ve=oe*d+pe;if(255===Vd[ve]){let xe=0,ke=0,Ae=-1,$e=-1;for(let Ce=-1;Ce<=1;++Ce)for(let nt=-1;nt<=1;++nt){const ft=(oe+Ce)*d+pe+nt;if(Vd[ft]>=W)continue;const It=Ff[ft],et=Math.abs(It);et>ke&&(xe=It,ke=et,Ae=nt,$e=Ce)}if(ke>.1){const Ce=1-(W+.5*Math.abs(Ae*$e))/S;let nt=n._dem.get(pe,oe)+xe*Ce;const ft=n._dem.get(pe+Ae,oe+$e),It=n._dem.get(pe-Ae,oe-$e,!0);(nt-ft)*(nt-It)>0&&(nt=(ft+It)/2),Ff[ve]=n._dem.set(pe,oe,nt),Vd[ve]=W}}}}}f&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=ne.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new Db(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Lf(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const n of e)qu(n.node),Lf(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=s[c].node;s[c].hiddenByReplacement=!!d.footprint&&!i.find(f=>f.footprint===d.footprint)}}getHeightAtTileCoord(e,n){const i=this.getNodesInfo(),s=[];for(let c=0;c<this.nodesInfo.length;c++){const d=i[c],f=d.node.meshes[0];if(e<f.aabb.min[0]||n<f.aabb.min[1]||e>f.aabb.max[0]||n>f.aabb.max[1])continue;const _=(e-f.aabb.min[0])/(f.aabb.max[0]-f.aabb.min[0])*64|0,y=64*Math.min(63,(n-f.aabb.min[1])/(f.aabb.max[1]-f.aabb.min[1])*64|0)+Math.min(63,_);if(!(f.heightmap[y]<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:f.heightmap[y],maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new me(e,n),new me(e,n),s),s.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function Ds(t,e){return!t.isLightConstant&&e}function DE(t,e,n,i,s,c,d,f){let _=(61440&e|(61440&e)>>4)>>8,y=(3840&e|(3840&e)>>4)>>4,v=240&e|(240&e)>>4;n[3]>0&&(_=Er(_,255*n[0],n[3]),y=Er(y,255*n[1],n[3]),v=Er(v,255*n[2],n[3]));const w=_<<8|y,I=v<<8|Math.floor(255*i[3]),C=function(W){const oe=_n(W,0,2);return Math.min(Math.round(.5*oe*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],S=_n(s[0],0,1),M=_n(s[1],0,1),P=_n(s[2],0,1),R=_n(s[3],0,1);let z,G,H,j;if(S!==M&&d!==c&&M!==S){const W=d-c;G=1/(W*(M-S)),H=-(c+W*S)/(W*(M-S));const oe=_n(s[4],-1,1);j=Math.pow(10,oe),z=255*P<<8|255*R}else z=65535,G=0,H=1,j=1;if(t.emplaceBack(w,I,C,z,G,H,j),f){const W=f.length;f.clear();for(let oe=0;oe<W;oe++)f.emplaceBack(w,I,C,z,G,H,j)}}function Mb(t,e){const n=t.node;let i=0;for(const s of n.meshes){if(n.lights&&n.lightMeshIndex===i||!s.featureData)continue;s.featureArray=new og,s.featureArray.reserve(s.featureData.length);let c=e;for(const d of s.featureData){let f;const _=65535&d,y=(15&_)<8?15&_:0,v=d>>16&65535,w=t.evaluatedRMEA[y],I=t.evaluatedColor[y],C=t.emissionHeightBasedParams[y];if(c&&2===y&&n.lights&&(f=new og,f.resize(10*n.lights.length)),DE(s.featureArray,v,I,w,C,s.aabb.min[2],s.aabb.max[2],f),f&&c){c=!1;const S=n.meshes[n.lightMeshIndex];S.featureArray=f,S.featureArray._trim()}}s.featureArray._trim(),i++}}lr(Vf,"Tiled3dModelBucket",{omit:["layers"]}),lr(Db,"Tiled3dModelFeature");class Ys{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const n=am(new me(0,0),new me(Vt,Vt),e),i=[];for(const s of this._activeRegions){if(s.hiddenByOverlap||!Bv(n,s))continue;const c=Vv(s.min,s.max,e);i.push({min:c.min,max:c.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return i}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const i=[];for(const s of n.cache.getVisibleCoordinates()){const c=n.cache.getTile(s).buckets[n.layer];if(c)for(const d of c.getNodesInfo()){const f=d.node;f.footprint&&i.push({footprint:f.footprint,id:s.toUnwrapped()})}}return i}})))}_addSource(e){const n=e.getFootprints();if(0!==n.length){for(const i of n){if(!i.footprint)continue;const s=am(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,i)=>n.priority-i.priority||Mh(n.min,i.min)||Mh(n.max,i.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let n=0,i=0;for(;!e&&n!==this._activeRegions.length;){const s=this._activeRegions[n],c=this._prevRegions[i];e=s.priority!==c.priority||!sm(s,c),++n,++i}}if(e){++this._updateTime;const n=i=>{const s=this._activeRegions;if(i>=s.length)return i;const c=s[i].priority;for(;i<s.length&&s[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,s=n(i);for(;i!==s;){let c=i;const d=i;for(;c!==s;){const f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let _=0;_<d;_++){const y=this._activeRegions[_];if(!y.hiddenByOverlap&&Bv(f,y)&&(f.hiddenByOverlap=Rb(f.footprint,f.tileId,y.footprint,y.tileId),f.hiddenByOverlap))break}++c}i=s,s=n(i)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=e.length-1;n>=0;n--)this._addSource(e[n]);this._computeReplacement()}}function Mh(t,e){return t.x-e.x||t.y-e.y}function sm(t,e){return 0===Mh(t.min,e.min)&&0===Mh(t.max,e.max)}function Bv(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function am(t,e,n){const i=1/Vt,s=1/(1<<n.canonical.z),c=(e.x*i+n.canonical.x)*s+n.wrap,d=(e.y*i+n.canonical.y)*s;return{min:new me((t.x*i+n.canonical.x)*s+n.wrap,(t.y*i+n.canonical.y)*s),max:new me(c,d)}}function Vv(t,e,n){const i=1<<n.canonical.z,s=((e.x-n.wrap)*i-n.canonical.x)*Vt,c=(e.y*i-n.canonical.y)*Vt;return{min:new me(((t.x-n.wrap)*i-n.canonical.x)*Vt,(t.y*i-n.canonical.y)*Vt),max:new me(s,c)}}function za(t,e,n,i,s,c,d){const f=t.indices,_=t.vertices,y=[];for(let v=i;v<i+s;v+=3){const w=e[n[v+0]+c],I=e[n[v+1]+c],C=e[n[v+2]+c],S=Math.min(w.x,I.x,C.x),M=Math.max(w.x,I.x,C.x),P=Math.min(w.y,I.y,C.y),R=Math.max(w.y,I.y,C.y);y.length=0,t.grid.query(new me(S,P),new me(M,R),y);for(let z=0;z<y.length;z++){const G=y[z];if(JT(_[f[3*G+0]],_[f[3*G+1]],_[f[3*G+2]],w,I,C,d))return!0}}return!1}function Rb(t,e,n,i){if(!t||!n)return!1;let s=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return Rb(n,i,t,e);const c=e.canonical,d=i.canonical,f=Math.pow(2,d.z-c.z);s=t.vertices.map(_=>new me(_.x*c.x*Vt*f-d.x*Vt,_.y*c.y*Vt*f-d.y*Vt))}return za(n,s,t.indices,0,t.indices.length,0,0)}const Ms=Ug.types,Zu=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Pb=["fill-extrusion-flood-light-ground-radius"],ME=Math.pow(2,13),zf=Math.pow(2,15)-1,Uf=new me(0,1),Rh=2147483648;function $i(t,e,n,i,s,c,d,f){t.emplaceBack((e<<1)+d,(n<<1)+c,(Math.floor(i*ME)<<1)+s,Math.round(f))}function Uo(t,e,n,i,s,c){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+s,c)}function zd(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class h_{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class zv{constructor(){this.centroidXY=new me(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new me(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new me(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new me(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ob{constructor(){this.acc=new me(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let s=!!this.borders;n.x<e.min.x?(e.min.x=n.x,s=!0):n.x>e.max.x&&(e.max.x=n.x,s=!0),n.y<e.min.y?(e.min.y=n.y,s=!0):n.y>e.max.y&&(e.max.y=n.y,s=!0),((0===n.x||n.x===Vt)&&n.x===i.x)!=((0===n.y||n.y===Vt)&&n.y===i.y)&&this.processBorderOverlap(n,i),s&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Er(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Vt!=e.x>Vt&&this.addBorderIntersection(1,Er(n.y,e.y,(Vt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Er(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Vt!=e.y>Vt&&this.addBorderIntersection(3,Er(n.x,e.x,(Vt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new me(0,0):new me(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function kb(t,e){const n=t.add(e)._unit(),i=_n(t.x*n.x+t.y*n.y,-1,1);var s,c,d;return s=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(s)))/4*zf*((c=t).x*(d=e).y-c.y*d.x<0?-1:1)}const HS=[t=>t.x<0,t=>t.x>Vt,t=>t.y<0,t=>t.y>Vt];function NA(t,e,n,i){const s=[4];if(0===i)return s;n._mult(i);const c=t.sub(n),d=e.sub(n),f=[t,e,c,d];for(let _=0;_<4;_++)for(const y of f)if(HS[_](y)){s.push(_);break}return s}class f_{constructor(e){this.vertexArray=new uh,this.indexArray=new Is,this.programConfigurations=new cg(e.layers,e.zoom,n=>Pb.includes(n)),this._segments=new so,this.hiddenByLandmarkVertexArray=new lx,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new so}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,n,i,s=!1){const c=e.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const f=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let _;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const y=e[0],v=e[1];_=kb(y.sub(e[c-1])._perp()._unit(),v.sub(y)._perp()._unit())}for(let y=0;y<c;y++){const v=y===c-1?0:y+1,w=e[y],I=e[v],C=e[v===c-1?0:v+1],S=I.sub(w)._perp()._unit(),M=kb(S,C.sub(I)._perp()._unit()),P=_,R=M;if(Fb(w,I,n)||s&&$f(w,n)&&$f(I,n)){_=M;continue}const z=f.vertexLength;Uo(this.vertexArray,w,I,1,1,P),Uo(this.vertexArray,w,I,1,0,P),Uo(this.vertexArray,w,I,0,1,R),Uo(this.vertexArray,w,I,0,0,R),f.vertexLength+=4;const G=NA(w,I,S,i);for(const H of G)this._segmentToGroundQuads[d].push({id:z,region:H}),this._segmentToRegionTriCounts[d][H]+=2,f.primitiveLength+=2;_=M}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((s,c)=>s.region-c.region);for(let i=0;i<n;i++){const s=this._segmentToGroundQuads[i],c=e[i],d=this._segmentToRegionTriCounts[i];d.reduce((_,y)=>_+y,0);let f=0;for(let _=0;_<=4;_++){const y=d[_];if(0!==y){let v=this.regionSegments[_];v||(v=this.regionSegments[_]=new so);const w={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+f,vertexLength:c.vertexLength,primitiveLength:y};v.get().push(w)}f+=y}for(let _=0;_<s.length;_++){const y=s[_].id;this.indexArray.emplaceBack(y,y+1,y+3),this.indexArray.emplaceBack(y,y+3,y+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,s,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,s,c,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,rb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,s,c,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,s,c,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&Rh?1:0;for(let s=e.groundVertexArrayOffset;s<n;++s)this.hiddenByLandmarkVertexArray.emplace(s,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Uw.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class lm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Is,this.footprintVertices=new Vl,this.footprintSegments=[],this.layoutVertexArray=new Mu,this.centroidVertexArray=new ag,this.indexArray=new Is,this.programConfigurations=new cg(e.layers,e.zoom,n=>Zu.includes(n)),this.segments=new so,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new f_(e),this.maxHeight=0,this.partLookup={}}populate(e,n,i,s){this.features=[],this.hasPattern=iv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=$x(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:f,sourceLayerIndex:_}of e){const y=this.layers[0]._featureFilter.needGeometry,v=xf(c,y);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),v,i))continue;const w={id:d,sourceLayerIndex:_,index:f,geometry:y?v.geometry:bh(c,i,s),properties:c.properties,type:c.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ef("fill-extrusion",this.layers,w,this.zoom,n)):this.addFeature(w,w.geometry,f,i,{},n.availableImages,s,n.brightness),n.featureIndex.insert(c,w.geometry,f,_,this.index,I)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,n,i,s,c,d){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,n,i,s,c,d)}this.sortBorders()}update(e,n,i,s,c){const d=0!==Object.keys(e).length;if(d&&!this.stateDependentLayers.length)return;const f=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,f,i,s,c),this.groundEffect.update(e,n,f,i,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,nl.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sv.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,s,c,d,f,_){const y=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,v=[new me(0,0),new me(Vt,Vt)],w=f.projection,I="globe"===w.name,C="Polygon"===Ms[e.type],S=new Ob;S.centroidDataIndex=this.centroidData.length;const M=new zv,P=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,R=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);M.height=R,M.vertexArrayOffset=this.layoutVertexArray.length,M.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new md);const z=Fp(n,500);for(let pe=z.length-1;pe>=0;pe--){const ve=z[pe];(0===ve.length||(G=ve[0]).every(xe=>xe.x<=0)||G.every(xe=>xe.x>=Vt)||G.every(xe=>xe.y<=0)||G.every(xe=>xe.y>=Vt))&&z.splice(pe,1)}var G;let H;if(I)H=Uv(z,v,s);else{H=[];for(const pe of z)H.push({polygon:pe,bounds:v})}const j=C?this.edgeRadius:0,W=j>0&&this.zoom<17,oe=(pe,ve)=>{if(0===pe.length)return!1;const xe=pe[pe.length-1];return ve.x===xe.x&&ve.y===xe.y};for(const{polygon:pe,bounds:ve}of H){let xe=0,ke=0;for(const Ce of pe)C&&!Ce[0].equals(Ce[Ce.length-1])&&Ce.push(Ce[0]),ke+=C?Ce.length-1:Ce.length;const Ae=this.segments.prepareSegment((C?5:4)*ke,this.layoutVertexArray,this.indexArray);M.footprintSegIdx<0&&(M.footprintSegIdx=this.footprintSegments.length);const $e=new h_;if($e.vertexOffset=this.footprintVertices.length,$e.indexOffset=3*this.footprintIndices.length,$e.ringIndices=[],C){const Ce=[],nt=[];xe=Ae.vertexLength;for(let It=0;It<pe.length;It++){const et=pe[It];et.length&&0!==It&&nt.push(Ce.length/2);const it=[];let St,Ut;St=et[1].sub(et[0])._perp()._unit(),$e.ringIndices.push(et.length-1);for(let Wt=1;Wt<et.length;Wt++){const ln=et[Wt],pn=et[Wt===et.length-1?1:Wt+1],Yt=ln.clone();if(j){Ut=pn.sub(ln)._perp()._unit();const tn=St.add(Ut)._unit(),Vn=j*Math.min(4,1/(St.x*tn.x+St.y*tn.y));Yt.x+=Vn*tn.x,Yt.y+=Vn*tn.y,Yt.x=Math.round(Yt.x),Yt.y=Math.round(Yt.y),St=Ut}!P||0!==j&&!W||oe(it,Yt)||it.push(Yt),$i(this.layoutVertexArray,Yt.x,Yt.y,0,0,1,1,0),Ae.vertexLength++,this.footprintVertices.emplaceBack(ln.x,ln.y),Ce.push(ln.x,ln.y),I&&zd(this.layoutVertexExtArray,w.projectTilePoint(Yt.x,Yt.y,s),w.upVector(s,Yt.x,Yt.y))}P&&(0===j||W)&&(0!==it.length&&oe(it,it[0])&&it.pop(),this.groundEffect.addData(it,ve,y))}const ft=Bg(Ce,nt);for(let It=0;It<ft.length;It+=3)this.footprintIndices.emplaceBack($e.vertexOffset+ft[It+0],$e.vertexOffset+ft[It+1],$e.vertexOffset+ft[It+2]),this.indexArray.emplaceBack(xe+ft[It],xe+ft[It+2],xe+ft[It+1]),Ae.primitiveLength++;$e.indexCount+=ft.length,$e.vertexCount+=this.footprintVertices.length-$e.vertexOffset}for(let Ce=0;Ce<pe.length;Ce++){const nt=pe[Ce];S.startRing(M,nt[0]);let ft=nt.length>4&&Bb(nt[nt.length-2],nt[0],nt[1]),It=j?p_(nt[nt.length-2],nt[0],nt[1],j):0;const et=[];let it,St,Ut;St=nt[1].sub(nt[0])._perp()._unit();let Wt=!0;for(let ln=1,pn=0;ln<nt.length;ln++){let Yt=nt[ln-1],tn=nt[ln];const Vn=nt[ln===nt.length-1?1:ln+1];if(S.appendEdge(M,tn,Yt),Fb(tn,Yt,ve)){j&&(St=Vn.sub(tn)._perp()._unit(),Wt=!Wt);continue}const Jn=tn.sub(Yt)._perp(),Yn=Jn.x/(Math.abs(Jn.x)+Math.abs(Jn.y)),Xn=Jn.y>0?1:0,yr=Yt.dist(tn);if(pn+yr>32768&&(pn=0),j){Ut=Vn.sub(tn)._perp()._unit();let Zr=Nb(Yt,tn,Vn,Lb(St,Ut),j);isNaN(Zr)&&(Zr=0);const zr=tn.sub(Yt)._unit();Yt=Yt.add(zr.mult(It))._round(),tn=tn.add(zr.mult(-Zr))._round(),It=Zr,St=Ut,P&&this.zoom>=17&&(oe(et,Yt)||et.push(Yt),oe(et,tn)||et.push(tn))}const Fr=Ae.vertexLength,Or=nt.length>4&&Bb(Yt,tn,Vn);let Ci=Vb(pn,ft,Wt);if($i(this.layoutVertexArray,Yt.x,Yt.y,Yn,Xn,0,0,Ci),$i(this.layoutVertexArray,Yt.x,Yt.y,Yn,Xn,0,1,Ci),pn+=yr,Ci=Vb(pn,Or,!Wt),ft=Or,$i(this.layoutVertexArray,tn.x,tn.y,Yn,Xn,0,0,Ci),$i(this.layoutVertexArray,tn.x,tn.y,Yn,Xn,0,1,Ci),Ae.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Ae.primitiveLength+=2,j){const Zr=xe+(1===ln?nt.length-2:ln-2),zr=1===ln?xe:Zr+1;if(this.indexArray.emplaceBack(Fr+1,Zr,Fr+3),this.indexArray.emplaceBack(Zr,zr,Fr+3),Ae.primitiveLength+=2,void 0===it&&(it=Fr),!Fb(Vn,nt[ln],ve)){const Pr=ln===nt.length-1?it:Ae.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,Pr),this.indexArray.emplaceBack(Fr+3,Pr+1,Pr),this.indexArray.emplaceBack(Fr+3,zr,Pr+1),Ae.primitiveLength+=3}Wt=!Wt}if(I){const Zr=this.layoutVertexExtArray,zr=w.projectTilePoint(Yt.x,Yt.y,s),Pr=w.projectTilePoint(tn.x,tn.y,s),Dr=w.upVector(s,Yt.x,Yt.y),ci=w.upVector(s,tn.x,tn.y);zd(Zr,zr,Dr),zd(Zr,zr,Dr),zd(Zr,Pr,ci),zd(Zr,Pr,ci)}}C&&(xe+=nt.length-1),P&&j&&this.zoom>=17&&(0!==et.length&&oe(et,et[0])&&et.pop(),this.groundEffect.addData(et,ve,y,j>0))}this.footprintSegments.push($e),++M.footprintSegLen}if(M.vertexCount=this.layoutVertexArray.length-M.vertexArrayOffset,M.groundVertexCount=this.groundEffect.vertexArray.length-M.groundVertexArrayOffset,0!==M.vertexCount){if(M.centroidXY=S.borders?Uf:this.encodeCentroid(S,M),this.centroidData.push(M),S.borders){this.featuresOnBorder.push(S);const pe=this.featuresOnBorder.length-1;for(let ve=0;ve<S.borders.length;ve++)S.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,c,d,s,_),this.groundEffect.addPaintPropertiesData(e,i,c,d,s,_),this.maxHeight=Math.max(this.maxHeight,R)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}encodeCentroid(e,n){const i=e.centroid(),s=n.span(),c=Math.min(7,Math.round(s.x*this.tileToMeter/10)),d=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new me(_n(i.x,1,Vt-1)<<3|c,_n(i.y,1,Vt-1)<<3|d)}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Rh,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,s=e.flags&Rh?Uf:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==s.y||c!==s.x){for(let d=n;d<i;++d)this.centroidVertexArray.emplace(d,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(c,d){if(c.length!==d.length)return!1;for(let f=0;f<c.length;f++)if(c[f].sourceId!==d[f].sourceId||!sm(c[f],d[f]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const s=[];for(const c of this.activeReplacements){const d=Math.pow(2,c.footprintTileId.canonical.z-e.canonical.z);for(const f of this.centroidData)if(!(f.flags&Rh||c.min.x>f.max.x||f.min.x>c.max.x||c.min.y>f.max.y||f.min.y>c.max.y))for(let _=0;_<f.footprintSegLen;_++){const y=this.footprintSegments[f.footprintSegIdx+_];if(s.length=0,jf(this.footprintVertices,y.vertexOffset,y.vertexCount,c.footprintTileId.canonical,e.canonical,s),za(c.footprint,s,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-d)){f.flags|=Rh;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let s=!1;for(let c=0;c<i.footprintSegLen;c++){const d=this.footprintSegments[i.footprintSegIdx+c];let f=0;for(const _ of d.ringIndices){for(let y=f,v=_+f-1;y<_+f;v=y++){const w=this.footprintVertices.int16[2*(y+d.vertexOffset)+0],I=this.footprintVertices.int16[2*(y+d.vertexOffset)+1],C=this.footprintVertices.int16[2*(v+d.vertexOffset)+1];I>n!=C>n&&e<(this.footprintVertices.int16[2*(v+d.vertexOffset)+0]-w)*(n-I)/(C-I)+w&&(s=!s)}f=_}}return s}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,s=!0;const c=4*(e+Vt)*Vt+(n+Vt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&Rh)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||n>d.max.y||d.min.y>n||this.footprintContainsPoint(e,n,d)&&d&&d.height>i&&(i=d.height,this.partLookup[c]=d,s=!!(d.flags&Rh));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:s};this.partLookup[c]=void 0}}function Lb(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function p_(t,e,n,i){const s=e.sub(t)._perp()._unit(),c=n.sub(e)._perp()._unit();return Nb(t,e,n,Lb(s,c),i)}function Nb(t,e,n,i,s){const c=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,s*c/i)}function Fb(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function $f(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Bb(t,e,n){if(t.x<0||t.x>=Vt||e.x<0||e.x>=Vt||n.x<0||n.x>=Vt)return!1;const i=n.sub(e),s=i.perp(),c=t.sub(e);return(i.x*c.x+i.y*c.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(c.x*c.x+c.y*c.y))>-.866&&s.x*c.x+s.y*c.y<0}function Vb(t,e,n){const i=e?2|t:-3&t;return n?1|i:-2&i}function RE(){const t=Math.PI/32,e=Math.tan(t),n=yf;return n*Math.sqrt(1+2*e*e)-n}function Uv(t,e,n){const i=1<<n.z,s=Oc(n.x/i),c=Oc((n.x+1)/i),d=Gs(n.y/i),f=Gs((n.y+1)/i);return function(_,y,v,w,I=0,C){const S=[];if(!_.length||!v||!w)return S;const M=(W,oe)=>{for(const pe of W)S.push({polygon:pe,bounds:oe})},P=Math.ceil(Math.log2(v)),R=Math.ceil(Math.log2(w)),z=P-R,G=[];for(let W=0;W<Math.abs(z);W++)G.push(z>0?0:1);for(let W=0;W<Math.min(P,R);W++)G.push(0),G.push(1);let H=_;if(H=Tf(H,y[0].y-I,y[1].y+I,1),H=Tf(H,y[0].x-I,y[1].x+I,0),!H.length)return S;const j=[];for(G.length?j.push({polygons:H,bounds:y,depth:0}):M(H,y);j.length;){const W=j.pop(),oe=W.depth,pe=G[oe],ve=W.bounds[0],xe=W.bounds[1],ke=0===pe?ve.x:ve.y,Ae=0===pe?xe.x:xe.y,$e=C?C(pe,ke,Ae):.5*(ke+Ae),Ce=Tf(W.polygons,ke-I,$e+I,pe),nt=Tf(W.polygons,$e-I,Ae+I,pe);if(Ce.length){const ft=[ve,new me(0===pe?$e:xe.x,1===pe?$e:xe.y)];G.length>oe+1?j.push({polygons:Ce,bounds:ft,depth:oe+1}):M(Ce,ft)}if(nt.length){const ft=[new me(0===pe?$e:ve.x,1===pe?$e:ve.y),xe];G.length>oe+1?j.push({polygons:nt,bounds:ft,depth:oe+1}):M(nt,ft)}}return S}(t,e,Math.ceil((c-s)/11.25),Math.ceil((d-f)/11.25),1,(_,y,v)=>{if(0===_)return.5*(y+v);{const w=Gs((n.y+y/Vt)/i);return(Sa(.5*(Gs((n.y+v/Vt)/i)+w))*i-n.y)*Vt}})}function jf(t,e,n,i,s,c){const d=Math.pow(2,i.z-s.z);for(let f=0;f<n;f++){let _=t.int16[2*(f+e)+0],y=t.int16[2*(f+e)+1];_=(_+s.x*Vt)*d-i.x*Vt,y=(y+s.y*Vt)*d-i.y*Vt,c.push(new me(_,y))}}lr(lm,"FillExtrusionBucket",{omit:["layers","features"]}),lr(zv,"PartData"),lr(h_,"FootprintSegment"),lr(Ob,"BorderCentroidData"),lr(f_,"GroundEffect");const $v=new gs({visibility:new On(ut["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new On(ut["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var zb={paint:new gs({"fill-extrusion-opacity":new On(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new On(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new On(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new On(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new On(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new On(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new On(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new On(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ir(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new On(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new On(ut["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new On(ut["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new On(ut["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:$v};class _c extends me{constructor(e,n,i){super(e,n),this.z=i}}function cm(t,e){return t.x*e.x+t.y*e.y}function PE(t,e){if(1===t.length){let n=0;const i=e[n++];let s;for(;!s||i.equals(s);)if(s=e[n++],!s)return 1/0;for(;n<e.length;n++){const c=e[n],d=t[0],f=s.sub(i),_=c.sub(i),y=d.sub(i),v=cm(f,f),w=cm(f,_),I=cm(_,_),C=cm(y,f),S=cm(y,_),M=v*I-w*w,P=(I*C-w*S)/M,R=(v*S-w*C)/M,z=i.z*(1-P-R)+s.z*P+c.z*R;if(isFinite(z))return z}return 1/0}{let n=1/0;for(const i of e)n=Math.min(n,i.z);return n}}function Ud(t,e,n,i,s,c,d,f){const _=d*s.getElevationAt(t,e,!0,!0),y=0!==c[0],v=y?0===c[1]?d*(c[0]/7-450):d*function(w,I,C){const S=Math.floor(I[0]/8),M=Math.floor(I[1]/8),P=10*(I[0]-8*S),R=10*(I[1]-8*M),z=w.getElevationAt(S,M,!0,!0),G=w.getMeterToDEM(C),H=Math.floor(.5*(P*G-1)),j=Math.floor(.5*(R*G-1)),W=w.tileCoordToPixel(S,M),oe=2*H+1,pe=2*j+1,ve=(et=oe,it=pe,[(nt=w).getElevationAtPixel(ft=W.x-H,It=W.y-j,!0),nt.getElevationAtPixel(ft+it,It,!0),nt.getElevationAtPixel(ft,It+it,!0),nt.getElevationAtPixel(ft+et,It+it,!0)]),xe=Math.abs(ve[0]-ve[1]),ke=Math.abs(ve[2]-ve[3]),Ae=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),$e=Math.min(.25,.5*G*(xe+ke)/oe),Ce=Math.min(.25,.5*G*Ae/pe);var nt,ft,It,et,it;return z+Math.max($e*P,Ce*R)}(s,c,f):_;return{base:_+(0===n)?-1:n,top:y?Math.max(v+i,_+n+2):_+i}}const FA=new gs({"line-cap":new Ir(ut.layout_line["line-cap"]),"line-join":new Ir(ut.layout_line["line-join"]),"line-miter-limit":new On(ut.layout_line["line-miter-limit"]),"line-round-limit":new On(ut.layout_line["line-round-limit"]),"line-sort-key":new Ir(ut.layout_line["line-sort-key"]),visibility:new On(ut.layout_line.visibility)});var Gf={paint:new gs({"line-opacity":new Ir(ut.paint_line["line-opacity"]),"line-color":new Ir(ut.paint_line["line-color"]),"line-translate":new On(ut.paint_line["line-translate"]),"line-translate-anchor":new On(ut.paint_line["line-translate-anchor"]),"line-width":new Ir(ut.paint_line["line-width"]),"line-gap-width":new Ir(ut.paint_line["line-gap-width"]),"line-offset":new Ir(ut.paint_line["line-offset"]),"line-blur":new Ir(ut.paint_line["line-blur"]),"line-dasharray":new Ir(ut.paint_line["line-dasharray"]),"line-pattern":new Ir(ut.paint_line["line-pattern"]),"line-gradient":new xp(ut.paint_line["line-gradient"]),"line-trim-offset":new On(ut.paint_line["line-trim-offset"]),"line-emissive-strength":new On(ut.paint_line["line-emissive-strength"]),"line-border-width":new Ir(ut.paint_line["line-border-width"]),"line-border-color":new Ir(ut.paint_line["line-border-color"])}),layout:FA};const OE=(t,e,n,i,s,c,d)=>{const f=t.transform,_=f.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:jl(t,e,n,i),u_pixels_to_tile_units:_,u_device_pixel_ratio:c,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:g_(n)?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:m_(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:n.paint.get("line-emissive-strength")}},kE=(t,e,n,i,s)=>{const c=t.transform;return{u_matrix:jl(t,e,n,i),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:m_(e,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function m_(t,e){return 1/nm(t,1,e.tileZoom)}function jl(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ub=t=>{const e=[];g_(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function g_(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const jv=new class extends Ir{possiblyEvaluate(t,e){return e=new Vo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=Ye({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(Gf.paint.properties["line-width"].specification);function __(t,e){return e>0?e+2*t:t}jv.useIntegerZoom=!0;const BA=new gs({visibility:new On(ut.layout_background.visibility)});var y_={paint:new gs({"background-color":new On(ut.paint_background["background-color"]),"background-pattern":new On(ut.paint_background["background-pattern"]),"background-opacity":new On(ut.paint_background["background-opacity"]),"background-emissive-strength":new On(ut.paint_background["background-emissive-strength"])}),layout:BA};const Gv=new gs({visibility:new On(ut.layout_raster.visibility)});var VA={paint:new gs({"raster-opacity":new On(ut.paint_raster["raster-opacity"]),"raster-color":new xp(ut.paint_raster["raster-color"]),"raster-color-mix":new On(ut.paint_raster["raster-color-mix"]),"raster-color-range":new On(ut.paint_raster["raster-color-range"]),"raster-hue-rotate":new On(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new On(ut.paint_raster["raster-saturation"]),"raster-contrast":new On(ut.paint_raster["raster-contrast"]),"raster-resampling":new On(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new On(ut.paint_raster["raster-fade-duration"])}),layout:Gv};function LE(t,e,n,i,s,c,d,f){const _=[t,n,s,e,i,c,1,1,1],y=[d,f,1],v=yl.adjoint([],_),[w,I,C]=He.transformMat3(y,y,yl.transpose(v,v));return yl.multiply(_,[w,0,0,0,I,0,0,0,C],_)}class $d extends Kn{constructor(e,n,i,s){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new kt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=rt(this.map._requestManager.transformRequest(this.url,Ht.Image),(i,s)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new wn(i));else if(s){const{HTMLImageElement:c}=ge;this.image=s instanceof c?ne.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Dv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Dv||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(const c of e)c[1]>i&&(i=c[1]),c[1]<n&&(n=c[1]);const s=(i+n)/2;if(s>As?this.onNorthPole=!0:s<-As&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(Ri.fromLngLat);this.tileID=function(d){let f=1/0,_=1/0,y=-1/0,v=-1/0;for(const S of d)f=Math.min(f,S.x),_=Math.min(_,S.y),y=Math.max(y,S.x),v=Math.max(v,S.y);const w=Math.max(y-f,v-_),I=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),C=Math.pow(2,I);return new vh(I,Math.floor((f+y)/2*C),Math.floor((_+v)/2*C))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new kt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const _ in this.tiles){const y=this.tiles[_];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}if(this._boundsArray)return;const n=Pd(this.tileID,this.map.transform.projection),[i,s,c,d]=this.coordinates.map(_=>{const y=n.projection.project(_[0],_[1]);return Nc(n,y)._round()});this.perspectiveTransform=function(_,y,v,w,I,C,S,M,P,R){const z=LE(0,0,_,0,0,y,_,y),G=LE(v,w,I,C,S,M,P,R);return yl.multiply(G,yl.adjoint(z,z),G),[G[6]/G[8]*_/Vt,G[7]/G[8]*y/Vt]}(this.width,this.height,i.x,i.y,s.x,s.y,d.x,d.y,c.x,c.y);const f=this._boundsArray=new Mu;f.emplaceBack(i.x,i.y,0,0),f.emplaceBack(s.x,s.y,Vt,0),f.emplaceBack(d.x,d.y,0,Vt),f.emplaceBack(c.x,c.y,Vt,Vt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(f,hr.members),this.boundsSegments=so.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof Dv||(this.texture?this.texture.update(this.image):(this.texture=new ls(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ph extends uc{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const WS=new gs({visibility:new On(ut.layout_sky.visibility)});var yc={paint:new gs({"sky-type":new On(ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new On(ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new On(ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new On(ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new On(ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new xp(ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new On(ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new On(ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new On(ut.paint_sky["sky-opacity"])}),layout:WS};function $b(t,e,n){const i=[0,0,1],s=ia.identity([]);return ia.rotateY(s,s,n?-De(t)+Math.PI:De(t)),ia.rotateX(s,s,-De(e)),He.transformQuat(i,i,s),He.normalize(i,i)}var Hv={paint:new gs({})};const zA={circle:class extends uc{constructor(t,e){super(t,ev,e)}createBucket(t){return new xS(t)}queryRadius(t){const e=t;return zl("circle-radius",this,e)+zl("circle-stroke-width",this,e)+Ar(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,s,c,d,f){const _=Di(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return tA(t,i,c,d,f,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),_,y)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=eA(this);return{config:new hf(this,e),defines:n,overrideFog:!1}}},heatmap:class extends uc{createBucket(t){return new Id(t)}constructor(t,e){super(t,Zx,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return zl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,s,c,d,f){const _=this.paint.get("heatmap-radius").evaluate(e,n);return tA(t,i,c,d,f,!0,!0,new me(0,0),_)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new hf(this,e),overrideFog:!1}:{}}},hillshade:class extends uc{constructor(t,e){super(t,rA,e)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends uc{constructor(t,e){super(t,nb,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new hf(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vg(t)}queryRadius(){return Ar(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,s,c){return!t.queryGeometry.isAboveHorizon&&wS(Lw(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends uc{constructor(t,e){super(t,zb,e)}createBucket(t){return new lm(t)}queryRadius(){return Ar(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,s,c,d,f,_){const y=Di(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,n),w=this.paint.get("fill-extrusion-base").evaluate(e,n),I=[0,0],C=f&&c.elevation,S=c.elevation?c.elevation.exaggeration():1,M=t.tile.getBucket(this);if(C&&M instanceof lm){const H=M.centroidVertexArray,j=_+1;j<H.length&&(I[0]=H.geta_centroid_pos0(j),I[1]=H.geta_centroid_pos1(j))}if(0===I[0]&&1===I[1])return!1;"globe"===c.projection.name&&(i=Uv([i],[new me(0,0),new me(Vt,Vt)],t.tileID.canonical).map(H=>H.polygon).flat());const P=C?f:null,[R,z]=(j=i,W=w,oe=v,pe=y,ve=d,xe=P,ke=I,Ae=S,$e=c.center.lat,"globe"===(H=c).projection.name?function(nt,ft,It,et,it,St,Ut,Wt,ln,pn,Yt){const tn=[],Vn=[],Jn=nt.projection.upVectorScale(Yt,nt.center.lat,nt.worldSize).metersToTile,Yn=[0,0,0,1],Xn=[0,0,0,1],yr=(Or,Ci,Zr,zr)=>{Or[0]=Ci,Or[1]=Zr,Or[2]=zr,Or[3]=1},Fr=RE();It>0&&(It+=Fr),et+=Fr;for(const Or of ft){const Ci=[],Zr=[];for(const zr of Or){const Pr=zr.x+it.x,Dr=zr.y+it.y,ci=nt.projection.projectTilePoint(Pr,Dr,Yt),Pi=nt.projection.upVector(Yt,zr.x,zr.y);let Jr=It,Xi=et;if(Ut){const vo=Ud(Pr,Dr,It,et,Ut,Wt,ln,pn);Jr+=vo.base,Xi+=vo.top}0!==It?yr(Yn,ci.x+Pi[0]*Jn*Jr,ci.y+Pi[1]*Jn*Jr,ci.z+Pi[2]*Jn*Jr):yr(Yn,ci.x,ci.y,ci.z),yr(Xn,ci.x+Pi[0]*Jn*Xi,ci.y+Pi[1]*Jn*Xi,ci.z+Pi[2]*Jn*Xi),He.transformMat4(Yn,Yn,St),He.transformMat4(Xn,Xn,St),Ci.push(new _c(Yn[0],Yn[1],Yn[2])),Zr.push(new _c(Xn[0],Xn[1],Xn[2]))}tn.push(Ci),Vn.push(Zr)}return[tn,Vn]}(H,j,W,oe,pe,ve,xe,ke,Ae,$e,t.tileID.canonical):xe?function(nt,ft,It,et,it,St,Ut,Wt,ln){const pn=[],Yt=[],tn=[0,0,0,1];for(const Vn of nt){const Jn=[],Yn=[];for(const Xn of Vn){const yr=Xn.x+et.x,Fr=Xn.y+et.y,Or=Ud(yr,Fr,ft,It,St,Ut,Wt,ln);tn[0]=yr,tn[1]=Fr,tn[2]=Or.base,tn[3]=1,no.transformMat4(tn,tn,it),tn[3]=Math.max(tn[3],1e-5);const Ci=new _c(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);tn[0]=yr,tn[1]=Fr,tn[2]=Or.top,tn[3]=1,no.transformMat4(tn,tn,it),tn[3]=Math.max(tn[3],1e-5);const Zr=new _c(tn[0]/tn[3],tn[1]/tn[3],tn[2]/tn[3]);Jn.push(Ci),Yn.push(Zr)}pn.push(Jn),Yt.push(Yn)}return[pn,Yt]}(j,W,oe,pe,ve,xe,ke,Ae,$e):function(nt,ft,It,et,it){const St=[],Ut=[],Wt=it[8]*ft,ln=it[9]*ft,pn=it[10]*ft,Yt=it[11]*ft,tn=it[8]*It,Vn=it[9]*It,Jn=it[10]*It,Yn=it[11]*It;for(const Xn of nt){const yr=[],Fr=[];for(const Or of Xn){const Ci=Or.x+et.x,Zr=Or.y+et.y,zr=it[0]*Ci+it[4]*Zr+it[12],Pr=it[1]*Ci+it[5]*Zr+it[13],Dr=it[2]*Ci+it[6]*Zr+it[14],ci=it[3]*Ci+it[7]*Zr+it[15],Pi=zr+Wt,Jr=Pr+ln,Xi=Dr+pn,vo=Math.max(ci+Yt,1e-5),So=zr+tn,xo=Pr+Vn,Ns=Dr+Jn,Qo=Math.max(ci+Yn,1e-5);yr.push(new _c(Pi/vo,Jr/vo,Xi/vo)),Fr.push(new _c(So/Qo,xo/Qo,Ns/Qo))}St.push(yr),Ut.push(Fr)}return[St,Ut]}(j,W,oe,pe,ve)),G=t.queryGeometry;var H,j,W,oe,pe,ve,xe,ke,Ae,$e;return function(H,j,W){let oe=1/0;wS(W,j)&&(oe=PE(W,j[0]));for(let pe=0;pe<j.length;pe++){const ve=j[pe],xe=H[pe];for(let ke=0;ke<ve.length-1;ke++){const Ae=ve[ke],$e=[Ae,ve[ke+1],xe[ke+1],xe[ke],Ae];bS(W,$e)&&(oe=Math.min(oe,PE(W,$e)))}}return oe!==1/0&&oe}(R,z,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends uc{constructor(t,e){super(t,Gf,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ol,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=jv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new mu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=Ub(this);return{config:new hf(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=__(zl("line-width",this,e),zl("line-gap-width",this,e)),i=zl("line-offset",this,e);return n/2+Math.abs(i)+Ar(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,s,c){if(t.queryGeometry.isAboveHorizon)return!1;const d=Lw(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),f=t.pixelToTileUnitsFactor/2*__(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),_=this.paint.get("line-offset").evaluate(e,n);return _&&(i=function(y,v){const w=[],I=new me(0,0);for(let C=0;C<y.length;C++){const S=y[C],M=[];for(let P=0;P<S.length;P++){const R=S[P],z=S[P+1],G=0===P?I:R.sub(S[P-1])._unit()._perp(),H=P===S.length-1?I:z.sub(R)._unit()._perp(),j=G._add(H)._unit();j._mult(1/(j.x*H.x+j.y*H.y)),M.push(j._mult(v)._add(R))}w.push(M)}return w}(i,_*t.pixelToTileUnitsFactor)),function(y,v,w){for(let I=0;I<v.length;I++){const C=v[I];if(y.length>=3)for(let S=0;S<C.length;S++)if(kp(y,C[S]))return!0;if(Jy(y,C,w))return!0}return!1}(d,i,f)}isTileClipped(){return!0}},symbol:i_,background:class extends uc{constructor(t,e){super(t,y_,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends uc{constructor(t,e){super(t,VA,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof $d&&(t._source.onNorthPole||t._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=bl({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends uc{constructor(t,e){super(t,yc,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=bl({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),s=!i,c=t.style.light,d=c.properties.get("position");return s&&"viewport"===c.properties.get("anchor")&&Me("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?$b(d.azimuthal,90-d.polar,e):$b(i[0],90-i[1],e)}const n=this.paint.get("sky-gradient-center");return $b(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends uc{constructor(t,e){super(t,Hv)}},model:class extends uc{constructor(t,e){super(t,SE,e)}createBucket(t){return new im(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof _r}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function zc(t,e){return"custom"===t.type?new Ph(t):new zA[t.type](t,e)}function UA(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class v_ extends Kn{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Ki({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,n){if(this.loaded[n]!==e&&(this.loaded[n]=e,e)){for(const{ids:i,callback:s}of this.requestors)this._notify(i,n,s);this.requestors=[]}}hasImage(e,n){return!!this.getImage(e,n)}getImage(e,n){return this.images[n][e]}addImage(e,n,i){this._validate(e,i)&&(this.images[n][e]=i)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new wn(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new wn(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new wn(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,n){if(!e)return!0;let i=0;for(const s of e){if(s[0]<i||s[1]<s[0]||n<s[1])return!1;i=s[1]}return!0}_validateContent(e,n){return!(e&&(4!==e.length||e[0]<0||n.data.width<e[0]||e[1]<0||n.data.height<e[1]||e[2]<0||n.data.width<e[2]||e[3]<0||n.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,n,i){i.version=this.images[n][e].version+1,this.images[n][e]=i,this.updatedImages[n][e]=!0}removeImage(e,n){const i=this.images[n][e];delete this.images[n][e],delete this.patterns[n][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,n,i){let s=!0;const c=!!this.loaded[n];if(!c)for(const d of e)this.images[n][d]||(s=!1);c||s?this._notify(e,n,i):this.requestors.push({ids:e,scope:n,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,n,i){const s={};for(const c of e){this.images[n][c]||this.fire(new kt("styleimagemissing",{id:c}));const d=this.images[n][c];d?s[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!(!d.userImage||!d.userImage.render)}:Me(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,s)}getPixelSize(e){const{width:n,height:i}=this.atlasImage[e];return{width:n,height:i}}getPattern(e,n){const i=this.patterns[n][e],s=this.getImage(e,n);if(!s)return null;if(i&&i.position.version===s.version)return i.position;if(i)i.position.version=s.version;else{const c={w:s.data.width+2,h:s.data.height+2,x:0,y:0},d=new Dd(c,s);this.patterns[n][e]={bin:c,position:d}}return this._updatePatternAtlas(n),this.patterns[n][e].position}bind(e,n){const i=e.gl;let s=this.atlasTexture[n];s?this.dirty&&(s.update(this.atlasImage[n]),this.dirty=!1):(s=new ls(e,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=s),s.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const n=[];for(const d in this.patterns[e])n.push(this.patterns[e][d].bin);const{w:i,h:s}=iE(n),c=this.atlasImage[e];c.resize({width:i||1,height:s||1});for(const d in this.patterns[e]){const{bin:f}=this.patterns[e][d],_=f.x+1,y=f.y+1,v=this.images[e][d].data,w=v.width,I=v.height;Ki.copy(v,c,{x:0,y:0},{x:_,y},{width:w,height:I}),Ki.copy(v,c,{x:0,y:I-1},{x:_,y:y-1},{width:w,height:1}),Ki.copy(v,c,{x:0,y:0},{x:_,y:y+I},{width:w,height:1}),Ki.copy(v,c,{x:w-1,y:0},{x:_-1,y},{width:1,height:I}),Ki.copy(v,c,{x:0,y:0},{x:_+w,y},{width:1,height:I})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,n){for(const i of e){if(this.callbackDispatchedThisFrame[n][i])continue;this.callbackDispatchedThisFrame[n][i]=!0;const s=this.images[n][i];UA(s)&&this.updateImage(i,n,s)}}}const $A=new gs({anchor:new On(ut.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return nn(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Er(t.x,e.x,n),y:Er(t.y,e.y,n),z:Er(t.z,e.z,n),azimuthal:Er(t.azimuthal,e.azimuthal,n),polar:Er(t.polar,e.polar,n)}}}(ut.light.position),color:new On(ut.light.color),intensity:new On(ut.light.intensity)});class Oh extends Kn{constructor(e,n="flat"){super(),this._transitionable=new rx($A),this.setLight(e,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n,i={}){this._validate(X1,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&nu(this,e.call(Zm,Ye({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ut})))}}const Hi=new gs({source:new On(ut.terrain.source),exaggeration:new On(ut.terrain.exaggeration)});let qS=class extends Kn{constructor(t,e){super(),this._transitionable=new rx(Hi),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}setScope(t){this.scope=t}get(){return this._transitionable.serialize()}set(t){this._transitionable.setTransitionOrValue(t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new Vo(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof _r}};const Wv=45,jb=65,yu=.05;function um(t,e,n,i){const s=sn(Wv,jb,n),[c,d]=x_(t,i);let f=1-Math.min(1,Math.exp((e-c)/(d-c)*-6));return f*=f*f,f=Math.min(1,1.00747*f),f*s*t.alpha}function x_(t,e){const n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}function NE(t,e,n,i,s){const c=He.transformMat4([],[e,n,i],s.mercatorFogMatrix);return um(t,He.length(c),s.pitch,s._fov)}function dm(t,e,n,i,s,c,d){const f=[[n,i,0],[s,i,0],[s,c,0],[n,c,0]];let _=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(const v of f){const w=He.transformMat4([],v,e),I=He.length(w);_=Math.min(_,I),y=Math.max(y,I)}return[um(t,_,d.pitch,d._fov),um(t,y,d.pitch,d._fov)]}const jA=new gs({range:new On(ut.fog.range),color:new On(ut.fog.color),"high-color":new On(ut.fog["high-color"]),"space-color":new On(ut.fog["space-color"]),"horizon-blend":new On(ut.fog["horizon-blend"]),"star-intensity":new On(ut.fog["star-intensity"]),"vertical-range":new On(ut.fog["vertical-range"])});class kh extends Kn{constructor(e,n){super(),this._transitionable=new rx(jA),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const e=this._transform,n="globe"===e.projection.name,i=el(e.zoom),s=this.properties.get("range"),c=[.5,3];return{range:n?[Er(c[0],s[0],i),Er(c[1],s[1],i)]:s,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(this._validate(Q1,e,n))return;const i=Ye({},e);for(const s of Object.keys(ut.fog))void 0===i[s]&&(i[s]=ut.fog[s].default);this._transitionable.setTransitionOrValue(i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:sn(Wv,jb,e))*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(i,s,c){const d=Ri.fromLngLat(s),f=c.elevation?c.elevation.getAtPointOrZero(d):0;return NE(i,d.x,d.y,f,c)}(this.state,e,n):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(e.toUnwrapped());return dm(this.state,n,0,0,Vt,Vt,this._transform)}getOpacityForBounds(e,n,i,s,c){return this._transform.projection.supportsFog?dm(this.state,e,n,i,s,c,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?x_(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const s=e.points[i];let c;if(s[2]>=0)c=s;else{const d=e.points[i-4];c=Yl(d,s,d[2]/(d[2]-s[2]))}if(NE(this.state,c[0],c[1],0,this._transform)>=yu)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&nu(this,e.call(Zm,Ye({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ut})))}}class jd{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Gb{constructor(){this.tasks={},this.taskQueue=[],gr(["process"],this),this.invoker=new jd(this.process),this.nextId=0}add(e,n){const i=this.nextId++,s=function({type:c,isSymbolTile:d,zoom:f}){return f=f||0,"message"===c?0:"maybePrepare"!==c||d?"parseTile"!==c||d?"parseTile"===c&&d?300-f:"maybePrepare"===c&&d?400-f:500:200-f:100-f}(n);if(0===s){Xt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:n,priority:s,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){Xt();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let s=0;s<this.taskQueue.length;s++){const c=this.tasks[this.taskQueue[s]];c.priority<n&&(n=c.priority,e=s)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Lh{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},gr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Gb}send(e,n,i,s,c=!1,d){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=d,this.callbacks[f]=i);const _=new Set;return this.target.postMessage({id:f,type:e,hasCallback:!!i,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Ac(n,_)},_),{cancel:()=>{i&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){const n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(n.mustQueue||Xt()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,n),s&&s.metadata||{type:"message"})}else this.processTask(i,n)}processTask(e,n){if("<response>"===n.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(Cu(n.error)):i(null,Cu(n.data)))}else{const i=new Set,s=n.hasCallback?(d,f)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?Ac(d):null,data:Ac(f,i)},i)}:d=>{},c=Cu(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,c,s);else if(this.parent.getWorkerSource){const d=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,d[0],c.source,c.scope)[d[1]](c,s)}else s(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let qv=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Gn();const s=this.workerPool.acquire(this.id);for(let c=0;c<s.length;c++){const d=new t.Actor(s[c],i,this.id);d.name=`Worker ${c}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,s){Xe(this.actors,(c,d)=>{c.send(n,i,d)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=Lh,t})();class hm extends Kn{constructor(e,n,i,s){super(),this.scope=i,this._options=e,this.properties=new hd(n),this._transitionable=new rx(n,new Map(s)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,n){this._options=e,this._transitionable.setTransitionOrValue(e.properties,n)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const GA=new gs({color:new On(ut.properties_light_ambient.color),intensity:new On(ut.properties_light_ambient.intensity)}),Hb=new gs({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){const s=nn([1,n,i]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Er(t.x,e.x,n),y:Er(t.y,e.y,n),z:Er(t.z,e.z,n)}}}(ut.properties_light_directional.direction),color:new On(ut.properties_light_directional.color),intensity:new On(ut.properties_light_directional.intensity),"cast-shadows":new On(ut.properties_light_directional["cast-shadows"]),"shadow-intensity":new On(ut.properties_light_directional["shadow-intensity"])});class Nh{constructor(e,n,i,s){this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,s)}static createFromScreenPoints(e,n){let i,s;if(e instanceof me||"number"==typeof e[0]){const c=me.convert(e);i=[c],s=n.isPointAboveHorizon(c)}else{const c=me.convert(e[0]),d=me.convert(e[1]);i=[c,d],s=on(c,d).every(f=>n.isPointAboveHorizon(f))}return new Nh(i,n.getCameraPoint(),s,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return on(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new me(1,1)):this.screenBounds[1],s=on(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?s.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?s[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(s[3]=this.cameraPoint)),function(c,d){const f=[];for(let _=0;_<c.length;_++){const y=yt(_-1,-1,c.length-1),v=yt(_+1,-1,c.length-1),w=c[_],I=c[v],C=c[y].sub(w).unit(),S=I.sub(w).unit(),M=S.angleWithSep(C.x,C.y),P=C.add(S).unit().mult(-1*d/Math.sin(M/2));f.push(w.add(P))}return f}(s,e)}bufferedCameraGeometryGlobe(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new me(1,1)):this.screenBounds[1],s=on(n,i,e),c=this.cameraPoint.clone();switch(3*((c.y>n.y)+(c.y>i.y))+((c.x>n.x)+(c.x>i.x))){case 0:s[0]=c,s[4]=c.clone();break;case 1:s.splice(1,0,c);break;case 2:s[1]=c;break;case 3:s.splice(4,0,c);break;case 5:s.splice(2,0,c);break;case 6:s[3]=c;break;case 7:s.splice(3,0,c);break;case 8:s[2]=c}return s}containsTile(e,n,i,s=0){const c=e.queryPadding/n._pixelsPerMercatorPixel+1,d=i?this._bufferedCameraMercator(c,n):this._bufferedScreenMercator(c,n);let f=e.tileID.wrap+(d.unwrapped?s:0);const _=d.polygon.map(P=>Nc(e.tileTransform,P,f));if(!kw(_,0,0,Vt,Vt))return;f=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?s:0);const y=this.screenGeometryMercator.polygon.map(P=>Rf(e.tileTransform,P,f)),v=y.map(P=>new me(P[0],P[1])),w=n.getFreeCameraOptions().position||new Ri(0,0,0),I=Rf(e.tileTransform,w,f),C=y.map(P=>{const R=He.sub(P,P,I);return He.normalize(R,R),new qy(I,R)}),S=nm(e,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:v,tilespaceRays:C,bufferedTilespaceGeometry:_,bufferedTilespaceBounds:(M=en(_),M.min.x=_n(M.min.x,0,Vt),M.min.y=_n(M.min.y,0,Vt),M.max.x=_n(M.max.x,0,Vt),M.max.y=_n(M.max.y,0,Vt),M),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:S};var M}_bufferedScreenMercator(e,n){const i=Ls(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let s;return s="globe"===n.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),n):{polygon:this.bufferedScreenGeometry(e).map(c=>n.pointCoordinate3D(c)),unwrapped:!0},this._screenRaycastCache[i]=s,s}}_bufferedCameraMercator(e,n){const i=Ls(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let s;return s="globe"===n.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),n):{polygon:this.bufferedCameraGeometry(e).map(c=>n.pointCoordinate3D(c)),unwrapped:!0},this._cameraRaycastCache[i]=s,s}}_projectAndResample(e,n){const i=function(c,d){const f=Dt.multiply([],d.pixelMatrix,d.globeMatrix),_=[0,-Ja,0,1],y=[0,Ja,0,1],v=[0,0,0,1];no.transformMat4(_,_,f),no.transformMat4(y,y,f),no.transformMat4(v,v,f);const w=new me(_[0]/_[3],_[1]/_[3]),I=new me(y[0]/y[3],y[1]/y[3]),C=kp(c,w)&&_[3]<v[3],S=kp(c,I)&&y[3]<v[3];if(!C&&!S)return null;const M=function(oe,pe,ve){for(let xe=1;xe<oe.length;xe++){const ke=b_(pe.pointCoordinate3D(oe[xe-1]).x),Ae=b_(pe.pointCoordinate3D(oe[xe]).x);if(ve<0){if(ke<Ae)return{idx:xe,t:-ke/(Ae-1-ke)}}else if(Ae<ke)return{idx:xe,t:(1-ke)/(Ae+1-ke)}}return null}(c,d,C?-1:1);if(!M)return null;const{idx:P,t:R}=M;let z=P>1?Yv(c.slice(0,P),d):[],G=P<c.length?Yv(c.slice(P),d):[];z=z.map(oe=>new me(b_(oe.x),oe.y)),G=G.map(oe=>new me(b_(oe.x),oe.y));const H=[...z];0===H.length&&H.push(G[G.length-1]);const j=Er(H[H.length-1].y,(0===G.length?z[0]:G[0]).y,R);let W;return W=C?[new me(0,j),new me(0,0),new me(1,0),new me(1,j)]:[new me(1,j),new me(1,1),new me(0,1),new me(0,j)],H.push(...W),0===G.length?H.push(z[0]):H.push(...G),{polygon:H.map(oe=>new Ri(oe.x,oe.y)),unwrapped:!1}}(e,n);if(i)return i;const s=function(c,d){let f=!1,_=-1/0,y=0;for(let w=0;w<c.length-1;w++)c[w].x>_&&(_=c[w].x,y=w);for(let w=0;w<c.length-1;w++){const I=(y+w)%(c.length-1),C=c[I],S=c[I+1];Math.abs(C.x-S.x)>.5&&(C.x<S.x?(C.x+=1,0===I&&(c[c.length-1].x+=1)):(S.x+=1,I+1===c.length-1&&(c[0].x+=1)),f=!0)}const v=tl(d.center.lng);return f&&v<Math.abs(v-1)&&c.forEach(w=>{w.x-=1}),{polygon:c,unwrapped:f}}(Yv(e,n).map(c=>new me(b_(c.x),c.y)),n);return{polygon:s.polygon.map(c=>new Ri(c.x,c.y)),unwrapped:s.unwrapped}}}function Yv(t,e){return jx(t,n=>{const i=e.pointCoordinate3D(n);n.x=i.x,n.y=i.y},1/256)}function b_(t){return t<0?1+t%1:t%1}function Ls(t){return 100*t|0}function w_(t,e,n,i,s){const c=function(d,f){if(d)return s(d);if(f){t.url&&f.tiles&&t.tiles&&delete t.tiles;const _=_t(Ye(f,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(_.vectorLayers=f.vector_layers,_.vectorLayerIds=_.vectorLayers.map(y=>y.id)),_.tiles=e.canonicalizeTileset(_,t.url),s(null,_)}};return t.url?En(e.transformRequest(e.normalizeSourceURL(t.url,null,n,i),Ht.Source),c):ne.frame(()=>c(null,t))}class Wb{constructor(e,n,i){this.bounds=Mc.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(tl(this.bounds.getWest())*n),s=Math.floor(Sa(this.bounds.getNorth())*n),c=Math.ceil(tl(this.bounds.getEast())*n),d=Math.ceil(Sa(this.bounds.getSouth())*n);return e.x>=i&&e.x<c&&e.y>=s&&e.y<d}}class qb{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new cu({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const i=this.getKey(e,n);return this.positions[i]}trim(){const e=this.width,n=this.height=Hn(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){const s=[];let c=e.length%2==1?-e[e.length-1]*i:0,d=e[0]*i,f=!0;s.push({left:c,right:d,isDash:f,zeroLength:0===e[0]});let _=e[0];for(let y=1;y<e.length;y++){f=!f;const v=e[y];c=_*i,_+=v,d=_*i,s.push({left:c,right:d,isDash:f,zeroLength:0===v})}return s}addRoundDash(e,n,i){const s=n/2;for(let c=-i;c<=i;c++){const d=this.width*(this.nextRow+i+c);let f=0,_=e[f];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++f]);const v=Math.abs(y-_.left),w=Math.abs(y-_.right),I=Math.min(v,w);let C;const S=c/i*(s+1);if(_.isDash){const M=s-Math.abs(S);C=Math.sqrt(I*I+M*M)}else C=s-Math.sqrt(I*I+S*S);this.image.data[d+y]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(e,n){for(let _=e.length-1;_>=0;--_){const y=e[_],v=e[_+1];y.zeroLength?e.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,e.splice(_,1))}const i=e[0],s=e[e.length-1];i.isDash===s.isDash&&(i.left=s.left-this.width,s.right=i.right+this.width);const c=this.width*this.nextRow;let d=0,f=e[d];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++d]);const y=Math.abs(_-f.left),v=Math.abs(_-f.right),w=Math.min(y,v);this.image.data[c+_]=Math.max(0,Math.min(255,(f.isDash?w:-w)+n+128))}}addDash(e,n){const i=this.getKey(e,n);if(this.positions[i])return this.positions[i];const s="round"===n,c=s?7:0,d=2*c+1;if(this.nextRow+d>this.height)return Me("LineAtlas out of space"),null;0===e.length&&e.push(1);let f=0;for(let v=0;v<e.length;v++)e[v]<0&&(Me("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),f+=e[v];if(0!==f){const v=this.width/f,w=this.getDashRanges(e,this.width,v);s?this.addRoundDash(w,v,c):this.addRegularDash(w,"square"===n?.5*v:0)}const _=this.nextRow+c;this.nextRow+=d;const y={tl:[_,c],br:[f,0]};return this.positions[i]=y,y}}lr(qb,"LineAtlas");const FE=1*$u;class vu{constructor(e){const n={},i=[];for(const f in e){const _=e[f],y=n[f]={};for(const v in _.glyphs){const w=_.glyphs[+v];if(!w||0===w.bitmap.width||0===w.bitmap.height)continue;const I=w.metrics.localGlyph?FE:1,C={x:0,y:0,w:w.bitmap.width+2*I,h:w.bitmap.height+2*I};i.push(C),y[v]=C}}const{w:s,h:c}=iE(i),d=new cu({width:s||1,height:c||1});for(const f in e){const _=e[f];for(const y in _.glyphs){const v=_.glyphs[+y];if(!v||0===v.bitmap.width||0===v.bitmap.height)continue;const w=n[f][y],I=v.metrics.localGlyph?FE:1;cu.copy(v.bitmap,d,{x:0,y:0},{x:w.x+I,y:w.y+I},v.bitmap)}}this.image=d,this.positions=n}}lr(vu,"GlyphAtlas");class YS{constructor(e){this.tileID=new Bi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Pd(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,i,s,c){this.status="parsing",this.data=e,this.collisionBoxArray=new cx;const d=new ib(Object.keys(e.layers).sort()),f=new Cf(this.tileID,this.promoteId);f.bucketLayerIDs=[];const _={},y=new qb(256,256),v={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:y,availableImages:i,brightness:this.brightness},w=n.familiesBySource[this.source];for(const z in w){const G=e.layers[z];if(!G)continue;let H=!1,j=!1,W=!1;for(const ve of w[z])"symbol"===ve[0].type?H=!0:j=!0,ve[0].is3D()&&"model"!==ve[0].type&&(W=!0);if(this.extraShadowCaster&&!W||!0===this.isSymbolTile&&!H||!1===this.isSymbolTile&&!j)continue;1===G.version&&Me(`Vector tile source "${this.source}" layer "${z}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const oe=d.encode(z),pe=[];for(let ve=0;ve<G.length;ve++){const xe=G.feature(ve),ke=f.getId(xe,z);pe.push({feature:xe,id:ke,index:ve,sourceLayerIndex:oe})}for(const ve of w[z]){const xe=ve[0];(!this.extraShadowCaster||xe.is3D()&&"model"!==xe.type)&&(void 0!==this.isSymbolTile&&"symbol"===xe.type!==this.isSymbolTile||xe.minzoom&&this.zoom<Math.floor(xe.minzoom)||xe.maxzoom&&this.zoom>=xe.maxzoom||"none"!==xe.visibility&&(Yb(ve,this.zoom,v.brightness,i),(_[xe.id]=xe.createBucket({index:f.bucketLayerIDs.length,layers:ve,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:oe,sourceID:this.source,projection:this.projection.spec})).populate(pe,v,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(ve.map(ke=>ke.id))))}}let I,C,S,M;y.trim();const P={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},R=()=>{if(I)return c(I);if(this.extraShadowCaster)this.status="done",c(null,{buckets:tt(_).filter(z=>!z.isEmpty()),featureIndex:f,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(C&&S&&M){const z=new vu(C),G=new oE(S,M);for(const H in _){const j=_[H];j instanceof Av?(Yb(j.layers,this.zoom,v.brightness,i),dE(j,C,z.positions,S,G.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):j.hasPattern&&(j instanceof mu||j instanceof Vg||j instanceof lm)&&(Yb(j.layers,this.zoom,v.brightness,i),j.addFeatures(v,this.tileID.canonical,G.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",c(null,{buckets:tt(_).filter(H=>!H.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:z.image,lineAtlas:y,imageAtlas:G,brightness:v.brightness})}};if(!this.extraShadowCaster){const z=An(v.glyphDependencies,j=>Object.keys(j).map(Number));Object.keys(z).length?s.send("getGlyphs",{uid:this.uid,stacks:z,scope:this.scope},(j,W)=>{I||(I=j,C=W,R())},void 0,!1,P):C={};const G=Object.keys(v.iconDependencies);G.length?s.send("getImages",{icons:G,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(j,W)=>{I||(I=j,S=W,R())},void 0,!1,P):S={};const H=Object.keys(v.patternDependencies);H.length?s.send("getImages",{icons:H,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(j,W)=>{I||(I=j,M=W,R())},void 0,!1,P):M={}}R()}}function Yb(t,e,n,i){const s=new Vo(e,{brightness:n});for(const c of t)c.recalculate(s,i)}class xu{constructor(e){this.entries={},this.scheduler=e}request(e,n,i,s){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[d,f]=c.result;return this.scheduler?this.scheduler.add(()=>{s(d,f)},n):s(d,f),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=i((d,f)=>{c.result=[d,f];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,f)},n):_(d,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==s),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Fh(t,e,n){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{const c=xn(t.request,(d,f,_,y)=>{d?s(d):f&&s(null,{vectorTile:n?void 0:new Hw(new Af(f)),rawData:f,cacheControl:_,expires:y})});return()=>{c.cancel(),s()}},e)}class Zv extends Kn{constructor(e,n,i,s){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Ye(this,_t(n,["url","scheme","tileSize","promoteId"])),this._options=Ye({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s),this._tileWorkers={},this._deduped=new xu}load(e){this._loaded=!1,this.fire(new kt("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=w_(this._options,this.map._requestManager,n,i,(s,c)=>{this._tileJSONRequest=null,this._loaded=!0,s?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new wn(s))):c&&(Ye(this,c),c.bounds&&(this.tileBounds=new Wb(c.bounds,this.minzoom,this.maxzoom)),ko(c.tiles,this.map._requestManager._customAccessToken),this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new kt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Xa(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ye({},this._options)}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(i,Ht.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ne.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(s.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",s,c.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",s,c.bind(this),void 0,!0);else{const d=Fh.call({deduped:this._deduped},s,(f,_)=>{f||!_?c.call(this,f):(s.data={cacheControl:_.cacheControl,expires:_.expires,rawData:_.rawData.slice(0)},e.actor&&e.actor.send("loadTile",s,c.bind(this),void 0,!0))},!0);e.request={cancel:d}}function c(d,f){return delete e.request,e.aborted?n(null):d&&404!==d.status?n(d):(f&&f.resourceTiming&&(e.resourceTiming=f.resourceTiming),this.map._refreshExpiredTiles&&f&&e.setExpiryData(f),e.loadVectorData(f,this.map.painter),Mo(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Kv extends Kn{constructor(e,n,i,s){super(),this.id=e,this.dispatcher=i,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Ye({type:"raster"},n),Ye(this,_t(n,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new kt("dataloading",{dataType:"source"})),this._tileJSONRequest=w_(this._options,this.map._requestManager,null,null,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new wn(n)):i&&(Ye(this,i),i.bounds&&(this.tileBounds=new Wb(i.bounds,this.minzoom,this.maxzoom)),ko(i.tiles),this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new kt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Xa(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ye({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const i=ne.devicePixelRatio>=2,s=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=rt(this.map._requestManager.transformRequest(s,Ht.Tile),(c,d,f,_)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):c?(e.state="errored",n(c)):d?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:f,expires:_}),e.setTexture(d,this.map.painter),e.state="loaded",Mo(this.dispatcher),void n(null)):n(null)))}static loadTileData(e,n,i){e.setTexture(n,i)}static unloadTileData(e,n){e.texture&&n.saveTileTexture(e.texture)}abortTile(e,n){e.request&&(e.request.cancel(),delete e.request),n()}unloadTile(e,n){e.texture&&this.map.painter.saveTileTexture(e.texture),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Xv;function fm(){return null!=kI.workerClass?new kI.workerClass:new ge.Worker(kI.workerUrl)}const Zb="mapboxgl_preloaded_worker_pool";class Uc{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Uc.workerCount;)this.workers.push(new fm);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Zb]}numActive(){return Object.keys(this.active).length}}let pm;function mm(){return pm||(pm=new Uc),pm}Uc.workerCount=2;let Kb,Hf,Xo,ro=null;function E_(){return Xt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Hf||Be.DRACO_URL}const Tl=5123,gm=5126,Qv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Tl]:Uint16Array,5125:Uint32Array,[gm]:Float32Array},ZS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Tl]:"DT_UINT16",5125:"DT_UINT32",[gm]:"DT_FLOAT32"},Jv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Xb(t,e,n){const i=n.json.bufferViews.length,s=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:s,byteLength:t.byteLength},n.buffers[s]=t}const I_="KHR_draco_mesh_compression";function T_(t,e){const n=t.extensions&&t.extensions[I_];if(!n)return;const i=new Xo.Decoder,s=BE(e,n.bufferView),c=new Xo.Mesh;if(!i.DecodeArrayToMesh(s,s.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[t.indices],f=Qv[d.componentType],_=d.count*f.BYTES_PER_ELEMENT,y=Xo._malloc(_);f===Uint16Array?i.GetTrianglesUInt16Array(c,_,y):i.GetTrianglesUInt32Array(c,_,y),Xb(Xo.memory.buffer.slice(y,y+_),d,e),Xo._free(y);for(const v of Object.keys(n.attributes)){const w=i.GetAttributeByUniqueId(c,n.attributes[v]),I=e.json.accessors[t.attributes[v]],C=ZS[I.componentType],S=I.count*Jv[I.type]*Qv[I.componentType].BYTES_PER_ELEMENT,M=Xo._malloc(S);i.GetAttributeDataArrayForAllPoints(c,w,Xo[C],S,M),Xb(Xo.memory.buffer.slice(M,M+S),I,e),Xo._free(M)}i.destroy(),c.destroy(),delete t.extensions[I_]}const A_=1179937895,C_=new TextDecoder("utf8");function e0(t,e){return new URL(t,e).href}function S_(t,e,n,i){return fetch(e0(t.uri,i)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[n]=s})}function BE(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function HA(t,e,n,i){if(t.uri){const s=e0(t.uri,i);return fetch(s).then(c=>c.blob()).then(c=>ge.createImageBitmap(c)).then(c=>{e.images[n]=c})}if(void 0!==t.bufferView){const s=BE(e,t.bufferView),c=new ge.Blob([s],{type:t.mimeType});return ge.createImageBitmap(c).then(d=>{e.images[n]=d})}}function WA(t,e=0,n){const i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===A_){const y=new Uint32Array(t,e);let v=2;const w=(y[v++]>>2)-3,I=y[v++]>>2;if(v++,i.json=JSON.parse(C_.decode(y.subarray(v,v+I))),v+=I,v<w){const C=y[v++];v++;const S=e+(v<<2);i.buffers[0]=t.slice(S,S+C)}}else i.json=JSON.parse(C_.decode(new Uint8Array(t,e)));const{buffers:s,images:c,meshes:d,extensionsUsed:f}=i.json;let _=Promise.resolve();if(s){const y=[];for(let v=0;v<s.length;v++){const w=s[v];w.uri?y.push(S_(w,i,v,n)):i.buffers[v]||(i.buffers[v]=null)}_=Promise.all(y)}return _.then(()=>{const y=[],v=f&&f.includes(I_);if(v&&y.push(function(){if(!Xo)return Kb||(Kb=function(w){let I,C=null;function S(){I=new Uint8Array(C.buffer)}function M(){throw new Error("Unexpected Draco error.")}const P={a:{a:M,d:function(R,z,G){return I.copyWithin(R,z,z+G)},c:function(R){const z=I.length,G=Math.max(R>>>0,Math.ceil(1.2*z)),H=Math.ceil((G-z)/65536);try{return C.grow(H),S(),!0}catch{return!1}},b:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(w,P):w.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,P))).then(R=>{const{Rb:z,Qb:G,P:H,T:j,X:W,Ja:oe,La:pe,Qa:ve,Va:xe,Wa:ke,eb:Ae,jb:$e,f:Ce,e:nt,yb:ft,zb:It,Ab:et,Bb:it,Db:St,Gb:Ut}=R.instance.exports;C=nt;const Wt=(()=>{let ln=0,pn=0,Yt=0,tn=0;return Vn=>{Yt&&(z(tn),z(ln),pn+=Yt,Yt=ln=0),ln||(pn+=128,ln=G(pn));const Jn=Vn.length+7&-8;let Yn=ln;Jn>=pn&&(Yt=Jn,Yn=tn=G(Jn));for(let Xn=0;Xn<Vn.length;Xn++)I[Yn+Xn]=Vn[Xn];return Yn}})();return S(),Ce(),{memory:nt,_free:z,_malloc:G,Mesh:class{constructor(){this.ptr=H()}destroy(){j(this.ptr)}},Decoder:class{constructor(){this.ptr=oe()}destroy(){$e(this.ptr)}DecodeArrayToMesh(ln,pn,Yt){const tn=Wt(ln),Vn=pe(this.ptr,tn,pn,Yt.ptr);return!!W(Vn)}GetAttributeByUniqueId(ln,pn){return{ptr:ve(this.ptr,ln.ptr,pn)}}GetTrianglesUInt16Array(ln,pn,Yt){xe(this.ptr,ln.ptr,pn,Yt)}GetTrianglesUInt32Array(ln,pn,Yt){ke(this.ptr,ln.ptr,pn,Yt)}GetAttributeDataArrayForAllPoints(ln,pn,Yt,tn,Vn){Ae(this.ptr,ln.ptr,pn.ptr,Yt,tn,Vn)}},DT_INT8:ft(),DT_UINT8:It(),DT_INT16:et(),DT_UINT16:it(),DT_UINT32:St(),DT_FLOAT32:Ut()}})}(fetch(E_())),Kb.then(w=>{Xo=w,Kb=void 0}))}()),c)for(let w=0;w<c.length;w++)y.push(HA(c[w],i,w,n));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(v&&d)for(const{primitives:w}of d)for(const I of w)T_(I,i);return i})})}function D_(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>WA(e,0,t))}class Qb{constructor(e,n,i){if(this.triangleCount=n.length/3,this.min=new me(0,0),this.max=new me(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===i)return;const s=e.map(v=>v.x),c=e.map(v=>v.y);this.min=new me(Math.min(...s),Math.min(...c)),this.max=new me(Math.max(...s),Math.max(...c));const d=this.max.sub(this.min);d.x=Math.max(d.x,1),d.y=Math.max(d.y,1);const f=Math.max(d.x,d.y)/i;this.cellsX=Math.max(1,Math.ceil(d.x/f)),this.cellsY=Math.max(1,Math.ceil(d.y/f)),this.xScale=1/f,this.yScale=1/f;const _=[];for(let v=0;v<this.triangleCount;v++){const w=e[n[3*v+0]].sub(this.min),I=e[n[3*v+1]].sub(this.min),C=e[n[3*v+2]].sub(this.min),S=Bh(Math.floor(Math.min(w.x,I.x,C.x)),this.xScale,this.cellsX),M=Bh(Math.floor(Math.max(w.x,I.x,C.x)),this.xScale,this.cellsX),P=Bh(Math.floor(Math.min(w.y,I.y,C.y)),this.yScale,this.cellsY),R=Bh(Math.floor(Math.max(w.y,I.y,C.y)),this.yScale,this.cellsY),z=new me(0,0),G=new me(0,0),H=new me(0,0),j=new me(0,0);for(let W=P;W<=R;++W){z.y=G.y=W*f,H.y=j.y=(W+1)*f;for(let oe=S;oe<=M;++oe)z.x=H.x=oe*f,G.x=j.x=(oe+1)*f,(JT(w,I,C,z,G,j)||JT(w,I,C,z,j,H))&&_.push({cellIdx:W*this.cellsX+oe,triIdx:v})}}if(0===_.length)return;_.sort((v,w)=>v.cellIdx-w.cellIdx||v.triIdx-w.triIdx);let y=0;for(;y<_.length;){const v=_[y].cellIdx,w={start:this.payload.length,len:0};for(;y<_.length&&_[y].cellIdx===v;)++w.len,this.payload.push(_[y++].triIdx);this.cells[v]=w}}query(e,n,i){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let _=0;_<this.lookup.length;_++)this.lookup[_]=0;const s=Bh(e.x-this.min.x,this.xScale,this.cellsX),c=Bh(n.x-this.min.x,this.xScale,this.cellsX),d=Bh(e.y-this.min.y,this.yScale,this.cellsY),f=Bh(n.y-this.min.y,this.yScale,this.cellsY);for(let _=d;_<=f;_++)for(let y=s;y<=c;y++){const v=this.cells[_*this.cellsX+y];if(v)for(let w=0;w<v.len;w++){const I=this.payload[v.start+w],C=Math.floor(I/8),S=1<<I%8;if(!(this.lookup[C]&S)&&(this.lookup[C]|=S,i.push(I),i.length===this.triangleCount))return}}}}function Bh(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function Wf(t,e){const n=t.json.bufferViews[e.bufferView];return new Qv[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*Jv[e.type])}function KS(t,e,n){const i=t.indices,s=t.attributes,c={};c.indexArray=new Is;const d=e.json.accessors[i],f=d.count/3;c.indexArray.reserve(f);const _=Wf(e,d);for(let I=0;I<f;I++)c.indexArray.emplaceBack(_[3*I],_[3*I+1],_[3*I+2]);c.indexArray._trim(),c.vertexArray=new Sc;const y=e.json.accessors[s.POSITION];c.vertexArray.reserve(y.count);const v=Wf(e,y);for(let I=0;I<y.count;I++)c.vertexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);if(c.vertexArray._trim(),c.aabb=new bo(y.min,y.max),c.centroid=function(I,C){const S=[0,0,0],M=I.length;if(M>0){for(let P=0;P<M;P++){const R=3*I[P];S[0]+=C[R],S[1]+=C[R+1],S[2]+=C[R+2]}S[0]/=M,S[1]/=M,S[2]/=M}return S}(_,v),void 0!==s.COLOR_0){const I=e.json.accessors[s.COLOR_0],C=Jv[I.type];if(I.componentType===gm){c.colorArray=3===C?new Sc:new dh,c.colorArray.reserve(I.count);const S=Wf(e,I);if(3===C)for(let M=0;M<I.count;M++)c.colorArray.emplaceBack(S[3*M],S[3*M+1],S[3*M+2]);else for(let M=0;M<I.count;M++)c.colorArray.emplaceBack(S[4*M],S[4*M+1],S[4*M+2],S[4*M+3]);c.colorArray._trim()}else if(I.componentType===Tl&&4===C){c.colorArray=new dh,c.colorArray.resize(I.count);const S=Wf(e,I),M=1/65535,P=c.colorArray.float32;for(let R=0;R<4*S.length;++R)P[R]=S[R]*M}else Me(`glTF color buffer parsing for accessor ${JSON.stringify(I)} is not supported`)}if(void 0!==s.NORMAL){c.normalArray=new Sc;const I=e.json.accessors[s.NORMAL];c.normalArray.reserve(I.count);const C=Wf(e,I);for(let S=0;S<I.count;S++)c.normalArray.emplaceBack(C[3*S],C[3*S+1],C[3*S+2]);c.normalArray._trim()}if(void 0!==s.TEXCOORD_0&&n.length>0){c.texcoordArray=new ig;const I=e.json.accessors[s.TEXCOORD_0];c.texcoordArray.reserve(I.count);const C=Wf(e,I);for(let S=0;S<I.count;S++)c.texcoordArray.emplaceBack(C[2*S],C[2*S+1]);c.texcoordArray._trim()}const w=t.material;return c.material=function(I,C){const{emissiveFactor:S=[0,0,0],alphaMode:M="OPAQUE",alphaCutoff:P=.5,normalTexture:R,occlusionTexture:z,emissiveTexture:G,doubleSided:H}=I,{baseColorFactor:j=[1,1,1,1],metallicFactor:W=1,roughnessFactor:oe=1,baseColorTexture:pe,metallicRoughnessTexture:ve}=I.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Ur(...j),metallicFactor:W,roughnessFactor:oe,baseColorTexture:pe?C[pe.index]:void 0,metallicRoughnessTexture:ve?C[ve.index]:void 0},doubleSided:H,emissiveFactor:S,alphaMode:M,alphaCutoff:P,normalTexture:R?C[R.index]:void 0,occlusionTexture:z?C[z.index]:void 0,emissionTexture:G?C[G.index]:void 0,defined:void 0===I.defined}}(void 0!==w?e.json.materials[w]:{defined:!1},n),void 0!==s._FEATURE_RGBA4444&&(c.featureData=new Uint32Array(Wf(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer)),c}function M_(t,e,n){const{matrix:i,rotation:s,translation:c,scale:d,mesh:f,extras:_,children:y}=t,v={};if(v.matrix=i||Dt.fromRotationTranslationScale([],s||[0,0,0,1],c||[0,0,0],d||[1,1,1]),void 0!==f){v.meshes=n[f];const w=v.anchor=[0,0];for(const I of v.meshes){const{min:C,max:S}=I.aabb;w[0]+=C[0]+S[0],w[1]+=C[1]+S[1]}w[0]=Math.floor(w[0]/v.meshes.length/2),w[1]=Math.floor(w[1]/v.meshes.length/2)}if(_&&(_.id&&(v.id=_.id),_.lights&&(v.lights=function(w){if(!w.length)return[];const I=function(R){const z=atob(R),G=new Uint8Array(z.length);for(let H=0;H<z.length;H++)G[H]=z.codePointAt(H);return G}(w),C=[],S=I.length/24,M=new Uint16Array(I.buffer),P=new Float32Array(I.buffer);for(let R=0;R<S;R++){const z=M[2*R*6]/30,G=M[2*R*6+1]/30,H=M[2*R*6+10]/100,j=P[6*R+1],W=P[6*R+2],oe=P[6*R+3],pe=P[6*R+4],ve=oe-j,xe=pe-W,ke=Math.hypot(ve,xe);C.push({pos:[j+.5*ve,W+.5*xe,G],normal:[xe/ke,-ve/ke,0],width:ke,height:z,depth:H,points:[j,W,oe,pe]})}return C}(_.lights))),y){const w=[];for(const I of y)w.push(M_(e.json.nodes[I],e,n));v.children=w}return v}function _m(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let d=1;d<t.vertices.length;++d){const f=t.vertices[d];e.x=Math.min(e.x,f.x),e.y=Math.min(e.y,f.y),n.x=Math.max(n.x,f.x),n.y=Math.max(n.y,f.y)}const i=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),s=Math.max(8,i),c=new Qb(t.vertices,t.indices,s);return{vertices:t.vertices,indices:t.indices,grid:c,min:e,max:n}}function R_(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const n=e[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const d of n){if(!Array.isArray(d)||2!==d.length)continue;const f=d[0],_=d[1];"number"==typeof f&&"number"==typeof _&&i.push(new me(f,_))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let s=0;for(let d=0;d<i.length;d++){const f=i[d],_=i[(d+1)%i.length],y=i[(d+2)%i.length];s+=(f.x-_.x)*(y.y-_.y)-(y.x-_.x)*(f.y-_.y)}s>0&&i.reverse();const c=Bg(i.flatMap(d=>[d.x,d.y]),[]);return 0===c.length?null:{vertices:i,indices:c}}function qA(t){const e=[],n=[];let i=0;for(const s of t){i=e.length;const c=s.vertexArray.float32,d=s.indexArray.uint16;for(let f=0;f<s.vertexArray.length;f++)e.push(new me(c[3*f+0],c[3*f+1]));for(let f=0;f<3*s.indexArray.length;f++)n.push(d[f]+i)}if(n.length%3!=0)return null;for(let s=0;s<n.length;s+=3){const c=e[n[s+0]],d=e[n[s+1]],f=e[n[s+2]];(c.x-d.x)*(f.y-d.y)-(f.x-d.x)*(c.y-d.y)>0&&([n[s+1],n[s+2]]=[n[s+2],n[s+1]])}return{vertices:e,indices:n}}function VE(t){const n=function(_,y){const v=[];for(const w of _.json.meshes){const I=[];for(const C of w.primitives)I.push(KS(C,_,y));v.push(I)}return v}(t,function(_,y){const v=[],w=ge.WebGL2RenderingContext;if(_.json.textures)for(const I of _.json.textures){const C={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};void 0!==I.sampler&&Object.assign(C,_.json.samplers[I.sampler]),v.push({image:y[I.source],sampler:C,uploaded:!1})}return v}(t,t.images)),{scenes:i,scene:s,nodes:c}=t.json,d=i?i[s||0].nodes:c,f=[];for(const _ of d)f.push(M_(c[_],t,n));return function(_,y,v){const w={},I=new Set;for(let C=0;C<_.length;C++){const S=v[y[C]];if(!S.extras)continue;const M=S.extras["mapbox:footprint:version"],P=S.extras["mapbox:footprint:id"];(M||P)&&I.add(C),"1.0.0"===M&&P&&(w[P]=C)}for(let C=0;C<_.length;C++){if(I.has(C))continue;const S=_[C],M=v[y[C]];if(!M.extras)continue;let P=null;S.id in w&&(P=qA(_[w[S.id]].meshes)),P||(P=R_(M)),P&&(S.footprint=_m(P))}if(I.size>0){const C=Array.from(I.values()).sort((S,M)=>S-M);for(let S=C.length-1;S>=0;S--)_.splice(C[S],1)}}(f,d,t.json.nodes),f}function aa(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,s=64/(t.aabb.max[0]-n+2),c=64/(t.aabb.max[1]-i+2);for(let d=0;d<e.length;d+=3){const f=e[d+2],_=(e[d+0]-n)*s|0,y=(e[d+1]-i)*c|0;f>t.heightmap[64*y+_]&&(t.heightmap[64*y+_]=f)}}function Jb(t,e){const n={};n.indexArray=new Is,n.indexArray.reserve(4*t.length),n.vertexArray=new Sc,n.vertexArray.reserve(10*t.length),n.colorArray=new dh,n.vertexArray.reserve(10*t.length);let i=0;for(const d of t){const f=Math.min(10,Math.max(4,1.3*d.height))*e,_=[-d.normal[1],d.normal[0],0],y=Math.min(.29,.1*d.width/d.depth),v=d.width-2*d.depth*e*(y+.01),w=He.scaleAndAdd([],d.pos,_,v/2),I=He.scaleAndAdd([],d.pos,_,-v/2),C=[w[0],w[1],w[2]+d.height],S=[I[0],I[1],I[2]+d.height],M=He.scaleAndAdd([],d.normal,_,y);He.scale(M,M,f);const P=He.scaleAndAdd([],d.normal,_,-y);He.scale(P,P,f),He.add(M,w,M),He.add(P,I,P),w[2]+=.1,I[2]+=.1,n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]);const R=v/f/2;n.colorArray.emplaceBack(-R-y,-1,R,.8),n.colorArray.emplaceBack(R+y,-1,R,.8),n.colorArray.emplaceBack(-R,0,R,1.3),n.colorArray.emplaceBack(R,0,R,1.3),n.colorArray.emplaceBack(R+y,-.8,R,.7),n.colorArray.emplaceBack(R+y,-.8,R,.7),n.colorArray.emplaceBack(0,0,R,1.3),n.colorArray.emplaceBack(0,0,R,1.3),n.colorArray.emplaceBack(R+y,-1.2,R,.8),n.colorArray.emplaceBack(R+y,-1.2,R,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const s={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=Ur.white,s.pbrMetallicRoughness=c,n.material=s,n.aabb=new bo([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}lr(Qb,"TriangleGridIndex");const t0={vector:Zv,raster:Kv,"raster-dem":class extends Kv{constructor(t,e,n,i){super(t,e,n,i),this.type="raster-dem",this.maxzoom=22,this._options=Ye({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){var n;const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);t.request=rt(this.map._requestManager.transformRequest(i,Ht.Tile),function(d,f,_,y){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(d)t.state="errored",e(d);else if(f){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:_,expires:y});const w=ge.ImageBitmap&&f instanceof ge.ImageBitmap&&(null==Xv&&(Xv=ge.OffscreenCanvas&&new ge.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof ge.createImageBitmap),Xv),I=1-(f.width-((v=f.width)<=1?1:Math.pow(2,Math.floor(Math.log(v)/Math.LN2))))/2;I<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const C=w?f:ne.getImageData(f,I),S={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:C,encoding:this.encoding,padding:I,convertToFloat:s};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",S,c.bind(this),void 0,!0))}var v}.bind(this));const s=null===(n=this.map)||void 0===n||null===(n=n.painter)||void 0===n?void 0:n.terrainUseFloatDEM();function c(d,f){d&&(t.state="errored",e(d)),f&&(t.dem=f,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}}_getNeighboringTiles(t){const e=t.canonical,n=Math.pow(2,e.z),i=(e.x-1+n)%n,s=0===e.x?t.wrap-1:t.wrap,c=(e.x+1+n)%n,d=e.x+1===n?t.wrap+1:t.wrap,f={};return f[new Bi(t.overscaledZ,s,e.z,i,e.y).key]={backfilled:!1},f[new Bi(t.overscaledZ,d,e.z,c,e.y).key]={backfilled:!1},e.y>0&&(f[new Bi(t.overscaledZ,s,e.z,i,e.y-1).key]={backfilled:!1},f[new Bi(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},f[new Bi(t.overscaledZ,d,e.z,c,e.y-1).key]={backfilled:!1}),e.y+1<n&&(f[new Bi(t.overscaledZ,s,e.z,i,e.y+1).key]={backfilled:!1},f[new Bi(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},f[new Bi(t.overscaledZ,d,e.z,c,e.y+1).key]={backfilled:!1}),f}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.hillshadeFBO&&(t.hillshadeFBO.destroy(),delete t.hillshadeFBO),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends Kn{constructor(t,e,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=e.data,this._options=Ye({},e),this._collectResourceTiming=e.collectResourceTiming,void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const s=Vt/this.tileSize;this.workerOptions=Ye({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*s,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*s,extent:Vt,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:Vt,radius:(void 0!==e.clusterRadius?e.clusterRadius:50)*s,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new kt("dataloading",{dataType:"source"})),this._loaded=!1;const t=Ye({},this.workerOptions);t.scope=this.scope;const e=this._data;"string"==typeof e?(t.request=this.map._requestManager.transformRequest(ne.resolveURL(e),Ht.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new wn(n));else{const s={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(s.resourceTiming=i.resourceTiming[this.id]),this.fire(new kt("data",s)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ne.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,i,(s,c)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):s?e(s):(t.loadVectorData(c,this.map.painter,"reloadTile"===n),e(null))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Ye({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends $d{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,Ht.Source).url);!function(e,n){const i=ge.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let s=0;s<e.length;s++){const c=ge.document.createElement("source");Ln(e[s])||(i.crossOrigin="Anonymous"),c.src=e[s],i.appendChild(c)}}(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new wn(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new wn(new Sn(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new ls(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:$d,model:class extends Kn{constructor(t,e,n,i){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const n=this._options.models[e],i=D_(this.map._requestManager.transformRequest(n.uri,Ht.Model).url).then(s=>{if(!s)return;const c=VE(s),d=new Fd(e,n.position,n.orientation,c);d.computeBoundsAndApplyParent(),this.models.push(d)}).catch(s=>{this.fire(new wn(new Error(`Could not load model ${e} from ${n.uri}: ${s.message}`)))});t.push(i)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new wn(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends Kn{constructor(t,e,n,i){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new kt("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=w_(this._options,this.map._requestManager,e,n,(i,s)=>{this._tileJSONRequest=null,this._loaded=!0,i?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new wn(i))):s&&(Ye(this,s),s.bounds&&(this.tileBounds=new Wb(s.bounds,this.minzoom,this.maxzoom)),ko(s.tiles,this.map._requestManager._customAccessToken),this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new kt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,Ht.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=e;else{if(t.buckets){const c=Object.values(t.buckets);for(const d of c)d.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,s.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,s.bind(this),void 0,!0);function s(c,d){return t.aborted?e(null):c&&404!==c.status?e(c):(d&&(d.resourceTiming&&(t.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(d),t.buckets={...t.buckets,...d.buckets}),t.state="loaded",void e(null))}}serialize(){return Ye({},this._options)}},canvas:class extends $d{constructor(t,e,n,i){super(t,e,n,i),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(s=>!Array.isArray(s)||2!==s.length||s.some(c=>"number"!=typeof c))||this.fire(new wn(new Sn(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new wn(new Sn(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new wn(new Sn(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof ge.HTMLCanvasElement||this.fire(new wn(new Sn(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new wn(new Sn(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof ge.HTMLCanvasElement?this.options.canvas:ge.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new wn(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Dv||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ls(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends Kn{constructor(t,e,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=e,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new wn(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new wn(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Wb(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),Ye(this,_t(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return _t(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new kt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new kt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new kt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:n,z:i}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:n,y:i,z:s}=t.tileID.canonical,c=new ge.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:s},{signal:c.signal})).then(function(d){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===d?(t.state="errored",e(null)):null===d?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):(f=d)instanceof ge.ImageData||f instanceof ge.HTMLCanvasElement||f instanceof ge.ImageBitmap||f instanceof ge.HTMLImageElement?(this.loadTileData(t,d),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var f}.bind(this)).catch(d=>{20!==d.code&&(t.state="errored",e(d))}),t.request.cancel=()=>c.abort()}loadTileData(t,e){Kv.loadTileData(t,e,this._map.painter)}unloadTileData(t){Kv.unloadTileData(t,this._map.painter)}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:n,y:i,z:s}=t.tileID.canonical;this._implementation.unloadTile({x:n,y:i,z:s})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=Xa(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new kt("data",{dataType:"source",sourceDataType:"content"}))}}},ym=function(t,e,n,i){const s=new t0[e.type](t,e,n,i);if(s.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${s.id}`);return gr(["load","abort","unload","serialize","prepare"],s),s};function Ku(t,e){const n=Dt.identity([]);return Dt.scale(n,n,[.5*t.width,.5*-t.height,1]),Dt.translate(n,n,[1,-1,0]),Dt.multiply(n,n,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(n)}function zE(t,e,n,i,s,c,d,f=!1){const _=t.tilesIn(i,d,f);_.sort(n0);const y=[];for(const w of _)y.push({wrappedTileID:w.tile.tileID.wrapped().key,queryResults:w.tile.queryRenderedFeatures(e,n,t._state,w,s,c,Ku(t.transform,w.tile.tileID),f)});const v=function(w){const I={},C={};for(const S of w){const M=S.queryResults,P=S.wrappedTileID,R=C[P]=C[P]||{};for(const z in M){const G=M[z],H=R[z]=R[z]||{},j=I[z]=I[z]||[];for(const W of G)H[W.featureIndex]||(H[W.featureIndex]=!0,j.push(W))}}return I}(y);for(const w in v)v[w].forEach(I=>{const C=I.feature,S=C.layer;S&&"background"!==S.type&&"sky"!==S.type&&"slot"!==S.type&&(C.source=S.source,S["source-layer"]&&(C.sourceLayer=S["source-layer"]),C.state=void 0!==C.id?t.getFeatureState(S["source-layer"],C.id):{})});return v}function YA(t,e){const n=t.getRenderableIds().map(c=>t.getTileByID(c)),i=[],s={};for(let c=0;c<n.length;c++){const d=n[c],f=d.tileID.canonical.key;s[f]||(s[f]=!0,d.querySourceFeatures(i,e))}return i}function n0(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class XS{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const n=this.style._mergedLayers[e];if("fill-extrusion"===n.type)this.layers.push(n);else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push(n)}}}updateZOffset(e,n){this.currentBuildingBuckets=[];for(let s=0;s<this.layers.length;++s){const c=this.layers[s],d=this.style.getLayerSourceCache(c);let f=1;"fill-extrusion"===c.type&&(f=c.paint.get("fill-extrusion-opacity")>0?c.paint.get("fill-extrusion-vertical-scale"):0);let _=d?d.getTile(n):null;if(!_&&d&&n.canonical.z>d.getSource().minzoom){let y=n.scaledTo(Math.min(d.getSource().maxzoom,n.overscaledZ-1));for(;y.overscaledZ>=d.getSource().minzoom&&(_=d.getTile(y),!_&&0!==y.overscaledZ);)y=y.scaledTo(y.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:_?_.getBucket(c):null,tileID:_?_.tileID:n,verticalScale:f})}e.hasAnyZOffset=!1;let i=!1;for(let s=0;s<e.symbolInstances.length;s++){const c=e.symbolInstances.get(s),d=c.zOffset,f=this._getHeightAtTileOffset(n,c.tileAnchorX,c.tileAnchorY);c.zOffset=-1!==f?f:d,i||d===c.zOffset||(i=!0),e.hasAnyZOffset||0===c.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,n,i,s){let c=n,d=i;if(e.canonical.z!==s.canonical.z){const f=s.canonical,_=1/(1<<e.canonical.z-f.z);c=(n+e.canonical.x*Vt)*_-f.x*Vt|0,d=(i+e.canonical.y*Vt)*_-f.y*Vt|0}return{tileX:c,tileY:d}}_getHeightAtTileOffset(e,n,i){let s;for(let c=0;c<this.layers.length;++c){if("fill-extrusion"!==this.layers[c].type)continue;const{bucket:d,tileID:f,verticalScale:_}=this.currentBuildingBuckets[c];if(!d)continue;const{tileX:y,tileY:v}=this._mapCoordToOverlappingTile(e,n,i,f),w=d.getHeightAtTileCoord(y,v);if(w&&void 0!==w.height){if(!w.hidden)return w.height*_;s=w.height}}for(let c=0;c<this.layers.length;++c){if("model"!==this.layers[c].type)continue;const{bucket:d,tileID:f}=this.currentBuildingBuckets[c];if(!d)continue;const{tileX:_,tileY:y}=this._mapCoordToOverlappingTile(e,n,i,f),v=d.getHeightAtTileCoord(_,y);if(v&&!v.hidden)return void 0===v.height&&void 0!==s?Math.min(v.maxHeight,s)*v.verticalScale:(v.height||0)*v.verticalScale}return-1}}var ZA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function QS(t,e){const n={};for(const i in t)"ref"!==i&&(n[i]=t[i]);return ZA.forEach(i=>{i in e&&(n[i]=e[i])}),n}function UE(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=QS(t[n],e[t[n].ref]));return t}const Fi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function P_(t,e,n){n.push({command:Fi.addSource,args:[t,e[t]]})}function e1(t,e,n){e.push({command:Fi.removeSource,args:[t]}),n[t]=!0}function KA(t,e,n,i){e1(t,n,i),P_(t,e,n)}function O_(t,e,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!st(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!st(t[n][i],e[n][i]))return!1;return!0}function k_(t,e,n,i,s,c){let d;for(d in e=e||{},t=t||{})t.hasOwnProperty(d)&&(st(t[d],e[d])||n.push({command:c,args:[i,d,e[d],s]}));for(d in e)e.hasOwnProperty(d)&&!t.hasOwnProperty(d)&&(st(t[d],e[d])||n.push({command:c,args:[i,d,e[d],s]}))}function r0(t){return t.id}function t1(t,e){return t[e.id]=e,t}class XA{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=_n(e,0,1);let n=1,i=this._distances[n];const s=e*this.paddedLength+this.padding;for(;i<s&&n<this._distances.length;)i=this._distances[++n];const c=n-1,d=this._distances[c],f=i-d,_=f>0?(s-d)/f:0;return this.points[c].mult(1-_).add(this.points[n].mult(_))}}class JS{constructor(e,n,i){const s=this.boxCells=[],c=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(n/i);for(let d=0;d<this.xCellCount*this.yCellCount;d++)s.push([]),c.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,i,s,c){this._forEachCell(n,i,s,c,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c)}insertCircle(e,n,i,s){this._forEachCell(n-s,i-s,n+s,i+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(i),this.circles.push(s)}_insertBoxCell(e,n,i,s,c,d){this.boxCells[c].push(d)}_insertCircleCell(e,n,i,s,c,d){this.circleCells[c].push(d)}_query(e,n,i,s,c,d){if(i<0||e>this.width||s<0||n>this.height)return!c&&[];const f=[];if(e<=0&&n<=0&&this.width<=i&&this.height<=s){if(c)return!0;for(let _=0;_<this.boxKeys.length;_++)f.push({key:this.boxKeys[_],x1:this.bboxes[4*_],y1:this.bboxes[4*_+1],x2:this.bboxes[4*_+2],y2:this.bboxes[4*_+3]});for(let _=0;_<this.circleKeys.length;_++){const y=this.circles[3*_],v=this.circles[3*_+1],w=this.circles[3*_+2];f.push({key:this.circleKeys[_],x1:y-w,y1:v-w,x2:y+w,y2:v+w})}return d?f.filter(d):f}return this._forEachCell(e,n,i,s,this._queryCell,f,{hitTest:c,seenUids:{box:{},circle:{}}},d),c?f.length>0:f}_queryCircle(e,n,i,s,c){const d=e-i,f=e+i,_=n-i,y=n+i;if(f<0||d>this.width||y<0||_>this.height)return!s&&[];const v=[];return this._forEachCell(d,_,f,y,this._queryCellCircle,v,{hitTest:s,circle:{x:e,y:n,radius:i},seenUids:{box:{},circle:{}}},c),s?v.length>0:v}query(e,n,i,s,c){return this._query(e,n,i,s,!1,c)}hitTest(e,n,i,s,c){return this._query(e,n,i,s,!0,c)}hitTestCircle(e,n,i,s){return this._queryCircle(e,n,i,!0,s)}_queryCell(e,n,i,s,c,d,f,_){const y=f.seenUids,v=this.boxCells[c];if(null!==v){const I=this.bboxes;for(const C of v)if(!y.box[C]){y.box[C]=!0;const S=4*C;if(e<=I[S+2]&&n<=I[S+3]&&i>=I[S+0]&&s>=I[S+1]&&(!_||_(this.boxKeys[C]))){if(f.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[C],x1:I[S],y1:I[S+1],x2:I[S+2],y2:I[S+3]})}}}const w=this.circleCells[c];if(null!==w){const I=this.circles;for(const C of w)if(!y.circle[C]){y.circle[C]=!0;const S=3*C;if(this._circleAndRectCollide(I[S],I[S+1],I[S+2],e,n,i,s)&&(!_||_(this.circleKeys[C]))){if(f.hitTest)return d.push(!0),!0;{const M=I[S],P=I[S+1],R=I[S+2];d.push({key:this.circleKeys[C],x1:M-R,y1:P-R,x2:M+R,y2:P+R})}}}}}_queryCellCircle(e,n,i,s,c,d,f,_){const y=f.circle,v=f.seenUids,w=this.boxCells[c];if(null!==w){const C=this.bboxes;for(const S of w)if(!v.box[S]){v.box[S]=!0;const M=4*S;if(this._circleAndRectCollide(y.x,y.y,y.radius,C[M+0],C[M+1],C[M+2],C[M+3])&&(!_||_(this.boxKeys[S])))return d.push(!0),!0}}const I=this.circleCells[c];if(null!==I){const C=this.circles;for(const S of I)if(!v.circle[S]){v.circle[S]=!0;const M=3*S;if(this._circlesCollide(C[M],C[M+1],C[M+2],y.x,y.y,y.radius)&&(!_||_(this.circleKeys[S])))return d.push(!0),!0}}}_forEachCell(e,n,i,s,c,d,f,_){const y=this._convertToXCellCoord(e),v=this._convertToYCellCoord(n),w=this._convertToXCellCoord(i),I=this._convertToYCellCoord(s);for(let C=y;C<=w;C++)for(let S=v;S<=I;S++)if(c.call(this,e,n,i,s,this.xCellCount*S+C,d,f,_))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,i,s,c,d){const f=s-e,_=c-n,y=i+d;return y*y>f*f+_*_}_circleAndRectCollide(e,n,i,s,c,d,f){const _=(d-s)/2,y=Math.abs(e-(s+_));if(y>_+i)return!1;const v=(f-c)/2,w=Math.abs(n-(c+v));if(w>v+i)return!1;if(y<=_||w<=v)return!0;const I=y-_,C=w-v;return I*I+C*C<=i*i}}const Gd=100;class QA{constructor(e,n,i=new JS(e.width+200,e.height+200,25),s=new JS(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=s,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Gd,this.screenBottomBoundary=e.height+Gd,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}placeCollisionBox(e,n,i,s,c,d,f,_){let y=i.projectedAnchorX,v=i.projectedAnchorY,w=i.projectedAnchorZ;const I=i.elevation,C=i.tileID,S=e.getProjection();if(I&&C){const[W,oe,pe]=S.upVector(C.canonical,i.tileAnchorX,i.tileAnchorY),ve=S.upVectorScale(C.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;y+=W*I*ve,v+=oe*I*ve,w+=pe*I*ve}const M=this.projectAndGetPerspectiveRatio(f,y,v,w,i.tileID,"globe"===S.name||!!I||this.transform.pitch>0,S),P=d*M.perspectiveRatio,R=(i.x1*n+s.x-i.padding)*P+M.point.x,z=(i.y1*n+s.y-i.padding)*P+M.point.y,G=(i.x2*n+s.x+i.padding)*P+M.point.x,H=(i.y2*n+s.y+i.padding)*P+M.point.y,j=M.perspectiveRatio<=.55||M.occluded;return!this.isInsideGrid(R,z,G,H)||!c&&this.grid.hitTest(R,z,G,H,_)||j?{box:[],offscreen:!1,occluded:M.occluded}:{box:[R,z,G,H],offscreen:this.isOffscreen(R,z,G,H),occluded:!1}}placeCollisionCircles(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M){const P=[],R=this.transform.elevation,z=e.getProjection(),G=R?R.getAtTileOffsetFunc(M,this.transform.center.lat,this.transform.worldSize,z):null,H=new me(i.tileAnchorX,i.tileAnchorY);let{x:j,y:W,z:oe}=z.projectTilePoint(H.x,H.y,M.canonical);if(G){const[It,et,it]=G(H);j+=It,W+=et,oe+=it}const pe="globe"===z.name,ve=this.projectAndGetPerspectiveRatio(f,j,W,oe,M,pe||!!R||this.transform.pitch>0,z),{perspectiveRatio:xe}=ve,ke=(w?d/xe:d*xe)/_a,Ae=gc(j,W,oe,_),$e=ve.signedDistanceFromCamera>0?d_(ke,c,i.lineOffsetX*ke,i.lineOffsetY*ke,!1,Ae,H,i,s,_,{},R&&!w?G:null,w&&!!R,z,M,w):null;let Ce=!1,nt=!1,ft=!0;if($e&&!ve.occluded){const It=.5*C*xe+S,et=new me(-100,-100),it=new me(this.screenRightBoundary,this.screenBottomBoundary),St=new XA,{first:Ut,last:Wt}=$e,ln=Ut.path.length;let pn=[];for(let Vn=ln-1;Vn>=1;Vn--)pn.push(Ut.path[Vn]);for(let Vn=1;Vn<Wt.path.length;Vn++)pn.push(Wt.path[Vn]);const Yt=2.5*It;y&&(pn=pn.map(([Vn,Jn,Yn],Xn)=>(G&&!pe&&(Yn=G(Xn<ln-1?Ut.tilePath[ln-1-Xn]:Wt.tilePath[Xn-ln+2])[2]),gc(Vn,Jn,Yn,y))),pn.some(Vn=>Vn[3]<=0)&&(pn=[]));let tn=[];if(pn.length>0){let Vn=1/0,Jn=-1/0,Yn=1/0,Xn=-1/0;for(const yr of pn)Vn=Math.min(Vn,yr[0]),Yn=Math.min(Yn,yr[1]),Jn=Math.max(Jn,yr[0]),Xn=Math.max(Xn,yr[1]);Jn>=et.x&&Vn<=it.x&&Xn>=et.y&&Yn<=it.y&&(tn=[pn.map(yr=>new me(yr[0],yr[1]))],(Vn<et.x||Jn>it.x||Yn<et.y||Xn>it.y)&&(tn=gA(tn,et.x,et.y,it.x,it.y)))}for(const Vn of tn){St.reset(Vn,.25*It);let Jn=0;Jn=St.length<=.5*It?1:Math.ceil(St.paddedLength/Yt)+1;for(let Yn=0;Yn<Jn;Yn++){const Xn=Yn/Math.max(Jn-1,1),yr=St.lerp(Xn),Fr=yr.x+Gd,Or=yr.y+Gd;P.push(Fr,Or,It,0);const Ci=Fr-It,Zr=Or-It,zr=Fr+It,Pr=Or+It;if(ft=ft&&this.isOffscreen(Ci,Zr,zr,Pr),nt=nt||this.isInsideGrid(Ci,Zr,zr,Pr),!n&&this.grid.hitTestCircle(Fr,Or,It,I)&&(Ce=!0,!v))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!v&&Ce||!nt?[]:P,offscreen:ft,collisionDetected:Ce,occluded:ve.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,s=1/0,c=-1/0,d=-1/0;for(const v of e){const w=new me(v.x+Gd,v.y+Gd);i=Math.min(i,w.x),s=Math.min(s,w.y),c=Math.max(c,w.x),d=Math.max(d,w.y),n.push(w)}const f=this.grid.query(i,s,c,d).concat(this.ignoredGrid.query(i,s,c,d)),_={},y={};for(const v of f){const w=v.key;void 0===_[w.bucketInstanceId]&&(_[w.bucketInstanceId]={}),_[w.bucketInstanceId][w.featureIndex]||bS(n,[new me(v.x1,v.y1),new me(v.x2,v.y1),new me(v.x2,v.y2),new me(v.x1,v.y2)])&&(_[w.bucketInstanceId][w.featureIndex]=!0,void 0===y[w.bucketInstanceId]&&(y[w.bucketInstanceId]=[]),y[w.bucketInstanceId].push(w.featureIndex))}return y}insertCollisionBox(e,n,i,s,c){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:s,collisionGroupID:c},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,i,s,c){const d=n?this.ignoredGrid:this.grid,f={bucketInstanceId:i,featureIndex:s,collisionGroupID:c};for(let _=0;_<e.length;_+=4)d.insertCircle(f,e[_],e[_+1],e[_+2])}projectAndGetPerspectiveRatio(e,n,i,s,c,d,f){const _=[n,i,s,1];let y=!1;s||this.transform.pitch>0?(no.transformMat4(_,_,e),this.fogState&&c&&"globe"!==f.name&&(y=function(I,C,S,M,P,R){const z=R.calculateFogTileMatrix(P),G=[C,S,M];return He.transformMat4(G,G,z),um(I,He.length(G),R.pitch,R._fov)}(this.fogState,n,i,s,c.toUnwrapped(),this.transform)>.9)):tc(_,_,e);const v=_[3];return{point:new me((_[0]/v+1)/2*this.transform.width+Gd,(-_[1]/v+1)/2*this.transform.height+Gd),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(f)/v*.5,1.5),signedDistanceFromCamera:v,occluded:d&&_[2]>v||y}}isOffscreen(e,n,i,s){return i<Gd||e>=this.screenRightBoundary||s<Gd||n>this.screenBottomBoundary}isInsideGrid(e,n,i,s){return i>=0&&e<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=Dt.identity([]);return Dt.translate(e,e,[-100,-100,0]),e}}function Hd(t,e,n){const i=e.createTileMatrix(t,t.worldSize,n.toUnwrapped());return Dt.multiply(new Float32Array(16),t.projMatrix,i)}function L_(t,e,n){if(e.projection.name===n.projection.name)return t.projMatrix;const i=n.clone();return i.setProjection(e.projection),Hd(i,e.getProjection(),t)}function qf(t,e,n){return e.name===n.projection.name?t.projMatrix:Hd(n,e,t)}class JA{constructor(e,n,i,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):s&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class vm{constructor(e,n,i,s,c,d=!1){this.text=new JA(e?e.text:null,n,i,c),this.icon=new JA(e?e.icon:null,n,s,c),this.clipped=d}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xu{constructor(e,n,i,s=!1){this.text=e,this.icon=n,this.skipFade=i,this.clipped=s}}class $E{constructor(){this.invProjMatrix=Dt.create(),this.viewportMatrix=Dt.create(),this.circles=[]}}class eD{constructor(e,n,i,s,c){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=s,this.tileID=c}}class jE{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:i=>i.collisionGroupID===n}}return this.collisionGroups[e]}}function o0(t,e,n,i,s){const{horizontalAlign:c,verticalAlign:d}=Qg(t),f=-(c-.5)*e,_=-(d-.5)*n,y=Hp(t,i);return new me(f+y[0]*s,_+y[1]*s)}function Qu(t,e,n,i,s){const c=new me(t,e);return n&&c._rotate(i?s:-s),c}class xm{constructor(e,n,i,s,c,d){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new QA(this.transform,c),this.buildingIndex=d,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new jE(i),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,s){const c=i.getBucket(n),d=i.latestFeatureIndex;if(!c||!d||n.fqid!==c.layerIds[0])return;const f=c.layers[0].layout,_=i.collisionBoxArray,y=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),v=i.tileSize/Vt,w=i.tileID.toUnwrapped();this.transform.setProjection(c.projection);const I=(C=i.tileID,S=c.getProjection(),M=this.transform,S.name===this.projection?M.calculateProjMatrix(C.toUnwrapped()):Hd(M,S,C));var C,S,M;const P="map"===f.get("text-pitch-alignment"),R="map"===f.get("text-rotation-alignment");n.compileFilter();const z=n.dynamicFilter(),G=n.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(i),j=Ab(I,i.tileID.canonical,P,R,this.transform,c.getProjection(),H);let W=null;if(P){const ve=c_(I,i.tileID.canonical,P,R,this.transform,c.getProjection(),H);W=Dt.multiply([],this.transform.labelPlaneMatrix,ve)}let oe=null;z&&i.latestFeatureIndex&&(oe={unwrappedTileID:w,dynamicFilter:z,dynamicFilterNeedsFeature:G,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[c.bucketInstanceId]=new eD(c.bucketInstanceId,d,c.sourceLayerIndex,c.index,i.tileID);const pe={bucket:c,layout:f,posMatrix:I,textLabelPlaneMatrix:j,labelToScreenMatrix:W,clippingData:oe,scale:y,textPixelRatio:v,holdingForFade:i.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:kc(c.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:kc(c.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(c.sourceID)};if(s)for(const ve of c.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:ke,symbolInstanceEnd:Ae}=ve;e.push({sortKey:xe,symbolInstanceStart:ke,symbolInstanceEnd:Ae,parameters:pe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:c.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z){const{textOffset0:G,textOffset1:H,crossTileID:j}=I,W=[G,H],oe=o0(e,i,s,W,c),pe=this.collisionIndex.placeCollisionBox(S,c,n,Qu(oe.x,oe.y,d,f,this.transform.angle),w,_,y,v.predicate);if(P){const ve=S.getSymbolInstanceIconSize(z,this.transform.zoom,I.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(S,ve,P,Qu(oe.x,oe.y,d,f,this.transform.angle),w,_,y,v.predicate).box.length)return}if(pe.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[j]&&this.prevPlacement.placements[j]&&this.prevPlacement.placements[j].text&&(ve=this.prevPlacement.variableOffsets[j].anchor),this.variableOffsets[j]={textOffset:W,width:i,height:s,anchor:e,textScale:c,prevAnchor:ve},this.markUsedJustification(S,e,I,M),S.allowVerticalPlacement&&(this.markUsedOrientation(S,M,I),this.placedOrientations[j]=M),{shift:oe,placedGlyphBoxes:pe}}}placeLayerBucketPart(e,n,i,s){const{bucket:c,layout:d,posMatrix:f,textLabelPlaneMatrix:_,labelToScreenMatrix:y,clippingData:v,textPixelRatio:w,holdingForFade:I,collisionBoxArray:C,partiallyEvaluatedTextSize:S,partiallyEvaluatedIconSize:M,collisionGroup:P}=e.parameters,R=d.get("text-optional"),z=d.get("icon-optional"),G=d.get("text-allow-overlap"),H=d.get("icon-allow-overlap"),j="map"===d.get("text-rotation-alignment"),W="map"===d.get("text-pitch-alignment"),oe="viewport-y"===d.get("symbol-z-order"),pe=d.get("symbol-z-elevate");this.transform.setProjection(c.projection);let ve=G&&(H||!c.hasIconData()||z),xe=H&&(G||!c.hasTextData()||R);!c.collisionArrays&&C&&c.deserializeCollisionBoxes(C),i&&s&&c.updateCollisionDebugBuffers(this.transform.zoom,C);const ke=(Ae,$e,Ce)=>{const{crossTileID:nt,numVerticalGlyphVertices:ft}=Ae;if(v){const zr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Pr=null;if(v.dynamicFilterNeedsFeature){const Dr=this.retainedQueryData[c.bucketInstanceId];Pr=v.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:Dr.bucketIndex,sourceLayerIndex:Dr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,v.dynamicFilter)(zr,Pr,this.retainedQueryData[c.bucketInstanceId].tileID.canonical,new me(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(v.unwrappedTileID)))return this.placements[nt]=new Xu(!1,!1,!1,!0),void n.add(nt)}if(n.has(nt))return;if(I)return void(this.placements[nt]=new Xu(!1,!1,!1));let It=!1,et=!1,it=!0,St=!1,Ut=!1,Wt=null,ln={box:null,offscreen:null,occluded:null},pn={box:null,offscreen:null,occluded:null},Yt=null,tn=null,Vn=null,Jn=0,Yn=0,Xn=0;Ce.textFeatureIndex?Jn=Ce.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(Jn=Ae.featureIndex),Ce.verticalTextFeatureIndex&&(Yn=Ce.verticalTextFeatureIndex);const yr=zr=>{zr.tileID=this.retainedQueryData[c.bucketInstanceId].tileID;const Pr=this.transform.elevation;zr.elevation=Ae.zOffset+(Pr?Pr.getAtTileOffset(zr.tileID,zr.tileAnchorX,zr.tileAnchorY):0)},Fr=Ce.textBox;if(Fr){yr(Fr);const zr=Dr=>{let ci=Ao.horizontal;if(c.allowVerticalPlacement&&!Dr&&this.prevPlacement){const Pi=this.prevPlacement.placedOrientations[nt];Pi&&(this.placedOrientations[nt]=Pi,ci=Pi,this.markUsedOrientation(c,ci,Ae))}return ci},Pr=(Dr,ci)=>{if(c.allowVerticalPlacement&&ft>0&&Ce.verticalTextBox){for(const Pi of c.writingModes)if(Pi===Ao.vertical?(ln=ci(),pn=ln):ln=Dr(),ln&&ln.box&&ln.box.length)break}else ln=Dr()};if(d.get("text-variable-anchor")){let Dr=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const Jr=this.prevPlacement.variableOffsets[nt];Dr.indexOf(Jr.anchor)>0&&(Dr=Dr.filter(Xi=>Xi!==Jr.anchor),Dr.unshift(Jr.anchor))}const ci=(Jr,Xi,vo)=>{const So=c.getSymbolInstanceTextSize(S,Ae,this.transform.zoom,$e),xo=(Jr.x2-Jr.x1)*So+2*Jr.padding,Ns=(Jr.y2-Jr.y1)*So+2*Jr.padding,Qo=Ae.hasIconTextFit&&!H?Xi:null;Qo&&yr(Qo);let qo={box:[],offscreen:!1,occluded:!1};const co=G?2*Dr.length:Dr.length;for(let la=0;la<co;++la){const jc=this.attemptAnchorPlacement(Dr[la%Dr.length],Jr,xo,Ns,So,j,W,w,f,P,la>=Dr.length,Ae,$e,c,vo,Qo,S,M);if(jc&&(qo=jc.placedGlyphBoxes,qo&&qo.box&&qo.box.length)){It=!0,Wt=jc.shift;break}}return qo};Pr(()=>ci(Fr,Ce.iconBox,Ao.horizontal),()=>{const Jr=Ce.verticalTextBox;return Jr&&yr(Jr),c.allowVerticalPlacement&&!(ln&&ln.box&&ln.box.length)&&ft>0&&Jr?ci(Jr,Ce.verticalIconBox,Ao.vertical):{box:null,offscreen:null,occluded:null}}),ln&&(It=ln.box,it=ln.offscreen,St=ln.occluded);const Pi=zr(!(!ln||!ln.box));if(!It&&this.prevPlacement){const Jr=this.prevPlacement.variableOffsets[nt];Jr&&(this.variableOffsets[nt]=Jr,this.markUsedJustification(c,Jr.anchor,Ae,Pi))}}else{const Dr=(ci,Pi)=>{const Jr=c.getSymbolInstanceTextSize(S,Ae,this.transform.zoom,$e),Xi=this.collisionIndex.placeCollisionBox(c,Jr,ci,new me(0,0),G,w,f,P.predicate);return Xi&&Xi.box&&Xi.box.length&&(this.markUsedOrientation(c,Pi,Ae),this.placedOrientations[nt]=Pi),Xi};Pr(()=>Dr(Fr,Ao.horizontal),()=>{const ci=Ce.verticalTextBox;return c.allowVerticalPlacement&&ft>0&&ci?(yr(ci),Dr(ci,Ao.vertical)):{box:null,offscreen:null,occluded:null}}),zr(!!(ln&&ln.box&&ln.box.length))}}if(Yt=ln,It=Yt&&Yt.box&&Yt.box.length>0,it=Yt&&Yt.offscreen,St=Yt&&Yt.occluded,Ae.useRuntimeCollisionCircles){const zr=c.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),Pr=Sf(c.textSizeData,S,zr),Dr=d.get("text-padding");tn=this.collisionIndex.placeCollisionCircles(c,G,zr,c.lineVertexArray,c.glyphOffsetArray,Pr,f,_,y,i,W,P.predicate,Ae.collisionCircleDiameter*Pr/_a,Dr,this.retainedQueryData[c.bucketInstanceId].tileID),It=G||tn.circles.length>0&&!tn.collisionDetected,it=it&&tn.offscreen,St=tn.occluded}if(Ce.iconFeatureIndex&&(Xn=Ce.iconFeatureIndex),Ce.iconBox){const zr=Pr=>{yr(Pr);const Dr=Ae.hasIconTextFit&&Wt?Qu(Wt.x,Wt.y,j,W,this.transform.angle):new me(0,0),ci=c.getSymbolInstanceIconSize(M,this.transform.zoom,Ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(c,ci,Pr,Dr,H,w,f,P.predicate)};pn&&pn.box&&pn.box.length&&Ce.verticalIconBox?(Vn=zr(Ce.verticalIconBox),et=Vn.box.length>0):(Vn=zr(Ce.iconBox),et=Vn.box.length>0),it=it&&Vn.offscreen,Ut=Vn.occluded}const Or=R||0===Ae.numHorizontalGlyphVertices&&0===ft,Ci=z||0===Ae.numIconVertices;if(Or||Ci?Ci?Or||(et=et&&It):It=et&&It:et=It=et&&It,It&&Yt&&Yt.box&&this.collisionIndex.insertCollisionBox(Yt.box,d.get("text-ignore-placement"),c.bucketInstanceId,pn&&pn.box&&Yn?Yn:Jn,P.ID),et&&Vn&&this.collisionIndex.insertCollisionBox(Vn.box,d.get("icon-ignore-placement"),c.bucketInstanceId,Xn,P.ID),tn&&(It&&this.collisionIndex.insertCollisionCircles(tn.circles,d.get("text-ignore-placement"),c.bucketInstanceId,Jn,P.ID),i)){const zr=c.bucketInstanceId;let Pr=this.collisionCircleArrays[zr];void 0===Pr&&(Pr=this.collisionCircleArrays[zr]=new $E);for(let Dr=0;Dr<tn.circles.length;Dr+=4)Pr.circles.push(tn.circles[Dr+0]),Pr.circles.push(tn.circles[Dr+1]),Pr.circles.push(tn.circles[Dr+2]),Pr.circles.push(tn.collisionDetected?1:0)}const Zr="globe"!==c.projection.name;ve=ve&&(Zr||!St),xe=xe&&(Zr||!Ut),this.placements[nt]=new Xu(It||ve,et||xe,it||c.justReloaded),n.add(nt)};if(pe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,this.retainedQueryData[c.bucketInstanceId].tileID),c.updateZOffset()),oe){const Ae=c.getSortedSymbolIndexes(this.transform.angle);for(let $e=Ae.length-1;$e>=0;--$e){const Ce=Ae[$e];ke(c.symbolInstances.get(Ce),Ce,c.collisionArrays[Ce])}c.hasAnyZOffset&&Me(`${c.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(c.hasAnyZOffset){const Ae=c.getSortedIndexesByZOffset();for(let $e=0;$e<Ae.length;++$e){const Ce=Ae[$e];ke(c.symbolInstances.get(Ce),Ce,c.collisionArrays[Ce])}}else for(let Ae=e.symbolInstanceStart;Ae<e.symbolInstanceEnd;Ae++)ke(c.symbolInstances.get(Ae),Ae,c.collisionArrays[Ae]);if(i&&c.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[c.bucketInstanceId];Dt.invert(Ae.invProjMatrix,f),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(e,n,i,s){const{leftJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,crossTileID:y}=i,v=n_(n),w=s===Ao.vertical?_:"left"===v?c:"center"===v?d:"right"===v?f:-1;c>=0&&(e.text.placedSymbolArray.get(c).crossTileID=w>=0&&c!==w?0:y),d>=0&&(e.text.placedSymbolArray.get(d).crossTileID=w>=0&&d!==w?0:y),f>=0&&(e.text.placedSymbolArray.get(f).crossTileID=w>=0&&f!==w?0:y),_>=0&&(e.text.placedSymbolArray.get(_).crossTileID=w>=0&&_!==w?0:y)}markUsedOrientation(e,n,i){const s=n===Ao.horizontal||n===Ao.horizontalOnly?n:0,c=n===Ao.vertical?n:0,{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:f,rightJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:y}=i,v=e.text.placedSymbolArray;d>=0&&(v.get(d).placedOrientation=s),f>=0&&(v.get(f).placedOrientation=s),_>=0&&(v.get(_).placedOrientation=s),y>=0&&(v.get(y).placedOrientation=c)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let i=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const s=n?n.symbolFadeChange(e):1,c=n?n.opacities:{},d=n?n.variableOffsets:{},f=n?n.placedOrientations:{};for(const _ in this.placements){const y=this.placements[_],v=c[_];v?(this.opacities[_]=new vm(v,s,y.text,y.icon,null,y.clipped),i=i||y.text!==v.text.placed||y.icon!==v.icon.placed):(this.opacities[_]=new vm(null,s,y.text,y.icon,y.skipFade,y.clipped),i=i||y.text||y.icon)}for(const _ in c){const y=c[_];if(!this.opacities[_]){const v=new vm(y,s,!1,!1);v.isHidden()||(this.opacities[_]=v,i=i||y.text.placed||y.icon.placed)}}for(const _ in d)this.variableOffsets[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.variableOffsets[_]=d[_]);for(const _ in f)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=f[_]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const i=new Set;for(const s of n){const c=s.getBucket(e);c&&s.latestFeatureIndex&&e.fqid===c.layerIds[0]&&(this.updateBucketOpacities(c,i,s.collisionBoxArray),c.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,s.tileID),c.updateZOffset()))}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const s=e.layers[0].layout,c=!!e.layers[0].dynamicFilter(),d=new vm(null,0,!1,!1,!0),f=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),y=s.get("text-variable-anchor"),v="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),I=new vm(null,0,f&&(_||!e.hasIconData()||s.get("icon-optional")),_&&(f||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const C=(M,P,R)=>{for(let z=0;z<P/4;z++)M.opacityVertexArray.emplaceBack(R)};let S=0;for(let M=0;M<e.symbolInstances.length;M++){const P=e.symbolInstances.get(M),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:z,crossTileID:G,numIconVertices:H}=P,j=n.has(G);let W=this.opacities[G];j?W=d:W||(W=I,this.opacities[G]=W),n.add(G);const oe=R>0||z>0,pe=H>0,ve=this.placedOrientations[G],xe=ve===Ao.vertical,ke=ve===Ao.horizontal||ve===Ao.horizontalOnly;if(!oe&&!pe||W.isHidden()||S++,oe){const Ae=WE(W.text);C(e.text,R,xe?s0:Ae),C(e.text,z,ke?s0:Ae);const $e=W.text.isHidden(),{leftJustifiedTextSymbolIndex:Ce,centerJustifiedTextSymbolIndex:nt,rightJustifiedTextSymbolIndex:ft,verticalPlacedTextSymbolIndex:It}=P,et=e.text.placedSymbolArray,it=$e||xe?1:0;Ce>=0&&(et.get(Ce).hidden=it),nt>=0&&(et.get(nt).hidden=it),ft>=0&&(et.get(ft).hidden=it),It>=0&&(et.get(It).hidden=$e||ke?1:0);const St=this.variableOffsets[G];St&&this.markUsedJustification(e,St.anchor,P,ve);const Ut=this.placedOrientations[G];Ut&&(this.markUsedJustification(e,"left",P,Ut),this.markUsedOrientation(e,Ut,P))}if(pe){const Ae=WE(W.icon),{placedIconSymbolIndex:$e,verticalPlacedIconSymbolIndex:Ce}=P,nt=e.icon.placedSymbolArray,ft=W.icon.isHidden()?1:0;$e>=0&&(C(e.icon,H,xe?s0:Ae),nt.get($e).hidden=ft),Ce>=0&&(C(e.icon,P.numVerticalIconVertices,ke?s0:Ae),nt.get(Ce).hidden=ft)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ae=e.collisionArrays[M];if(Ae){let $e=new me(0,0),Ce=!0;if(Ae.textBox||Ae.verticalTextBox){if(y){const ft=this.variableOffsets[G];ft?($e=o0(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textScale),v&&$e._rotate(w?this.transform.angle:-this.transform.angle)):Ce=!1}c&&(Ce=!W.clipped),Ae.textBox&&Ju(e.textCollisionBox.collisionVertexArray,W.text.placed,!Ce||xe,$e.x,$e.y),Ae.verticalTextBox&&Ju(e.textCollisionBox.collisionVertexArray,W.text.placed,!Ce||ke,$e.x,$e.y)}const nt=Ce&&!(ke||!Ae.verticalIconBox);Ae.iconBox&&Ju(e.iconCollisionBox.collisionVertexArray,W.icon.placed,nt,P.hasIconTextFit?$e.x:0,P.hasIconTextFit?$e.y:0),Ae.verticalIconBox&&Ju(e.iconCollisionBox.collisionVertexArray,W.icon.placed,!nt,P.hasIconTextFit?$e.x:0,P.hasIconTextFit?$e.y:0)}}}if(e.fullyClipped=0===S,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const M=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=M.invProjMatrix,e.placementViewportMatrix=M.viewportMatrix,e.collisionCircleArray=M.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const i=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Ju(t,e,n,i,s){t.emplaceBack(e?1:0,n?1:0,i||0,s||0),t.emplaceBack(e?1:0,n?1:0,i||0,s||0),t.emplaceBack(e?1:0,n?1:0,i||0,s||0),t.emplaceBack(e?1:0,n?1:0,i||0,s||0)}const N_=Math.pow(2,25),eC=Math.pow(2,24),GE=Math.pow(2,17),HE=Math.pow(2,16),n1=Math.pow(2,9),tC=Math.pow(2,8),nC=Math.pow(2,1);function WE(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*N_+e*eC+n*GE+e*HE+n*n1+e*tC+n*nC+e}const s0=0;class r1{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,n,i,s,c){const d=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(d,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,c())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort((f,_)=>f.sortKey-_.sortKey));this._currentPartIndex<d.length;){const f=d[this._currentPartIndex];if(n.placeLayerBucketPart(f,this._seenCrossTileIDs,i,0===f.symbolInstanceStart),this._currentPartIndex++,c())return!0}return!1}}class a0{constructor(e,n,i,s,c,d,f,_,y){this.placement=new xm(e,c,d,f,_,y),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=s,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i,s){const c=ne.now(),d=()=>{const f=ne.now()-c;return!this._forceFullPlacement&&f>2};for(;this._currentPlacementIndex>=0;){const f=n[e[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if("symbol"===f.type&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){const y=f,v=y.layout.get("symbol-z-elevate"),w=this._inProgressLayer=this._inProgressLayer||new r1(y),I=Xa(f.source,f.scope);if(w.continuePlacement(v?s[I]:i[I],this.placement,this._showCollisionBoxes,f,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Yf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class i1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,i]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const s=i>>4;if(1!==s)throw new Error(`Got v${s} data when expected v1.`);const c=Yf[15&i];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new i1(f,d,c,e)}constructor(e,n=64,i=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=Yf.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-f%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${i}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+f+_),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+_,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return o1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,_=[0,c.length-1,0],y=[];for(;_.length;){const v=_.pop()||0,w=_.pop()||0,I=_.pop()||0;if(w-I<=f){for(let P=I;P<=w;P++){const R=d[2*P],z=d[2*P+1];R>=e&&R<=i&&z>=n&&z<=s&&y.push(c[P])}continue}const C=I+w>>1,S=d[2*C],M=d[2*C+1];S>=e&&S<=i&&M>=n&&M<=s&&y.push(c[C]),(0===v?e<=S:n<=M)&&(_.push(I),_.push(C-1),_.push(1-v)),(0===v?i>=S:s>=M)&&(_.push(C+1),_.push(w),_.push(1-v))}return y}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:c,nodeSize:d}=this,f=[0,s.length-1,0],_=[],y=i*i;for(;f.length;){const v=f.pop()||0,w=f.pop()||0,I=f.pop()||0;if(w-I<=d){for(let P=I;P<=w;P++)B_(c[2*P],c[2*P+1],e,n)<=y&&_.push(s[P]);continue}const C=I+w>>1,S=c[2*C],M=c[2*C+1];B_(S,M,e,n)<=y&&_.push(s[C]),(0===v?e-i<=S:n-i<=M)&&(f.push(I),f.push(C-1),f.push(1-v)),(0===v?e+i>=S:n+i>=M)&&(f.push(C+1),f.push(w),f.push(1-v))}return _}}function o1(t,e,n,i,s,c){if(s-i<=n)return;const d=i+s>>1;rC(t,e,d,i,s,c),o1(t,e,n,i,d-1,1-c),o1(t,e,n,d+1,s,1-c)}function rC(t,e,n,i,s,c){for(;s>i;){if(s-i>600){const y=s-i+1,v=n-i+1,w=Math.log(y),I=.5*Math.exp(2*w/3),C=.5*Math.sqrt(w*I*(y-I)/y)*(v-y/2<0?-1:1);rC(t,e,n,Math.max(i,Math.floor(n-v*I/y+C)),Math.min(s,Math.floor(n+(y-v)*I/y+C)),c)}const d=e[2*n+c];let f=i,_=s;for(F_(t,e,i,n),e[2*s+c]>d&&F_(t,e,i,s);f<_;){for(F_(t,e,f,_),f++,_--;e[2*f+c]<d;)f++;for(;e[2*_+c]>d;)_--}e[2*i+c]===d?F_(t,e,i,_):(_++,F_(t,e,_,s)),_<=n&&(i=_+1),n<=_&&(s=_-1)}}function F_(t,e,n,i){s1(t,n,i),s1(e,2*n,2*i),s1(e,2*n+1,2*i+1)}function s1(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function B_(t,e,n,i){const s=t-n,c=e-i;return s*s+c*c}const Vh=512/Vt/2;class zh{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this.index=new i1(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const s=e.canonical.x*Vt,c=e.canonical.y*Vt;for(let d=0;d<n.length;d++){const{key:f,crossTileID:_,tileAnchorX:y,tileAnchorY:v}=n.get(d),w=Math.floor((s+y)*Vh),I=Math.floor((c+v)*Vh);this.index.add(w,I),this.keys.push(f),this.crossTileIDs.push(_)}this.index.finish()}findMatches(e,n,i){const s=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),c=Vh/Math.pow(2,n.canonical.z-this.tileID.canonical.z),d=n.canonical.x*Vt,f=n.canonical.y*Vt;for(let _=0;_<e.length;_++){const y=e.get(_);if(y.crossTileID)continue;const{key:v,tileAnchorX:w,tileAnchorY:I}=y,C=Math.floor((d+w)*c),S=Math.floor((f+I)*c),M=this.index.range(C-s,S-s,C+s,S+s);for(const P of M){const R=this.crossTileIDs[P];if(this.keys[P]===v&&!i.has(R)){i.add(R),y.crossTileID=R;break}}}}}class iC{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oC{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(0!==n)for(const i in this.indexes){const s=this.indexes[i],c={};for(const d in s){const f=s[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),c[f.tileID.key]=f}this.indexes[i]=c}this.lng=e}addBucket(e,n,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let c=0;c<n.symbolInstances.length;c++)n.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const s=this.usedCrossTileIDs[e.overscaledZ];for(const c in this.indexes){const d=this.indexes[c];if(Number(c)>e.overscaledZ)for(const f in d){const _=d[f];_.tileID.isChildOf(e)&&_.findMatches(n.symbolInstances,e,s)}else{const f=d[e.scaledTo(Number(c)).key];f&&f.findMatches(n.symbolInstances,e,s)}}for(let c=0;c<n.symbolInstances.length;c++){const d=n.symbolInstances.get(c);d.crossTileID||(d.crossTileID=i.generate(),s.add(d.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new zh(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const i of n.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let n=!1;for(const i in this.indexes){const s=this.indexes[i];for(const c in s)e[s[c].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,s[c]),delete s[c],n=!0)}return n}}class a1{constructor(){this.layerIndexes={},this.crossTileIDs=new iC,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,i,s){let c=this.layerIndexes[e.fqid];void 0===c&&(c=this.layerIndexes[e.fqid]=new oC);let d=!1;const f={};"globe"!==s.name&&c.handleWrapJump(i);for(const _ of n){const y=_.getBucket(e);y&&e.fqid===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(_.tileID,y,this.crossTileIDs)&&(d=!0),f[y.bucketInstanceId]=!0)}return c.removeStaleBuckets(f)&&(d=!0),d}pruneUnusedLayers(e){const n={};e.forEach(i=>{n[i]=!0});for(const i in this.layerIndexes)n[i]||delete this.layerIndexes[i]}}var qE="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",V_="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",l0="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",YE="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",c0="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",u0="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",l1="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const z_=[];Wd(qE,z_);const c1={"_prelude_fog.vertex.glsl":YE,"_prelude_terrain.vertex.glsl":l0,"_prelude_shadow.vertex.glsl":u0,"_prelude_fog.fragment.glsl":c0,"_prelude_shadow.fragment.glsl":l1,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},bm={};Vi("",l0),Vi(c0,YE),Vi(l1,u0);const U_=Vi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ZE=qE;var d0={background:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Vi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Vi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Vi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:Vi("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Vi('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Vi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Vi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:Vi('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Vi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Vi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Vi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Vi('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',V_),skyboxGradient:Vi('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',V_),skyboxCapture:Vi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Vi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Vi("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Vi("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Wd(t,e){const n=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const s=i.split(" ");for(const c of s)e.includes(c)||e.push(c)}}function Vi(t,e){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let s=e.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);s&&(s=s.filter((y,v)=>s.indexOf(y)===v));const c={},d=[],f=[];t=t.replace(n,(y,v)=>(f.push(v),"")),e=e.replace(n,(y,v)=>(d.push(v),""));let _=[...z_];Wd(t,_),Wd(e,_);for(const y of[...d,...f])c1[y]||console.error(`Undefined include: ${y}`),bm[y]||(bm[y]=[],Wd(c1[y],bm[y])),_=[..._,...bm[y]];return{fragmentSource:t=t.replace(i,(y,v,w,I,C)=>(c[C]=!0,"define"===v?`\n#ifndef HAS_UNIFORM_u_${C}\nvarying ${w} ${I} ${C};\n#else\nuniform ${w} ${I} u_${C};\n#endif\n`:"initialize"===v?`\n#ifdef HAS_UNIFORM_u_${C}\n    ${w} ${I} ${C} = u_${C};\n#endif\n`:"define-attribute"===v?`\n#ifdef HAS_ATTRIBUTE_a_${C}\n    varying ${w} ${I} ${C};\n#endif\n`:"initialize-attribute"===v?"":void 0)),vertexSource:e=e.replace(i,(y,v,w,I,C)=>{const S="float"===I?"vec2":I,M=C.match(/color/)?"color":S;return"define-attribute-vertex-shader-only"===v?`\n#ifdef HAS_ATTRIBUTE_a_${C}\nattribute ${w} ${I} a_${C};\n#endif\n`:c[C]?"define"===v?`\n#ifndef HAS_UNIFORM_u_${C}\nuniform lowp float u_${C}_t;\nattribute ${w} ${S} a_${C};\nvarying ${w} ${I} ${C};\n#else\nuniform ${w} ${I} u_${C};\n#endif\n`:"initialize"===v?"vec4"===M?`\n#ifndef HAS_UNIFORM_u_${C}\n    ${C} = a_${C};\n#else\n    ${w} ${I} ${C} = u_${C};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${C}\n    ${C} = unpack_mix_${M}(a_${C}, u_${C}_t);\n#else\n    ${w} ${I} ${C} = u_${C};\n#endif\n`:"define-attribute"===v?`\n#ifdef HAS_ATTRIBUTE_a_${C}\n    attribute ${w} ${I} a_${C};\n    varying ${w} ${I} ${C};\n#endif\n`:"initialize-attribute"===v?`\n#ifdef HAS_ATTRIBUTE_a_${C}\n    ${C} = a_${C};\n#endif\n`:void 0:"define"===v?`\n#ifndef HAS_UNIFORM_u_${C}\nuniform lowp float u_${C}_t;\nattribute ${w} ${S} a_${C};\n#else\nuniform ${w} ${I} u_${C};\n#endif\n`:"define-instanced"===v?"mat4"===M?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${C}0;\nattribute vec4 a_${C}1;\nattribute vec4 a_${C}2;\nattribute vec4 a_${C}3;\n#else\nuniform ${w} ${I} u_${C};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${w} ${S} a_${C};\n#else\nuniform ${w} ${I} u_${C};\n#endif\n`:"initialize-attribute-custom"===v?`\n#ifdef HAS_ATTRIBUTE_a_${C}\n    ${w} ${I} ${C} = a_${C};\n#endif\n`:"vec4"===M?`\n#ifndef HAS_UNIFORM_u_${C}\n    ${w} ${I} ${C} = a_${C};\n#else\n    ${w} ${I} ${C} = u_${C};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${C}\n    ${w} ${I} ${C} = unpack_mix_${M}(a_${C}, u_${C}_t);\n#else\n    ${w} ${I} ${C} = u_${C};\n#endif\n`}),staticAttributes:s,usedDefines:_,vertexIncludes:d,fragmentIncludes:f}}class wm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,n,i,s,c,d,f,_){this.context=e;let y=this.boundPaintVertexBuffers.length!==s.length;for(let w=0;!y&&w<s.length;w++)this.boundPaintVertexBuffers[w]!==s[w]&&(y=!0);let v=this.boundDynamicVertexBuffers.length!==f.length;for(let w=0;!v&&w<f.length;w++)this.boundDynamicVertexBuffers[w]!==f[w]&&(v=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==i||y||v||this.boundIndexBuffer!==c||this.boundVertexOffset!==d)this.freshBind(n,i,s,c,d,f,_);else{e.bindVertexArrayOES.set(this.vao);for(const w of f)w&&(w.bind(),_&&w.instanceCount&&w.setVertexAttribDivisor(e.gl,n,_));c&&c.dynamicDraw&&c.bind()}}freshBind(e,n,i,s,c,d,f){const _=e.numAttributes,y=this.context,v=y.gl;this.vao&&this.destroy(),this.vao=y.gl.createVertexArray(),y.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=s,this.boundVertexOffset=c,this.boundDynamicVertexBuffers=d,n.enableAttributes(v,e),n.bind(),n.setVertexAttribPointers(v,e,c);for(const w of i)w.enableAttributes(v,e),w.bind(),w.setVertexAttribPointers(v,e,c);for(const w of d)w&&(w.enableAttributes(v,e),w.bind(),w.setVertexAttribPointers(v,e,c),f&&w.instanceCount&&w.setVertexAttribDivisor(v,e,f));s&&s.bind(),y.currentNumAttributes=_}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function KE(t,e){const n=Math.pow(2,e.canonical.z),i=e.canonical.y;return[new Ri(0,i/n).toLngLat().lat,new Ri(0,(i+1)/n).toLngLat().lat]}function XE(t,e,n,i,s,c,d){const f=t.context,_=f.gl,y=n.hillshadeFBO;if(!y)return;t.prepareDrawTile();const v=t.isTileAffectedByFog(e),w=t.getOrCreateProgram("hillshade",{overrideFog:v});f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,y.colorAttachment.get());const I=((P,R,z,G)=>{const H=z.paint.get("hillshade-shadow-color"),j=z.paint.get("hillshade-highlight-color"),W=z.paint.get("hillshade-accent-color"),oe=z.paint.get("hillshade-emissive-strength");let pe=De(z.paint.get("hillshade-illumination-direction"));if("viewport"===z.paint.get("hillshade-illumination-anchor"))pe-=P.transform.angle;else if(P.style&&P.style.enable3dLights()&&P.style.directionalLight){const xe=P.style.directionalLight.properties.get("direction");pe=De(In(xe.x,xe.y,xe.z)[1])}const ve=!P.options.moving;return{u_matrix:G||P.transform.calculateProjMatrix(R.tileID.toUnwrapped(),ve),u_image:0,u_latrange:KE(0,R.tileID),u_light:[z.paint.get("hillshade-exaggeration"),pe],u_shadow:H,u_highlight:j,u_emissive_strength:oe,u_accent:W}})(t,n,i,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(f,w,e.toUnwrapped());const{tileBoundsBuffer:C,tileBoundsIndexBuffer:S,tileBoundsSegments:M}=t.getTileBoundsBuffers(n);w.draw(t,_.TRIANGLES,s,c,d,Vr.disabled,I,i.id,C,S,M)}function ol(t,e,n){if(!e.needsDEMTextureUpload)return;const i=t.context,s=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(n.stride);const c=n.getPixels();e.demTexture?e.demTexture.update(c,{premultiply:!1}):e.demTexture=new ls(i,c,t.terrainUseFloatDEM()?s.R32F:s.RGBA,{premultiply:!1}),e.needsDEMTextureUpload=!1}function QE(t,e,n){const i=t.context,s=i.gl;if(!e.dem)return;const c=e.dem;if(i.activeTexture.set(s.TEXTURE1),ol(t,e,c),!e.demTexture)return;e.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);const d=c.dim;i.activeTexture.set(s.TEXTURE0);let f=e.hillshadeFBO;if(!f){const I=new ls(i,{width:d,height:d,data:null},s.RGBA);I.bind(s.LINEAR,s.CLAMP_TO_EDGE),f=e.hillshadeFBO=i.createFramebuffer(d,d,!0,"renderbuffer"),f.colorAttachment.set(I.texture)}i.bindFramebuffer.set(f.framebuffer),i.viewport.set([0,0,d,d]);const{tileBoundsBuffer:_,tileBoundsIndexBuffer:y,tileBoundsSegments:v}=t.getMercatorTileBoundsBuffers(),w=[];t.terrainUseFloatDEM()&&w.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:w}).draw(t,s.TRIANGLES,Rr.disabled,Qr.disabled,Ai.unblended,Vr.disabled,((I,C)=>{const S=C.stride,M=Dt.create();return Dt.ortho(M,0,Vt,-Vt,0,0,1),Dt.translate(M,M,[0,-Vt,0]),{u_matrix:M,u_image:1,u_dimension:[S,S],u_zoom:I.overscaledZ,u_unpack:C.unpackVector}})(e.tileID,c),n.id,_,y,v),e.needsHillshadePrepare=!1}const $_=t=>({u_matrix:new Xr(t),u_image0:new gi(t),u_skirt_height:new kn(t),u_ground_shadow_factor:new ni(t)}),h0=(t,e,n)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:n}),JE=(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:s,u_merc_center:c,u_image0:0,u_frustum_tl:d,u_frustum_tr:f,u_frustum_br:_,u_frustum_bl:y,u_globe_pos:v,u_globe_radius:w,u_viewport:I,u_grid_matrix:S?Float32Array.from(S):new Float32Array(9),u_skirt_height:C}),$c=(t,e)=>{if(e>0&&t.terrain&&Me("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),s=n.isLODDisabled(!1)?sn(60,45,n.pitch):sn(30,15,n.pitch),c=n._farZ-n._nearZ,d=e*n.height,f=((1-(_=s))*(.75*n.cameraToCenterDistance)+_*(n._farZ+d))*i;var _;return{shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(f-n._nearZ)/c,(f-d-n._nearZ)/c]}}};function Em(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const Im=new class{constructor(){this.operations={}}newMorphing(t,e,n,i,s){if(t in this.operations){const c=this.operations[t];c.to.tileID.key!==n.tileID.key&&(c.queued=n)}else this.operations[t]={startTime:i,phase:0,duration:s,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},Zf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sC(t,e,n){if(0===e)return 0;const i=e<1&&514===n?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*i}function j_(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const u1=t=>({u_matrix:t});function Uh(t,e,n,i,s){if(s>0){const c=ne.now(),d=(c-t.timeAdded)/s,f=e?(c-e.timeAdded)/s:-1,_=n.getSource(),y=i.coveringZoomLevel({tileSize:_.tileSize,roundZoom:_.roundZoom}),v=!e||Math.abs(e.tileID.overscaledZ-y)>Math.abs(t.tileID.overscaledZ-y),w=v&&t.refreshedUponExpiration?1:_n(v?d:1-f,0,1);return t.refreshedUponExpiration&&d>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-w}:{opacity:w,mix:0}}return{opacity:1,mix:0}}class aC extends ec{constructor(e){const n={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new qv(mm(),null),s=ym("mock-dem",n,i,e.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,n){e.state="loaded",n(null)}}class lC extends ec{constructor(e){const n=ym("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new qv(mm(),null),e.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,i){if(e.freezeTileCoverage)return;this.transform=e;const s=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((c,d)=>{if(c[d.key]="",!this._tiles[d.key]){const f=new qn(d,this._source.tileSize*d.overscaleFactor(),e.tileZoom);f.state="loaded",this._tiles[d.key]=f}return c},{});for(const c in this._tiles)c in s||(this.freeFBO(c),this._tiles[c].unloadVectorData(),delete this._tiles[c])}freeFBO(e){const n=this.proxyCachedFBO[e];if(void 0!==n){const i=Object.values(n);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class d1 extends Bi{constructor(e,n,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=n,this.projMatrix=i}}class cC extends eE{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,s,c]=function(_){const y=new Vl,v=new Is,w=131;y.reserve(17161),v.reserve(33800);const I=Vt/128,C=Vt+I/2,S=C+I;for(let P=-I;P<S;P+=I)for(let R=-I;R<S;R+=I){const z=R<0||R>C||P<0||P>C?24575:0,G=_n(Math.round(R),0,Vt),H=_n(Math.round(P),0,Vt);y.emplaceBack(G+z,H)}const M=(P,R)=>{const z=R*w+P;v.emplaceBack(z+1,z,z+w),v.emplaceBack(z+w,z+w+1,z+1)};for(let P=1;P<129;P++)for(let R=1;R<129;R++)M(R,P);return[0,129].forEach(P=>{for(let R=0;R<130;R++)M(R,P),M(P,R)}),[y,v,32768]}(),d=e.context;this.gridBuffer=d.createVertexBuffer(i,Xl.members),this.gridIndexBuffer=d.createIndexBuffer(s),this.gridSegments=so.simpleSegment(0,0,i.length,s.length),this.gridNoSkirtSegments=so.simpleSegment(0,0,i.length,c),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lC(n.map),this.orthoMatrix=Dt.create(),Dt.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,Vt,0,Vt,0,1);const f=d.gl;this._overlapStencilMode=new Qr({func:f.GEQUAL,mask:255},0,255,f.KEEP,f.KEEP,f.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new aC(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,n,i){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const s=e.terrain.properties,c=0===e.terrain.drapeRenderMode,d=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ne.now();const f=e.terrain&&e.terrain.scope,_=s.get("source"),y=c?this._mockSourceCache:e.getSourceCache(_,f);if(!y)return void Me(`Couldn't find terrain source "${_}".`);if(this.sourceCache=y,this._exaggeration=d?this.calculateExaggeration(n):s.get("exaggeration"),!n.projection.requiresDraping&&d&&0===this._exaggeration)return void this._disable();this.enabled=!0;const v=()=>{this.sourceCache.used&&Me(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(n,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(e){const n=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=i;const s=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(s)<2)return this._exaggeration;const c=e.zoom,d=this._style.terrain;if(!this._previousUpdateTimestamp)return d.getExaggeration(c);let f=c-this._previousZoom;const _=this._previousUpdateTimestamp;let y=c;null!=this._evaluationZoom&&(y=this._evaluationZoom,Math.abs(c-y)>.5&&(f=.5*(c-y+f)),f*s<0&&(y+=f)),this._evaluationZoom=y;const v=d.getExaggeration(y),w=v===d.getExaggeration(Math.max(0,y-.1));if(w&&Math.abs(v-this._exaggeration)<.01)return v;let I=Math.min(.1,.00375*(this._updateTimestamp-_));return(w||v<.1||Math.abs(f)<1e-4)&&(I=Math.min(.2,4*I)),Er(this._exaggeration,v,I)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(Ri.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const s=this.proxyCoords=n.getIds().map(_=>{const y=n.getTileByID(_).tileID;return y.projMatrix=i.calculateProjMatrix(y.toUnwrapped()),y});!function(_,y){const v=y.transform.pointCoordinate(y.transform.getCameraPoint()),w=new me(v.x,v.y);_.sort((I,C)=>{if(C.overscaledZ-I.overscaledZ)return C.overscaledZ-I.overscaledZ;const S=new me(I.canonical.x+(1<<I.canonical.z)*I.wrap,I.canonical.y),M=new me(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),P=w.mult(1<<I.canonical.z);return P.x-=.5,P.y-=.5,P.distSqr(S)-P.distSqr(M)})}(s,this.painter);const c=this.proxyToSource||{};this.proxyToSource={},s.forEach(_=>{this.proxyToSource[_.key]={}}),this.terrainTileForTile={};const d=this._style._mergedSourceCaches;for(const _ in d){const y=d[_];if(!y.used||(y!==this.sourceCache&&this.resetTileLookupCache(y.id),this._setupProxiedCoordsForOrtho(y,e[_],c),y.usedForTerrain))continue;const v=e[_];y.getSource().reparseOverscaled&&this._assignTerrainTiles(v)}this.proxiedCoords[n.id]=s.map(_=>new d1(_,_.key,this.orthoMatrix)),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(c),this.renderingToTexture=!1;const f={};this._visibleDemTiles=[];for(const _ of this.proxyCoords){const y=this.terrainTileForTile[_.key];if(!y)continue;const v=y.tileID.key;v in f||(this._visibleDemTiles.push(y),f[v]=v)}}_assignTerrainTiles(e){this._initializing||e.forEach(n=>{if(this.terrainTileForTile[n.key])return;const i=this._findTileCoveringTileID(n,this.sourceCache);i&&(this.terrainTileForTile[n.key]=i)})}_prepareDEMTextures(){const e=this.painter.context,n=e.gl;for(const i in this.terrainTileForTile){const s=this.terrainTileForTile[i],c=s.dem;!c||s.demTexture&&!s.needsDEMTextureUpload||(e.activeTexture.set(n.TEXTURE1),ol(this.painter,s,c))}}_prepareDemTileUniforms(e,n,i,s){if(!n||null==n.demTexture)return!1;const c=e.tileID.canonical,d=Math.pow(2,n.tileID.canonical.z-c.z),f=s||"";return i[`u_dem_tl${f}`]=[c.x*d%1,c.y*d%1],i[`u_dem_scale${f}`]=d,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){const i=new Ki({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new ls(e,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const n=this._visibleDemTiles.reduce((i,s)=>{if(!s.dem)return i;const c=s.dem.tree.minimums[0];return c>0&&e++,i+c},0);return e?n/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),[s,c]=(()=>{if(this.painter.terrainUseFloatDEM()){const f=new Bw({width:1,height:1},new Float32Array([i]));return[n.R32F,f]}{const f=new Ki({width:1,height:1},new Uint8Array(Fu.pack(i,this.sourceCache.getSource().encoding)));return[n.RGBA,f]}})();this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(c,{premultiply:!1}):d=this._emptyDEMTexture=new ls(e,c,s,{premultiply:!1}),d}setupElevationDraw(e,n,i){const s=this.painter.context,c=s.gl,d=(f=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:Fu.getUnpackVector(f),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var f;d.u_exaggeration=this.exaggeration();let _=null,y=null,v=1;if(i&&i.morphing&&this._useVertexMorphing){const C=i.morphing.srcDemTile,S=i.morphing.dstDemTile;v=i.morphing.phase,C&&S&&(this._prepareDemTileUniforms(e,C,d,"_prev")&&(y=C),this._prepareDemTileUniforms(e,S,d)&&(_=S))}const w=C=>C&&C.demTexture&&this.painter.terrainUseFloatDEM()?c.LINEAR:c.NEAREST,I=C=>{d.u_dem_size=1===C.size[0]?1:C.size[0]-2};if(y&&_)s.activeTexture.set(c.TEXTURE2),_.demTexture.bind(w(_),c.CLAMP_TO_EDGE),s.activeTexture.set(c.TEXTURE4),y.demTexture.bind(w(y),c.CLAMP_TO_EDGE),_.demTexture&&I(_.demTexture),d.u_dem_lerp=v;else{_=this.terrainTileForTile[e.tileID.key],s.activeTexture.set(c.TEXTURE2);const C=this._prepareDemTileUniforms(e,_,d)?_.demTexture:this.emptyDEMTexture;C.bind(w(_),c.CLAMP_TO_EDGE),I(C)}if(s.activeTexture.set(c.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),this._depthFBO&&(d.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),d.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&_){const C=(1<<_.tileID.canonical.z)*Zi(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;d.u_meter_to_dem=C}if(i&&i.labelPlaneMatrixInv&&(d.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(s,d),"globe"===this.painter.transform.projection.name){const C=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(s,C)}}globeUniformValues(e,n,i){const s=e.projection;return{u_tile_tl_up:s.upVector(n,0,0),u_tile_tr_up:s.upVector(n,Vt,0),u_tile_br_up:s.upVector(n,Vt,Vt),u_tile_bl_up:s.upVector(n,0,Vt),u_tile_up_scale:i?Vx(1):s.upVectorScale(n,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const n=this.painter,i=this.painter.context;0!==e.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(s,c,d,f,_){if("globe"===s.transform.projection.name)!function(y,v,w,I,C){const S=y.context,M=S.gl;let P,R;const z=y.transform,G=Xy(y,S,z),H=($e,Ce)=>{if(R===Ce)return;const nt=[Zf[Ce],"PROJECTION_GLOBE_VIEW"];G&&nt.push("CUSTOM_ANTIALIASING");const ft=y.isTileAffectedByFog($e);P=y.getOrCreateProgram("globeRaster",{defines:nt,overrideFog:ft}),R=Ce},j=y.colorModeForRenderPass(),W=new Rr(M.LEQUAL,Rr.ReadWrite,y.depthRangeFor3D);Im.update(C);const oe=function($e){const Ce=$e.pixelsPerMeter,nt=Ce/Zi(1,$e.center.lat),ft=Dt.identity(new Float64Array(16));return Dt.translate(ft,ft,[$e.point.x,$e.point.y,0]),Dt.scale(ft,ft,[nt,nt,Ce]),Float32Array.from(ft)}(z),pe=[tl(z.center.lng),Sa(z.center.lat)],ve=y.globeSharedBuffers,xe=[z.width*ne.devicePixelRatio,z.height*ne.devicePixelRatio],ke=Float32Array.from(z.globeMatrix),Ae={useDenormalizedUpVectorScale:!0};{const $e=y.transform,Ce=sC($e.zoom,v.exaggeration(),v.sourceCache._source.tileSize);R=-1;const nt=M.TRIANGLES;for(const ft of I){const It=w.getTile(ft),et=Qr.disabled,it=v.prevTerrainTileForTile[ft.key],St=v.terrainTileForTile[ft.key];Em(it,St)&&Im.newMorphing(ft.key,it,St,C,250),S.activeTexture.set(M.TEXTURE0),It.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const Ut=Im.getMorphValuesForProxy(ft.key),Wt=Ut?1:0;Ut&&N(Ae,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:Gt(Ut.phase)}});const ln=Mp(ft.canonical),pn=hM(ln.getCenter().lat),Yt=VD(ft.canonical,ln,pn,$e.worldSize/$e._pixelsPerMercatorPixel),tn=Cg(au(ft.canonical)),Vn=JE($e.projMatrix,ke,oe,tn,el($e.zoom),pe,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,xe,Ce,Yt);if(H(ft,Wt),P&&(v.setupElevationDraw(It,P,Ae),y.uploadCommonUniforms(S,P,ft.toUnwrapped()),ve)){const[Jn,Yn,Xn]=ve.getGridBuffers(pn,0!==Ce);P.draw(y,nt,W,et,j,Vr.backCCW,Vn,"globe_raster",Jn,Yn,Xn)}}}if(ve&&(y.renderDefaultNorthPole||y.renderDefaultSouthPole)){const $e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];G&&$e.push("CUSTOM_ANTIALIASING"),P=y.getOrCreateProgram("globeRaster",{defines:$e});for(const Ce of I){const{x:nt,y:ft,z:It}=Ce.canonical,et=0===ft,it=ft===(1<<It)-1,[St,Ut,Wt,ln]=ve.getPoleBuffers(It,!1);if(ln&&(et||it)){const pn=w.getTile(Ce);S.activeTexture.set(M.TEXTURE0),pn.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);let Yt=BD(It,nt,z);const tn=Cg(au(Ce.canonical)),Vn=(Jn,Yn)=>Jn.draw(y,M.TRIANGLES,W,Qr.disabled,j,Vr.disabled,JE(z.projMatrix,Yt,Yt,tn,0,pe,z.frustumCorners.TL,z.frustumCorners.TR,z.frustumCorners.BR,z.frustumCorners.BL,z.globeCenterInViewSpace,z.globeRadius,xe,0),"globe_pole_raster",Yn,Wt,ln);v.setupElevationDraw(pn,P,Ae),y.uploadCommonUniforms(S,P,Ce.toUnwrapped()),et&&y.renderDefaultNorthPole&&Vn(P,St),it&&y.renderDefaultSouthPole&&(Yt=Dt.scale(Dt.create(),Yt,[1,-1,1]),Vn(P,Ut))}}}}(s,c,d,f,_);else{const y=s.context,v=y.gl;let w,I;const C=s.shadowRenderer,S=$c(s,s.longestCutoffRange),M=j=>{if(I===j)return;const W=[];W.push(Zf[j]),S.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),w=s.getOrCreateProgram("terrainRaster",{defines:W}),I=j},P=s.colorModeForRenderPass(),R=new Rr(v.LEQUAL,Rr.ReadWrite,s.depthRangeFor3D);Im.update(_);const z=s.transform,G=sC(z.zoom,c.exaggeration(),c.sourceCache._source.tileSize);let H=[0,0,0];if(C){const j=s.style.directionalLight,W=s.style.ambientLight;j&&W&&(H=E0(j,W))}{I=-1;const j=v.TRIANGLES,[W,oe]=[c.gridIndexBuffer,c.gridSegments];for(const pe of f){const ve=d.getTile(pe),xe=Qr.disabled,ke=c.prevTerrainTileForTile[pe.key],Ae=c.terrainTileForTile[pe.key];Em(ke,Ae)&&Im.newMorphing(pe.key,ke,Ae,_,250),y.activeTexture.set(v.TEXTURE0),ve.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const $e=Im.getMorphValuesForProxy(pe.key),Ce=$e?1:0;let nt;$e&&(nt={morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:Gt($e.phase)}});const ft=h0(pe.projMatrix,j_(pe.canonical,z.renderWorldCopies)?G/10:G,H);if(M(Ce),!w)continue;c.setupElevationDraw(ve,w,nt);const It=pe.toUnwrapped();C&&C.setupShadows(It,w),s.uploadCommonUniforms(y,w,It,null,S),w.draw(s,j,R,xe,P,Vr.backCCW,ft,"terrain_raster",c.gridBuffer,W,oe)}}}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,s=this.proxySourceCache,c=this.proxiedCoords[s.id],d=this._drapedRenderBatches.shift(),f=n.style.order,_=[];let y=0;for(const v of c){const w=s.getTileByID(v.proxyTileKey),I=s.proxyCachedFBO[v.key]?s.proxyCachedFBO[v.key][e]:void 0,C=void 0!==I?s.renderCache[I]:this.pool[y++],S=void 0!==I;if(w.texture=C.tex,S&&!C.dirty){_.push(w.tileID);continue}let M;i.bindFramebuffer.set(C.fb.framebuffer),this.renderedToTile=!1,C.dirty&&(i.clear({color:Ur.transparent,stencil:0}),C.dirty=!1);for(let P=d.start;P<=d.end;++P){const R=n.style._mergedLayers[f[P]];if(R.isHidden(n.transform.zoom))continue;const z=n.style.getLayerSourceCache(R),G=z?this.proxyToSource[v.key][z.id]:[v];if(!G)continue;const H=G;i.viewport.set([0,0,C.fb.width,C.fb.height]),M!==(z?z.id:null)&&(this._setupStencil(C,G,R,z),M=z?z.id:null),n.renderLayer(n,z,R,H)}if(0===this._drapedRenderBatches.length)for(const P of this._pendingGroundEffectLayers){const R=n.style._mergedLayers[f[P]];if(R.isHidden(n.transform.zoom))continue;const z=n.style.getLayerSourceCache(R),G=z?this.proxyToSource[v.key][z.id]:[v];if(!G)continue;const H=G;i.viewport.set([0,0,C.fb.width,C.fb.height]),M!==(z?z.id:null)&&(this._setupStencil(C,G,R,z),M=z?z.id:null),n.renderLayer(n,z,R,H)}this.renderedToTile?(C.dirty=!0,_.push(w.tileID)):S||--y,5===y&&(y=0,this.renderToBackBuffer(_))}return this.renderToBackBuffer(_),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),d.end+1}postRender(){}isLayerOrderingCorrect(e){const n=e.order.length;let i=-1,s=n;for(let c=0;c<n;++c)this._style.isLayerDraped(e._mergedLayers[e.order[c]])?i=Math.max(i,c):s=Math.min(s,c);return s>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{e=Math.min(e,n.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,n,i){if(!this._visibleDemTiles)return null;const s=this._visibleDemTiles.filter(c=>c.dem).map(c=>{const d=c.tileID,f=1<<d.overscaledZ,{x:_,y}=d.canonical,v=_/f,w=(_+1)/f,I=y/f,C=(y+1)/f;return{minx:v,miny:I,maxx:w,maxy:C,t:c.dem.tree.raycastRoot(v,I,w,C,e,n,i),tile:c}});s.sort((c,d)=>(null!==c.t?c.t:Number.MAX_VALUE)-(null!==d.t?d.t:Number.MAX_VALUE));for(const c of s){if(null==c.t)return null;const d=c.tile.dem.tree.raycast(c.minx,c.miny,c.maxx,c.maxy,e,n,i);if(null!=d)return d}return null}_createFBO(){const e=this.painter.context,n=e.gl,i=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const s=new ls(e,{width:i[0],height:i[1],data:null},n.RGBA);s.bind(n.LINEAR,n.CLAMP_TO_EDGE);const c=e.createFramebuffer(i[0],i[1],!0,null);return c.colorAttachment.set(s.texture),c.depthAttachment=new vE(e,c.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,c.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):c.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:c,tex:s,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const n=this._style._mergedLayers[e],i=n.isHidden(this.painter.transform.zoom);return"custom"===n.type?!i&&n.shouldRedrape():!i&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const i of this._style.getSources())if(i instanceof Zv){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const s=this._style._mergedLayers[this._style.order[i]],c=this._style.getLayerSourceCache(s);if(c&&!n[c.id]&&!s.isHidden(this.painter.transform.zoom)&&"line"===s.type&&s.widthExpression()instanceof _r){n[c.id]=!0;for(const d of this.proxyCoords){const f=this.proxyToSource[d.key][c.id];if(f)for(const _ of f)this._clearRenderCacheForTile(c.id,_)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof Kv){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const s=this._style._mergedLayers[this._style.order[i]],c=this._style.getLayerSourceCache(s);if(!c||n[c.id]||s.isHidden(this.painter.transform.zoom)||"raster"!==s.type)continue;const d=s.paint.get("raster-fade-duration");for(const f of this.proxyCoords){const _=this.proxyToSource[f.key][c.id];if(_)for(const y of _){const v=Uh(c.getTile(y),c.findLoadedParent(y,0),c,this.painter.transform,d);(1!==v.opacity||0!==v.mix)&&this._clearRenderCacheForTile(c.id,y)}}}}_setupDrapedRenderBatches(){const e=this._style.order,n=e.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let s,c=0,d=this._style._mergedLayers[e[c]];for(;!this._style.isLayerDraped(d)&&d.isHidden(this.painter.transform.zoom)&&++c<n;)d=this._style._mergedLayers[e[c]];for(;c<n;++c){const f=this._style._mergedLayers[e[c]];f.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(f)?void 0===s&&(s=c):("fill-extrusion"===f.type&&this._pendingGroundEffectLayers.push(c),void 0!==s&&(i.push({start:s,end:c-1}),s=void 0)))}if(void 0!==s&&i.push({start:s,end:c-1}),0!==i.length){const f=i[i.length-1];this._pendingGroundEffectLayers.every(y=>y>f.end)||Me("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const d=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let f=0;f<d.length;++f){const _=Object.values(d[f]);n.renderCachePool.push(..._)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,s=this._tilesDirty;for(let d=i.length-1;d>=0;d--){const f=i[d];if(n.getTileByID(f.key),void 0!==n.proxyCachedFBO[f.key]){const _=e[f.key],y=this.proxyToSource[f.key];let v=0;for(const w in y){const I=y[w],C=_[w];if(!C||C.length!==I.length||I.some((S,M)=>S!==C[M]||s[w]&&s[w].hasOwnProperty(S.key))){v=-1;break}++v}for(const w in n.proxyCachedFBO[f.key])n.renderCache[n.proxyCachedFBO[f.key][w]].dirty=v<0||v!==Object.values(_).length}}const c=[...this._drapedRenderBatches];c.sort((d,f)=>f.end-f.start-(d.end-d.start));for(const d of c)for(const f of i){if(n.proxyCachedFBO[f.key])continue;let _=n.renderCachePool.pop();void 0===_&&n.renderCache.length<50&&(_=n.renderCache.length,n.renderCache.push(this._createFBO())),void 0!==_&&(n.proxyCachedFBO[f.key]={},n.proxyCachedFBO[f.key][d.start]=_,n.renderCache[_].dirty=!0)}this._tilesDirty={}}_setupStencil(e,n,i,s){if(!s||!this._sourceTilesOverlap[s.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const c=this.painter.context,d=c.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let f;if(i.isTileClipped())f=n.length,this._overlapStencilMode.test={func:d.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);f=1,this._overlapStencilMode.test={func:d.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+f>255&&(c.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=f,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Qr.disabled}_renderTileClippingMasks(e,n){const i=this.painter,s=this.painter.context,c=s.gl;i._tileClippingMaskIDs={},s.setColorMode(Ai.disabled),s.setDepthMode(Rr.disabled);const d=i.getOrCreateProgram("clippingMask");for(const f of e){const _=i._tileClippingMaskIDs[f.key]=--n;d.draw(i,c.TRIANGLES,Rr.disabled,new Qr({func:c.ALWAYS,mask:0},_,255,c.KEEP,c.KEEP,c.REPLACE),Ai.disabled,Vr.disabled,u1(f.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const i=[e.x,e.y,1,1];no.transformMat4(i,i,n.pixelMatrixInverse),no.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const s=n._camera.position,c=Zi(1,n.center.lat),d=[s[0],s[1],s[2]/c,0],f=He.subtract([],i.slice(0,3),d);He.normalize(f,f);const _=this.raycast(d,f,this._exaggeration);return null!==_&&_?(He.scaleAndAdd(d,d,f,_),d[3]=d[2],d[2]*=c,d):null}drawDepth(){const e=this.painter,n=e.context,i=this.proxySourceCache,s=Math.ceil(e.width),c=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===s&&this._depthFBO.height===c||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const d=n.gl,f=n.createFramebuffer(s,c,!0,"renderbuffer");n.activeTexture.set(d.TEXTURE0);const _=new ls(n,{width:s,height:c,data:null},d.RGBA);_.bind(d.NEAREST,d.CLAMP_TO_EDGE),f.colorAttachment.set(_.texture);const y=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,s,c);f.depthAttachment.set(y),this._depthFBO=f,this._depthTexture=_}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,s,c]),function(d,f,_,y){if("globe"===d.transform.projection.name)return;const v=d.context,w=v.gl;v.clear({depth:1});const I=d.getOrCreateProgram("terrainDepth"),C=new Rr(w.LESS,Rr.ReadWrite,d.depthRangeFor3D);for(const S of y){const M=_.getTile(S),P=h0(S.projMatrix,0,[0,0,0]);f.setupElevationDraw(M,I),I.draw(d,w.TRIANGLES,C,Qr.disabled,Ai.unblended,Vr.backCCW,P,"terrain_depth",f.gridBuffer,f.gridIndexBuffer,f.gridNoSkirtSegments)}}(e,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,n,i){if(e.getSource()instanceof $d)return this._setupProxiedCoordsForImageSource(e,n,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const s=this.proxiedCoords[e.id]=[],c=this.proxyCoords;for(let f=0;f<c.length;f++){const _=c[f],y=this._findTileCoveringTileID(_,e);if(y){const v=this._createProxiedId(_,y,i[_.key]&&i[_.key][e.id]);s.push(v),this.proxyToSource[_.key][e.id]=[v]}}let d=!1;for(let f=0;f<n.length;f++){const _=e.getTile(n[f]);if(!_||!_.hasData())continue;const y=this._findTileCoveringTileID(_.tileID,this.proxySourceCache);if(y&&y.tileID.canonical.z!==_.tileID.canonical.z){const v=this.proxyToSource[y.tileID.key][e.id],w=this._createProxiedId(y.tileID,_,i[y.tileID.key]&&i[y.tileID.key][e.id]);v?v.splice(v.length-1,0,w):this.proxyToSource[y.tileID.key][e.id]=[w],s.push(w),d=!0}}this._sourceTilesOverlap[e.id]=d}_setupProxiedCoordsForImageSource(e,n,i){if(!e.getSource().loaded())return;const s=this.proxiedCoords[e.id]=[],c=this.proxyCoords,d=e.getSource(),f=d.tileID;if(!f)return;const _=new me(f.x,f.y)._div(1<<f.z),y=d.coordinates.map(Ri.fromLngLat).reduce((w,I)=>(w.min.x=Math.min(w.min.x,I.x-_.x),w.min.y=Math.min(w.min.y,I.y-_.y),w.max.x=Math.max(w.max.x,I.x-_.x),w.max.y=Math.max(w.max.y,I.y-_.y),w),{min:new me(Number.MAX_VALUE,Number.MAX_VALUE),max:new me(-Number.MAX_VALUE,-Number.MAX_VALUE)}),v=(w,I)=>{const C=w.wrap+w.canonical.x/(1<<w.canonical.z),S=w.canonical.y/(1<<w.canonical.z),M=Vt/(1<<w.canonical.z),P=I.wrap+I.canonical.x/(1<<I.canonical.z),R=I.canonical.y/(1<<I.canonical.z);return C+M<P+y.min.x||C>P+y.max.x||S+M<R+y.min.y||S>R+y.max.y};for(let w=0;w<c.length;w++){const I=c[w];for(let C=0;C<n.length;C++){const S=e.getTile(n[C]);if(!S||!S.hasData()||v(I,S.tileID))continue;const M=this._createProxiedId(I,S,i[I.key]&&i[I.key][e.id]),P=this.proxyToSource[I.key][e.id];P?P.push(M):this.proxyToSource[I.key][e.id]=[M],s.push(M)}}}_createProxiedId(e,n,i){let s=this.orthoMatrix;if(i){const c=i.find(d=>d.key===n.tileID.key);if(c)return c}if(n.tileID.key!==e.key){const c=e.canonical.z-n.tileID.canonical.z;let d,f,_;s=Dt.create();const y=n.tileID.wrap-e.wrap<<e.overscaledZ;c>0?(d=Vt>>c,f=d*((n.tileID.canonical.x<<c)-e.canonical.x+y),_=d*((n.tileID.canonical.y<<c)-e.canonical.y)):(d=Vt<<-c,f=Vt*(n.tileID.canonical.x-(e.canonical.x+y<<-c)),_=Vt*(n.tileID.canonical.y-(e.canonical.y<<-c))),Dt.ortho(s,0,d,0,d,0,1),Dt.translate(s,s,[f,_,0])}return new d1(n.tileID,e.key,s)}_findTileCoveringTileID(e,n){let i=n.getTile(e);if(i&&i.hasData())return i;const s=this._findCoveringTileCache[n.id],c=s[e.key];if(i=c?n.getTileByID(c):null,i&&i.hasData()||null===c)return i;let d=i?i.tileID:e,f=d.overscaledZ;const _=n.getSource().minzoom,y=[];if(!c){const w=n.getSource().maxzoom;if(e.canonical.z>=w){const I=e.canonical.z-w;n.getSource().reparseOverscaled?(f=Math.max(e.canonical.z+2,n.transform.tileZoom),d=new Bi(f,e.wrap,w,e.canonical.x>>I,e.canonical.y>>I)):0!==I&&(f=w,d=new Bi(f,e.wrap,w,e.canonical.x>>I,e.canonical.y>>I))}d.key!==e.key&&(y.push(d.key),i=n.getTile(d))}const v=w=>{y.forEach(I=>{s[I]=w}),y.length=0};for(f-=1;f>=_&&(!i||!i.hasData());f--){i&&v(i.tileID.key);const w=d.calculateScaledKey(f);if(i=n.getTileByID(w),i&&i.hasData())break;const I=s[w];if(null===I)break;void 0===I?y.push(w):i=n.getTileByID(I)}return v(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,n){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[n.key]=!0}}function eI(t,e,n){const i=function(f,_,y){const v=He.dot(_,f),w=He.dot(y,[.2126,.7152,.0722]),I=(S,M,P)=>(1-P)*S+P*M,C=I(1-.3*Math.min(w,1),1,Math.min(v+1,1));return I(.92,1,Math.asin(_n(_[2],-1,1))/Math.PI+.5)*C}(t,[0,0,1],e),s=[0,0,0];He.scale(s,n.slice(0,3),i);const c=[0,0,0];He.scale(c,e.slice(0,3),t[2]);const d=[0,0,0];return He.add(d,s,c),Kr(d)}const uC=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],f0=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class dC{static cacheKey(e,n,i,s){let c=`${n}${s?s.cacheKey:""}`;for(const d of i)e.usedDefines.includes(d)&&(c+=`/${d}`);return c}constructor(e,n,i,s,c,d){const f=e.gl;this.program=f.createProgram(),this.configuration=s,this.name=n,this.fixedDefines=[...d];const _=function(R){const z=[];for(let G=0;G<R.length;G++){if(null===R[G])continue;const H=R[G].split(" ");z.push(H.pop())}return z}(i.staticAttributes),y=s?s.getBinderAttributes():[],v=_.concat(y);let w=s?s.defines():[];w=w.concat(d.map(R=>`#define ${R}`));const I="#version 300 es\n";let C=I+w.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ZE,U_.fragmentSource).join("\n");for(const R of i.fragmentIncludes)C+=`\n${c1[R]}`;C+=`\n${i.fragmentSource}`;let S=I+w.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ZE,U_.vertexSource).join("\n");for(const R of i.vertexIncludes)S+=`\n${c1[R]}`;S+=`\n${i.vertexSource}`;const M=f.createShader(f.FRAGMENT_SHADER);if(f.isContextLost())return void(this.failedToCreate=!0);f.shaderSource(M,C),f.compileShader(M),f.attachShader(this.program,M);const P=f.createShader(f.VERTEX_SHADER);if(f.isContextLost())this.failedToCreate=!0;else{f.shaderSource(P,S),f.compileShader(P),f.attachShader(this.program,P),this.attributes={},this.numAttributes=v.length;for(let R=0;R<this.numAttributes;R++)if(v[R]){const z=v[R].startsWith("a_")?v[R]:`a_${v[R]}`;f.bindAttribLocation(this.program,R,z),this.attributes[z]=R}f.linkProgram(this.program),f.deleteShader(P),f.deleteShader(M),this.fixedUniforms=c(e),this.binderUniforms=s?s.getUniforms(e):[],d.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new gi(R=e),u_dem_prev:new gi(R),u_dem_unpack:new Os(R),u_dem_tl:new Ti(R),u_dem_scale:new kn(R),u_dem_tl_prev:new Ti(R),u_dem_scale_prev:new kn(R),u_dem_size:new kn(R),u_dem_lerp:new kn(R),u_exaggeration:new kn(R),u_depth:new gi(R),u_depth_size_inv:new Ti(R),u_meter_to_dem:new kn(R),u_label_plane_matrix_inv:new Xr(R)}),d.includes("GLOBE")&&(this.globeUniforms=(R=>({u_tile_tl_up:new ni(R),u_tile_tr_up:new ni(R),u_tile_br_up:new ni(R),u_tile_bl_up:new ni(R),u_tile_up_scale:new kn(R)}))(e)),d.includes("FOG")&&(this.fogUniforms=(R=>({u_fog_matrix:new Xr(R),u_fog_range:new Ti(R),u_fog_color:new Os(R),u_fog_horizon_blend:new kn(R),u_fog_vertical_limit:new Ti(R),u_fog_temporal_offset:new kn(R),u_frustum_tl:new ni(R),u_frustum_tr:new ni(R),u_frustum_br:new ni(R),u_frustum_bl:new ni(R),u_globe_pos:new ni(R),u_globe_radius:new kn(R),u_globe_transition:new kn(R),u_is_globe:new gi(R),u_viewport:new Ti(R)}))(e)),d.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(R=>({u_cutoff_params:new Os(R)}))(e)),d.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(R=>({u_lighting_ambient_color:new ni(R),u_lighting_directional_dir:new ni(R),u_lighting_directional_color:new ni(R),u_ground_radiance:new ni(R)}))(e)),d.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(R=>({u_light_matrix_0:new Xr(R),u_light_matrix_1:new Xr(R),u_fade_range:new Ti(R),u_shadow_normal_offset:new ni(R),u_shadow_intensity:new kn(R),u_shadow_texel_size:new kn(R),u_shadow_map_resolution:new kn(R),u_shadow_direction:new ni(R),u_shadow_bias:new ni(R),u_shadowmap_0:new gi(R),u_shadowmap_1:new gi(R)}))(e))}var R}setTerrainUniformValues(e,n){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const s in n)i[s]&&i[s].set(this.program,s,n[s])}}setGlobeUniformValues(e,n){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const s in n)i[s]&&i[s].set(this.program,s,n[s])}}setFogUniformValues(e,n){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const s in n)i[s].set(this.program,s,n[s])}}setCutoffUniformValues(e,n){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const s in n)i[s].set(this.program,s,n[s])}}setLightsUniformValues(e,n){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const s in n)i[s].set(this.program,s,n[s])}}setShadowUniformValues(e,n){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const s in n)i[s].set(this.program,s,n[s])}_drawDebugWireframe(e,n,i,s,c,d,f,_,y,v){const w=e.options.wireframe;if(!1===w.terrain&&!1===w.layers2D&&!1===w.layers3D)return;const I=e.context;if(!(()=>!(!w.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!w.layers2D||e._terrain&&e._terrain.renderingToTexture||!uC.includes(this.name))||!(!w.layers3D||!f0.includes(this.name)))())return;const C=I.gl,S=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,c,I);if(!S)return;const M=[...this.fixedDefines];M.push("DEBUG_WIREFRAME");const P=e.getOrCreateProgram(this.name,{config:this.configuration,defines:M});I.program.set(P.program);const R=(H,j,W)=>{if(j[H]&&W[H])for(const oe in j[H])W[H][oe]&&W[H][oe].set(W.program,oe,j[H][oe].current)};y&&y.setUniforms(P.program,I,P.binderUniforms,f,{zoom:_}),R("fixedUniforms",this,P),R("terrainUniforms",this,P),R("globeUniforms",this,P),R("fogUniforms",this,P),R("lightsUniforms",this,P),R("shadowUniforms",this,P),S.bind(),I.setColorMode(new Ai([C.ONE,C.ONE_MINUS_SRC_ALPHA,C.ZERO,C.ONE],Ur.transparent,[!0,!0,!0,!1])),I.setDepthMode(new Rr(n.func===C.LESS?C.LEQUAL:n.func,Rr.ReadOnly,n.range)),I.setStencilMode(Qr.disabled);const z=3*d.primitiveLength*2,G=3*d.primitiveOffset*2*2;v&&v>1?C.drawElementsInstanced(C.LINES,z,C.UNSIGNED_SHORT,G,v):C.drawElements(C.LINES,z,C.UNSIGNED_SHORT,G),c.bind(),I.program.set(this.program),I.setDepthMode(n),I.setStencilMode(i),I.setColorMode(s)}draw(e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P){const R=e.context,z=R.gl;if(this.failedToCreate)return;R.program.set(this.program),R.setDepthMode(i),R.setStencilMode(s),R.setColorMode(c),R.setCullFace(d);for(const j of Object.keys(this.fixedUniforms))this.fixedUniforms[j].set(this.program,j,f[j]);S&&S.setUniforms(this.program,R,this.binderUniforms,I,{zoom:C});const G={[z.LINES]:2,[z.TRIANGLES]:3,[z.LINE_STRIP]:1}[n],H=P&&P>0?1:void 0;for(const j of w.get()){const W=j.vaos||(j.vaos={});(W[_]||(W[_]=new wm)).bind(R,this,y,S?S.getPaintVertexBuffers():[],v,j.vertexOffset,M||[],H),P&&P>1?z.drawElementsInstanced(n,j.primitiveLength*G,z.UNSIGNED_SHORT,j.primitiveOffset*G*2,P):z.drawElements(n,j.primitiveLength*G,z.UNSIGNED_SHORT,j.primitiveOffset*G*2),n===z.TRIANGLES&&this._drawDebugWireframe(e,i,s,c,v,j,I,C,S,P)}}}function tI(t,e){const n=Math.pow(2,e.tileID.overscaledZ),i=e.tileSize*Math.pow(2,t.transform.tileZoom)/n,s=i*(e.tileID.canonical.x+e.tileID.wrap*n),c=i*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture.size,u_tile_units_to_pixels:1/nm(e,1,t.transform.tileZoom),u_pixel_coord_upper:[s>>16,c>>16],u_pixel_coord_lower:[65535&s,65535&c]}}const nI=Dt.create(),rI=(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S)=>{const M=e.style.light,P=M.properties.get("position"),R=[P.x,P.y,P.z],z=yl.create();"viewport"===M.properties.get("anchor")&&(yl.fromRotation(z,-e.transform.angle),He.transformMat3(R,R,z));const G=M.properties.get("color"),H=e.transform,j={u_matrix:t,u_lightpos:R,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nI,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:s,u_edge_radius:c,u_flood_light_color:w,u_vertical_scale:I,u_flood_light_intensity:C,u_ground_shadow_factor:S};return"globe"===H.projection.name&&(j.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],j.u_zoom_transition=_,j.u_inv_rot_matrix=v,j.u_merc_center=y,j.u_up_dir=H.projection.upVector(new vh(0,0,0),y[0]*Vt,y[1]*Vt),j.u_height_lift=f),j},iI=(t,e,n)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:n}),Tm=(t,e,n,i,s,c,d,f,_,y,v,w,I,C)=>{const S=rI(t,e,n,i,s,c,d,_,y,v,w,I,C,1,[0,0,0]),M={u_height_factor:-Math.pow(2,d.overscaledZ)/f.tileSize/8};return Ye(S,tI(e,f),M)},G_=(t,e)=>({u_matrix:t,u_emissive_strength:e}),p0=(t,e,n,i)=>Ye(G_(t,e),tI(n,i)),m0=(t,e,n)=>({u_matrix:t,u_world:n,u_emissive_strength:e}),hC=(t,e,n,i,s)=>Ye(p0(t,e,n,i),{u_world:s}),oI=(t,e,n,i)=>{const s=Vt/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(i),u_extrude_scale:[e.pixelsToGLUnits[0]/s,e.pixelsToGLUnits[1]/s]}},sI=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),fC=Dt.create(),h1=(t,e,n,i,s,c,d)=>{const f=t.transform,_="globe"===f.projection.name,y=_?yS(f.zoom,e.canonical)*f._pixelsPerMercatorPixel:nm(n,1,c),v={u_matrix:e.projMatrix,u_extrude_scale:y,u_intensity:d,u_inv_rot_matrix:fC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(_){v.u_inv_rot_matrix=i,v.u_merc_center=s,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=el(f.zoom);const w=s[0]*Vt,I=s[1]*Vt;v.u_up_dir=f.projection.upVector(new vh(0,0,0),w,I)}return v},Ra=(t,e,n,i,s,c,d,f,_,y,v)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:n,u_tl_parent:i,u_scale_parent:s,u_fade_t:c.mix,u_opacity:c.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(I=d.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(w=d.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:pC(d.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_colorization_mix:y,u_colorization_scale:mC(v),u_color_ramp:_};var w,I};function pC(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function mC([t,e]){if(t===e)return[t,e];const n=(e+t)/2,i=(e-t)/2*256/255;return[-(t=n-i)/((e=n+i)-t),1/(e-t)]}const gC=Dt.create(),f1=(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P)=>{const R=s.transform,z={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.getCameraToCenterDistance(M),u_rotate_symbol:+n,u_aspect_ratio:R.width/R.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:c,u_label_plane_matrix:d,u_coord_matrix:f,u_is_text:+_,u_pitch_with_map:+i,u_texsize:y,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gC,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gC,u_up_vector:[0,-1,0],u_icon_transition:P||0};return"globe"===M.name&&(z.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],z.u_zoom_transition=w,z.u_inv_rot_matrix=C,z.u_merc_center=I,z.u_camera_forward=R._camera.forward(),z.u_ecef_origin=function(G,H){const j=[0,0,0],W=Cg(au(H.canonical));return He.transformMat4(j,j,W),He.transformMat4(j,j,G),j}(R.globeMatrix,v.toUnwrapped()),z.u_tile_matrix=Float32Array.from(R.globeMatrix),z.u_up_vector=S),z},H_=(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P)=>Ye(f1(t,e,n,i,s,c,d,f,_,y,w,I,C,S,M,P),{u_gamma_scale:i?s.transform.getCameraToCenterDistance(P)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:ne.devicePixelRatio,u_is_halo:+v,undefined:void 0}),_C=(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M)=>Ye(H_(t,e,n,i,s,c,d,f,!0,_,!0,v,w,I,C,S,M),{u_texsize_icon:y,u_texture_icon:1}),W_=(t,e,n,i)=>({u_matrix:t,u_emissive_strength:e,u_opacity:n,u_color:i}),p1=(t,e,n,i,s,c,d)=>Ye(function(f,_,y,v){const w=y.imageManager.getPattern(f.toString(),_),{width:I,height:C}=y.imageManager.getPixelSize(_),S=Math.pow(2,v.tileID.overscaledZ),M=v.tileSize*Math.pow(2,y.transform.tileZoom)/S,P=M*(v.tileID.canonical.x+v.tileID.wrap*S),R=M*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:w.tl,u_pattern_br:w.br,u_texsize:[I,C],u_pattern_size:w.displaySize,u_tile_units_to_pixels:1/nm(v,1,y.transform.tileZoom),u_pixel_coord_upper:[P>>16,R>>16],u_pixel_coord_lower:[65535&P,65535&R]}}(s,c,i,d),{u_matrix:t,u_emissive_strength:e,u_opacity:n}),vc={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},q_=(t,e,n,i,s,c,d,f,_,y,v,w=[0,0,0])=>{const I=i.style.light,C=I.properties.get("position"),S=[-C.x,-C.y,C.z],M=yl.create();"viewport"===I.properties.get("anchor")&&(yl.fromRotation(M,-i.transform.angle),He.transformMat3(S,S,M));const P="MASK"===y.alphaMode,R=I.properties.get("color"),z=v.paint.get("model-ambient-occlusion-intensity"),G=v.paint.get("model-color").constantOr(Ur.white),H=v.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:n,u_lightpos:S,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_camera_pos:w,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+P,u_alphaCutoff:y.alphaCutoff,u_baseColorFactor:[c.r,c.g,c.b,c.a],u_emissiveFactor:[d[0],d[1],d[2],1],u_metallicFactor:f,u_roughnessFactor:_,u_baseColorTexture:vc.BaseColor,u_metallicRoughnessTexture:vc.MetallicRoughness,u_normalTexture:vc.Normal,u_occlusionTexture:vc.Occlusion,u_emissionTexture:vc.Emission,u_color_mix:[G.r,G.g,G.b,H],u_aoIntensity:z}},m1=new Float32Array(16),g0=(t,e=m1,n=m1)=>({u_matrix:t,u_instance:e,u_node_matrix:n}),ed={fillExtrusion:t=>({u_matrix:new Xr(t),u_lightpos:new ni(t),u_lightintensity:new kn(t),u_lightcolor:new ni(t),u_vertical_gradient:new kn(t),u_opacity:new kn(t),u_edge_radius:new kn(t),u_ao:new Ti(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_up_dir:new ni(t),u_height_lift:new kn(t),u_flood_light_color:new ni(t),u_vertical_scale:new kn(t),u_flood_light_intensity:new kn(t),u_ground_shadow_factor:new ni(t)}),fillExtrusionDepth:t=>({u_matrix:new Xr(t),u_edge_radius:new kn(t),u_vertical_scale:new kn(t)}),fillExtrusionPattern:t=>({u_matrix:new Xr(t),u_lightpos:new ni(t),u_lightintensity:new kn(t),u_lightcolor:new ni(t),u_vertical_gradient:new kn(t),u_height_factor:new kn(t),u_edge_radius:new kn(t),u_ao:new Ti(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_up_dir:new ni(t),u_height_lift:new kn(t),u_image:new gi(t),u_texsize:new Ti(t),u_pixel_coord_upper:new Ti(t),u_pixel_coord_lower:new Ti(t),u_tile_units_to_pixels:new kn(t),u_opacity:new kn(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new Xr(t),u_opacity:new kn(t),u_ao_pass:new kn(t),u_meter_to_tile:new kn(t),u_ao:new Ti(t),u_flood_light_intensity:new kn(t),u_flood_light_color:new ni(t),u_attenuation:new kn(t),u_edge_radius:new kn(t),u_fb:new gi(t),u_fb_size:new kn(t)}),fill:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t)}),fillPattern:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t),u_image:new gi(t),u_texsize:new Ti(t),u_pixel_coord_upper:new Ti(t),u_pixel_coord_lower:new Ti(t),u_tile_units_to_pixels:new kn(t)}),fillOutline:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t),u_world:new Ti(t)}),fillOutlinePattern:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t),u_world:new Ti(t),u_image:new gi(t),u_texsize:new Ti(t),u_pixel_coord_upper:new Ti(t),u_pixel_coord_lower:new Ti(t),u_tile_units_to_pixels:new kn(t)}),circle:t=>({u_camera_to_center_distance:new kn(t),u_extrude_scale:new ky(t),u_device_pixel_ratio:new kn(t),u_matrix:new Xr(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_up_dir:new ni(t),u_emissive_strength:new kn(t)}),collisionBox:t=>({u_matrix:new Xr(t),u_camera_to_center_distance:new kn(t),u_extrude_scale:new Ti(t)}),collisionCircle:t=>({u_matrix:new Xr(t),u_inv_matrix:new Xr(t),u_camera_to_center_distance:new kn(t),u_viewport_size:new Ti(t)}),debug:t=>({u_color:new cf(t),u_matrix:new Xr(t),u_overlay:new gi(t),u_overlay_scale:new kn(t)}),clippingMask:t=>({u_matrix:new Xr(t)}),heatmap:t=>({u_extrude_scale:new kn(t),u_intensity:new kn(t),u_matrix:new Xr(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_up_dir:new ni(t)}),heatmapTexture:t=>({u_image:new gi(t),u_color_ramp:new gi(t),u_opacity:new kn(t)}),hillshade:t=>({u_matrix:new Xr(t),u_image:new gi(t),u_latrange:new Ti(t),u_light:new Ti(t),u_shadow:new cf(t),u_highlight:new cf(t),u_emissive_strength:new kn(t),u_accent:new cf(t)}),hillshadePrepare:t=>({u_matrix:new Xr(t),u_image:new gi(t),u_dimension:new Ti(t),u_zoom:new kn(t),u_unpack:new Os(t)}),line:t=>({u_matrix:new Xr(t),u_pixels_to_tile_units:new ky(t),u_device_pixel_ratio:new kn(t),u_units_to_pixels:new Ti(t),u_dash_image:new gi(t),u_gradient_image:new gi(t),u_image_height:new kn(t),u_texsize:new Ti(t),u_tile_units_to_pixels:new kn(t),u_alpha_discard_threshold:new kn(t),u_trim_offset:new Ti(t),u_emissive_strength:new kn(t)}),linePattern:t=>({u_matrix:new Xr(t),u_texsize:new Ti(t),u_pixels_to_tile_units:new ky(t),u_device_pixel_ratio:new kn(t),u_image:new gi(t),u_units_to_pixels:new Ti(t),u_tile_units_to_pixels:new kn(t),u_alpha_discard_threshold:new kn(t)}),raster:t=>({u_matrix:new Xr(t),u_normalize_matrix:new Xr(t),u_globe_matrix:new Xr(t),u_tl_parent:new Ti(t),u_scale_parent:new kn(t),u_fade_t:new kn(t),u_opacity:new kn(t),u_image0:new gi(t),u_image1:new gi(t),u_brightness_low:new kn(t),u_brightness_high:new kn(t),u_saturation_factor:new kn(t),u_contrast_factor:new kn(t),u_spin_weights:new ni(t),u_perspective_transform:new Ti(t),u_colorization_mix:new Os(t),u_colorization_scale:new Ti(t),u_color_ramp:new gi(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new gi(t),u_is_size_feature_constant:new gi(t),u_size_t:new kn(t),u_size:new kn(t),u_camera_to_center_distance:new kn(t),u_rotate_symbol:new gi(t),u_aspect_ratio:new kn(t),u_fade_change:new kn(t),u_matrix:new Xr(t),u_label_plane_matrix:new Xr(t),u_coord_matrix:new Xr(t),u_is_text:new gi(t),u_pitch_with_map:new gi(t),u_texsize:new Ti(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_camera_forward:new ni(t),u_tile_matrix:new Xr(t),u_up_vector:new ni(t),u_ecef_origin:new ni(t),u_texture:new gi(t),u_icon_transition:new kn(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new gi(t),u_is_size_feature_constant:new gi(t),u_size_t:new kn(t),u_size:new kn(t),u_camera_to_center_distance:new kn(t),u_rotate_symbol:new gi(t),u_aspect_ratio:new kn(t),u_fade_change:new kn(t),u_matrix:new Xr(t),u_label_plane_matrix:new Xr(t),u_coord_matrix:new Xr(t),u_is_text:new gi(t),u_pitch_with_map:new gi(t),u_texsize:new Ti(t),u_texture:new gi(t),u_gamma_scale:new kn(t),u_device_pixel_ratio:new kn(t),u_tile_id:new ni(t),u_zoom_transition:new kn(t),u_inv_rot_matrix:new Xr(t),u_merc_center:new Ti(t),u_camera_forward:new ni(t),u_tile_matrix:new Xr(t),u_up_vector:new ni(t),u_ecef_origin:new ni(t),u_is_halo:new gi(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new gi(t),u_is_size_feature_constant:new gi(t),u_size_t:new kn(t),u_size:new kn(t),u_camera_to_center_distance:new kn(t),u_rotate_symbol:new gi(t),u_aspect_ratio:new kn(t),u_fade_change:new kn(t),u_matrix:new Xr(t),u_label_plane_matrix:new Xr(t),u_coord_matrix:new Xr(t),u_is_text:new gi(t),u_pitch_with_map:new gi(t),u_texsize:new Ti(t),u_texsize_icon:new Ti(t),u_texture:new gi(t),u_texture_icon:new gi(t),u_gamma_scale:new kn(t),u_device_pixel_ratio:new kn(t),u_is_halo:new gi(t)}),background:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t),u_opacity:new kn(t),u_color:new cf(t)}),backgroundPattern:t=>({u_matrix:new Xr(t),u_emissive_strength:new kn(t),u_opacity:new kn(t),u_image:new gi(t),u_pattern_tl:new Ti(t),u_pattern_br:new Ti(t),u_texsize:new Ti(t),u_pattern_size:new Ti(t),u_pixel_coord_upper:new Ti(t),u_pixel_coord_lower:new Ti(t),u_tile_units_to_pixels:new kn(t)}),terrainRaster:$_,terrainDepth:$_,skybox:t=>({u_matrix:new Xr(t),u_sun_direction:new ni(t),u_cubemap:new gi(t),u_opacity:new kn(t),u_temporal_offset:new kn(t)}),skyboxGradient:t=>({u_matrix:new Xr(t),u_color_ramp:new gi(t),u_center_direction:new ni(t),u_radius:new kn(t),u_opacity:new kn(t),u_temporal_offset:new kn(t)}),skyboxCapture:t=>({u_matrix_3f:new Oy(t),u_sun_direction:new ni(t),u_sun_intensity:new kn(t),u_color_tint_r:new Os(t),u_color_tint_m:new Os(t),u_luminance:new kn(t)}),globeRaster:t=>({u_proj_matrix:new Xr(t),u_globe_matrix:new Xr(t),u_normalize_matrix:new Xr(t),u_merc_matrix:new Xr(t),u_zoom_transition:new kn(t),u_merc_center:new Ti(t),u_image0:new gi(t),u_grid_matrix:new Oy(t),u_skirt_height:new kn(t),u_frustum_tl:new ni(t),u_frustum_tr:new ni(t),u_frustum_br:new ni(t),u_frustum_bl:new ni(t),u_globe_pos:new ni(t),u_globe_radius:new kn(t),u_viewport:new Ti(t)}),globeAtmosphere:t=>({u_frustum_tl:new ni(t),u_frustum_tr:new ni(t),u_frustum_br:new ni(t),u_frustum_bl:new ni(t),u_horizon:new kn(t),u_transition:new kn(t),u_fadeout_range:new kn(t),u_color:new Os(t),u_high_color:new Os(t),u_space_color:new Os(t),u_temporal_offset:new kn(t),u_horizon_angle:new kn(t)}),model:t=>({u_matrix:new Xr(t),u_lighting_matrix:new Xr(t),u_normal_matrix:new Xr(t),u_lightpos:new ni(t),u_lightintensity:new kn(t),u_lightcolor:new ni(t),u_camera_pos:new ni(t),u_opacity:new kn(t),u_baseColorFactor:new Os(t),u_emissiveFactor:new Os(t),u_metallicFactor:new kn(t),u_roughnessFactor:new kn(t),u_baseTextureIsAlpha:new gi(t),u_alphaMask:new gi(t),u_alphaCutoff:new kn(t),u_baseColorTexture:new gi(t),u_metallicRoughnessTexture:new gi(t),u_normalTexture:new gi(t),u_occlusionTexture:new gi(t),u_emissionTexture:new gi(t),u_color_mix:new Os(t),u_aoIntensity:new kn(t)}),modelDepth:t=>({u_matrix:new Xr(t),u_instance:new Xr(t),u_node_matrix:new Xr(t)}),groundShadow:t=>({u_matrix:new Xr(t),u_ground_shadow_factor:new ni(t)}),stars:t=>({u_matrix:new Xr(t),u_up:new ni(t),u_right:new ni(t),u_intensity_multiplier:new kn(t)})};let Kf;function g1(t,e,n,i,s,c,d){const f=t.context,_=f.gl,y=t.transform,v=t.getOrCreateProgram("collisionBox"),w=[];let I=0,C=0;for(let H=0;H<i.length;H++){const j=i[H],W=e.getTile(j),oe=W.getBucket(n);if(!oe)continue;const pe=L_(j,oe,y);let ve=pe;0===s[0]&&0===s[1]||(ve=t.translatePosMatrix(pe,W,s,c));const xe=d?oe.textCollisionBox:oe.iconCollisionBox,ke=oe.collisionCircleArray;if(ke.length>0){const Ae=Dt.create(),$e=ve;Dt.mul(Ae,oe.placementInvProjMatrix,y.glCoordMatrix),Dt.mul(Ae,Ae,oe.placementViewportMatrix),w.push({circleArray:ke,circleOffset:C,transform:$e,invTransform:Ae,projection:oe.getProjection()}),I+=ke.length/4,C=I}xe&&(t.terrain&&t.terrain.setupElevationDraw(W,v),v.draw(t,_.LINES,Rr.disabled,Qr.disabled,t.colorModeForRenderPass(),Vr.disabled,oI(ve,y,W,oe.getProjection()),n.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,y.zoom,null,[xe.collisionVertexBuffer,xe.collisionVertexBufferExt]))}if(!d||!w.length)return;const S=t.getOrCreateProgram("collisionCircle"),M=new tw;M.resize(4*I),M._trim();let P=0;for(const H of w)for(let j=0;j<H.circleArray.length/4;j++){const W=4*j,oe=H.circleArray[W+0],pe=H.circleArray[W+1],ve=H.circleArray[W+2],xe=H.circleArray[W+3];M.emplace(P++,oe,pe,ve,xe,0),M.emplace(P++,oe,pe,ve,xe,1),M.emplace(P++,oe,pe,ve,xe,2),M.emplace(P++,oe,pe,ve,xe,3)}(!Kf||Kf.length<2*I)&&(Kf=function(H){const j=2*H,W=new Is;W.resize(j),W._trim();for(let oe=0;oe<j;oe++){const pe=6*oe;W.uint16[pe+0]=4*oe+0,W.uint16[pe+1]=4*oe+1,W.uint16[pe+2]=4*oe+2,W.uint16[pe+3]=4*oe+2,W.uint16[pe+4]=4*oe+3,W.uint16[pe+5]=4*oe+0}return W}(I));const R=f.createIndexBuffer(Kf,!0),z=f.createVertexBuffer(M,RS.members,!0);for(const H of w){const j={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(G=y).getCameraToCenterDistance(H.projection),u_viewport_size:[G.width,G.height]};S.draw(t,_.TRIANGLES,Rr.disabled,Qr.disabled,t.colorModeForRenderPass(),Vr.disabled,j,n.id,z,R,so.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,y.zoom)}var G;z.destroy(),R.destroy()}const aI=Dt.create();function lI({width:t,height:e,anchor:n,textOffset:i,textScale:s},c){const{horizontalAlign:d,verticalAlign:f}=Qg(n),_=-(d-.5)*t,y=-(f-.5)*e,v=Hp(n,i);return new me((_/s+v[0])*c,(y/s+v[1])*c)}function _1(t,e,n,i,s,c,d,f,_,y,v){const w=t.text.placedSymbolArray,I=t.text.dynamicLayoutVertexArray,C=t.icon.dynamicLayoutVertexArray,S={},M=t.getProjection(),P=qf(f,M,c),R=c.elevation,z=M.upVectorScale(f.canonical,c.center.lat,c.worldSize).metersToTile;I.clear();for(let G=0;G<w.length;G++){const H=w.get(G),{tileAnchorX:j,tileAnchorY:W,numGlyphs:oe}=H,pe=H.hidden||!H.crossTileID||t.allowVerticalPlacement&&!H.placedOrientation?null:i[H.crossTileID];if(pe){let ve=0,xe=0,ke=0;if(R){const St=R?R.getAtTileOffset(f,j,W):0,[Ut,Wt,ln]=M.upVector(f.canonical,j,W);ve=St*Ut*z,xe=St*Wt*z,ke=St*ln*z}let[Ae,$e,Ce,nt]=gc(H.projectedAnchorX+ve,H.projectedAnchorY+xe,H.projectedAnchorZ+ke,n?P:d);const ft=qs(c.getCameraToCenterDistance(M),nt);let It=s.evaluateSizeForFeature(t.textSizeData,y,H)*ft/_a;n&&(It*=t.tilePixelRatio/_);const et=lI(pe,It);n?(({x:Ae,y:$e,z:Ce}=M.projectTilePoint(j+et.x,W+et.y,f.canonical)),[Ae,$e,Ce]=gc(Ae+ve,$e+xe,Ce+ke,d)):(e&&et._rotate(-c.angle),Ae+=et.x,$e+=et.y,Ce=0);const it=t.allowVerticalPlacement&&H.placedOrientation===Ao.vertical?Math.PI/2:0;for(let St=0;St<oe;St++)o_(I,Ae,$e,Ce,it);v&&H.associatedIconIndex>=0&&(S[H.associatedIconIndex]={x:Ae,y:$e,z:Ce,angle:it})}else _u(oe,I)}if(v){C.clear();const G=t.icon.placedSymbolArray;for(let H=0;H<G.length;H++){const j=G.get(H),{numGlyphs:W}=j,oe=S[H];if(j.hidden||!oe)_u(W,C);else{const{x:pe,y:ve,z:xe,angle:ke}=oe;for(let Ae=0;Ae<W;Ae++)o_(C,pe,ve,xe,ke)}}t.icon.dynamicLayoutVertexBuffer.updateData(C)}t.text.dynamicLayoutVertexBuffer.updateData(I)}function tD(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function y1(t,e,n,i,s,c,d,f,_,y,v,w){const I=t.context,C=I.gl,S=t.transform,M="map"===f,P="map"===_,R=M&&"point"!==n.layout.get("symbol-placement"),z=M&&!P&&!R,G=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let H=!1;const j=t.depthModeForSublayer(0,Rr.ReadOnly),W=[tl(S.center.lng),Sa(S.center.lat)],oe=n.layout.get("text-variable-anchor"),pe="globe"===S.projection.name,ve=[],xe=[0,-1,0];let ke=xe;!pe&&!S.mercatorFromTransition||M||(ke=function(Ae){const $e=Ae._camera.getWorldToCamera(Ae.worldSize,1),Ce=Dt.multiply([],$e,Ae.globeMatrix);Dt.invert(Ce,Ce);const nt=[0,0,0],ft=[0,1,0,0];return no.transformMat4(ft,ft,Ce),nt[0]=ft[0],nt[1]=ft[1],nt[2]=ft[2],He.normalize(nt,nt),nt}(S));for(const Ae of i){const $e=e.getTile(Ae),Ce=$e.getBucket(n);if(!Ce||"mercator"===Ce.projection.name&&pe)continue;const nt=s?Ce.text:Ce.icon;if(!nt||Ce.fullyClipped||!nt.segments.get().length)continue;const ft=nt.programConfigurations.get(n.id),It=s||Ce.sdfIcons,et=s?Ce.textSizeData:Ce.iconSizeData,it=P||0!==S.pitch,St=kc(et,S.zoom);let Ut,Wt,ln,pn,Yt=[0,0],tn=null;if(s)Wt=$e.glyphAtlasTexture,ln=C.LINEAR,Ut=$e.glyphAtlasTexture.size,Ce.iconsInText&&(Yt=$e.imageAtlasTexture.size,tn=$e.imageAtlasTexture,pn=it||t.options.rotating||t.options.zooming||"composite"===et.kind||"camera"===et.kind?C.LINEAR:C.NEAREST);else{const Qo=1!==n.layout.get("icon-size").constantOr(0)||Ce.iconsNeedLinear;Wt=$e.imageAtlasTexture,ln=It||t.options.rotating||t.options.zooming||Qo||it?C.LINEAR:C.NEAREST,Ut=$e.imageAtlasTexture.size}const Vn="globe"===Ce.projection.name,Jn=Vn?ke:xe,Yn=Vn?el(S.zoom):0,Xn=qf(Ae,Ce.getProjection(),S),yr=S.calculatePixelsToTileUnitsMatrix($e),Fr=l_(Xn,$e.tileID.canonical,P,M,S,Ce.getProjection(),yr),Or=t.terrain&&P&&R?Dt.invert(Dt.create(),Fr):aI,Ci=c_(Xn,$e.tileID.canonical,P,M,S,Ce.getProjection(),yr),Zr=oe&&Ce.hasTextData(),zr=Ce.hasIconTextFit()&&Zr&&Ce.hasIconData();if(R){const Qo=S.elevation,qo=Qo?Qo.getAtTileOffsetFunc(Ae,S.center.lat,S.worldSize,Ce.getProjection()):null,co=Ab(Xn,$e.tileID.canonical,P,M,S,Ce.getProjection(),yr);Nd(Ce,Xn,t,s,co,Ci,P,y,qo,Ae)}const Pr=R||s&&oe||zr,Dr=t.translatePosMatrix(Xn,$e,c,d),ci=Pr?aI:Fr,Pi=t.translatePosMatrix(Ci,$e,c,d,!0),Jr=Ce.getProjection().createInversionMatrix(S,Ae.canonical),Xi=n.paint.get("icon-image-cross-fade").constantOr(0),vo=[];t.terrainRenderModeElevated()&&P&&vo.push("PITCH_WITH_MAP_TERRAIN"),Vn&&(vo.push("PROJECTION_GLOBE_VIEW"),Pr&&vo.push("PROJECTED_POS_ON_VIEWPORT")),Xi>0&&vo.push("ICON_TRANSITION"),nt.zOffsetVertexBuffer&&vo.push("Z_OFFSET");const So=It&&0!==n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1);let xo;xo=It?Ce.iconsInText?_C(et.kind,St,z,P,t,Dr,ci,Pi,Ut,Yt,Ae,Yn,W,Jr,Jn,Ce.getProjection()):H_(et.kind,St,z,P,t,Dr,ci,Pi,s,Ut,!0,Ae,Yn,W,Jr,Jn,Ce.getProjection()):f1(et.kind,St,z,P,t,Dr,ci,Pi,s,Ut,Ae,Yn,W,Jr,Jn,Ce.getProjection(),Xi);const Ns={program:t.getOrCreateProgram(tD(It,s,Ce),{config:ft,defines:vo}),buffers:nt,uniformValues:xo,atlasTexture:Wt,atlasTextureIcon:tn,atlasInterpolation:ln,atlasInterpolationIcon:pn,isSDF:It,hasHalo:So,tile:$e,labelPlaneMatrixInv:Or};if(G&&Ce.canOverlap){H=!0;const Qo=nt.segments.get();for(const qo of Qo)ve.push({segments:new so([qo]),sortKey:qo.sortKey,state:Ns})}else ve.push({segments:nt.segments,sortKey:0,state:Ns})}H&&ve.sort((Ae,$e)=>Ae.sortKey-$e.sortKey);for(const Ae of ve){const $e=Ae.state;if(t.terrain&&t.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:S.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}),I.activeTexture.set(C.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,C.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(I.activeTexture.set(C.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,C.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,$e.program),$e.hasHalo){const Ce=$e.uniformValues;Ce.u_is_halo=1,_0($e.buffers,Ae.segments,n,t,$e.program,j,v,w,Ce,2),Ce.u_is_halo=0}else{if($e.isSDF){const Ce=$e.uniformValues;$e.hasHalo&&(Ce.u_is_halo=1,_0($e.buffers,Ae.segments,n,t,$e.program,j,v,w,Ce,1)),Ce.u_is_halo=0}_0($e.buffers,Ae.segments,n,t,$e.program,j,v,w,$e.uniformValues,1)}}}function _0(t,e,n,i,s,c,d,f,_,y){const v=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];s.draw(i,i.context.gl.TRIANGLES,c,d,f,Vr.disabled,_,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),v,y)}function v1(t,e,n,i,s,c,d){const f=t.context.gl,_=n.paint.get("fill-pattern"),y=_&&_.constantOr(1);let v,w,I,C,S;d?(w=y&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",v=f.LINES):(w=y?"fillPattern":"fill",v=f.TRIANGLES);for(const M of i){const P=e.getTile(M);if(y&&!P.patternsLoaded())continue;const R=P.getBucket(n);if(!R)continue;t.prepareDrawTile();const z=R.programConfigurations.get(n.id),G=t.isTileAffectedByFog(M),H=t.getOrCreateProgram(w,{config:z,overrideFog:G});y&&(t.context.activeTexture.set(f.TEXTURE0),P.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),z.updatePaintBuffers());const j=_.constantOr(null);if(j&&P.imageAtlas){const pe=P.imageAtlas.patternPositions[j.toString()];pe&&z.setConstantPatternPositions(pe)}const W=t.translatePosMatrix(M.projMatrix,P,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),oe=n.paint.get("fill-emissive-strength");if(d){C=R.indexBuffer2,S=R.segments2;const pe=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[f.drawingBufferWidth,f.drawingBufferHeight];I="fillOutlinePattern"===w&&y?hC(W,oe,t,P,pe):m0(W,oe,pe)}else C=R.indexBuffer,S=R.segments,I=y?p0(W,oe,t,P):G_(W,oe);t.uploadCommonUniforms(t.context,H,M.toUnwrapped()),H.draw(t,v,s,t.stencilModeForClipping(M),c,Vr.disabled,I,n.id,R.layoutVertexBuffer,C,S,n.paint,t.transform.zoom,z,void 0)}}function y0(t,e,n,i,s,c,d,f){const _=t.context,y=_.gl,v=t.transform,w=n.paint.get("fill-extrusion-pattern"),I=w.constantOr(1),C=n.paint.get("fill-extrusion-opacity"),S=t.style.enable3dLights(),M=n.paint.get(S&&!I?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),P=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),M],R=n.layout.get("fill-extrusion-edge-radius"),z=R>0&&!n.paint.get("fill-extrusion-rounded-roof"),G=z?0:R,H="globe"===v.projection.name?RE():0,j="globe"===v.projection.name,W=j?el(v.zoom):0,oe=[tl(v.center.lng),Sa(v.center.lat)],pe=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ve=n.paint.get("fill-extrusion-flood-light-intensity"),xe=n.paint.get("fill-extrusion-vertical-scale"),ke=$c(t,n.paint.get("fill-extrusion-cutoff-fade-range")),Ae=[];let $e;j&&Ae.push("PROJECTION_GLOBE_VIEW"),P[0]>0&&Ae.push("FAUX_AO"),z&&Ae.push("ZERO_ROOF_RADIUS"),f&&Ae.push("HAS_CENTROID"),ve>0&&Ae.push("FLOOD_LIGHT"),ke.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const Ce="shadow"===t.renderPass,nt=t.shadowRenderer,ft=Ce&&!!nt;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let It=[0,0,0];if(nt){const it=t.style.directionalLight,St=t.style.ambientLight;it&&St&&(It=E0(it,St)),$e=Ae.concat(["SHADOWS_SINGLE_CASCADE"])}const et=ft?"fillExtrusionDepth":I?"fillExtrusionPattern":"fillExtrusion";for(const it of i){const St=e.getTile(it),Ut=St.getBucket(n);if(!Ut||Ut.projection.name!==v.projection.name)continue;let Wt=!1;nt&&(Wt=0===nt.getMaxCascadeForTile(it.toUnwrapped()));const ln=t.isTileAffectedByFog(it),pn=Ut.programConfigurations.get(n.id),Yt=t.getOrCreateProgram(et,{config:pn,defines:Wt?$e:Ae,overrideFog:ln});if(t.terrain){const Xn=t.terrain;t.style.terrainSetForDrapingOnly(),Xn.setupElevationDraw(St,Yt,{useMeterToDem:!0})}if(!Ut.centroidVertexBuffer){const Xn=Yt.attributes.a_centroid_pos;void 0!==Xn&&y.vertexAttrib2f(Xn,0,0)}!Ce&&nt&&nt.setupShadows(St.tileID.toUnwrapped(),Yt,"vector-tile",St.tileID.overscaledZ),I&&(t.context.activeTexture.set(y.TEXTURE0),St.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),pn.updatePaintBuffers());const tn=w.constantOr(null);if(tn&&St.imageAtlas){const Xn=St.imageAtlas.patternPositions[tn.toString()];Xn&&pn.setConstantPatternPositions(Xn)}const Vn=n.paint.get("fill-extrusion-vertical-gradient");let Jn;if(Ce&&nt){if(Cm(St.tileID,Ut,t))continue;const Xn=nt.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());Jn=iI(Xn,G,xe)}else{const Xn=t.translatePosMatrix(it.projMatrix,St,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),yr=v.projection.createInversionMatrix(v,it.canonical);Jn=I?Tm(Xn,t,Vn,C,P,G,it,St,H,W,oe,yr,pe,xe):rI(Xn,t,Vn,C,P,G,it,H,W,oe,yr,pe,xe,ve,It)}t.uploadCommonUniforms(_,Yt,it.toUnwrapped(),null,ke);const Yn=[];(t.terrain||f)&&Yn.push(Ut.centroidVertexBuffer),j&&Yn.push(Ut.layoutVertexExtBuffer),Yt.draw(t,_.gl.TRIANGLES,s,c,d,Vr.backCCW,Jn,n.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,n.paint,t.transform.zoom,pn,Yn)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function Am(t,e,n,i,s,c,d,f,_,y,v,w,I,C,S,M,P,R,z){const G=t.context,H=G.gl,j=t.transform,W=t.transform.zoom,oe=[],pe=$c(t,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===y?(oe.push("CLEAR_SUBPASS"),z&&(oe.push("CLEAR_FROM_TEXTURE"),G.activeTexture.set(H.TEXTURE0),z.bind(H.LINEAR,H.CLAMP_TO_EDGE))):"sdf"===y&&oe.push("SDF_SUBPASS"),P&&oe.push("HAS_CENTROID"),pe.shouldRenderCutoff&&oe.push("RENDER_CUTOFF");const ve=n.layout.get("fill-extrusion-edge-radius"),xe=(ke,Ae,$e,Ce,nt)=>{const ft=Ae.programConfigurations.get(n.id),It=t.isTileAffectedByFog(ke),et=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:ft,defines:oe,overrideFog:It}),it={u_matrix:Ce,u_opacity:v,u_ao_pass:_?1:0,u_meter_to_tile:nt,u_ao:[w,I*nt],u_flood_light_intensity:C,u_flood_light_color:S,u_attenuation:M,u_edge_radius:W>=17?0:ve*nt,u_fb:0,u_fb_size:z?z.size[0]:0},St=[];P&&St.push(Ae.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(G,et,ke.toUnwrapped(),null,pe),et.draw(t,G.gl.TRIANGLES,s,c,d,f,it,n.id,Ae.vertexBuffer,Ae.indexBuffer,$e,n.paint,W,ft,St)};for(const ke of i){const Ae=e.getTile(ke),$e=Ae.getBucket(n);if(!$e||$e.projection.name!==j.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const Ce=$e.groundEffect,nt=1/$e.tileToMeter;{const ft=t.translatePosMatrix(ke.projMatrix,Ae,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),It=Ce.getDefaultSegment();xe(ke,Ce,It,ft,nt)}if(R)for(let ft=0;ft<4;ft++){const It=mS[ft](ke),et=e.getTile(It);if(!et)continue;const it=et.getBucket(n);if(!it||it.projection.name!==j.projection.name||!it.groundEffect||it.groundEffect&&!it.groundEffect.hasData())continue;const St=it.groundEffect;let Ut,Wt;0===ft?(Ut=[-Vt,0,0],Wt=1):1===ft?(Ut=[Vt,0,0],Wt=0):2===ft?(Ut=[0,-Vt,0],Wt=3):(Ut=[0,Vt,0],Wt=2);const ln=St.regionSegments[Wt];if(!ln)continue;const pn=new Float32Array(16);Dt.translate(pn,ke.projMatrix,Ut),xe(ke,St,ln,t.translatePosMatrix(pn,Ae,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),nt)}}}function nD(t,e,n,i,s,c,d){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const f=c?c.findDEMTileFor(n):null;if(!(f&&f.dem||d))return;const _=R=>{const z=e.getSource().minzoom,G=j=>{const W=e.getTileByID(j);if(W&&W.hasData())return W.getBucket(s)},H=[0,-1,1];for(const j of H){if(R.overscaledZ+j<z)continue;const W=G(R.calculateScaledKey(R.overscaledZ+j));if(W)return W}},y=[0,0,0],v=(R,z)=>(y[0]=Math.min(R.min.y,z.min.y),y[1]=Math.max(R.max.y,z.max.y),y[2]=Vt-z.min.x>R.max.x?z.min.x-Vt:R.max.x,y),w=(R,z)=>(y[0]=Math.min(R.min.x,z.min.x),y[1]=Math.max(R.max.x,z.max.x),y[2]=Vt-z.min.y>R.max.y?z.min.y-Vt:R.max.y,y),I=[(R,z)=>v(R,z),(R,z)=>v(z,R),(R,z)=>w(R,z),(R,z)=>w(z,R)],C=(R,z,G,H,j,W,oe)=>{if(!c)return 0;const pe=[[W?G:R,W?R:G,0],[W?G:z,W?z:G,0]],ve=oe<0?Vt+oe:oe,xe=[W?ve:(R+z)/2,W?(R+z)/2:ve,0];return 0===G&&oe<0||0!==G&&oe>0?c.getForTilePoints(j,[xe],!0,H):pe.push(xe),c.getForTilePoints(n,pe,!0,f),Math.max(pe[0][2],pe[1][2],xe[2])/c.exaggeration()};for(let R=0;R<4;R++){const z=i.borderFeatureIndices[R];if(0===z.length)continue;const G=mS[R](n),H=_(G);if(!(H&&H instanceof lm)||i.borderDoneWithNeighborZ[R]===H.canonical.z)continue;0===H.centroidVertexArray.length&&H.createCentroidsBuffer();const j=c?c.findDEMTileFor(G):null;if(!(j&&j.dem||d))continue;const W=(R<2?1:5)-R,oe=H.borderDoneWithNeighborZ[W]!==i.canonical.z,pe=H.borderFeatureIndices[W];let ve=0;if(i.canonical.z!==H.canonical.z){for(const xe of z)i.showCentroid(i.featuresOnBorder[xe]);if(oe)for(const xe of pe)H.showCentroid(H.featuresOnBorder[xe]);i.borderDoneWithNeighborZ[R]=H.canonical.z,H.borderDoneWithNeighborZ[W]=i.canonical.z}for(const xe of z){const ke=i.featuresOnBorder[xe],Ae=i.centroidData[ke.centroidDataIndex],$e=ke.borders[R];let Ce;for(;ve<pe.length;){Ce=H.featuresOnBorder[pe[ve]];const nt=Ce.borders[W];if(nt[1]>$e[0]+3||nt[0]>$e[0]-3)break;H.showCentroid(Ce),ve++}if(Ce&&ve<pe.length){const nt=ve;let ft=0;for(;!(Ce.borders[W][0]>$e[1]-3)&&(ft++,++ve!==pe.length);)Ce=H.featuresOnBorder[pe[ve]];if(Ce=H.featuresOnBorder[pe[nt]],ft>1){const it=Ce.borders[W];Math.abs($e[0]-it[0])<3&&Math.abs($e[1]-it[1])<3&&(ft=1,ve=nt+1)}else if(0===ft){i.showCentroid(ke);continue}const It=H.centroidData[Ce.centroidDataIndex];d&&1===ft&&(((M=Ae).flags|(P=It).flags)&Rh?(M.flags|=Rh,P.flags|=Rh):(M.flags&=2147483647,P.flags&=2147483647));let et=new me(0,0);if(ft>1)ve=nt;else if(j&&j.dem&&!(ke.intersectsCount()>1||Ce.intersectsCount()>1)){const it=I[R](Ae,It),St=R%2?Vt-1:0;S=C(it[0],Math.min(Vt-1,it[1]),St,j,G,R<2,it[2]),et=new me(Math.ceil(7*(S+450)),0)}Ae.centroidXY=It.centroidXY=et,i.writeCentroidToBuffer(Ae),H.writeCentroidToBuffer(It)}else i.showCentroid(ke)}i.borderDoneWithNeighborZ[R]=H.canonical.z,H.borderDoneWithNeighborZ[W]=i.canonical.z}var S,M,P;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const v0=[1,0,0],yC=[0,1,0],Xf=[0,0,1];function Cm(t,e,n){const i=n.transform,s=n.shadowRenderer;if(!s)return!0;const c=t.toUnwrapped(),d=i.tileSize*s._cascades[n.currentShadowCascade].scale;let f=e.maxHeight;if(i.elevation){const M=i.elevation.getMinMaxForTile(t);M&&(f+=M.max)}const _=[...s.shadowDirection];_[2]=-_[2];const y=s.computeSimplifiedTileShadowVolume(c,f,d,_);if(!y)return!1;const v=[v0,yC,Xf,_,[_[0],0,_[2]],[0,_[1],_[2]]],w="globe"===i.projection.name,I=i.scaleZoom(d),C=La.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,I,!w),S=s.getCurrentCascadeFrustum();return 0===C.intersectsPrecise(y.vertices,y.planes,v)||0===S.intersectsPrecise(y.vertices,y.planes,v)}const x1=new Ur(1,0,0,1),x0=new Ur(0,1,0,1),cI=new Ur(0,0,1,1),vC=new Ur(1,0,1,1),xC=new Ur(0,1,1,1);function rD(t,e,n){const i=t.context,s=t.transform,c=i.gl,d="globe"===s.projection.name,f=d?["PROJECTION_GLOBE_VIEW"]:[];let _=n.projMatrix;if(d&&el(s.zoom)>0){const xe=qT(zx(n.canonical,s));_=Dt.multiply(new Float32Array(16),s.globeMatrix,xe),Dt.multiply(_,s.projMatrix,_)}const y=t.getOrCreateProgram("debug",{defines:f}),v=e.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(v,y);const w=Rr.disabled,I=Qr.disabled,C=t.colorModeForRenderPass(),S="$debug";i.activeTexture.set(c.TEXTURE0),t.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),d?v._makeGlobeTileDebugBuffers(t.context,s):v._makeDebugTileBoundsBuffers(t.context,s.projection);const M=v._tileDebugBuffer||t.debugBuffer,P=v._tileDebugIndexBuffer||t.debugIndexBuffer,R=v._tileDebugSegments||t.debugSegments;y.draw(t,c.LINE_STRIP,w,I,C,Vr.disabled,sI(_,Ur.red),S,M,P,R,null,null,null,[v._globeTileDebugBorderBuffer]);const z=v.latestRawTileData,G=Math.floor((z&&z.byteLength||0)/1024),H=e.getTile(n).tileSize,j=512/Math.min(H,512)*(n.overscaledZ/s.zoom)*.5;let W=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(W+=` => ${n.overscaledZ}`),W+=` ${G}kb`,function(xe,ke){xe.initDebugOverlayCanvas();const Ae=xe.debugOverlayCanvas,$e=xe.context.gl,Ce=xe.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,Ae.width,Ae.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(ke,5,5),Ce.strokeText(ke,5,5),xe.debugOverlayTexture.update(Ae),xe.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(t,W);const oe=v._tileDebugTextBuffer||t.debugBuffer,pe=v._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,ve=v._tileDebugTextSegments||t.debugSegments;y.draw(t,c.TRIANGLES,w,I,Ai.alphaBlended,Vr.disabled,sI(_,Ur.transparent,j),S,oe,pe,ve,null,null,null,[v._globeTileDebugTextBuffer])}function b1(t,e,n,i){b0(t,0,e+n/2,t.transform.width,n,i)}function uI(t,e,n,i){b0(t,e-n/2,0,n,t.transform.height,i)}function b0(t,e,n,i,s,c){const d=t.context,f=d.gl;f.enable(f.SCISSOR_TEST),f.scissor(e*ne.devicePixelRatio,n*ne.devicePixelRatio,i*ne.devicePixelRatio,s*ne.devicePixelRatio),d.clear({color:c}),f.disable(f.SCISSOR_TEST)}const dI=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bC}=dI;function qd(t,e,n,i){t.emplaceBack(e,n,i)}class w1{constructor(e){this.vertexArray=new Sc,this.indices=new Is,qd(this.vertexArray,-1,-1,1),qd(this.vertexArray,1,-1,1),qd(this.vertexArray,-1,1,1),qd(this.vertexArray,1,1,1),qd(this.vertexArray,-1,-1,-1),qd(this.vertexArray,1,-1,-1),qd(this.vertexArray,-1,1,-1),qd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,bC),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=so.simpleSegment(0,0,36,12)}}function Yd(t,e,n,i,s,c){const d=t.context.gl,f=e.paint.get("sky-atmosphere-color"),_=e.paint.get("sky-atmosphere-halo-color"),y=e.paint.get("sky-atmosphere-sun-intensity"),v={u_matrix_3f:yl.fromMat4(yl.create(),i),u_sun_direction:s,u_sun_intensity:y,u_color_tint_r:[(S=f).r,S.g,S.b,S.a],u_color_tint_m:[(M=_).r,M.g,M.b,M.a],u_luminance:5e-5};var S,M;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+c,e.skyboxTexture,0),n.draw(t,d.TRIANGLES,Rr.disabled,Qr.disabled,Ai.unblended,Vr.frontCW,v,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const Sm=Gi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class wC{constructor(e){const n=new _d;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new Is;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(n,Sm.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=so.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const EC=Gi([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hI{constructor(){this.colorModeAlphaBlendedWriteRGB=new Ai([1,771,1,771],Ur.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ai([1,0,1,0],Ur.transparent,[!1,!1,!1,!0])}update(e){const n=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new wC(n);const i=100,s=200,c=function(v){const w=Vm(30),I=[];for(let C=0;C<16e3;++C){const S=2*Math.PI*w(),M=Math.acos(1-2*w())-.5*Math.PI;I.push(He.fromValues(Math.cos(M)*Math.cos(S),Math.cos(M)*Math.sin(S),Math.sin(M)))}return I}(),d=Vm(300),f=new ng,_=new Is;let y=0;for(let v=0;v<c.length;++v){const w=He.scale([],c[v],200),I=Math.max(0,1+.01*i*(1*d()-.5)),C=Math.max(0,1+.01*s*(1*d()-.5));f.emplaceBack(w[0],w[1],w[2],-1,-1,I,C),f.emplaceBack(w[0],w[1],w[2],1,-1,I,C),f.emplaceBack(w[0],w[1],w[2],1,1,I,C),f.emplaceBack(w[0],w[1],w[2],-1,1,I,C),_.emplaceBack(y+0,y+1,y+2),_.emplaceBack(y+0,y+2,y+3),y+=4}this.starsVx=n.createVertexBuffer(f,EC.members),this.starsIdx=n.createIndexBuffer(_),this.starsSegments=so.simpleSegment(0,0,f.length,_.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,n){const i=e.context,s=i.gl,c=e.transform,d=new Rr(s.LEQUAL,Rr.ReadOnly,[0,1]),f=el(c.zoom),_=n.properties.get("color").toArray01(),y=n.properties.get("high-color").toArray01(),v=n.properties.get("space-color").toArray01PremultipliedAlpha(),w=5e-4,I=_n((n.properties.get("horizon-blend")-0)/1*.2495+w,5e-4,.25),C=Xy(e,i,c)&&I===w?c.worldSize/(2*Math.PI*1.025)-1:c.globeRadius,S=e.frameCounter/1e3%1,M=He.length(c.globeCenterInViewSpace),P=Math.sqrt(Math.pow(M,2)-Math.pow(C,2)),R=Math.acos(P/M),z=G=>{const H="globe"===c.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];G&&H.push("ALPHA_PASS");const j=e.getOrCreateProgram("globeAtmosphere",{defines:H}),W={u_frustum_tl:c.frustumCorners.TL,u_frustum_tr:c.frustumCorners.TR,u_frustum_br:c.frustumCorners.BR,u_frustum_bl:c.frustumCorners.BL,u_horizon:c.frustumCorners.horizon,u_transition:f,u_fadeout_range:I,u_color:_,u_high_color:y,u_space_color:v,u_temporal_offset:S,u_horizon_angle:R};e.uploadCommonUniforms(i,j);const oe=this.atmosphereBuffer;oe&&j.draw(e,s.TRIANGLES,d,Qr.disabled,G?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Vr.backCW,W,G?"atmosphere_glow_alpha":"atmosphere_glow",oe.vertexBuffer,oe.indexBuffer,oe.segments)};z(!1),z(!0)}drawStars(e,n){const i=_n(n.properties.get("star-intensity"),0,1);if(0===i)return;const s=e.context,c=s.gl,d=e.transform,f=e.getOrCreateProgram("stars"),_=ia.identity([]);ia.rotateX(_,_,-d._pitch),ia.rotateZ(_,_,-d.angle),ia.rotateX(_,_,De(d._center.lat)),ia.rotateY(_,_,-De(d._center.lng));const y=Dt.fromQuat(new Float32Array(16),_),v=Dt.multiply([],d.starsProjMatrix,y),w=yl.fromMat4([],y),I=yl.invert([],w),C=[0,1,0];He.transformMat3(C,C,I),He.scale(C,C,.15);const S=[1,0,0];He.transformMat3(S,S,I),He.scale(S,S,.15);const M=(R=C,z=S,G=i,{u_matrix:Float32Array.from(v),u_up:R,u_right:z,u_intensity_multiplier:G});var R,z,G;e.uploadCommonUniforms(s,f),this.starsVx&&this.starsIdx&&f.draw(e,c.TRIANGLES,Rr.disabled,Qr.disabled,this.colorModeAlphaBlendedWriteRGB,Vr.disabled,M,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function E1(t,e){const n=[...t],i=e.cameraWorldSizeForFog/e.worldSize,s=Dt.identity([]);return Dt.scale(s,s,[i,i,1]),Dt.multiply(n,s,n),Dt.multiply(n,e.worldToFogMatrix,n),n}function fI(t,e,n,i){const s=n.material,c=i.context,{baseColorTexture:d,metallicRoughnessTexture:f}=s.pbrMetallicRoughness,{normalTexture:_,occlusionTexture:y,emissionTexture:v}=s;function w(I,C,S){if(I&&(t.push(C),c.activeTexture.set(c.gl.TEXTURE0+S),I.gfxTexture)){const{minFilter:M,magFilter:P,wrapS:R,wrapT:z}=I.sampler;I.gfxTexture.bindExtraParam(M,P,R,z)}}w(d,"HAS_TEXTURE_u_baseColorTexture",vc.BaseColor),w(f,"HAS_TEXTURE_u_metallicRoughnessTexture",vc.MetallicRoughness),w(_,"HAS_TEXTURE_u_normalTexture",vc.Normal),w(y,"HAS_TEXTURE_u_occlusionTexture",vc.Occlusion),w(v,"HAS_TEXTURE_u_emissionTexture",vc.Emission),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(n.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function Y_(t,e,n,i,s,c){const d=n.paint.get("model-opacity"),f=e.context,_=new Rr(e.context.gl.LEQUAL,Rr.ReadWrite,e.depthRangeFor3D),y=e.transform,v=t.mesh,w=v.material,I=w.pbrMetallicRoughness,C=e.style.fog;let S;S="pixels"===e.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:Dt.multiply([],i.zScaleMatrix,t.nodeModelMatrix),Dt.multiply(S,i.negCameraPosMatrix,S);const M=Dt.invert([],S);Dt.transpose(M,M);const P=q_(new Float32Array(t.worldViewProjection),new Float32Array(S),new Float32Array(M),e,d,I.baseColorFactor,w.emissiveFactor,I.metallicFactor,I.roughnessFactor,w,n),R={defines:[]},z=[];fI(R.defines,z,v,e);const G=e.shadowRenderer;G&&(G.useNormalOffset=!1);let H=null;if(C){const oe=E1(t.nodeModelMatrix,e.transform);if(H=new Float32Array(oe),"globe"!==y.projection.name){const pe=v.aabb.min,ve=v.aabb.max,[xe,ke]=C.getOpacityForBounds(oe,pe[0],pe[1],ve[0],ve[1]);R.overrideFog=xe>=yu||ke>=yu}}const j=$c(e,n.paint.get("model-cutoff-fade-range"));j.shouldRenderCutoff&&R.defines.push("RENDER_CUTOFF");const W=e.getOrCreateProgram("model",R);e.uploadCommonUniforms(f,W,null,H,j),"shadow"!==e.renderPass&&G&&G.setupShadowsFromMatrix(t.nodeModelMatrix,W),W.draw(e,f.gl.TRIANGLES,_,s,c,v.material.doubleSided?Vr.disabled:Vr.backCCW,P,n.id,v.vertexBuffer,v.indexBuffer,v.segments,n.paint,e.transform.zoom,void 0,z)}function Z_(t,e,n,i,s,c,d){let f;f="globe"===t.projection.name?Qs(n,t):[...n],Dt.multiply(f,f,e.matrix);const _=Dt.multiply([],i,f);if(e.meshes)for(const y of e.meshes){if("BLEND"!==y.material.alphaMode){d.push({mesh:y,depth:0,modelIndex:s,worldViewProjection:_,nodeModelMatrix:f});continue}const v=He.transformMat4([],y.centroid,_);v[2]>0&&c.push({mesh:y,depth:v[2],modelIndex:s,worldViewProjection:_,nodeModelMatrix:f})}if(e.children)for(const y of e.children)Z_(t,y,n,i,s,c,d)}function I1(t,e,n,i){const s=n.shadowRenderer;if(!s)return;const c=s.getShadowPassDepthMode(),d=s.getShadowPassColorMode(),f=s.calculateShadowPassMatrixFromMatrix(e),_=g0(f);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,c,Qr.disabled,d,Vr.backCCW,_,i.id,t.vertexBuffer,t.indexBuffer,t.segments,i.paint,n.transform.zoom,void 0,void 0)}function ZD(t,e,n){const i=e.updateZoomBasedPaintProperties(),s=function(c,d,f){let _,y,v,w=c.terrain?c.terrain.exaggeration():0;if(c.terrain&&w>0){const I=c.terrain,C=I.findDEMTileFor(f);C&&C.dem?_=Bu.create(I,f,C):w=0}if(0===w&&(d.terrainElevationMin=0,d.terrainElevationMax=0),w===d.validForExaggeration&&(0===w||_&&_._demTile&&_._demTile.tileID===d.validForDEMTile.id&&_._dem._timestamp===d.validForDEMTile.timestamp))return!1;for(const I in d.instancesPerModel){const C=d.instancesPerModel[I];for(let S=0;S<C.instancedDataArray.length;++S){const M=(_?w*_.getElevationAt(0|C.instancedDataArray.float32[16*S],0|C.instancedDataArray.float32[16*S+1],!0,!0):0)+C.instancesEvaluatedElevation[S];C.instancedDataArray.float32[16*S+6]=M,y=y?Math.min(d.terrainElevationMin,M):M,v=v?Math.max(d.terrainElevationMax,M):M}}return d.terrainElevationMin=y||0,d.terrainElevationMax=v||0,d.validForExaggeration=w,d.validForDEMTile=_&&_._demTile?{id:_._demTile.tileID,timestamp:_._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,n);(i||s)&&(e.uploaded=!1,e.upload(t.context))}const Zd={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new bo([0,0,0],[Vt,Vt,0])};function Gl(t,e){const n=1<<t.canonical.z,i=e.getFreeCameraOptions().position,s=e.elevation,c=t.canonical.x/n,d=(t.canonical.x+1)/n,f=t.canonical.y/n,_=(t.canonical.y+1)/n;let y=e._centerAltitude;if(s){const C=s.getMinMaxForTile(t);C&&C.max>y&&(y=C.max)}const v=_n(i.x,c,d)-i.x,w=_n(i.y,f,_)-i.y,I=Zi(y,e.center.lat)-i.z;return e._zoomFromMercatorZ(Math.sqrt(v*v+w*w+I*I))}function IC(t,e,n,i,s,c,d){const f=t.context,_="shadow"===t.renderPass,y=t.shadowRenderer,v=_&&y?y.getShadowPassDepthMode():new Rr(f.gl.LEQUAL,Rr.ReadWrite,t.depthRangeFor3D),w=t.isTileAffectedByFog(c);if(n.meshes)for(const I of n.meshes){const C=["MODEL_POSITION_ON_GPU"],S=[];let M,P,R;i.instancedDataArray.length>20&&C.push("INSTANCED_ARRAYS");const z=$c(t,e.paint.get("model-cutoff-fade-range"));if(z.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),_&&y)M=t.getOrCreateProgram("modelDepth",{defines:C}),P=g0(d.shadowTileMatrix,d.shadowTileMatrix,Float32Array.from(n.matrix)),R=y.getShadowPassColorMode();else{fI(C,S,I,t),M=t.getOrCreateProgram("model",{defines:C,overrideFog:w});const H=I.material,j=H.pbrMetallicRoughness,W=e.paint.get("model-opacity");P=q_(c.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),t,W,j.baseColorFactor,H.emissiveFactor,j.metallicFactor,j.roughnessFactor,H,e,s),y&&(d.shadowUniformsInitialized?M.setShadowUniformValues(f,y.getShadowUniformValues()):(y.setupShadows(c.toUnwrapped(),M,"model-tile",c.overscaledZ),d.shadowUniformsInitialized=!0)),R=z.shouldRenderCutoff||W<1||"OPAQUE"!==H.alphaMode?Ai.alphaBlended:Ai.unblended}t.uploadCommonUniforms(f,M,c.toUnwrapped(),null,z);const G=I.material.doubleSided?Vr.disabled:Vr.backCCW;if(i.instancedDataArray.length>20)S.push(i.instancedDataBuffer),M.draw(t,f.gl.TRIANGLES,v,Qr.disabled,R,G,P,e.id,I.vertexBuffer,I.indexBuffer,I.segments,e.paint,t.transform.zoom,void 0,S,i.instancedDataArray.length);else{const H=_?"u_instance":"u_normal_matrix";for(let j=0;j<i.instancedDataArray.length;++j)P[H]=new Float32Array(i.instancedDataArray.arrayBuffer,64*j,16),M.draw(t,f.gl.TRIANGLES,v,Qr.disabled,R,G,P,e.id,I.vertexBuffer,I.indexBuffer,I.segments,e.paint,t.transform.zoom,void 0,S)}}if(n.children)for(const I of n.children)IC(t,e,I,i,s,c,d)}const TC=[1,-1,1];function Qf(t,e,n,i){if(!n.modelManager)return!0;const s=n.modelManager;if(!n.shadowRenderer)return!0;const c=n.shadowRenderer,d=e.aabb;let f=!0,_=t.maxHeight;if(0===_){let v=0;for(const w in t.instancesPerModel){const I=s.getModel(w,i);I?v=Math.max(v,Math.max(Math.max(I.aabb.max[0],I.aabb.max[1]),I.aabb.max[2])):f=!1}_=t.maxScale*v*1.41+t.maxVerticalOffset,f&&(t.maxHeight=_)}d.max[2]=_,d.min[2]+=t.terrainElevationMin,d.max[2]+=t.terrainElevationMax,He.transformMat4(d.min,d.min,e.tileMatrix),He.transformMat4(d.max,d.max,e.tileMatrix);const y=d.intersects(c.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===y),0===y}class K_{}class T1{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,n,i){{const w=this._storage.get(n.id);if(w)return w.lastUsedFrameIdx=e,w.buf}const s=i.gl,c=s.getBufferParameter(s.ELEMENT_ARRAY_BUFFER,s.BUFFER_SIZE),d=new ArrayBuffer(c),f=new Int16Array(d);s.getBufferSubData(s.ELEMENT_ARRAY_BUFFER,0,new Int16Array(d));const _=new gd;for(let w=0;w<c/2;w+=3){const I=f[w],C=f[w+1],S=f[w+2];_.emplaceBack(I,C),_.emplaceBack(C,S),_.emplaceBack(S,I)}const y=i.bindVertexArrayOES.current,v=new K_;return v.buf=new mE(i,_),v.lastUsedFrameIdx=e,this._storage.set(n.id,v),i.bindVertexArrayOES.set(y),v.buf}update(e){for(const[n,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(n))}destroy(){for(const[e,n]of this._storage)n.buf.destroy(),this._storage.delete(e)}}const AC={symbol:function(t,e,n,i,s){if("translucent"!==t.renderPass)return;const c=Qr.disabled,d=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(f,_,y,v,w,I,C){const S=_.transform,M="map"===w,P="map"===I;for(const R of f){const z=v.getTile(R),G=z.getBucket(y);if(!G||!G.text||!G.text.segments.get().length)continue;const H=kc(G.textSizeData,S.zoom),j=qf(R,G.getProjection(),S),W=S.calculatePixelsToTileUnitsMatrix(z),oe=l_(j,z.tileID.canonical,P,M,S,G.getProjection(),W),pe=G.hasIconTextFit()&&G.hasIconData();if(H){const ve=Math.pow(2,S.zoom-z.tileID.overscaledZ);_1(G,M,P,C,fA,S,oe,R,ve,H,pe)}}}(i,t,n,e,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),s),0!==n.paint.get("icon-opacity").constantOr(1)&&y1(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),c,d),0!==n.paint.get("text-opacity").constantOr(1)&&y1(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),c,d),e.map.showCollisionBoxes&&(g1(t,e,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),g1(t,e,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,n,i){if("translucent"!==t.renderPass)return;const s=n.paint.get("circle-opacity"),c=n.paint.get("circle-stroke-width"),d=n.paint.get("circle-stroke-opacity"),f=void 0!==n.layout.get("circle-sort-key").constantOr(1),_=n.paint.get("circle-emissive-strength");if(0===s.constantOr(1)&&(0===c.constantOr(1)||0===d.constantOr(1)))return;const y=t.context,v=y.gl,w=t.transform,I=t.depthModeForSublayer(0,Rr.ReadOnly),C=Qr.disabled,S=t.colorModeForDrapableLayerRenderPass(_),M="globe"===w.projection.name,P=[tl(w.center.lng),Sa(w.center.lat)],R=[];for(let G=0;G<i.length;G++){const H=i[G],j=e.getTile(H),W=j.getBucket(n);if(!W||W.projection.name!==w.projection.name)continue;const oe=W.programConfigurations.get(n.id),pe=eA(n),ve=t.isTileAffectedByFog(H);M&&pe.push("PROJECTION_GLOBE_VIEW");const xe=t.getOrCreateProgram("circle",{config:oe,defines:pe,overrideFog:ve}),ke=W.layoutVertexBuffer,Ae=W.globeExtVertexBuffer,$e=W.indexBuffer,Ce=w.projection.createInversionMatrix(w,H.canonical),nt={programConfiguration:oe,program:xe,layoutVertexBuffer:ke,globeExtVertexBuffer:Ae,indexBuffer:$e,uniformValues:Yx(t,H,j,Ce,P,n),tile:j};if(f){const ft=W.segments.get();for(const It of ft)R.push({segments:new so([It]),sortKey:It.sortKey,state:nt})}else R.push({segments:W.segments,sortKey:0,state:nt})}f&&R.sort((G,H)=>G.sortKey-H.sortKey);const z={useDepthForOcclusion:w.depthOcclusionForSymbolsAndCircles};for(const G of R){const{programConfiguration:H,program:j,layoutVertexBuffer:W,globeExtVertexBuffer:oe,indexBuffer:pe,uniformValues:ve,tile:xe}=G.state,ke=G.segments;t.terrain&&t.terrain.setupElevationDraw(xe,j,z),t.uploadCommonUniforms(y,j,xe.tileID.toUnwrapped()),j.draw(t,v.TRIANGLES,I,C,S,Vr.disabled,ve,n.id,W,pe,ke,n.paint,w.zoom,H,[oe])}},heatmap:function(t,e,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const s=t.context,c=s.gl,d=Qr.disabled,f=new Ai([c.ONE,c.ONE,c.ONE,c.ONE],Ur.transparent,[!0,!0,!0,!0]);(function(C,S,M,P){const R=C.gl,z=S.width*P,G=S.height*P;C.activeTexture.set(R.TEXTURE1),C.viewport.set([0,0,z,G]);let H=M.heatmapFbo;if(!H||H&&(H.width!==z||H.height!==G)){H&&H.destroy();const j=R.createTexture();R.bindTexture(R.TEXTURE_2D,j),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),H=M.heatmapFbo=C.createFramebuffer(z,G,!0,null),function(W,oe,pe,ve,xe,ke){const Ae=W.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,W.extRenderToTextureHalfFloat?Ae.RGBA16F:Ae.RGBA,xe,ke,0,Ae.RGBA,W.extRenderToTextureHalfFloat?Ae.HALF_FLOAT:Ae.UNSIGNED_BYTE,null),ve.colorAttachment.set(pe)}(C,0,j,H,z,G)}else R.bindTexture(R.TEXTURE_2D,H.colorAttachment.get()),C.bindFramebuffer.set(H.framebuffer)})(s,t,n,"globe"===t.transform.projection.name?.5:.25),s.clear({color:Ur.transparent});const _=t.transform,y="globe"===_.projection.name,v=y?["PROJECTION_GLOBE_VIEW"]:[],w=y?Vr.frontCCW:Vr.disabled,I=[tl(_.center.lng),Sa(_.center.lat)];for(let C=0;C<i.length;C++){const S=i[C];if(e.hasRenderableParent(S))continue;const M=e.getTile(S),P=M.getBucket(n);if(!P||P.projection.name!==_.projection.name)continue;const R=t.isTileAffectedByFog(S),z=P.programConfigurations.get(n.id),G=t.getOrCreateProgram("heatmap",{config:z,defines:v,overrideFog:R}),{zoom:H}=t.transform;t.terrain&&t.terrain.setupElevationDraw(M,G),t.uploadCommonUniforms(s,G,S.toUnwrapped());const j=_.projection.createInversionMatrix(_,S.canonical);G.draw(t,c.TRIANGLES,Rr.disabled,d,f,w,h1(t,S,M,j,I,H,n.paint.get("heatmap-intensity")),n.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,n.paint,t.transform.zoom,z,y?[P.globeExtVertexBuffer]:null)}s.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(s,c){const d=s.context,f=d.gl,_=c.heatmapFbo;if(!_)return;d.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,_.colorAttachment.get()),d.activeTexture.set(f.TEXTURE1);let y=c.colorRampTexture;y||(y=c.colorRampTexture=new ls(d,c.colorRamp,f.RGBA)),y.bind(f.LINEAR,f.CLAMP_TO_EDGE),s.getOrCreateProgram("heatmapTexture").draw(s,f.TRIANGLES,Rr.disabled,Qr.disabled,s.colorModeForRenderPass(),Vr.disabled,{u_image:0,u_color_ramp:1,u_opacity:c.paint.get("heatmap-opacity")},c.id,s.viewportBuffer,s.quadTriangleIndexBuffer,s.viewportSegments,c.paint,s.transform.zoom)}(t,n))},line:function(t,e,n,i){if("translucent"!==t.renderPass)return;const s=n.paint.get("line-opacity"),c=n.paint.get("line-width");if(0===s.constantOr(1)||0===c.constantOr(1))return;const d=n.paint.get("line-emissive-strength"),f=t.depthModeForSublayer(0,Rr.ReadOnly),_=t.colorModeForDrapableLayerRenderPass(d),y=t.terrain&&t.terrain.renderingToTexture?1:ne.devicePixelRatio,v=n.paint.get("line-dasharray"),w=v.constantOr(1),I=n.layout.get("line-cap"),C=n.paint.get("line-pattern"),S=C.constantOr(1),M=n.paint.get("line-pattern").constantOr(1),P=1!==n.paint.get("line-opacity").constantOr(1);let R=!M&&P;const z=n.paint.get("line-gradient"),G=S?"linePattern":"line",H=t.context,j=H.gl,W=Ub(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(R=!1);for(const oe of i){const pe=e.getTile(oe);if(S&&!pe.patternsLoaded())continue;const ve=pe.getBucket(n);if(!ve)continue;t.prepareDrawTile();const xe=ve.programConfigurations.get(n.id),ke=t.isTileAffectedByFog(oe),Ae=t.getOrCreateProgram(G,{config:xe,defines:W,overrideFog:ke}),$e=C.constantOr(null);if($e&&pe.imageAtlas){const Ut=pe.imageAtlas.patternPositions[$e.toString()];Ut&&xe.setConstantPatternPositions(Ut)}const Ce=v.constantOr(null),nt=I.constantOr(null);if(!S&&Ce&&nt&&pe.lineAtlas){const Ut=pe.lineAtlas.getDash(Ce,nt);Ut&&xe.setConstantPatternPositions(Ut)}let[ft,It]=n.paint.get("line-trim-offset");("round"===nt||"square"===nt)&&ft!==It&&(0===ft&&(ft-=1),1===It&&(It+=1));const et=t.terrain?oe.projMatrix:null,it=S?kE(t,pe,n,et,y):OE(t,pe,n,et,ve.lineClipsArray.length,y,[ft,It]);if(z){const Ut=ve.gradients[n.id];let Wt=Ut.texture;if(n.gradientVersion!==Ut.version){let ln=256;if(n.stepInterpolant){const pn=e.getSource().maxzoom,Yt=oe.canonical.z===pn?Math.ceil(1<<t.transform.maxZoom-oe.canonical.z):1;ln=_n(Hn(ve.maxLineLength/Vt*1024*Yt),256,H.maxTextureSize)}Ut.gradient=bl({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:ln,image:Ut.gradient||void 0,clips:ve.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new ls(H,Ut.gradient,j.RGBA),Ut.version=n.gradientVersion,Wt=Ut.texture}H.activeTexture.set(j.TEXTURE1),Wt.bind(n.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}w&&(H.activeTexture.set(j.TEXTURE0),pe.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),xe.updatePaintBuffers()),S&&(H.activeTexture.set(j.TEXTURE0),pe.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),xe.updatePaintBuffers()),t.uploadCommonUniforms(H,Ae,oe.toUnwrapped());const St=Ut=>{Ae.draw(t,j.TRIANGLES,f,Ut,_,Vr.disabled,it,n.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,n.paint,t.transform.zoom,xe,[ve.layoutVertexBuffer2])};if(R){const Ut=t.stencilModeForClipping(oe).ref;0===Ut&&t.terrain&&H.clear({stencil:0});const Wt={func:j.EQUAL,mask:255};it.u_alpha_discard_threshold=.8,St(new Qr(Wt,Ut,255,j.KEEP,j.KEEP,j.INVERT)),it.u_alpha_discard_threshold=0,St(new Qr(Wt,Ut,255,j.KEEP,j.KEEP,j.KEEP))}else St(t.stencilModeForClipping(oe))}R&&(t.resetStencilClippingMasks(),t.terrain&&H.clear({stencil:0}))},fill:function(t,e,n,i){const s=n.paint.get("fill-color"),c=n.paint.get("fill-opacity");if(0===c.constantOr(1))return;const d=n.paint.get("fill-emissive-strength"),f=t.colorModeForDrapableLayerRenderPass(d),_=n.paint.get("fill-pattern"),y=t.opaquePassEnabledForLayer()&&!_.constantOr(1)&&1===s.constantOr(Ur.transparent).a&&1===c.constantOr(0)?"opaque":"translucent";if(t.renderPass===y){const v=t.depthModeForSublayer(1,"opaque"===t.renderPass?Rr.ReadWrite:Rr.ReadOnly);v1(t,e,n,i,v,f,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const v=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Rr.ReadOnly);v1(t,e,n,i,v,f,!0)}},"fill-extrusion":function(t,e,n,i){const s=n.paint.get("fill-extrusion-opacity"),c=t.context,d=c.gl,f=t.terrain,_=f&&f.renderingToTexture,y=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===s)return;const v=t.conflationActive&&t.layerUsedInConflation(n,e.getSource());if(v&&function(w,I,C,S){for(const M of S){const P=I.getTile(M).getBucket(C);P&&(P.updateReplacement(M,w.replacementSource),P.uploadCentroid(w.context))}}(t,e,n,i),f||v)for(const w of i){const I=e.getTile(w).getBucket(n);I&&nD(t.context,e,w,I,n,f,v)}if("shadow"===t.renderPass&&t.shadowRenderer){const w=t.shadowRenderer;if(f&&s<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof _r)return;const I=w.getShadowPassDepthMode(),C=w.getShadowPassColorMode();y0(t,e,n,i,I,Qr.disabled,C,v)}else if("translucent"===t.renderPass){const w=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!_){const I=new Rr(t.context.gl.LEQUAL,Rr.ReadWrite,t.depthRangeFor3D);0===y&&1===s&&w?y0(t,e,n,i,I,Qr.disabled,Ai.unblended,v):(y0(t,e,n,i,I,Qr.disabled,Ai.disabled,v),y0(t,e,n,i,I,t.stencilModeFor3D(),t.colorModeForRenderPass(),v),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&w&&(!f&&"globe"!==t.transform.projection.name||_)){const I=n.paint.get("fill-extrusion-opacity"),C=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),S=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),M=n.paint.get("fill-extrusion-flood-light-intensity"),P=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),R=C>0&&S>0,z=M>0,G=(j,W,oe)=>(1-oe)*j+oe*W,H=j=>{const W=t.depthModeForSublayer(1,Rr.ReadOnly,d.LEQUAL,!0),oe=n.paint.get(j?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=G(.1,3,oe),ve=t._showOverdrawInspector;if(!ve){const xe=new Qr({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),ke=new Ai([d.ONE,d.ONE,d.ONE,d.ONE],Ur.transparent,[!1,!1,!1,!0],d.MIN);Am(t,e,n,i,W,xe,ke,Vr.disabled,j,"sdf",I,C,S,M,P,pe,v,!1)}{const xe=ve?Qr.disabled:new Qr({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),ke=ve?t.colorModeForRenderPass():new Ai([d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA,d.ONE,d.ONE],Ur.transparent,[!0,!0,!0,!0]);Am(t,e,n,i,W,xe,ke,Vr.disabled,j,"color",I,C,S,M,P,pe,v,!1)}};if(_){const j=(W,oe,pe)=>{const ve=t.depthModeForSublayer(1,Rr.ReadOnly,d.LEQUAL,!1),xe=n.paint.get(W?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=G(.1,3,xe);{const Ae=new Ai([d.ONE,d.ONE,d.ONE,d.ONE],Ur.transparent,[!1,!1,!1,!0]);Am(t,e,n,i,ve,Qr.disabled,Ae,Vr.disabled,W,"clear",I,C,S,M,P,ke,v,oe)}{const Ae=new Qr({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),$e=new Ai([d.ONE,d.ONE,d.ONE,d.ONE],Ur.transparent,[!1,!1,!1,!0],d.MIN);Am(t,e,n,i,ve,Ae,$e,Vr.disabled,W,"sdf",I,C,S,M,P,ke,v,oe)}{const Ae=W?d.ZERO:d.ONE_MINUS_DST_ALPHA,$e=new Qr({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),Ce=new Ai([Ae,d.DST_ALPHA,d.ONE_MINUS_DST_ALPHA,d.ZERO],Ur.transparent,[!0,!0,!0,!0]);Am(t,e,n,i,ve,$e,Ce,Vr.disabled,W,"color",I,C,S,M,P,ke,v,oe)}{const Ae=new Ai([d.ONE,d.ONE,d.ONE,W?d.ZERO:d.ONE],Ur.transparent,[!1,!1,!1,!0],W?d.FUNC_ADD:d.MAX);Am(t,e,n,i,ve,Qr.disabled,Ae,Vr.disabled,W,"clear",I,C,S,M,P,ke,v,oe,pe)}};if(R||z){let W;if(t.prepareDrawTile(),f){const oe=f.drapeBufferSize[0],pe=f.drapeBufferSize[1];W=f.framebufferCopyTexture,W&&(!W||W.size[0]===oe&&W.size[1]===pe)||(W&&W.destroy(),W=f.framebufferCopyTexture=new ls(c,new Ki({width:oe,height:pe}),d.RGBA)),W.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,oe,pe,0)}R&&j(!0,!1,W),z&&j(!1,!0,W)}}else R&&H(!0),z&&H(!1)}}},hillshade:function(t,e,n,i){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const s=t.context,c=t.terrain&&t.terrain.renderingToTexture,[d,f]="translucent"!==t.renderPass||c?[{},i]:t.stencilConfigForOverlap(i);for(const _ of f){const y=e.getTile(_);if(y.needsHillshadePrepare&&"offscreen"===t.renderPass)QE(t,y,n);else if("translucent"===t.renderPass){const v=t.depthModeForSublayer(0,Rr.ReadOnly),w=n.paint.get("hillshade-emissive-strength"),I=t.colorModeForDrapableLayerRenderPass(w),C=c&&t.terrain?t.terrain.stencilModeForRTTOverlap(_):d[_.overscaledZ];XE(t,_,y,n,v,C,I)}}s.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,n,i,s,c){if("translucent"!==t.renderPass||0===n.paint.get("raster-opacity"))return;const d=t.context,f=d.gl,_=e.getSource(),y=function(G,H,j){const W=[];let oe,pe;if(G.paint.get("raster-color")){W.push("RASTER_COLOR"),oe=G.paint.get("raster-color-mix"),pe=G.paint.get("raster-color-range"),H.activeTexture.set(j.TEXTURE2);let ve=G.colorRampTexture;ve||(ve=G.colorRampTexture=new ls(H,G.colorRamp,j.RGBA)),ve.bind(j.LINEAR,j.CLAMP_TO_EDGE)}return{mix:oe,range:pe,defines:W}}(n,d,f),v=y.defines;let w=!1;if(_ instanceof $d&&!i.length){if("globe"!==t.transform.projection.name)return;if(_.onNorthPole)w=!0,v.push("PROJECTION_GLOBE_VIEW");else{if(!_.onSouthPole)return;w=!0,v.push("PROJECTION_GLOBE_VIEW")}}const I=t.colorModeForDrapableLayerRenderPass(),C=t.terrain&&t.terrain.renderingToTexture,S=!t.options.moving,M="nearest"===n.paint.get("raster-resampling")?f.NEAREST:f.LINEAR;if(w){const G=e.getSource();if(!(G instanceof $d))return;const H=G.texture;if(!H)return;const j=t.globeSharedBuffers;if(!j)return;const W=new Rr(f.LEQUAL,Rr.ReadWrite,t.depthRangeFor3D),oe=Float32Array.from(t.transform.projMatrix);let pe=BD(0,0,t.transform);const ve=Float32Array.from(Cg(au(new vh(0,0,0)))),xe={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),d.activeTexture.set(f.TEXTURE0),H.bind(M,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE1),H.bind(M,f.CLAMP_TO_EDGE),H.useMipmap&&d.extTextureFilterAnisotropic&&t.transform.pitch>20&&f.texParameterf(f.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const[ke,Ae,$e,Ce]=j.getPoleBuffers(0,!0);let nt;G.onNorthPole?(nt=ke,t.renderDefaultNorthPole=!1):(pe=Dt.scale(Dt.create(),pe,[1,-1,1]),nt=Ae,t.renderDefaultSouthPole=!1);const ft=Ra(oe,ve,pe,[0,0],1,xe,n,G.perspectiveTransform||[0,0],2,y.mix||[0,0,0,0],y.range||[0,0]),It=t.getOrCreateProgram("raster",{defines:y.defines});return t.uploadCommonUniforms(d,It,null),void It.draw(t,f.TRIANGLES,W,Qr.disabled,I,Vr.disabled,ft,n.id,nt,$e,Ce)}if(!i.length)return;const[P,R]=_ instanceof $d||C?[{},i]:t.stencilConfigForOverlap(i),z=R[R.length-1].overscaledZ;for(const G of R){const H=C?Rr.disabled:t.depthModeForSublayer(G.overscaledZ-z,1===n.paint.get("raster-opacity")?Rr.ReadWrite:Rr.ReadOnly,f.LESS),j=G.toUnwrapped(),W=e.getTile(G);if(C&&(!W||!W.hasData())||!W.texture)continue;const oe=C?G.projMatrix:t.transform.calculateProjMatrix(j,S),pe=t.terrain&&C?t.terrain.stencilModeForRTTOverlap(G):P[G.overscaledZ],ve=c?0:n.paint.get("raster-fade-duration");W.registerFadeDuration(ve);const xe=e.findLoadedParent(G,0),ke=Uh(W,xe,e,t.transform,ve);let Ae,$e;t.terrain&&t.terrain.prepareDrawTile(),d.activeTexture.set(f.TEXTURE0),W.texture.bind(M,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE1),xe?(xe.texture.bind(M,f.CLAMP_TO_EDGE),Ae=Math.pow(2,xe.tileID.overscaledZ-W.tileID.overscaledZ),$e=[W.tileID.canonical.x*Ae%1,W.tileID.canonical.y*Ae%1]):W.texture.bind(M,f.CLAMP_TO_EDGE),W.texture.useMipmap&&d.extTextureFilterAnisotropic&&t.transform.pitch>20&&f.texParameterf(f.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const Ce=_ instanceof $d?_.perspectiveTransform:[0,0],nt=new Float32Array(16),ft=Ra(oe,nt,nt,$e||[0,0],Ae||1,ke,n,Ce,2,y.mix||[0,0,0,0],y.range||[0,0]),It=t.isTileAffectedByFog(G),et=t.getOrCreateProgram("raster",{defines:y.defines,overrideFog:It});if(t.uploadCommonUniforms(d,et,j),_ instanceof $d)_.boundsBuffer&&_.boundsSegments&&et.draw(t,f.TRIANGLES,H,Qr.disabled,I,Vr.disabled,ft,n.id,_.boundsBuffer,t.quadTriangleIndexBuffer,_.boundsSegments);else{const{tileBoundsBuffer:it,tileBoundsIndexBuffer:St,tileBoundsSegments:Ut}=t.getTileBoundsBuffers(W);et.draw(t,f.TRIANGLES,H,pe,I,Vr.disabled,ft,n.id,it,St,Ut)}}t.resetStencilClippingMasks()},background:function(t,e,n,i){const s=n.paint.get("background-color"),c=n.paint.get("background-opacity"),d=n.paint.get("background-emissive-strength");if(0===c)return;const f=t.context,_=f.gl,y=t.transform,v=y.tileSize,w=n.paint.get("background-pattern");if(t.isPatternMissing(w,n.scope))return;const I=!w&&1===s.a&&1===c&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==I)return;const C=Qr.disabled,S=t.depthModeForSublayer(0,"opaque"===I?Rr.ReadWrite:Rr.ReadOnly),M=t.colorModeForDrapableLayerRenderPass(d),P=w?"backgroundPattern":"background";let R,z=i;z||(R=t.getBackgroundTiles(),z=Object.values(R).map(G=>G.tileID)),w&&(f.activeTexture.set(_.TEXTURE0),t.imageManager.bind(t.context,n.scope));for(const G of z){const H=t.isTileAffectedByFog(G),j=t.getOrCreateProgram(P,{overrideFog:H}),W=G.toUnwrapped(),oe=i?G.projMatrix:t.transform.calculateProjMatrix(W);t.prepareDrawTile();const pe=e?e.getTile(G):R?R[G.key]:new qn(G,v,y.zoom,t),ve=w?p1(oe,d,c,t,w,n.scope,{tileID:G,tileSize:v}):W_(oe,d,c,s);t.uploadCommonUniforms(f,j,W);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:ke,tileBoundsSegments:Ae}=t.getTileBoundsBuffers(pe);j.draw(t,_.TRIANGLES,S,C,M,Vr.disabled,ve,n.id,xe,ke,Ae)}},sky:function(t,e,n){const i=t._atmosphere?el(t.transform.zoom):1,s=n.paint.get("sky-opacity")*i;if(0===s)return;const c=t.context,d=n.paint.get("sky-type"),f=new Rr(c.gl.LEQUAL,Rr.ReadOnly,[0,1]),_=t.frameCounter/1e3%1;"atmosphere"===d?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(y,v,w,I){const C=y.context,S=C.gl;let M=v.skyboxFbo;if(!M){M=v.skyboxFbo=C.createFramebuffer(32,32,!0,null),v.skyboxGeometry=new w1(C),v.skyboxTexture=C.gl.createTexture(),S.bindTexture(S.TEXTURE_CUBE_MAP,v.skyboxTexture),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR);for(let G=0;G<6;++G)S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+G,0,S.RGBA,32,32,0,S.RGBA,S.UNSIGNED_BYTE,null)}C.bindFramebuffer.set(M.framebuffer),C.viewport.set([0,0,32,32]);const P=v.getCenter(y,!0),R=y.getOrCreateProgram("skyboxCapture"),z=new Float64Array(16);Dt.identity(z),Dt.rotateY(z,z,.5*-Math.PI),Yd(y,v,R,z,P,0),Dt.identity(z),Dt.rotateY(z,z,.5*Math.PI),Yd(y,v,R,z,P,1),Dt.identity(z),Dt.rotateX(z,z,.5*-Math.PI),Yd(y,v,R,z,P,2),Dt.identity(z),Dt.rotateX(z,z,.5*Math.PI),Yd(y,v,R,z,P,3),Dt.identity(z),Yd(y,v,R,z,P,4),Dt.identity(z),Dt.rotateY(z,z,Math.PI),Yd(y,v,R,z,P,5),C.viewport.set([0,0,y.width,y.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(y,v,w,I,C){const S=y.context,M=S.gl,P=y.transform,R=y.getOrCreateProgram("skybox");S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_CUBE_MAP,v.skyboxTexture);const z={u_matrix:P.skyboxMatrix,u_sun_direction:v.getCenter(y,!1),u_cubemap:0,u_opacity:I,u_temporal_offset:C};y.uploadCommonUniforms(S,R),R.draw(y,M.TRIANGLES,w,Qr.disabled,y.colorModeForRenderPass(),Vr.backCW,z,"skybox",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,n,f,s,_):"gradient"===d&&"sky"===t.renderPass&&function(y,v,w,I,C){const S=y.context,M=S.gl,P=y.transform,R=y.getOrCreateProgram("skyboxGradient");v.skyboxGeometry||(v.skyboxGeometry=new w1(S)),S.activeTexture.set(M.TEXTURE0);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new ls(S,v.colorRamp,M.RGBA)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE);const G=(oe=I,pe=C,{u_matrix:P.skyboxMatrix,u_color_ramp:0,u_center_direction:v.getCenter(y,!1),u_radius:De(v.paint.get("sky-gradient-radius")),u_opacity:oe,u_temporal_offset:pe});var oe,pe;y.uploadCommonUniforms(S,R),R.draw(y,M.TRIANGLES,w,Qr.disabled,y.colorModeForRenderPass(),Vr.backCW,G,"skyboxGradient",v.skyboxGeometry.vertexBuffer,v.skyboxGeometry.indexBuffer,v.skyboxGeometry.segment)}(t,n,f,s,_)},debug:function(t,e,n){for(let i=0;i<n.length;i++)rD(t,e,n[i])},custom:function(t,e,n,i){const s=t.context,c=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped(e)){if("offscreen"===t.renderPass){const d=c.prerender;if(d){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const f=t.transform.pointMerc;d.call(c,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),el(t.transform.zoom),[f.x,f.y],t.transform.pixelsPerMeterRatio)}else d.call(c,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const f=c.renderToTile;if(f){const _=i[0].canonical,y=new Ri(_.x+i[0].wrap*(1<<_.z),_.y,_.z);s.setDepthMode(Rr.disabled),s.setStencilMode(Qr.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),f.call(c,s.gl,y),s.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(Qr.disabled);const d="3d"===c.renderingMode?new Rr(t.context.gl.LEQUAL,Rr.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Rr.ReadOnly);if(s.setDepthMode(d),"globe"===t.transform.projection.name){const f=t.transform.pointMerc;c.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),el(t.transform.zoom),[f.x,f.y],t.transform.pixelsPerMeterRatio)}else c.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null)}}else Me("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,n,i){if("opaque"===t.renderPass)return;const s=n.paint.get("model-opacity");if(0===s)return;const c=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass&&(!c||t.terrain&&s<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof _r))return;const d=t.shadowRenderer,f=n.paint.get("model-receive-shadows");d&&(d.useNormalOffset=!0,f||(d.enabled=!1));const _=()=>{d&&(d.useNormalOffset=!0,f||(d.enabled=!0))},y=e.getSource();if("light-beam"===t.renderPass&&"batched-model"!==y.type)return;if("vector"===y.type||"geojson"===y.type)return function(R,z,G,H){const j=R.transform;if("mercator"!==j.projection.name)return void Me(`Drawing 3D models for ${j.projection.name} projection is not yet implemented`);const W=j.getFreeCameraOptions().position;if(!R.modelManager)return;const oe=R.modelManager,pe=R.shadowRenderer;if(!G._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ve=G._unevaluatedLayout._values["model-id"],xe={...G.layout.get("model-id").parameters};for(const ke of H){const Ae=z.getTile(ke).getBucket(G);if(!Ae||Ae.projection.name!==j.projection.name)continue;const $e=Gl(ke,j);xe.zoom=$e;const Ce=ve.possiblyEvaluate(xe);if(ZD(R,Ae,ke),Zd.shadowUniformsInitialized=!1,Zd.useSingleShadowCascade=!!pe&&0===pe.getMaxCascadeForTile(ke.toUnwrapped()),"shadow"===R.renderPass&&pe){if(1===R.currentShadowCascade&&Ae.isInsideFirstShadowMapFrustum)continue;const It=j.calculatePosMatrix(ke.toUnwrapped(),j.worldSize);if(Zd.tileMatrix.set(It),Zd.shadowTileMatrix=Float32Array.from(pe.calculateShadowPassMatrixFromMatrix(It)),Zd.aabb.min.fill(0),Zd.aabb.max[0]=Zd.aabb.max[1]=Vt,Zd.aabb.max[2]=0,Qf(Ae,Zd,R,G.scope))continue}const nt=1<<ke.canonical.z,ft=[((W.x-ke.wrap)*nt-ke.canonical.x)*Vt,(W.y*nt-ke.canonical.y)*Vt,W.z*nt*Vt];for(let It in Ae.instancesPerModel){const et=Ae.instancesPerModel[It];et.features.length>0&&(It=Ce.evaluate(et.features[0].feature,{}));const it=oe.getModel(It,G.scope);if(it&&it.uploaded)for(const St of it.nodes)IC(R,G,St,et,ft,ke,Zd)}}}(t,e,n,i),void _();if(!y.loaded())return;if("batched-model"===y.type)return function(R,z,G,H){const j=R.context,W=R.transform,oe=R.style.fog,pe=R.shadowRenderer;if("mercator"!==W.projection.name)return void Me(`Drawing 3D landmark models for ${W.projection.name} projection is not yet implemented`);const ve=R.transform.getFreeCameraOptions().position,xe=He.scale([],[ve.x,ve.y,ve.z],R.transform.worldSize);He.negate(xe,xe);const ke=Dt.identity([]),Ae=vf(W.center.lat,W.zoom),$e=Dt.fromScaling([],[1,1,1/Ae]);Dt.translate(ke,ke,xe);const Ce=G.paint.get("model-opacity"),nt=new Rr(j.gl.LEQUAL,Rr.ReadWrite,R.depthRangeFor3D),ft=new Rr(j.gl.LEQUAL,Rr.ReadOnly,R.depthRangeFor3D),It=function(et,it){for(const St of H){const Ut=z.getTile(St).getBucket(G);if(!Ut||!Ut.uploaded)continue;let Wt=!1;pe&&(Wt=0===pe.getMaxCascadeForTile(St.toUnwrapped()));const ln=W.calculatePosMatrix(St.toUnwrapped(),W.worldSize),pn=Ut.modelTraits;for(const Yt of Ut.getNodesInfo()){if(Yt.hiddenByReplacement||!Yt.node.meshes)continue;const tn=Yt.node,Vn="light-beam"===R.renderPass,Jn=[...ln],Yn=Yt.evaluatedScale;let Xn=0;R.terrain&&tn.elevation&&(Xn=tn.elevation*R.terrain.exaggeration()),Dt.translate(Jn,Jn,[(tn.anchor?tn.anchor[0]:0)*(Yn[0]-1),(tn.anchor?tn.anchor[1]:0)*(Yn[1]-1),Xn]),Yn!==Sb&&Dt.scale(Jn,Jn,Yn),Dt.multiply(Jn,Jn,tn.matrix);const yr=Dt.multiply([],$e,Jn);Dt.multiply(yr,ke,yr);const Fr=Dt.invert([],yr);Dt.transpose(Fr,Fr),Dt.scale(Fr,Fr,TC);const Or=Dt.multiply([],W.projMatrix,Jn);for(let Ci=0;Ci<tn.meshes.length;++Ci){const Zr=tn.meshes[Ci],zr=Ci===tn.lightMeshIndex;if(zr){if(!Vn&&!R.terrain&&R.shadowRenderer){R.currentLayer<R.firstLightBeamLayer&&(R.firstLightBeamLayer=R.currentLayer);continue}}else if(Vn)continue;const Pr={defines:[]},Dr=[];fI(Pr.defines,Dr,Zr,R),4&pn||Pr.defines.push("DIFFUSE_SHADED"),Wt&&Pr.defines.push("SHADOWS_SINGLE_CASCADE");const ci="shadow"===R.renderPass;if(ci){I1(Zr,Jn,R,G);continue}let Pi=null;if(oe){const xo=E1(Jn,R.transform);if(Pi=new Float32Array(xo),"globe"!==W.projection.name){const Ns=Zr.aabb.min,Qo=Zr.aabb.max,[qo,co]=oe.getOpacityForBounds(xo,Ns[0],Ns[1],Qo[0],Qo[1]);Pr.overrideFog=qo>=yu||co>=yu}}const Jr=R.getOrCreateProgram("model",Pr);!ci&&pe&&(pe.useNormalOffset=!!Zr.normalBuffer,pe.setupShadowsFromMatrix(Jn,Jr,pe.useNormalOffset)),R.uploadCommonUniforms(j,Jr,St.toUnwrapped(),Pi);const Xi=Zr.material,vo=Xi.pbrMetallicRoughness;vo.metallicFactor=.9,vo.roughnessFactor=.5;const So=q_(new Float32Array(Or),new Float32Array(yr),new Float32Array(Fr),R,Ce,vo.baseColorFactor,Xi.emissiveFactor,vo.metallicFactor,vo.roughnessFactor,Xi,G);Jr.draw(R,j.gl.TRIANGLES,it&&!zr?nt:ft,Qr.disabled,et?zr||Ce<1||Yt.hasTranslucentParts?Ai.alphaBlended:Ai.unblended:Ai.disabled,Vr.backCCW,So,G.id,Zr.vertexBuffer,Zr.indexBuffer,Zr.segments,G.paint,R.transform.zoom,void 0,Dr)}}}};(function(et,it,St,Ut){const Wt=et.terrain?et.terrain.exaggeration():0,ln=et.transform.zoom;for(const pn of Ut){const Yt=it.getTile(pn).getBucket(St);Yt&&(et.conflationActive&&Yt.updateReplacement(pn,et.replacementSource),Yt.evaluateScale(et,St),et.terrain&&Wt>0&&Yt.elevationUpdate(et.terrain,Wt,pn,St.source),Yt.needsReEvaluation(et,ln,St)&&Yt.evaluate(St))}})(R,z,G,H),1===Ce?It(!0,!0):(It(!1,!0),It(!0,!1))}(t,e,n,i),void _();const v=y.getModels(),w=[],I=t.transform.getFreeCameraOptions().position,C=He.scale([],[I.x,I.y,I.z],t.transform.worldSize);He.negate(C,C);const S=[],M=[];let P=0;for(const R of v){const z=n.paint.get("model-rotation").constantOr(null),G=n.paint.get("model-scale").constantOr(null),H=n.paint.get("model-translation").constantOr(null);R.computeModelMatrix(t,z,G,H,!0,!0,!1);const j=Dt.identity([]),W=vf(R.position.lat,t.transform.zoom),oe=Dt.fromScaling([],[1,1,1/W]);Dt.translate(j,j,C),w.push({zScaleMatrix:oe,negCameraPosMatrix:j});for(const pe of R.nodes)Z_(t.transform,pe,R.matrix,t.transform.projMatrix,P,S,M);P++}if(S.sort((R,z)=>z.depth-R.depth),"shadow"!==t.renderPass){if(1===s)for(const R of M)Y_(R,t,n,w[R.modelIndex],Qr.disabled,t.colorModeForRenderPass());else{for(const R of M)Y_(R,t,n,w[R.modelIndex],Qr.disabled,Ai.disabled);for(const R of M)Y_(R,t,n,w[R.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const R of S)Y_(R,t,n,w[R.modelIndex],Qr.disabled,t.colorModeForRenderPass());_()}else{for(const R of M)I1(R.mesh,R.nodeModelMatrix,t,n);for(const R of S)I1(R.mesh,R.nodeModelMatrix,t,n);_()}}},pI={modelUpload:function(t,e,n){const i=e.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(t.modelManager&&t.modelManager.upload(t,n));if("batched-model"===i.type)return;const s=i.getModels();for(const c of s)c.upload(t.context)}};class CC{constructor(e,n){this.context=new kf(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=ec.maxUnderzooming+ec.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new Ys,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new KD(this),this._wireframeDebugCache=new T1,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,n){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cC(this,e));const s=this._terrain;this.transform.elevation=i?s:null,s.update(e,this.transform,n),this.transform.elevation&&!s.enabled&&(this.transform.elevation=null)}_updateFog(e){const n=e.fog;if(!n||"globe"===this.transform.projection.name||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,s]=n.getFovAdjustedRange(this.transform._fov);if(i>s)return void(this.transform.fogCullDistSq=null);const c=i+.78*(s-i);this.transform.fogCullDistSq=c*c}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,n){if(this.width=e*ne.devicePixelRatio,this.height=n*ne.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style.order)this.style._mergedLayers[i].resize()}setup(){const e=this.context,n=new Vl;n.emplaceBack(0,0),n.emplaceBack(Vt,0),n.emplaceBack(0,Vt),n.emplaceBack(Vt,Vt),this.tileExtentBuffer=e.createVertexBuffer(n,Xl.members),this.tileExtentSegments=so.simpleSegment(0,0,4,2);const i=new Vl;i.emplaceBack(0,0),i.emplaceBack(Vt,0),i.emplaceBack(0,Vt),i.emplaceBack(Vt,Vt),this.debugBuffer=e.createVertexBuffer(i,Xl.members),this.debugSegments=so.simpleSegment(0,0,4,5);const s=new Vl;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(-1,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,Xl.members),this.viewportSegments=so.simpleSegment(0,0,4,2);const c=new Mu;c.emplaceBack(0,0,0,0),c.emplaceBack(Vt,0,Vt,0),c.emplaceBack(0,Vt,0,Vt),c.emplaceBack(Vt,Vt,Vt,Vt),this.mercatorBoundsBuffer=e.createVertexBuffer(c,hr.members),this.mercatorBoundsSegments=so.simpleSegment(0,0,4,2);const d=new Is;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(d);const f=new Ip;for(const y of[0,1,3,2,0])f.emplaceBack(y);this.debugIndexBuffer=e.createIndexBuffer(f),this.emptyTexture=new ls(e,new Ki({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=Dt.create();const _=this.context.gl;this.stencilClearMode=new Qr({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO),this.loadTimeStamps.push(ge.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Rr.disabled,this.stencilClearMode,Ai.disabled,Vr.disabled,u1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,n,i){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let f=!1;for(const _ of i)if(void 0===this._tileClippingMaskIDs[_.key]){f=!0;break}if(!f)return}this.currentStencilSource=n.id;const s=this.context,c=s.gl;this.nextStencilID+i.length>256&&this.clearStencil(),s.setColorMode(Ai.disabled),s.setDepthMode(Rr.disabled);const d=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const f of i){const _=n.getTile(f),y=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,{tileBoundsBuffer:v,tileBoundsIndexBuffer:w,tileBoundsSegments:I}=this.getTileBoundsBuffers(_);d.draw(this,c.TRIANGLES,Rr.disabled,new Qr({func:c.ALWAYS,mask:0},y,255,c.KEEP,c.KEEP,c.REPLACE),Ai.disabled,Vr.disabled,u1(f.projMatrix),"$clipping",v,w,I)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Qr({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new Qr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,i=e.sort((d,f)=>f.overscaledZ-d.overscaledZ),s=i[i.length-1].overscaledZ,c=i[0].overscaledZ-s+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();const d={};for(let f=0;f<c;f++)d[f+s]=new Qr({func:n.GEQUAL,mask:255},f+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=c,[d,i]}return[{[s]:Qr.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ai([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new Ur(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ai.unblended:Ai.alphaBlended}colorModeForDrapableLayerRenderPass(e){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Ai([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new Ur(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,n,i,s=!1){if(!this.opaquePassEnabledForLayer()&&!s)return Rr.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Rr(i||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const i=this.style._mergedLayers,s=this.style.order,c=s.map(j=>i[j]),d=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();let f=0,_=!1;for(const j in d){const W=d[j];W.used&&(W.prepare(this.context),W.getSource().usedInConflation&&++f)}const y={},v={},w={},I={},C={};for(const j in d){const W=d[j];y[j]=W.getVisibleCoordinates(),v[j]=y[j].slice().reverse(),w[j]=W.getVisibleCoordinates(!0).reverse(),I[j]=W.getShadowCasterCoordinates(),C[j]=W.sortCoordinatesByDistance(y[j])}const S=j=>{const W=this.style.getLayerSourceCache(j);return W&&W.used?W.getSource():null};if(f){const j=[];for(const W of c)this.layerUsedInConflation(W,S(W))&&j.push(W);if(j&&j.length>1){const W=[];for(const oe of j){const pe=this.style.getLayerSourceCache(oe);pe&&pe.used&&pe.getSource().usedInConflation&&W.push({layer:oe.fqid,cache:pe})}this.replacementSource.setSources(W),_=!0}}_||this.replacementSource.clear(),this.conflationActive=_,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const j of c){const W=j.cutoffRange();if(this.longestCutoffRange=Math.max(W,this.longestCutoffRange),W>0){const oe=S(j);oe&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom)),j.minzoom&&(this.minCutoffZoom=Math.max(j.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let j=0;j<c.length;j++)if(c[j].is3D()){this.opaquePassCutoff=j;break}const M=this.style&&this.style.fog;M?(this._fogVisible=0!==M.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=M.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(w),this.opaquePassCutoff=0);const P=this._shadowRenderer;if(P){P.updateShadowParameters(this.transform,this.style.directionalLight);for(const j in d)for(const W of y[j]){let oe={min:0,max:0};this.terrain&&(oe=this.terrain.getMinMaxForTile(W)||oe),P.addShadowReceiver(W.toUnwrapped(),oe.min,oe.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Tw(this.context));for(const j of c){if(j.isHidden(this.transform.zoom))continue;const W=e.getLayerSourceCache(j);this.uploadLayer(this,j,W)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hI),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!po.has(this.context.gl))return;this.renderPass="offscreen";for(const j of c){const W=e.getLayerSourceCache(j);if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;const oe=W?v[W.id]:void 0;("custom"===j.type||"raster"===j.type||j.isSky()||oe&&oe.length)&&this.renderLayer(this,W,j,oe)}this.depthRangeFor3D=[0,1-(c.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&R.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,I)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const z="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),G=(()=>{if(n.showOverdrawInspector)return Ur.black;if(this.style.fog&&this.transform.projection.supportsFog&&!z){const j=this.style.fog.properties.get("color").toArray01();return new Ur(...j)}if(this.style.fog&&this.transform.projection.supportsFog&&z){const j=this.style.fog.properties.get("space-color").toArray01();return new Ur(...j)}return Ur.transparent})();if(this.context.clear({color:G,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&z&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){const j=c[this.currentLayer],W=e.getLayerSourceCache(j);if(j.isSky())continue;const oe=W?(j.is3D()?C:v)[W.id]:void 0;this._renderTileClippingMasks(j,W,oe),this.renderLayer(this,W,j,oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&z&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||el(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){const j=c[this.currentLayer],W=e.getLayerSourceCache(j);j.isSky()&&this.renderLayer(this,W,j,W?v[W.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let H=0;for(P&&(H=P.getShadowCastingLayerCount());this.currentLayer<s.length;){const j=c[this.currentLayer],W=e.getLayerSourceCache(j);if(j.isSky()){++this.currentLayer;continue}if(R&&this.style.isLayerDraped(j)){if(j.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=R.renderBatch(this.currentLayer);continue}let oe;if(W&&(oe=("symbol"===j.type?w:j.is3D()?C:v)[W.id]),this._renderTileClippingMasks(j,W,W?y[W.id]:void 0),this.renderLayer(this,W,j,oe),!R&&P&&H>0&&j.hasShadowPass()&&0==--H&&(P.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=pe;this.currentLayer++){const ve=c[this.currentLayer];if(!ve.hasLightBeamPass())continue;const xe=e.getLayerSourceCache(ve);this.renderLayer(this,xe,ve,xe?v[xe.id]:void 0)}this.currentLayer=pe,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let j=null;c.forEach(W=>{const oe=e.getLayerSourceCache(W);oe&&!W.isHidden(this.transform.zoom)&&oe.getVisibleCoordinates().length&&(!j||j.getSource().maxzoom<oe.getSource().maxzoom)&&(j=oe)}),j&&this.options.showTileBoundaries&&AC.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const W=j.transform.padding;b1(j,j.transform.height-(W.top||0),3,x1),b1(j,W.bottom||0,3,x0),uI(j,W.left||0,3,cI),uI(j,j.transform.width-(W.right||0),3,vC);const oe=j.transform.centerPoint;var pe,ve,xe,ke;b0(pe=j,(ve=oe.x)-1,(xe=j.transform.height-oe.y)-10,2,20,ke=xC),b0(pe,ve-10,xe-1,20,2,ke)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(ge.performance.now()),this.saveCanvasCopy()),_||(this.conflationActive=!1)}uploadLayer(e,n,i){this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&pI[`${n.type}Upload`]&&pI[`${n.type}Upload`](e,i,n.scope),this.gpuTimingEnd()}renderLayer(e,n,i,s){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||s&&s.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&AC[i.type](e,n,i,s,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,i=this.context.gl;let s=this.gpuTimers[e.id];s||(s=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),s.calls++,i.beginQuery(n.TIME_ELAPSED_EXT,s.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,n=this.context.gl,i=n.createQuery();this.deferredRenderGpuTimeQueries.push(i),n.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const n={};for(const i in e){const s=e[i],c=this.context.extTimerQuery,d=c.getQueryParameter(s.query,this.context.gl.QUERY_RESULT)/1e6;c.deleteQueryEXT(s.query),n[i]=d}return n}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,i=this.context.gl;let s=0;for(const c of e)s+=n.getQueryParameter(c,i.QUERY_RESULT)/1e6,n.deleteQueryEXT(c);return s}translatePosMatrix(e,n,i,s,c){if(!i[0]&&!i[1])return e;const d=c?"map"===s?this.transform.angle:0:"viewport"===s?-this.transform.angle:0;if(d){const y=Math.sin(d),v=Math.cos(d);i=[i[0]*v-i[1]*y,i[0]*y+i[1]*v]}const f=[c?i[0]:nm(n,i[0],this.transform.zoom),c?i[1]:nm(n,i[1],this.transform.zoom),0],_=new Float32Array(16);return Dt.translate(_,e,f),_}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e,n){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,n,i){const s=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,c=this.terrain&&0===this.terrain.exaggeration(),d=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(d.push("LIGHTING_3D_MODE"),d.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):s||d.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||d.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?d.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):d.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(d.push("TERRAIN"),this.terrainUseFloatDEM()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),c&&d.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&d.push("GLOBE"),!this._fogVisible||s||void 0!==n&&!n||d.push("FOG","FOG_DITHERING"),s&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}getOrCreateProgram(e,n){this.cache=this.cache||{};const i=n&&n.defines||[],s=n&&n.config,c=this.currentGlobalDefines(e,n&&n.overrideFog,n&&n.overrideRtt).concat(i),d=dC.cacheKey(d0[e],e,c,s);return this.cache[d]||(this.cache[d]=new dC(this.context,e,d0[e],s,ed[e],c)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=ge.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ls(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,s=this.style.ambientLight;if(i&&s){const c=((d,f)=>{const _=d.properties.get("direction"),y=d.properties.get("color").toArray01(),v=d.properties.get("intensity"),w=f.properties.get("color").toArray01(),I=f.properties.get("intensity"),C=[_.x,_.y,_.z],S=Nn(w,I),M=Nn(y,v);return{u_lighting_ambient_color:S,u_lighting_directional_dir:C,u_lighting_directional_color:M,u_ground_radiance:eI(C,M,S)}})(i,s);n.setLightsUniformValues(e,c)}}}uploadCommonUniforms(e,n,i,s,c){if(this.uploadCommonLightUniforms(e,n),this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const f=d.getOpacity(this.transform.pitch),_=((y,v,w,I,C,S,M,P,R,z,G,H)=>{const j=y.transform,W=v.properties.get("color").toArray01();W[3]=I;const oe=y.frameCounter/1e3%1,[pe,ve]=v.properties.get("vertical-range");return{u_fog_matrix:w?j.calculateFogTileMatrix(w):H||y.identityMat,u_fog_range:v.getFovAdjustedRange(j._fov),u_fog_color:W,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(pe,ve),ve],u_fog_temporal_offset:oe,u_frustum_tl:C,u_frustum_tr:S,u_frustum_br:M,u_frustum_bl:P,u_globe_pos:R,u_globe_radius:z,u_viewport:G,u_globe_transition:el(j.zoom),u_is_globe:+("globe"===j.projection.name)}})(this,d,i,f,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ne.devicePixelRatio,this.transform.height*ne.devicePixelRatio],s);n.setFogUniformValues(e,_)}c&&n.setCutoffUniformValues(e,c.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const s of i)n[s.key]=e[s.key]||new qn(s,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,n){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!n||"batched-model"!==n.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let n=this._cachedTileFogOpacities[e.key];return n||(this._cachedTileFogOpacities[e.key]=n=this.style.fog.getOpacityForTile(e)),n[0]>=yu||n[1]>=yu}}const Jf=2048;class iD{constructor(e,n){this.aabb=e,this.lastCascade=n}}class SC{add(e,n){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],n.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],n.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],n.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],n.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],n.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],n.max[2])):this.receivers[e.key]=new iD(n,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,n,i){const s=bo.fromPoints(e.points);let c=0;for(const d in this.receivers){const f=this.receivers[d];if(!f||!s.intersectsAabb(f.aabb))continue;f.aabb.min=s.closestPoint(f.aabb.min),f.aabb.max=s.closestPoint(f.aabb.max);const _=f.aabb.getCorners();for(let y=0;y<i.length;y++){let v=!0;for(const w of _){const I=[w[0]*n,w[1]*n,w[2]];if(He.transformMat4(I,I,i[y].matrix),I[0]<-1||I[0]>1||I[1]<-1||I[1]>1){v=!1;break}}if(f.lastCascade=y,c=Math.max(c,y),v)break}}return c+1}}class KD{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new SC,this._depthMode=new Rr(e.context.gl.LEQUAL,Rr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const s=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||s<=0||(this._shadowLayerCount=i.style.order.reduce((C,S)=>{const M=i.style._mergedLayers[S];return C+(M.hasShadowPass()&&!M.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const c=i.context,d=Jf,f=Jf;if(0===this._cascades.length)for(let C=0;C<2;++C){const S=i._shadowMapDebug,M=c.gl,P=c.createFramebuffer(d,f,S,"texture"),R=new ls(c,{width:d,height:f,data:null},M.DEPTH_COMPONENT);if(P.depthAttachment.set(R.texture),S){const z=new ls(c,{width:d,height:f,data:null},M.RGBA);P.colorAttachment.set(z.texture)}this._cascades.push({framebuffer:P,texture:R,matrix:[],far:0,boundingSphereRadius:0,frustum:new La,scale:0})}this.shadowDirection=X_(n);let _=0;if(e.elevation){const C=e.elevation,S=[1e4,-1e4];C.visibleDemTiles.filter(M=>M.dem).forEach(M=>{const P=M.dem.tree;S[0]=Math.min(S[0],P.minimums[0]),S[1]=Math.max(S[1],P.maximums[0])}),1e4!==S[0]&&(_=(S[1]-S[0])*C.exaggeration())}const y=1.5*e.cameraToCenterDistance,v=3*y,w=new Float64Array(16);for(let C=0;C<2;++C){const S=this._cascades[C];let M=e.height/50,P=1;0===C?P=y:(M=y,P=v);const[R,z]=Q_(e,this.shadowDirection,M,P,Jf,_);S.scale=e.scale,S.matrix=R,S.boundingSphereRadius=z,Dt.invert(w,S.matrix),S.frustum=La.fromInvProjectionMatrix(w,1,0,!0),S.far=P}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=s,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Jf,this._uniformValues.u_shadowmap_0=vc.ShadowMap0,this._uniformValues.u_shadowmap_1=vc.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const I=i.transform.elevation;for(const C of this._groundShadowTiles){let S={min:0,max:0};if(I){const M=I.getMinMaxForTile(C);M&&(S=M)}this.addShadowReceiver(C.toUnwrapped(),S.min,S.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,n){if(!this._enabled)return;const i=this.painter,s=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),s.viewport.set([0,0,Jf,Jf]);for(let c=0;c<this._numCascadesToRender;++c){i.currentShadowCascade=c,s.bindFramebuffer.set(this._cascades[c].framebuffer.framebuffer),s.clear({color:Ur.white,depth:1});for(const d of e.order){const f=e._mergedLayers[d];if(!f.hasShadowPass()||f.isHidden(i.transform.zoom))continue;const _=e.getLayerSourceCache(f),y=_?n[_.id]:void 0;("model"===f.type||y&&y.length)&&i.renderLayer(i,_,f,y)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,n=e.style,i=e.context,s=n.directionalLight,c=n.ambientLight;if(!s||!c)return;const d=[],f=$c(e,e.longestCutoffRange);f.shouldRenderCutoff&&d.push("RENDER_CUTOFF");const _=E0(s,c),y=new Rr(i.gl.LEQUAL,Rr.ReadOnly,e.depthRangeFor3D);for(const v of this._groundShadowTiles){const w=v.toUnwrapped(),I=e.isTileAffectedByFog(v),C=e.getOrCreateProgram("groundShadow",{defines:d,overrideFog:I});this.setupShadows(w,C),e.uploadCommonUniforms(i,C,w,null,f);const S={u_matrix:e.transform.calculateProjMatrix(w),u_ground_shadow_factor:_};C.draw(e,i.gl.TRIANGLES,y,Qr.disabled,Ai.multiply,Vr.disabled,S,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ai.unblended:Ai.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const n=this.painter.transform,i=n.calculatePosMatrix(e,n.worldSize);return Dt.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(e){return Dt.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,n,i,s=0){if(!this._enabled)return;const c=this.painter.transform,d=this.painter.context,f=d.gl,_=this._uniformValues,y=new Float64Array(16),v=c.calculatePosMatrix(e,c.worldSize);for(let w=0;w<2;w++)Dt.multiply(y,this._cascades[w].matrix,v),_[0===w?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(y),d.activeTexture.set(f.TEXTURE0+vc.ShadowMap0+w),this._cascades[w].texture.bind(f.NEAREST,f.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const w=$x(e.canonical),I=2/c.tileSize*Vt/Jf,C=I*this._cascades[0].boundingSphereRadius,S=I*this._cascades[1].boundingSphereRadius,M=("vector-tile"===i?1:3)/Math.pow(2,s-e.canonical.z-(1-c.zoom+Math.floor(c.zoom)));_.u_shadow_normal_offset=[w,C*M,S*M],_.u_shadow_bias=[6e-5,.0012,.012]}else _.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(d,_)}setupShadowsFromMatrix(e,n,i=!1){if(!this._enabled)return;const s=this.painter.context,c=s.gl,d=this._uniformValues,f=new Float64Array(16);for(let _=0;_<2;_++)Dt.multiply(f,this._cascades[_].matrix,e),d[0===_?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(f),s.activeTexture.set(c.TEXTURE0+vc.ShadowMap0+_),this._cascades[_].texture.bind(c.NEAREST,c.CLAMP_TO_EDGE);this.useNormalOffset=i,i?(d.u_shadow_normal_offset=[1,5,5],d.u_shadow_bias=[6e-5,.0012,.012]):d.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(s,d)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,n,i,s){if(s[2]>=0)return{};const c=function(_,y,v){const w=v/(1<<_.canonical.z);return new bo([_.canonical.x*w+_.wrap*v,_.canonical.y*w+_.wrap*v,0],[(_.canonical.x+1)*w+_.wrap*v,(_.canonical.y+1)*w+_.wrap*v,y])}(e,n,i).getCorners(),d=n/-s[2];s[0]<0?(He.add(c[0],c[0],[s[0]*d,0,0]),He.add(c[3],c[3],[s[0]*d,0,0])):s[0]>0&&(He.add(c[1],c[1],[s[0]*d,0,0]),He.add(c[2],c[2],[s[0]*d,0,0])),s[1]<0?(He.add(c[0],c[0],[0,s[1]*d,0]),He.add(c[1],c[1],[0,s[1]*d,0])):s[1]>0&&(He.add(c[2],c[2],[0,s[1]*d,0]),He.add(c[3],c[3],[0,s[1]*d,0]));const f={};return f.vertices=c,f.planes=[w0(c[1],c[0],c[4]),w0(c[2],c[1],c[5]),w0(c[3],c[2],c[6]),w0(c[0],c[3],c[7])],f}addShadowReceiver(e,n,i){this._receivers.add(e,bo.fromTileIdAndHeight(e,n,i))}getMaxCascadeForTile(e){const n=this._receivers.get(e);return n&&n.lastCascade?n.lastCascade:0}}function w0(t,e,n){const i=He.sub([],n,e),s=He.sub([],t,e),c=He.cross([],i,s),d=He.length(c);return 0===d?[0,0,1,0]:(He.scale(c,c,1/d),[c[0],c[1],c[2],-He.dot(c,e)])}function X_(t){const e=t.properties.get("direction"),n=In(e.x,e.y,e.z);n[2]=_n(n[2],0,75);const i=nn([n[0],n[1],n[2]]);return He.fromValues(i.x,i.y,i.z)}function E0(t,e){const n=t.properties.get("color"),i=t.properties.get("intensity"),s=t.properties.get("direction"),c=[s.x,s.y,s.z],d=e.properties.get("color"),f=e.properties.get("intensity"),_=Math.max(He.dot([0,0,1],c),0),y=[0,0,0];He.scale(y,d.toArray01Linear().slice(0,3),f);const v=[0,0,0];return He.scale(v,n.toArray01Linear().slice(0,3),_*i),Kr([y[0]>0?y[0]/(y[0]+v[0]):0,y[1]>0?y[1]/(y[1]+v[1]):0,y[2]>0?y[2]/(y[2]+v[2]):0])}function Q_(t,e,n,i,s,c){const d=t.zoom,f=t.scale,_=t.worldSize,y=1/_,v=t.aspect,w=Math.sqrt(1+v*v)*Math.tan(.5*t.fovX),I=w*w,C=i-n,S=i+n;let M,P;I>C/S?(M=i,P=i*w):(M=.5*S*(1+I),P=.5*Math.sqrt(C*C+2*(i*i+n*n)*I+S*S*I*I));const R=t.projection.pixelsPerMeter(t.center.lat,_),z=t._camera.getCameraToWorldMercator(),G=[0,0,-M*y];He.transformMat4(G,G,z);let H=P*y;const j=t._edgeInsets;if(!(0===j.left&&0===j.top&&0===j.right&&0===j.bottom||j.left===j.right&&j.top===j.bottom)){const Ut=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?R:1),Wt=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);Wt[8]=2*-t.centerOffset.x/t.width,Wt[9]=2*t.centerOffset.y/t.height;const ln=new Float64Array(16);Dt.mul(ln,Wt,Ut);const pn=new Float64Array(16);Dt.invert(pn,ln);const Yt=La.fromInvProjectionMatrix(pn,_,d,!0);for(const tn of Yt.points){const Vn=((W=tn)[0]/=f,W[1]/=f,W[2]=Zi(W[2],t._center.lat),W);H=Math.max(H,He.len(He.subtract([],G,Vn)))}}var W;H*=s/(s-1);const oe=Math.acos(e[2]),pe=Math.atan2(-e[0],-e[1]),ve=new Ib;ve.position=G,ve.setPitchBearing(oe,pe);const xe=ve.getWorldToCamera(_,R),ke=H*_,Ae=Math.min(t._mercatorZfromZoom(17)*_*-2,-2*ke),$e=ve.getCameraToClipOrthographic(-ke,ke,-ke,ke,Ae,(ke+c*R)/e[2]),Ce=new Float64Array(16);Dt.multiply(Ce,$e,xe);const nt=He.fromValues(Math.floor(1e6*G[0])/1e6*_,Math.floor(1e6*G[1])/1e6*_,0),ft=.5*s,It=[0,0,0];He.transformMat4(It,nt,Ce),He.scale(It,It,ft);const et=[Math.floor(It[0]),Math.floor(It[1]),Math.floor(It[2])],it=[0,0,0];He.sub(it,It,et),He.scale(it,it,-1/ft);const St=new Float64Array(16);return Dt.identity(St),Dt.translate(St,St,it),Dt.multiply(Ce,St,Ce),[Ce,ke]}class mI extends Kn{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,n){return D_(this.requestManager.transformRequest(n,Ht.Model).url).then(i=>{if(!i)return;const s=VE(i),c=new Fd(e,void 0,void 0,s);return c.computeBoundsAndApplyParent(),c}).catch(i=>{this.fire(new wn(new Error(`Could not load model ${e} from ${n}: ${i.message}`)))})}load(e,n){this.models[n]||(this.models[n]={});const i=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;const s=[];for(const c of i)s.push(this.loadModel(c,e[c]));Promise.allSettled(s).then(c=>{for(let d=0;d<c.length;d++){const{status:f,value:_}=c[d];"fulfilled"===f&&_&&(this.models[n][i[d]]=_)}this.numModelsLoading[n]-=i.length,this.fire(new kt("data",{dataType:"style"}))}).catch(c=>{this.fire(new wn(new Error(`Could not load models: ${c.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,n){return!!this.getModel(e,n)}getModel(e,n){return this.models[n]||(this.models[n]={}),this.models[n][e]}addModel(e,n,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(n)},i)}addModels(e,n){const i={};for(const s in e)i[s]=this.requestManager.normalizeModelURL(e[s]);this.load(i,n)}removeModel(e,n){this.models[n]||(this.models[n]={});const i=this.models[n][e];delete this.models[n][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,n){this.models[n]||(this.models[n]={});for(const i in this.models[n])this.models[n][i].upload(e.context)}}const bu=(t,e)=>nu(t,e&&e.filter(n=>"source.canvas"!==n.identifier)),I0=_t(Fi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),T0=_t(Fi,["setCenter","setZoom","setBearing","setPitch"]),Dm={version:8,layers:[],sources:{}},A1={duration:300,delay:0},gI=new Set(["fill","line","background","hillshade","raster"]);class sl extends Kn{constructor(e,n={}){super(),this.map=e,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=Ye({},A1),this._buildingIndex=new XS(this),this.crossTileSymbolIndex=new a1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new dT,this.dispatcher=n.dispatcher?n.dispatcher:new qv(mm(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new v_,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new e_(e._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new mI(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",yn());const i=this;this._rtlTextPluginCallback=sl.registerForPluginStateChange(s=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s.pluginStatus,pluginURL:s.pluginURL},(c,d)=>{if(uT(c),d&&d.every(f=>f))for(const f in i._sourceCaches){const _=i._sourceCaches[f],y=_.getSource().type;"vector"!==y&&"geojson"!==y||_.reload()}})}),this.on("data",s=>{if("source"!==s.dataType||"metadata"!==s.sourceDataType)return;const c=this.getOwnSource(s.sourceId);if(c&&c.vectorLayerIds)for(const d in this._layers){const f=this._layers[d];f.source===c.id&&this._validateLayer(f)}})}loadURL(e,n={}){this.fire(new kt("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!Rn(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken),this.resolvedImports.add(e);const s=this.importsCache.get(e);if(s)return this._load(s,i);const c=this.map._requestManager.transformRequest(e,Ht.Style);this._request=En(c,(d,f)=>{if(this._request=null,d)this.fire(new wn(d));else if(f)return this.importsCache.set(e,f),this._load(f,i)})}loadJSON(e,n={}){this.fire(new kt("dataloading",{dataType:"style"})),this._request=ne.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new kt("dataloading",{dataType:"style"})),this._load(Dm,!1)}_loadImports(e,n){if(this.importDepth>=4)return Me("Style doesn't support nesting deeper than 5"),this._reloadImports();const i=[];for(const s of e){const c=this._createFragmentStyle(s),d=new Promise(_=>c.on("style.import.load",_));if(i.push(d),this.resolvedImports.has(s.url)){c.loadEmpty();continue}const f=s.data||this.importsCache.get(s.url);f?c.loadJSON(f,{validate:n}):s.url?c.loadURL(s.url,{validate:n}):c.loadEmpty(),this.fragments.push({style:c,id:s.id,config:s.config})}Promise.all(i).then(()=>this._reloadImports())}_createFragmentStyle(e){const n=this.scope?Xa(e.id,this.scope):e.id,i=new sl(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return i.setEventedParent(this.map,{style:i}),i.setConfig(e.config),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new kt("data",{dataType:"style"})),this.fire(new kt(e?"style.load":"style.import.load"))}_load(e,n){const i=e.schema;if(this.isRootStyle()&&(e.fragment||i&&!1!==e.fragment)){const d=Ye({},Dm,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(d,n)}if(this.updateSchema(i),n&&bu(this,Zm(e)))return;this._loaded=!0,this.stylesheet=ue(e);for(const d in e.sources)this.addSource(d,e.sources[d],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const s=UE(this.stylesheet.layers);if(this._order=s.map(d=>d.id),this.stylesheet.light&&Me("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const d=this.stylesheet.lights[0];this.light=new Oh(d.properties,d.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Oh(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const d of s){const f=zc(d,this.options);f.setScope(this.scope),f.isConfigDependent&&this._configDependentLayers.add(f.fqid),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize();const _=this.getOwnLayerSourceCache(f),y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();_&&f.canCastShadows()&&y&&(_.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const c=this.stylesheet.terrain;if(c&&!this.terrainSetForDrapingOnly()&&this._createTerrain(c,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new kt("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,n);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const d=this.isRootStyle();this._shouldPrecompile=d,this.fire(new kt(d?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,n,i,s,c,d,f,_;this.forEachFragmentStyle(y=>{if(y.stylesheet){if(null!=y.light&&(e=y.light),y.stylesheet.lights)for(const v of y.stylesheet.lights)"ambient"===v.type&&null!=y.ambientLight&&(n=y.ambientLight),"directional"===v.type&&null!=y.directionalLight&&(i=y.directionalLight);(y.stylesheet.terrain||y.stylesheet.projection&&"globe"===y.stylesheet.projection.name)&&null!=y.terrain&&(!s||s&&0===s.drapeRenderMode||1===y.terrain.drapeRenderMode)&&(s=y.terrain),y.stylesheet.fog&&null!=y.fog&&(c=y.fog),null!=y.stylesheet.camera&&(_=y.stylesheet.camera),null!=y.stylesheet.projection&&(d=y.stylesheet.projection),null!=y.stylesheet.transition&&(f=y.stylesheet.transition)}}),this.light=e,this.ambientLight=n,this.directionalLight=i,this.terrain=s,this.fog=c,this.camera=_||{"camera-projection":"perspective"},this.projection=d||{name:"mercator"},this.transition=Ye({},A1,f),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const n=i=>{for(const s of i.fragments)n(s.style);e(i)};n(this)}mergeTerrain(){let e;this.forEachFragmentStyle(n=>{null!=n.terrain&&(!e||e&&0===e.drapeRenderMode||1===n.terrain.drapeRenderMode)&&(e=n.terrain)}),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(n=>{null!=n.stylesheet.projection&&(e=n.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},n={},i={};this.forEachFragmentStyle(s=>{for(const c in s._sourceCaches){const d=Xa(c,s.scope);e[d]=s._sourceCaches[c]}for(const c in s._otherSourceCaches){const d=Xa(c,s.scope);n[d]=s._otherSourceCaches[c]}for(const c in s._symbolSourceCaches){const d=Xa(c,s.scope);i[d]=s._symbolSourceCaches[c]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){const e={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(c=>{for(const d of c._order){const f=c._layers[d];if("slot"===f.type){const _=Cy(d);if(e[_])continue;e[_]=[]}f.slot&&e[f.slot]?e[f.slot].push(f):n.push(f)}}),this._mergedOrder=[];const s=(c=[])=>{for(const d of c)if("slot"===d.type){const f=Cy(d.id);e[f]&&s(e[f])}else{const f=Xa(d.id,d.scope);this._mergedOrder.push(f),i[f]=d,d.is3D()&&(this._has3DLayers=!0),"circle"===d.type&&(this._hasCircleLayers=!0),"symbol"===d.type&&(this._hasSymbolLayers=!0)}};s(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Ye({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(n,i,s){let c,d,f;const _=ne.devicePixelRatio>1?"@2x":"";let y=En(i.transformRequest(i.normalizeSpriteURL(n,_,".json"),Ht.SpriteJSON),(I,C)=>{y=null,f||(f=I,c=C,w())}),v=rt(i.transformRequest(i.normalizeSpriteURL(n,_,".png"),Ht.SpriteImage),(I,C)=>{v=null,f||(f=I,d=C,w())});function w(){if(f)s(f);else if(c&&d){const I=ne.getImageData(d),C={};for(const S in c){const{width:M,height:P,x:R,y:z,sdf:G,pixelRatio:H,stretchX:j,stretchY:W,content:oe}=c[S],pe=new Ki({width:M,height:P});Ki.copy(I,pe,{x:R,y:z},{x:0,y:0},{width:M,height:P}),C[S]={data:pe,pixelRatio:H,sdf:G,stretchX:j,stretchY:W,content:oe}}s(null,C)}}return{cancel(){y&&(y.cancel(),y=null),v&&(v.cancel(),v=null)}}}(e,this.map._requestManager,(n,i)=>{if(this._spriteRequest=null,n)this.fire(new wn(n));else if(i)for(const s in i)this.imageManager.addImage(s,this.scope,i[s]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new kt("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getOwnSource(e.source);if(!n)return;const i=e.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new wn(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,n)=>{const i=this.fragments[n];return i&&i.style&&(e.data=i.style.serialize()),e})}_serializeSources(){const e={};for(const n in this._sourceCaches){const i=this._sourceCaches[n].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const n=[];for(const i of e){const s=this._layers[i];s&&"custom"!==s.type&&n.push(s.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):gI.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const n=this.getOwnLayer(e);if(n)return n;this.fire(new wn(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const n=this.getOwnSource(e);if(n)return n;this.fire(new wn(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const n=this.calculateLightsBrightness();e.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const i=this._changes.changed;if(this._changes.changed){const c=this._changes.getLayerUpdatesByScope();for(const d in c){const{updatedIds:f,removedIds:_}=c[d];(f||_)&&this._updateWorkerLayers(d,f,_)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const s={};for(const c in this._mergedSourceCaches){const d=this._mergedSourceCaches[c];s[c]=d.used,d.used=!1}for(const c of this._mergedOrder){const d=this._mergedLayers[c];if(d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)){const f=this.getOwnLayerSourceCache(d);f&&(f.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let f=d.minzoom||0;f<(d.maxzoom||25.5);f++){const _=this.map.painter;if(_){const y=d.getProgramIds();if(!y)continue;for(const v of y){const w=d.getDefaultProgramParams(v,e.zoom);w&&(_.style=this,this.fog&&(_._fogVisible=!0,w.overrideFog=!0,_.getOrCreateProgram(v,w)),_._fogVisible=!1,w.overrideFog=!1,_.getOrCreateProgram(v,w),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(w.overrideRtt=!0,_.getOrCreateProgram(v,w)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const c in s){const d=this._mergedSourceCaches[c];s[c]!==d.used&&d.getSource().fire(new kt("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new kt("data",{dataType:"style"}));for(const{style:c}of this.fragments)c.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,n,i){const s=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:n?s._serializeLayers(n):[],scope:e,removedIds:i||[],options:s.options})}setState(e){if(this._checkLoaded(),bu(this,Zm(e)))return!1;(e=ue(e)).layers=UE(e.layers);const n=function(s,c){if(!s)return[{command:Fi.setStyle,args:[c]}];let d=[];try{if(!st(s.version,c.version))return[{command:Fi.setStyle,args:[c]}];st(s.center,c.center)||d.push({command:Fi.setCenter,args:[c.center]}),st(s.zoom,c.zoom)||d.push({command:Fi.setZoom,args:[c.zoom]}),st(s.bearing,c.bearing)||d.push({command:Fi.setBearing,args:[c.bearing]}),st(s.pitch,c.pitch)||d.push({command:Fi.setPitch,args:[c.pitch]}),st(s.sprite,c.sprite)||d.push({command:Fi.setSprite,args:[c.sprite]}),st(s.glyphs,c.glyphs)||d.push({command:Fi.setGlyphs,args:[c.glyphs]}),st(s.transition,c.transition)||d.push({command:Fi.setTransition,args:[c.transition]}),st(s.light,c.light)||d.push({command:Fi.setLight,args:[c.light]}),st(s.fog,c.fog)||d.push({command:Fi.setFog,args:[c.fog]}),st(s.projection,c.projection)||d.push({command:Fi.setProjection,args:[c.projection]}),st(s.lights,c.lights)||d.push({command:Fi.setLights,args:[c.lights]}),st(s.camera,c.camera)||d.push({command:Fi.setCamera,args:[c.camera]});const f={},_=[];!function(w,I,C,S){let M;for(M in I=I||{},w=w||{})w.hasOwnProperty(M)&&(I.hasOwnProperty(M)||e1(M,C,S));for(M in I){if(!I.hasOwnProperty(M))continue;const P=I[M];w.hasOwnProperty(M)?st(w[M],P)||("geojson"===w[M].type&&"geojson"===P.type&&O_(w,I,M)?C.push({command:Fi.setGeoJSONSourceData,args:[M,P.data]}):KA(M,I,C,S)):P_(M,I,C)}}(s.sources,c.sources,_,f);const y=[];s.layers&&s.layers.forEach(w=>{w.source&&f[w.source]?d.push({command:Fi.removeLayer,args:[w.id]}):y.push(w)});let v=s.terrain;v&&f[v.source]&&(d.push({command:Fi.setTerrain,args:[void 0]}),v=void 0),d=d.concat(_),st(v,c.terrain)||d.push({command:Fi.setTerrain,args:[c.terrain]}),function(w,I,C){I=I||[];const S=(w=w||[]).map(r0),M=I.map(r0),P=w.reduce(t1,{}),R=I.reduce(t1,{}),z=S.slice(),G=Object.create(null);let H,j,W,oe,pe,ve,xe;for(H=0,j=0;H<S.length;H++)W=S[H],R.hasOwnProperty(W)?j++:(C.push({command:Fi.removeLayer,args:[W]}),z.splice(z.indexOf(W,j),1));for(H=0,j=0;H<M.length;H++)W=M[M.length-1-H],z[z.length-1-H]!==W&&(P.hasOwnProperty(W)?(C.push({command:Fi.removeLayer,args:[W]}),z.splice(z.lastIndexOf(W,z.length-j),1)):j++,ve=z[z.length-H],C.push({command:Fi.addLayer,args:[R[W],ve]}),z.splice(z.length-H,0,W),G[W]=!0);for(H=0;H<M.length;H++)if(W=M[H],oe=P[W],pe=R[W],!G[W]&&!st(oe,pe))if(st(oe.source,pe.source)&&st(oe["source-layer"],pe["source-layer"])&&st(oe.type,pe.type)){for(xe in k_(oe.layout,pe.layout,C,W,null,Fi.setLayoutProperty),k_(oe.paint,pe.paint,C,W,null,Fi.setPaintProperty),st(oe.slot,pe.slot)||C.push({command:Fi.setSlot,args:[W,pe.slot]}),st(oe.filter,pe.filter)||C.push({command:Fi.setFilter,args:[W,pe.filter]}),st(oe.minzoom,pe.minzoom)&&st(oe.maxzoom,pe.maxzoom)||C.push({command:Fi.setLayerZoomRange,args:[W,pe.minzoom,pe.maxzoom]}),oe)oe.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&"slot"!==xe&&(0===xe.indexOf("paint.")?k_(oe[xe],pe[xe],C,W,xe.slice(6),Fi.setPaintProperty):st(oe[xe],pe[xe])||C.push({command:Fi.setLayerProperty,args:[W,xe,pe[xe]]}));for(xe in pe)pe.hasOwnProperty(xe)&&!oe.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&"slot"!==xe&&(0===xe.indexOf("paint.")?k_(oe[xe],pe[xe],C,W,xe.slice(6),Fi.setPaintProperty):st(oe[xe],pe[xe])||C.push({command:Fi.setLayerProperty,args:[W,xe,pe[xe]]}))}else C.push({command:Fi.removeLayer,args:[W]}),ve=z[z.lastIndexOf(W)+1],C.push({command:Fi.addLayer,args:[pe,ve]})}(y,c.layers,d),function(w=[],I=[],C){I=I||[];const S=(w=w||[]).map(r0),M=I.map(r0),P=w.reduce(t1,{}),R=I.reduce(t1,{}),z=S.slice();let G,H,j,W;for(G=0,H=0;G<S.length;G++)j=S[G],R.hasOwnProperty(j)?H++:(C.push({command:Fi.removeImport,args:[j]}),z.splice(z.indexOf(j,H),1));for(G=0,H=0;G<M.length;G++)j=M[M.length-1-G],z[z.length-1-G]!==j&&(P.hasOwnProperty(j)?(C.push({command:Fi.removeImport,args:[j]}),z.splice(z.lastIndexOf(j,z.length-H),1)):H++,W=z[z.length-G],C.push({command:Fi.addImport,args:[R[j],W]}),z.splice(z.length-G,0,j));for(const oe of I){const pe=P[oe.id];if(!pe||st(pe,oe))continue;st(pe.config,oe.config)||C.push({command:Fi.setImportConfig,args:[oe.id,oe.config]}),st(pe.url,oe.url)||C.push({command:Fi.setImportUrl,args:[oe.id,oe.url]});const ve=oe.data;st(pe&&pe.data,ve)||C.push({command:Fi.setImportData,args:[oe.id,ve]})}}(s.imports,c.imports,d)}catch(f){console.warn("Unable to compute style diff:",f),d=[{command:Fi.setStyle,args:[c]}]}return d}(this.serialize(),e).filter(s=>!(s.command in T0));if(0===n.length)return!1;const i=n.filter(s=>!(s.command in I0));if(i.length>0)throw new Error(`Unimplemented: ${i.map(s=>s.command).join(", ")}.`);return n.forEach(s=>{this[s.command].apply(this,s.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,n){return this.getImage(e)?this.fire(new wn(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,n),this._afterImageUpdated(e),this)}updateImage(e,n){this.imageManager.updateImage(e,this.scope,n)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new wn(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new kt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,n,i={}){return this._checkLoaded(),this._validate(aT,`models.${e}`,n,null,i)||(this.modelManager.addModel(e,n,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new wn(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(ZC,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const s=ym(e,n,this.dispatcher,this);s.scope=this.scope,s.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s.id),source:s.serialize(),sourceId:s.id}));const c=d=>{const f=(d?"symbol:":"other:")+s.id,_=Xa(f,this.scope),y=this._sourceCaches[f]=new ec(_,s,d);(d?this._symbolSourceCaches:this._otherSourceCaches)[s.id]=y,y.onAdd(this.map)};c(!1),"vector"!==n.type&&"geojson"!==n.type||c(!0),s.onAdd&&s.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const n=this.getOwnSource(e);if(!n)throw new Error("There is no source with this ID");for(const s in this._layers)if(this._layers[s].source===e)return this.fire(new wn(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new wn(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(e);for(const s of i){const c=Cy(s.id);delete this._sourceCaches[c],delete this._changes.updatedSourceCaches[s.id],s.fire(new kt("data",{sourceDataType:"metadata",dataType:"source",sourceId:s.getSource().id})),s.setEventedParent(null),s.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,n){this._checkLoaded(),this.getOwnSource(e).setData(n),this._changes.changed=!0}getOwnSource(e){const n=this.getOwnSourceCache(e);return n&&n.getSource()}getOwnSources(){const e=[];for(const n in this._otherSourceCaches){const i=this.getOwnSourceCache(n);i&&e.push(i.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const s of e){if(this._validate(Q0,"lights",s))return;switch(s.type){case"ambient":if(this.ambientLight){const c=this.ambientLight;c.set(s),c.updateTransitions(n)}else this.ambientLight=new hm(s,GA,this.scope,this.options);break;case"directional":if(this.directionalLight){const c=this.directionalLight;c.set(s),c.updateTransitions(n)}else this.directionalLight=new hm(s,Hb,this.scope,this.options)}}const i=new Vo(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,n=this.ambientLight;if(!e||!n)return;const i=w=>.2126*(w[0]<=.03928?w[0]/12.92:Math.pow((w[0]+.055)/1.055,2.4))+.7152*(w[1]<=.03928?w[1]/12.92:Math.pow((w[1]+.055)/1.055,2.4))+.0722*(w[2]<=.03928?w[2]/12.92:Math.pow((w[2]+.055)/1.055,2.4)),s=e.properties.get("color").toArray01(),c=e.properties.get("intensity"),d=e.properties.get("direction"),f=1-In(d.x,d.y,d.z)[2]/90,_=i(s)*c*f,y=n.properties.get("color").toArray01(),v=n.properties.get("intensity");return(_+i(y)*v)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const n=this.fragments.find(({id:i})=>i===e);if(!n)throw new Error(`Style import not found: ${e}`);return n.style}setConfigProperty(e,n,i){const s=Zt(i);if("success"!==s.result)return void bu(this,s.value);const c=s.value.expression,d=this.getFragmentStyle(e);d.options.set(n,c),d.updateConfigDependencies()}setConfig(e,n){if(this.options.clear(),e){for(const i in e){const s=Zt(e[i]);"success"===s.result&&this.options.set(i,s.value.expression)}this.updateSchema(n)}}updateSchema(e){if(e)for(const n in e){if(this.options.has(n))continue;const i=Zt(e[n].default);"success"===i.result&&this.options.set(n,i.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const n=this.getLayer(e);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,n,i={}){this._checkLoaded();const s=e.id;if(this._layers[s])return void this.fire(new wn(new Error(`Layer with id "${s}" already exists on this map`)));let c;if("custom"===e.type){if(bu(this,function(v){const w=[],I=v.id;return void 0===I&&w.push({message:`layers.${I}: missing required property "id"`}),void 0===v.render&&w.push({message:`layers.${I}: missing required method "render"`}),v.renderingMode&&"2d"!==v.renderingMode&&"3d"!==v.renderingMode&&w.push({message:`layers.${I}: property "renderingMode" must be either "2d" or "3d"`}),w}(e)))return;c=zc(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(s,e.source),e=Ye(e=ue(e),{source:s})),this._validate(J0,`layers.${s}`,e,{arrayIndex:-1},i))return;c=zc(e,this.options),this._validateLayer(c),c.setEventedParent(this,{layer:{id:s}}),this._serializedLayers[c.id]=c.serialize()}c.isConfigDependent&&this._configDependentLayers.add(c.fqid),c.setScope(this.scope);const d=n?this._order.indexOf(n):this._order.length;if(n&&-1===d)return void this.fire(new wn(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(d,0,s),this._layerOrderChanged=!0,this._layers[s]=c;const f=this.getOwnLayerSourceCache(c),_=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&c.canCastShadows()&&_&&(f.castsShadows=!0);const y=this._changes.getRemovedLayer(c);if(y&&c.source&&f&&"custom"!==c.type){this._changes.discardLayerRemoval(c);const v=Xa(c.source,c.scope);y.type!==c.type?this._changes.updatedSourceCaches[v]="clear":(this._changes.updatedSourceCaches[v]="reload",f.pause())}this._updateLayer(c),c.onAdd&&c.onAdd(this.map),c.scope=this.scope,this.mergeLayers()}moveLayer(e,n){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e)||e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const s=n?this._order.indexOf(n):this._order.length;n&&-1===s?this.fire(new wn(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const s=this.getOwnLayerSourceCache(n);if(s&&s.castsShadows){let c=!1;for(const d in this._layers)if(this._layers[d].source===n.source&&this._layers[d].canCastShadows()){c=!0;break}s.castsShadows=c}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const n in this._layers)if(this._layers[n].type===e)return!0;return!1}setLayerZoomRange(e,n,i){this._checkLoaded();const s=this._checkLayer(e);s&&(s.minzoom===n&&s.maxzoom===i||(null!=n&&(s.minzoom=n),null!=i&&(s.maxzoom=i),this._updateLayer(s)))}setSlot(e,n){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==n&&(i.slot=n,this._updateLayer(i))}setFilter(e,n,i={}){this._checkLoaded();const s=this._checkLayer(e);if(s&&!st(s.filter,n))return null==n?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(Au,`layers.${s.id}.filter`,n,{layerType:s.type},i)||(s.filter=ue(n),this._updateLayer(s)))}getFilter(e){const n=this._checkLayer(e);if(n)return ue(n.filter)}setLayoutProperty(e,n,i,s={}){this._checkLoaded();const c=this._checkLayer(e);c&&(st(c.getLayoutProperty(n),i)||(c.setLayoutProperty(n,i,s),c.isConfigDependent&&this._configDependentLayers.add(c.fqid),this._updateLayer(c)))}getLayoutProperty(e,n){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(n)}setPaintProperty(e,n,i,s={}){this._checkLoaded();const c=this._checkLayer(e);if(!c||st(c.getPaintProperty(n),i))return;const d=c.setPaintProperty(n,i,s);c.isConfigDependent&&this._configDependentLayers.add(c.fqid),d&&this._updateLayer(c),this._changes.changed=!0,this._changes.updatedPaintProps.add(c.fqid)}getPaintProperty(e,n){const i=this._checkLayer(e);if(i)return i.getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const i=e.source,s=e.sourceLayer,c=this._checkSource(i);if(!c)return;const d=c.type;if("geojson"===d&&s)return void this.fire(new wn(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===d&&!s)return void this.fire(new wn(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new wn(new Error("The feature id parameter must be provided.")));const f=this.getOwnSourceCaches(i);for(const _ of f)_.setFeatureState(s,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const i=e.source,s=this._checkSource(i);if(!s)return;const c=s.type,d="vector"===c?e.sourceLayer:void 0;if("vector"===c&&!d)return void this.fire(new wn(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new wn(new Error("A feature id is required to remove its specific state property.")));const f=this.getOwnSourceCaches(i);for(const _ of f)_.removeFeatureState(d,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,s=this._checkSource(n);if(s){if("vector"!==s.type||i)return void 0===e.id&&this.fire(new wn(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,e.id);this.fire(new wn(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Ye({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Ye({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),n=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return qe({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},i=>void 0!==i)}_updateLayer(e){this._changes.updateLayer(e);const n=this.getLayerSourceCache(e),i=Xa(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updatedSourceCaches[i]="reload",n.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const n=f=>"fill-extrusion"===this._mergedLayers[f].type,i=this.order,s={},c=[];for(let f=i.length-1;f>=0;f--){const _=i[f];if(n(_)){s[_]=f;for(const y of e){const v=y[_];if(v)for(const w of v)c.push(w)}}}c.sort((f,_)=>_.intersectionZ-f.intersectionZ);const d=[];for(let f=i.length-1;f>=0;f--){const _=i[f];if(n(_))for(let y=c.length-1;y>=0;y--){const v=c[y].feature;if(s[v.layer.id]<f)break;d.push(v),c.pop()}else for(const y of e){const v=y[_];if(v)for(const w of v)d.push(w.feature)}}return d}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(Au,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new wn(new Error("parameters.layers must be an Array."))),[];for(const y of n.layers){const v=this._mergedLayers[y];if(!v)return this.fire(new wn(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];s[v.source]=!0}}const c=[],d=n.serializedLayers||{},f=n&&n.layers?n.layers.some(y=>{const v=this.getLayer(y);return v&&v.is3D()}):this.has3DLayers(),_=Nh.createFromScreenPoints(e,i);for(const y in this._mergedSourceCaches){const v=this._mergedSourceCaches[y].getSource();if(!v||v.scope!==n.scope)continue;const w=this._mergedSourceCaches[y].getSource().id;n.layers&&!s[w]||c.push(zE(this._mergedSourceCaches[y],this._mergedLayers,d,_,n,i,f,!!this.map._showQueryGeometry))}return this.placement&&c.push(function(y,v,w,I,C,S,M){const P={},R=S.queryRenderedSymbols(I),z=[];for(const G of Object.keys(R).map(Number))z.push(M[G]);z.sort(n0);for(const G of z){const H=G.featureIndex.lookupSymbolFeatures(R[G.bucketInstanceId],v,G.bucketIndex,G.sourceLayerIndex,C.filter,C.layers,C.availableImages,y);for(const j in H){const W=P[j]=P[j]||[],oe=H[j];oe.sort((pe,ve)=>{const xe=G.featureSortOrder;if(xe){const ke=xe.indexOf(pe.featureIndex);return xe.indexOf(ve.featureIndex)-ke}return ve.featureIndex-pe.featureIndex});for(const pe of oe)W.push(pe)}}for(const G in P)P[G].forEach(H=>{const j=H.feature,W=w(y[G]);if(!W)return;const oe=W.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=oe});return P}(this._mergedLayers,d,this.getLayerSourceCache.bind(this),_.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(e,n){n&&n.filter&&this._validate(Au,"querySourceFeatures.filter",n.filter,null,n);const i=this.getOwnSourceCaches(e);let s=[];for(const c of i)s=s.concat(YA(c,n));return s}addSourceType(e,n,i){return sl.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(sl.setSourceType(e,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:n.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n,i={}){this._checkLoaded();const s=this.light.getLight();let c=!1;for(const f in e)if(!st(e[f],s[f])){c=!0;break}if(!c)return;const d=this._getTransitionParameters();this.light.setLight(e,n,i),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=e;if(1===n){if("object"==typeof i.source){const s="terrain-dem-src";this.addSource(s,i.source),i=ue(i),i=Ye(i,{source:s})}if(this._validate(sT,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new kt("data",{dataType:"style"}))}else{const s=this.terrain,c=s.get();for(const d of Object.keys(ut.terrain))!i.hasOwnProperty(d)&&ut.terrain[d].default&&(i[d]=ut.terrain[d].default);for(const d in e)if(!st(e[d],c[d])){s.set(e),this.stylesheet.terrain=e;const f=this._getTransitionParameters({duration:0});s.updateTransitions(f),this.fire(new kt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const n=this.fog=new kh(e,this.map.transform);this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!st(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:ne.now(),transition:Ye(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],n=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):n.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...n)}_createTerrain(e,n){const i=this.terrain=new qS(e,n);i.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const s=this._getTransitionParameters({duration:0});i.updateTransitions(s)}_force3DLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"fill-extrusion"===n.type&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"symbol"===n.type&&this._updateLayer(n)}}_validate(e,n,i,s,c={}){if(c&&!1===c.validate)return!1;const d=Ye({},this.serialize());return bu(this,e.call(Zm,Ye({key:n,style:d,value:i,styleSpec:ut},s)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_p.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const n=this.getSourceCaches(e);for(const i of n)i.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const n=this.getSourceCaches(e);for(const i of n)i.resume(),i.reload()}updateSources(e){let n;this.directionalLight&&(n=X_(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,n)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const n=this._sourceCaches[e];n.resume(),n.reload()}}_updatePlacement(e,n,i,s,c=!1){let d=!1,f=!1;const _={},y={};for(const v of this._mergedOrder){const w=this._mergedLayers[v];if("symbol"!==w.type)continue;const I=Xa(w.source,w.scope);let C=_[I];if(!C){const M=this.getLayerSourceCache(w);if(!M)continue;const P=M.getRenderableIds(!0).map(R=>M.getTileByID(R));y[I]=P.slice(),C=_[I]=P.sort((R,z)=>z.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(z.tileID)?-1:1))}const S=this.crossTileSymbolIndex.addLayer(w,C,e.center.lng,e.projection);d=d||S}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),c=c||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new kt("neworder")),(c||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),e.zoom))&&(this.pauseablePlacement=new a0(e,this._mergedOrder,c,n,i,s,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,_,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),f=!0),d&&this.pauseablePlacement.placement.setStale()),f||d)for(const v of this._mergedOrder){const w=this._mergedLayers[v];"symbol"===w.type&&this.placement.updateLayerOpacities(w,_[Xa(w.source,w.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex(({id:s})=>s===e.id)?this.fire(new wn(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(n.push(e),this._loadImports([e],!0),this)}setImportUrl(e,n){this._checkLoaded();const i=this.stylesheet.imports||[],s=this.getImportIndex(e);if(-1===s)return this;i[s].url=n;const c=this.fragments[s];c.style=this._createFragmentStyle({id:e,url:n});const d=new Promise(f=>c.style.on("style.import.load",f));return c.style.loadURL(n),d.then(()=>this._reloadImports()),this}setImportData(e,n){this._checkLoaded();const i=this.getImportIndex(e),s=this.stylesheet.imports||[];return-1===i?this:n?(this.fragments[i].style.setState(n),this._reloadImports(),this):(delete s[i].data,this.setImportUrl(e,s[i].url))}setImportConfig(e,n){this._checkLoaded();const i=this.getImportIndex(e),s=this.stylesheet.imports||[];if(-1===i)return this;n?s[i].config=n:delete s[i].config;const c=this.fragments[i],d=c.style.stylesheet&&c.style.stylesheet.schema;return c.config=n,c.style.setConfig(n,d),c.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);return-1===i||(n.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){const n=(this.stylesheet.imports||[]).findIndex(i=>i.id===e);return-1===n&&this.fire(new wn(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const n in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[n];i&&e.push(i.getSource())}return e}getSource(e,n){const i=this.getSourceCache(e,n);return i&&i.getSource()}getLayerSource(e){const n=this.getLayerSourceCache(e);return n&&n.getSource()}getSourceCache(e,n){const i=Xa(e,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(e){const n=Xa(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){const n=[];return this._mergedOtherSourceCaches[e]&&n.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&n.push(this._mergedSymbolSourceCaches[e]),n}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const n=this._changes.updatedSourceCaches[e];"reload"===n?this.reloadSource(e):"clear"===n&&this.clearSource(e)}}updateLayers(e){for(const n of this._changes.updatedPaintProps){const i=this.getLayer(n);i&&i.updateTransitions(e)}}getImages(e,n,i){this.imageManager.getImages(n.icons,n.scope,i),this._updateTilesForChangedImages();const s=c=>{c&&c.setDependencies(n.tileID.key,n.type,n.icons)};s(this._otherSourceCaches[n.source]),s(this._symbolSourceCaches[n.source])}getGlyphs(e,n,i){this.glyphManager.getGlyphs(n.stacks,n.scope,i)}getResource(e,n,i){return vn(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const n=[];return this._otherSourceCaches[e]&&n.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&n.push(this._symbolSourceCaches[e]),n}_isSourceCacheLoaded(e){const n=this.getOwnSourceCaches(e);return 0===n.length?(this.fire(new wn(new Error(`There is no source with ID '${e}'`))),!1):n.every(i=>i.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function J_(t,e){let n=!1,i=null;const s=()=>{i=null,n&&(t(),i=setTimeout(s,e),n=!1)};return()=>(n=!0,i||s(),i)}sl.getSourceType=function(t){return t0[t]},sl.setSourceType=function(t,e){t0[t]=e},sl.registerForPluginStateChange=function(t){return t({pluginStatus:Nl,pluginURL:Es}),_p.on("pluginStateChange",t),t};class _I{constructor(e){this._hashName=e&&encodeURIComponent(e),gr(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=J_(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,ge.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),ge.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=ey(e);if(this._hashName){const i=this._hashName;let s=!1;const c=ge.location.hash.slice(1).split("&").map(d=>{const f=d.split("=")[0];return f===i?(s=!0,`${f}=${n}`):d}).filter(d=>d);return s||c.push(`${i}=${n}`),`#${c.join("&")}`}return`#${n}`}_getCurrentHash(){const e=ge.location.hash.replace("#","");if(this._hashName){let n;return e.split("&").map(i=>i.split("=")).forEach(i=>{i[0]===this._hashName&&(n=i)}),(n&&n[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(i=>isNaN(i))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(n[3]||0):e.getBearing();return e.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=ge.location.href.replace(/(#.+)?$/,this.getHashString());ge.history.replaceState(ge.history.state,null,e)}}function ey(t,e){const n=t.getCenter(),i=Math.round(100*t.getZoom())/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,s),d=Math.round(n.lng*c)/c,f=Math.round(n.lat*c)/c,_=t.getBearing(),y=t.getPitch();let v=e?`/${d}/${f}/${i}`:`${i}/${f}/${d}`;return(_||y)&&(v+="/"+Math.round(10*_)/10),y&&(v+=`/${Math.round(y)}`),v}const A0={linearity:.3,easing:Un(0,0,.3,1)},C0=Ye({deceleration:2500,maxSpeed:1400},A0),yI=Ye({deceleration:20,maxSpeed:1400},A0),vI=Ye({deceleration:1e3,maxSpeed:360},A0),C1=Ye({deceleration:1e3,maxSpeed:90},A0);class xI{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=ne.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new me(0,0),pinchAround:void 0,around:void 0};for(const{settings:c}of this._inertiaBuffer)n.zoom+=c.zoomDelta||0,n.bearing+=c.bearingDelta||0,n.pitch+=c.pitchDelta||0,c.panDelta&&n.pan._add(c.panDelta),c.around&&(n.around=c.around),c.pinchAround&&(n.pinchAround=c.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){const c=Kd(n.pan.mag(),i,Ye({},C0,e||{}));s.offset=n.pan.mult(c.amount/n.pan.mag()),s.center=this._map.transform.center,S0(s,c)}if(n.zoom){const c=Kd(n.zoom,i,yI);s.zoom=this._map.transform.zoom+c.amount,S0(s,c)}if(n.bearing){const c=Kd(n.bearing,i,vI);s.bearing=this._map.transform.bearing+_n(c.amount,-179,179),S0(s,c)}if(n.pitch){const c=Kd(n.pitch,i,C1);s.pitch=this._map.transform.pitch+c.amount,S0(s,c)}if(s.zoom||s.bearing){const c=void 0===n.pinchAround?n.around:n.pinchAround;s.around=c?this._map.unproject(c):this._map.getCenter()}return this.clear(),s.noMoveStart=!0,s}}function S0(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Kd(t,e,n){const{maxSpeed:i,linearity:s,deceleration:c}=n,d=_n(t*s/(e/1e3),-i,i),f=Math.abs(d)/(c*s);return{easing:n.easing,duration:1e3*f,amount:d*(f/2)}}class Al extends kt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,s={}){const c=$t(n.getCanvasContainer(),i);super(e,Ye({point:c,lngLat:n.unproject(c),originalEvent:i},s)),this._defaultPrevented=!1,this.target=n}}class D0 extends kt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const s="touchend"===e?i.changedTouches:i.touches,c=bt(n.getCanvasContainer(),s),d=c.map(_=>n.unproject(_)),f=c.reduce((_,y,v,w)=>_.add(y.div(w.length)),new me(0,0));super(e,{points:c,point:f,lngLats:d,lngLat:n.unproject(f),originalEvent:i}),this._defaultPrevented=!1}}class DC extends kt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class bI{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new DC(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Al(e.type,this._map,e))}mouseup(e){this._map.fire(new Al(e.type,this._map,e))}preclick(e){const n=Ye({},e);n.type="preclick",this._map.fire(new Al(n.type,this._map,n))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Al(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Al(e.type,this._map,e))}mouseover(e){this._map.fire(new Al(e.type,this._map,e))}mouseout(e){this._map.fire(new Al(e.type,this._map,e))}touchstart(e){return this._firePreventable(new D0(e.type,this._map,e))}touchmove(e){this._map.fire(new D0(e.type,this._map,e))}touchend(e){this._map.fire(new D0(e.type,this._map,e))}touchcancel(e){this._map.fire(new D0(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wI{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Al(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Al("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Al(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oD{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&0===e.button&&(q(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const i=n,s=this._startPos,c=this._lastPos;if(!s||!c||c.equals(i)||!this._box&&i.dist(s)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(s.x,i.x),f=Math.max(s.x,i.x),_=Math.min(s.y,i.y),y=Math.max(s.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${d}px,${_}px)`,this._box.style.width=f-d+"px",this._box.style.height=y-_+"px")})}mouseupWindow(e,n){if(!this._active)return;const i=this._startPos,s=n;if(i&&0===e.button){if(this.reset(),ct(),i.x!==s.x||i.y!==s.y)return this._map.fire(new kt("boxzoomend",{originalEvent:e})),{cameraAnimation:c=>c.fitScreenCoordinates(i,s,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ce(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new kt(e,{originalEvent:n}))}}function ty(t,e){const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class MC{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(s){const c=new me(0,0);for(const d of s)c._add(d);return c.div(s.length)}(n),this.touches=ty(i,n)))}touchmove(e,n,i){if(this.aborted||!this.centroid)return;const s=ty(i,n);for(const c in this.touches){const d=s[c];(!d||d.dist(this.touches[c])>30)&&(this.aborted=!0)}}touchend(e,n,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class M0{constructor(e){this.singleTap=new MC(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,n,i){this.singleTap.touchstart(e,n,i)}touchmove(e,n,i){this.singleTap.touchmove(e,n,i)}touchend(e,n,i){const s=this.singleTap.touchend(e,n,i);if(s){const c=e.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(s)<30;if(c&&d||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class RC{constructor(){this._zoomIn=new M0({numTouches:1,numTaps:2}),this._zoomOut=new M0({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,i){this._zoomIn.touchstart(e,n,i),this._zoomOut.touchstart(e,n,i)}touchmove(e,n,i){this._zoomIn.touchmove(e,n,i),this._zoomOut.touchmove(e,n,i)}touchend(e,n,i){const s=this._zoomIn.touchend(e,n,i),c=this._zoomOut.touchend(e,n,i);return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()+1,around:d.unproject(s)},{originalEvent:e})}):c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()-1,around:d.unproject(c)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const EI={0:1,2:2};class II{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,n){return!1}_move(e,n){return{}}mousedown(e,n){if(this._lastPoint)return;const i=fn(e);this._correctButton(e,i)&&(this._lastPoint=n,this._eventButton=i)}mousemoveWindow(e,n){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(s,c){const d=EI[c];return void 0===s.buttons||(s.buttons&d)!==d}(e,this._eventButton))this.reset();else if(this._moved||!(n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}mouseupWindow(e){this._lastPoint&&fn(e)===this._eventButton&&(this._moved&&ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class TI extends II{mousedown(e,n){super.mousedown(e,n),this._lastPoint&&(this._active=!0)}_correctButton(e,n){return 0===n&&!e.ctrlKey}_move(e,n){return{around:n,panDelta:n.sub(e)}}}class Cl extends II{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=.8*(n.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class $h extends II{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=-.5*(n.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class AI{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),gr(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new me(0,0)}touchstart(e,n,i){return this._calculateTransform(e,n,i)}touchmove(e,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!Dn())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,n,i)}}touchend(e,n,i){this._calculateTransform(e,n,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const s=ty(i,n),c=new me(0,0),d=new me(0,0);let f=0;for(const y in s){const v=s[y],w=this._touches[y];w&&(c._add(v),d._add(v.sub(w)),f++,s[y]=v)}if(this._touches=s,f<this._minTouches||!d.mag())return;const _=d.div(f);return this._sum._add(_),this._sum.mag()<this._clickTolerance?void 0:{around:c.div(f),panDelta:_}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class R0{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,n,i){return{}}touchstart(e,n,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,i){const s=this._firstTwoTouches;if(!s)return;e.preventDefault();const[c,d]=s,f=ep(i,n,c),_=ep(i,n,d);if(!f||!_)return;const y=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],y,e)}touchend(e,n,i){if(!this._firstTwoTouches)return;const[s,c]=this._firstTwoTouches,d=ep(i,n,s),f=ep(i,n,c);d&&f||(this._active&&ct(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ep(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function tp(t,e){return Math.log(t/e)/Math.LN2}class Mm extends R0{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(tp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tp(this._distance,i),pinchAround:n}}}function Rm(t,e){return 180*t.angleWith(e)/Math.PI}class np extends R0{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rm(this._vector,i),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const s=Rm(e,i);return Math.abs(s)<n}}function S1(t){return Math.abs(t.y)>Math.abs(t.x)}class Pm extends R0{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,S1(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,i){const s=this._lastPoints;if(!s)return;const c=e[0].sub(s[0]),d=e[1].sub(s[1]);return this._map._cooperativeGestures&&!Dn()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(c,d,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5})}gestureBeginsVertically(e,n,i){if(void 0!==this._valid)return this._valid;const s=e.mag()>=2,c=n.mag()>=2;if(!s&&!c)return;if(!s||!c)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const d=e.y>0==n.y>0;return S1(e)&&S1(n)&&d}}const sD={panStep:100,bearingStep:15,pitchStep:10};class aD{constructor(){const e=sD;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,i=0,s=0,c=0,d=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),c=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),c=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),d=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),d=1);break;default:return}return this._rotationDisabled&&(i=0,s=0),{cameraAnimation:f=>{const _=f.getZoom();f.easeTo({duration:300,easeId:"keyboardHandler",easing:CI,zoom:n?Math.round(_)+n*(e.shiftKey?2:1):_,bearing:f.getBearing()+i*this._bearingStep,pitch:f.getPitch()+s*this._pitchStep,offset:[-c*this._panStep,-d*this._panStep],center:f.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function CI(t){return t*(2-t)}const ny=4.000244140625;class D1{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,gr(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||Dn()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===ge.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=ne.now(),s=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%ny==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=$t(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const y="wheel"===this._type&&Math.abs(this._delta)>ny?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&0!==v&&(v=1/v);const w=n(),I=Math.pow(2,w),C="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):I;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(C*v))),"wheel"===this._type&&(this._startZoom=w,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),s=this._startZoom,c=this._easing;let d,f=!1;if("wheel"===this._type&&s&&c){const y=Math.min((ne.now()-this._lastWheelEventTime)/200,1);d=Er(s,i,c(y)),y<1?this._frameId||(this._frameId=!0):f=!0}else d=i,f=!0;this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let _=d-n();return _*this._lastDelta<0&&(_=0),{noInertia:!0,needsRenderFrame:!f,zoomDelta:_,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=nr;if(this._prevEase){const i=this._prevEase,s=(ne.now()-i.start)/i.duration,c=i.easing(s+.01)-i.easing(s),d=.27/Math.sqrt(c*c+1e-4)*.01;n=Un(d,Math.sqrt(.0729-d*d),.25,1)}return this._prevEase={start:ne.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(ge.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class SI{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class M1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,n){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class DI{constructor(){this._tap=new M0({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,n,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=n[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,n,i))}touchmove(e,n,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const s=n[0],c=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:c/128}}}else this._tap.touchmove(e,n,i)}touchend(e,n,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,n,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class PC{constructor(e,n,i){this._el=e,this._mousePan=n,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class R1{constructor(e,n,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lD{constructor(e,n,i,s){this._el=e,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ry=t=>t.zoom||t.drag||t.pitch||t.rotate;class iy extends kt{}class OC{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const i=He.sub([],n,e);this.radius=He.length(i[2]<0?He.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){He.div(e,e,this.constants),He.normalize(e,e),He.mul(e,e,this.constants);const n=He.scale([],e,this.radius);if(n[2]>0){const i=He.scale([],[0,0,1],He.dot(n,[0,0,1])),s=He.scale([],He.normalize([],[n[0],n[1],0]),this.radius),c=He.add([],n,He.scale([],He.sub([],He.add([],s,i),n),2));n[0]=c[0],n[1]=c[1]}return n}}function oy(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class P1{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xI(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new OC,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),gr(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[ge.document,"mousemove",{capture:!0}],[ge.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[ge,"blur",void 0]];for(const[s,c,d]of this._listeners)s.addEventListener(c,s===ge.document?this.handleWindowEvent:this.handleEvent,d)}destroy(){for(const[e,n,i]of this._listeners)e.removeEventListener(n,e===ge.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new bI(n,e));const s=n.boxZoom=new oD(n,e);this._add("boxZoom",s);const c=new RC,d=new M1;n.doubleClickZoom=new SI(d,c),this._add("tapZoom",c),this._add("clickZoom",d);const f=new DI;this._add("tapDragZoom",f);const _=n.touchPitch=new Pm(n);this._add("touchPitch",_);const y=new Cl(e),v=new $h(e);n.dragRotate=new R1(e,y,v),this._add("mouseRotate",y,["mousePitch"]),this._add("mousePitch",v,["mouseRotate"]);const w=new TI(e),I=new AI(n,e);n.dragPan=new PC(i,w,I),this._add("mousePan",w),this._add("touchPan",I,["touchZoom","touchRotate"]);const C=new np,S=new Mm;n.touchZoomRotate=new lD(i,S,C,f),this._add("touchRotate",C,["touchPan","touchZoom"]),this._add("touchZoom",S,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wI(n));const M=n.scrollZoom=new D1(n,this);this._add("scrollZoom",M,["mousePan"]);const P=n.keyboard=new aD;this._add("keyboard",P);for(const R of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[R]&&n[R].enable(e[R])}_add(e,n,i){this._handlers.push({handlerName:e,handler:n,allowed:i}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ry(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,n,i){for(const s in e)if(s!==i&&(!n||n.indexOf(s)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const n=[];for(const i of e)this._el.contains(i.target)&&n.push(i);return n}handleEvent(e,n){this._updatingCamera=!0;const i="renderFrame"===e.type,s=i?void 0:e,c={needsRenderFrame:!1},d={},f={},_=e.touches?this._getMapTouches(e.touches):void 0,y=_?bt(this._el,_):i?void 0:$t(this._el,e);for(const{handlerName:I,handler:C,allowed:S}of this._handlers){if(!C.isEnabled())continue;let M;this._blockedByActive(f,S,I)?C.reset():C[n||e.type]&&(M=C[n||e.type](e,y,_),this.mergeHandlerResult(c,d,M,I,s),M&&M.needsRenderFrame&&this._triggerRenderFrame()),(M||C.isActive())&&(f[I]=C)}const v={};for(const I in this._previousActiveHandlers)f[I]||(v[I]=s);this._previousActiveHandlers=f,(Object.keys(v).length||oy(c))&&(this._changes.push([c,d,v]),this._triggerRenderFrame()),(Object.keys(f).length||oy(c))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:w}=c;w&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],w(this._map))}mergeHandlerResult(e,n,i,s,c){if(!i)return;Ye(e,i);const d={handlerName:s,originalEvent:i.originalEvent||c};void 0!==i.zoomDelta&&(n.zoom=d),void 0!==i.panDelta&&(n.drag=d),void 0!==i.pitchDelta&&(n.pitch=d),void 0!==i.bearingDelta&&(n.rotate=d)}_applyChanges(){const e={},n={},i={};for(const[s,c,d]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new me(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.aroundCoord&&(e.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),Ye(n,c),Ye(i,d);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,n,i){const s=this._map,c=s.transform,d=z=>[z.x,z.y,z.z];if((z=>{const G=this._eventsInProgress.drag;return G&&!this._handlersById[G.handlerName].isActive()})()&&!oy(e)){const z=c.zoom;c.cameraElevationReference="sea",null!=this._originalZoom&&c._orthographicProjectionAtLowPitch&&"globe"!==c.projection.name&&0===c.pitch?(c.cameraElevationReference="ground",c.zoom=this._originalZoom):(c.recenterOnTerrain(),c.cameraElevationReference="ground"),z!==c.zoom&&this._map._update(!0)}if(c._isCameraConstrained&&s._stop(!0),!oy(e))return void this._fireEvents(n,i,!0);let{panDelta:f,zoomDelta:_,bearingDelta:y,pitchDelta:v,around:w,aroundCoord:I,pinchAround:C}=e;c._isCameraConstrained&&(_>0&&(_=0),c._isCameraConstrained=!1),void 0!==C&&(w=C),(_||(z=>n[z]&&!this._eventsInProgress[z])("drag"))&&w&&(this._dragOrigin=d(c.pointCoordinate3D(w)),this._originalZoom=c.zoom,this._trackingEllipsoid.setup(c._camera.position,this._dragOrigin)),c.cameraElevationReference="sea",s._stop(!0),w=w||s.transform.centerPoint,y&&(c.bearing+=y),v&&(c.pitch+=v),c._updateCameraState();const S=[0,0,0];if(f)if("mercator"===c.projection.name){const z=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(w).dir),G=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(w.sub(f)).dir);S[0]=G[0]-z[0],S[1]=G[1]-z[1]}else{const z=c.pointCoordinate(w);if("globe"===c.projection.name){f=f.rotate(-c.angle);const G=c._pixelsPerMercatorPixel/c.worldSize;S[0]=-f.x*XT(Gs(z.y))*G,S[1]=-f.y*XT(c.center.lat)*G}else{const G=c.pointCoordinate(w.sub(f));z&&G&&(S[0]=G.x-z.x,S[1]=G.y-z.y)}}const M=c.zoom,P=[0,0,0];if(_){const z=d(I||c.pointCoordinate3D(w)),G={dir:He.normalize([],He.sub([],z,c._camera.position))};if(G.dir[2]<0){const H=c.zoomDeltaToMovement(z,_);He.scale(P,G.dir,H)}}const R=He.add(S,S,P);c._translateCameraConstrained(R),_&&Math.abs(c.zoom-M)>1e-4&&c.recenterOnTerrain(),c.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,i,!0)}_fireEvents(e,n,i){const s=ry(this._eventsInProgress),c=ry(e),d={};for(const v in e){const{originalEvent:w}=e[v];this._eventsInProgress[v]||(d[`${v}start`]=w),this._eventsInProgress[v]=e[v]}!s&&c&&this._fireEvent("movestart",c.originalEvent);for(const v in d)this._fireEvent(v,d[v]);c&&this._fireEvent("move",c.originalEvent);for(const v in e){const{originalEvent:w}=e[v];this._fireEvent(v,w)}const f={};let _;for(const v in this._eventsInProgress){const{handlerName:w,originalEvent:I}=this._eventsInProgress[v];this._handlersById[w].isActive()||(delete this._eventsInProgress[v],_=n[w]||I,f[`${v}end`]=_)}for(const v in f)this._fireEvent(v,f[v]);const y=ry(this._eventsInProgress);if(i&&(s||c)&&!y){this._updatingCamera=!0;const v=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),w=I=>0!==I&&-this._bearingSnap<I&&I<this._bearingSnap;v?(w(v.bearing||this._map.getBearing())&&(v.bearing=0),this._map.easeTo(v,{originalEvent:_})):(this._map.fire(new kt("moveend",{originalEvent:_})),w(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new kt(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new iy("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const kC="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class cD extends Kn{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,gr(["_renderFrameCallback"],this)}getCenter(){return new kr(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,i){return e=me.convert(e).mult(-1),this.panTo(this.transform.center,Ye({offset:e},n),i)}panTo(e,n,i){return this.easeTo(Ye({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,i){return this.easeTo(Ye({zoom:e},n),i)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,i){return this.easeTo(Ye({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,Ye({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(Ye({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Mc.convert(e);const i=n&&n.bearing||0,s=n&&n.pitch||0,c=e.getNorthWest(),d=e.getSouthEast();return this._cameraForBounds(this.transform,c,d,i,s,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=Ye({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}return e.padding=Ye(n,e.padding),e}_minimumAABBFrustumDistance(e,n){const i=n.max[0]-n.min[0],s=n.max[1]-n.min[1];return i/s>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):s/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,n,i,s,c,d){const f=e.clone(),_=this._extendCameraOptions(d);f.bearing=s,f.pitch=c;const y=kr.convert(n),v=kr.convert(i),w=.5*(y.lat+v.lat),I=.5*(y.lng+v.lng),C=hc(w,I),S=He.normalize([],C),M=He.normalize([],He.cross([],S,[0,1,0])),P=He.cross([],M,S),R=[M[0],M[1],M[2],0,P[0],P[1],P[2],0,S[0],S[1],S[2],0,0,0,0,1],z=[C,hc(y.lat,y.lng),hc(v.lat,y.lng),hc(v.lat,v.lng),hc(y.lat,v.lng),hc(w,y.lng),hc(w,v.lng),hc(y.lat,I),hc(v.lat,I)];let G=bo.fromPoints(z.map(it=>[He.dot(M,it),He.dot(P,it),He.dot(S,it)]));const H=He.transformMat4([],G.center,R);0===He.squaredLength(H)&&He.set(H,0,0,1),He.normalize(H,H),He.scale(H,H,Ja),f.center=function([it,St,Ut]){const Wt=Math.hypot(it,St,Ut),ln=Math.atan2(it,Ut),pn=.5*Math.PI-Math.acos(-St/Wt);return new kr(dt(ln),dt(pn))}(H);const j=f.getWorldToCameraMatrix(),W=Dt.invert(new Float64Array(16),j);G=bo.applyTransform(G,Dt.multiply([],j,R)),He.transformMat4(H,H,j);const oe=.5*(G.max[2]-G.min[2]),pe=this._minimumAABBFrustumDistance(f,G),ve=He.scale([],[0,0,1],oe),xe=He.add(ve,H,ve),ke=pe+(0===f.pitch?0:He.distance(H,xe)),Ae=f.globeCenterInViewSpace,$e=He.sub([],H,[Ae[0],Ae[1],Ae[2]]);He.normalize($e,$e),He.scale($e,$e,ke);const Ce=He.add([],H,$e);He.transformMat4(Ce,Ce,W);const nt=yf/Ja,ft=He.length(Ce),It=Zi(Math.max(ft*nt-yf,Number.EPSILON),0),et=Math.min(f.zoomFromMercatorZAdjusted(It),_.maxZoom);return et>.5*(Tg+_f)?(f.setProjection({name:"mercator"}),f.zoom=et,this._cameraForBounds(f,n,i,s,c,d)):{center:f.center,zoom:et,bearing:s,pitch:c}}queryTerrainElevation(e,n){const i=this.transform.elevation;return i?(n=Ye({},{exaggerated:!0},n),i.getAtPoint(Ri.fromLngLat(e),null,n.exaggerated)):null}_cameraForBounds(e,n,i,s,c,d){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,n,i,s,c,d);const f=e.clone(),_=this._extendCameraOptions(d),y=f.padding;f.bearing=s,f.pitch=c;const v=kr.convert(n),w=kr.convert(i),I=new kr(v.lng,w.lat),C=new kr(w.lng,v.lat),S=f.project(v),M=f.project(w),P=this.queryTerrainElevation(v),R=this.queryTerrainElevation(w),z=this.queryTerrainElevation(I),G=this.queryTerrainElevation(C),H=[[S.x,S.y,Math.min(P||0,R||0,z||0,G||0)],[M.x,M.y,Math.max(P||0,R||0,z||0,G||0)]];let j=bo.fromPoints(H);const W=f.getWorldToCameraMatrix(),oe=Dt.invert(new Float64Array(16),W);j=bo.applyTransform(j,W);const pe=He.sub([],j.max,j.min),ve=y.left||0,xe=y.right||0,ke=y.bottom||0,Ae=y.top||0,{left:$e,right:Ce,top:nt,bottom:ft}=_.padding,It=.5*(ve+xe),et=.5*(Ae+ke),it=Math.min(f.scaleZoom(f.scale*Math.min((f.width-(ve+xe+$e+Ce))/pe[0],(f.height-(ke+Ae+ft+nt))/pe[1])),_.maxZoom),St=f.scale/f.zoomScale(it);j=new bo([j.min[0]-($e+It)*St,j.min[1]-(ft+et)*St,j.min[2]],[j.max[0]+(Ce+It)*St,j.max[1]+(nt+et)*St,j.max[2]]);const Ut=.5*pe[2],Wt=this._minimumAABBFrustumDistance(f,j),ln=[0,0,1,0];no.transformMat4(ln,ln,W),no.normalize(ln,ln);const pn=He.scale([],ln,Wt+Ut),Yt=He.add([],j.center,pn),tn=("number"==typeof _.offset.x&&"number"==typeof _.offset.y?new me(_.offset.x,_.offset.y):me.convert(_.offset)).rotate(-De(s));j.center[0]-=tn.x*St,j.center[1]+=tn.y*St,He.transformMat4(j.center,j.center,oe),He.transformMat4(Yt,Yt,oe);const Vn=[j.center[0],j.center[1],Yt[2]*f.pixelsPerMeter];He.scale(Vn,Vn,1/f.worldSize);const Jn=Oc(Vn[0]),Yn=Gs(Vn[1]),Xn=Math.min(f._zoomFromMercatorZ(Vn[2]),_.maxZoom),yr=new kr(Jn,Yn);return f.mercatorFromTransition&&Xn<.5*(Tg+_f)?(f.setProjection({name:"globe"}),f.zoom=Xn,this._cameraForBounds(f,n,i,s,c,d)):{center:yr,zoom:Xn,bearing:s,pitch:c}}fitBounds(e,n,i){const s=this.cameraForBounds(e,n);return this._fitInternal(s,n,i)}fitScreenCoordinates(e,n,i,s,c){const d=me.convert(e),f=me.convert(n),_=new me(Math.min(d.x,f.x),Math.min(d.y,f.y)),y=new me(Math.max(d.x,f.x),Math.max(d.y,f.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(d,f))return this;const v=this.transform.pointLocation3D(_),w=this.transform.pointLocation3D(y),I=this.transform.pointLocation3D(new me(_.x,y.y)),C=this.transform.pointLocation3D(new me(y.x,_.y)),S=[Math.min(v.lng,w.lng,I.lng,C.lng),Math.min(v.lat,w.lat,I.lat,C.lat)],M=[Math.max(v.lng,w.lng,I.lng,C.lng),Math.max(v.lat,w.lat,I.lat,C.lat)],P=s&&s.pitch?s.pitch:this.getPitch(),R=this._cameraForBounds(this.transform,S,M,i,P,s);return this._fitInternal(R,s,c)}_fitInternal(e,n,i){return e?(delete(n=Ye(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=e.preloadOnly?this.transform.clone():this.transform;let s=!1,c=!1,d=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(s=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=kr.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(c=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(d=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new kt("movestart",n)).fire(new kt("move",n)),s&&this.fire(new kt("zoomstart",n)).fire(new kt("zoom",n)).fire(new kt("zoomend",n)),c&&this.fire(new kt("rotatestart",n)).fire(new kt("rotate",n)).fire(new kt("rotateend",n)),d&&this.fire(new kt("pitchstart",n)).fire(new kt("pitch",n)).fire(new kt("pitchend",n)),this.fire(new kt("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Me(kC),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return Me(kC),this;this.stop();const s=i.zoom,c=i.pitch,d=i.bearing;i.setFreeCameraOptions(e);const f=s!==i.zoom,_=c!==i.pitch,y=d!==i.bearing;return this.fire(new kt("movestart",n)).fire(new kt("move",n)),f&&this.fire(new kt("zoomstart",n)).fire(new kt("zoom",n)).fire(new kt("zoomend",n)),y&&this.fire(new kt("rotatestart",n)).fire(new kt("rotate",n)).fire(new kt("rotateend",n)),_&&this.fire(new kt("pitchstart",n)).fire(new kt("pitch",n)).fire(new kt("pitchend",n)),this.fire(new kt("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=Ye({offset:[0,0],duration:500,easing:nr},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const i=this.transform,s=this.getZoom(),c=this.getBearing(),d=this.getPitch(),f=this.getPadding(),_="zoom"in e?+e.zoom:s,y="bearing"in e?this._normalizeBearing(e.bearing,c):c,v="pitch"in e?+e.pitch:d,w="padding"in e?e.padding:i.padding,I=me.convert(e.offset);let C,S,M;if("globe"===i.projection.name){const ve=Ri.fromLngLat(i.center),xe=I.rotate(-i.angle);ve.x+=xe.x/i.worldSize,ve.y+=xe.y/i.worldSize;const ke=ve.toLngLat(),Ae=kr.convert(e.center||ke);this._normalizeCenter(Ae),C=i.centerPoint.add(xe),S=new me(ve.x,ve.y).mult(i.worldSize),M=new me(tl(Ae.lng),Sa(Ae.lat)).mult(i.worldSize).sub(S)}else{C=i.centerPoint.add(I);const ve=i.pointLocation(C),xe=kr.convert(e.center||ve);this._normalizeCenter(xe),S=i.project(ve),M=i.project(xe).sub(S)}const P=i.zoomScale(_-s);let R,z;e.around&&(R=kr.convert(e.around),z=i.locationPoint(R));const G=this._zooming||_!==s,H=this._rotating||c!==y,j=this._pitching||v!==d,W=!i.isPaddingEqual(w),oe=ve=>xe=>{if(G&&(ve.zoom=Er(s,_,xe)),H&&(ve.bearing=Er(c,y,xe)),j&&(ve.pitch=Er(d,v,xe)),W&&(ve.interpolatePadding(f,w,xe),C=ve.centerPoint.add(I)),R)ve.setLocationAtPoint(R,z);else{const ke=ve.zoomScale(ve.zoom-s),Ae=_>s?Math.min(2,P):Math.max(.5,P),$e=Math.pow(Ae,1-xe),Ce=ve.unproject(S.add(M.mult(xe*$e)).mult(ke));ve.setLocationAtPoint(ve.renderWorldCopies?Ce.wrap():Ce,C)}return e.preloadOnly||this._fireMoveEvents(n),ve};if(e.preloadOnly){const ve=this._emulate(oe,e.duration,i);return this._preloadTiles(ve),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=G,this._rotating=H,this._pitching=j,this._padding=W,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,pe),this._ease(oe(i),ve=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,ve)},e),this}_prepareEase(e,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new kt("movestart",e)),this._zooming&&!i.zooming&&this.fire(new kt("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new kt("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new kt("pitchstart",e))}_fireMoveEvents(e){this.fire(new kt("move",e)),this._zooming&&this.fire(new kt("zoom",e)),this._rotating&&this.fire(new kt("rotate",e)),this._pitching&&this.fire(new kt("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,s=this._rotating,c=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new kt("zoomend",e)),s&&this.fire(new kt("rotateend",e)),c&&this.fire(new kt("pitchend",e)),this.fire(new kt("moveend",e))}flyTo(e,n){if(this._prefersReducedMotion(e)){const it=_t(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(it,n)}this.stop(),e=Ye({offset:[0,0],speed:1.2,curve:1.42,easing:nr},e);const i=this.transform,s=this.getZoom(),c=this.getBearing(),d=this.getPitch(),f=this.getPadding(),_="zoom"in e?_n(+e.zoom,i.minZoom,i.maxZoom):s,y="bearing"in e?this._normalizeBearing(e.bearing,c):c,v="pitch"in e?+e.pitch:d,w="padding"in e?e.padding:i.padding,I=i.zoomScale(_-s),C=me.convert(e.offset);let S=i.centerPoint.add(C);const M=i.pointLocation(S),P=kr.convert(e.center||M);this._normalizeCenter(P);const R=i.project(M),z=i.project(P).sub(R);let G=e.curve;const H=Math.max(i.width,i.height),j=H/I,W=z.mag();if("minZoom"in e){const it=_n(Math.min(e.minZoom,s,_),i.minZoom,i.maxZoom),St=H/i.zoomScale(it-s);G=Math.sqrt(St/W*2)}const oe=G*G;function pe(it){const St=(j*j-H*H+(it?-1:1)*oe*oe*W*W)/(2*(it?j:H)*oe*W);return Math.log(Math.sqrt(St*St+1)-St)}function ve(it){return(Math.exp(it)-Math.exp(-it))/2}function xe(it){return(Math.exp(it)+Math.exp(-it))/2}const ke=pe(0);let Ae=function(it){return xe(ke)/xe(ke+G*it)},$e=function(it){return H*((xe(ke)*(ve(St=ke+G*it)/xe(St))-ve(ke))/oe)/W;var St},Ce=(pe(1)-ke)/G;if(Math.abs(W)<1e-6||!isFinite(Ce)){if(Math.abs(H-j)<1e-6)return this.easeTo(e,n);const it=j<H?-1:1;Ce=Math.abs(Math.log(j/H))/G,$e=function(){return 0},Ae=function(St){return Math.exp(it*G*St)}}e.duration="duration"in e?+e.duration:1e3*Ce/("screenSpeed"in e?+e.screenSpeed/G:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const nt=c!==y,ft=v!==d,It=!i.isPaddingEqual(w),et=it=>St=>{const Ut=St*Ce,Wt=1/Ae(Ut);it.zoom=1===St?_:s+it.scaleZoom(Wt),nt&&(it.bearing=Er(c,y,St)),ft&&(it.pitch=Er(d,v,St)),It&&(it.interpolatePadding(f,w,St),S=it.centerPoint.add(C));const ln=1===St?P:it.unproject(R.add(z.mult($e(Ut))).mult(Wt));return it.setLocationAtPoint(it.renderWorldCopies?ln.wrap():ln,S),it._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),it};if(e.preloadOnly){const it=this._emulate(et,e.duration,i);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=nt,this._pitching=ft,this._padding=It,this._prepareEase(n,!1),this._ease(et(i),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const i=this._onEaseEnd;this._onEaseEnd=void 0,i.call(this,n)}if(!e){const i=this.handlers;i&&i.stop(!1)}return this}_ease(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=ne.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=yt(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(e){const n=this.transform;if(!n.renderWorldCopies||n.maxBounds)return;const i=e.lng-n.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&ne.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,n,i){const s=Math.ceil(15*n/1e3),c=[],d=e(i.clone());for(let f=0;f<=s;f++){const _=d(f/s);c.push(_.clone())}return c}}class LC{constructor(e={}){this.options=e,gr(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const n=this.options&&this.options.compact;return this._map=e,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===n&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const i=this._map._getUIString(`AttributionControl.${n}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Be.ACCESS_TOKEN}];if(e){const i=n.reduce((s,c,d)=>(c.value&&(s+=`${c.key}=${c.value}${d<n.length-1?"&":""}`),s),"?");e.href=`${Be.FEEDBACK_URL}/${i}#${ey(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}const n=this._map.style._mergedSourceCaches;for(const s in n){const c=n[s];if(c.used){const d=c.getSource();d.attribution&&e.indexOf(d.attribution)<0&&e.push(d.attribution)}}e.sort((s,c)=>s.length-c.length),e=e.filter((s,c)=>{for(let d=c+1;d<e.length;d++)if(e[d].indexOf(s)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class NC{constructor(){gr(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=Z("div","mapboxgl-ctrl");const n=Z("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const n in e){const i=e[n].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const n=e[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class MI{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue;for(const s of i)if(s.id===e)return void(s.cancelled=!0)}run(e=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const i of n)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function P0(t,e,n){if(t=new kr(t.lng,t.lat),e){const i=new kr(t.lng-360,t.lat),s=new kr(t.lng+360,t.lat),c=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),d=n.locationPoint(t).distSqr(e),f=e.x<0||e.y<0||e.x>n.width||e.y>n.height;n.locationPoint(i).distSqr(e)<d&&(f||Math.abs(i.lng-n.center.lng)<c)?t=i:n.locationPoint(s).distSqr(e)<d&&(f||Math.abs(s.lng-n.center.lng)<c)&&(t=s)}for(;Math.abs(t.lng-n.center.lng)>180;){const i=n.locationPoint(t);if(i.x>=0&&i.y>=0&&i.x<=n.width&&i.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const O0={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sy extends Kn{constructor(e,n){if(super(),(e instanceof ge.HTMLElement||n)&&(e=Ye({element:e},n)),gr(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=me.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");const c=41,d=27,f=_e("svg",{display:"block",height:c*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${c}`},this._element),_=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},f));_e("stop",{offset:"10%","stop-opacity":.4},_),_e("stop",{offset:"100%","stop-opacity":.05},_),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),this._offset=me.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()});const i=this._element.classList;for(const c in O0)i.remove(`mapboxgl-marker-anchor-${c}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const s=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...s),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=kr.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const s=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(24.6+s)],"bottom-right":[-s,-1*(24.6+s)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const n=e.code,i=e.charCode||e.keyCode;"Space"!==n&&"Enter"!==n&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const n=e.originalEvent.target,i=this._element;this._popup&&(n===i||i.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,n=this._pos;if(!e||!n)return!1;const i=e.unproject(n),s=e.getFreeCameraOptions();if(!s.position)return!1;const c=s.position.toLngLat();return c.distanceTo(i)<.9*c.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const n=this._pos;if(!n||n.x<0||n.x>e.transform.width||n.y<0||n.y>e.transform.height)return void this._clearFadeTimer();const i=e.unproject(n);let s;e._showingGlobe()&&Ew(e.transform,this._lngLat)?s=0:(s=1-e._queryFogOpacity(i),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(s*=this._occludedOpacity)),this._element.style.opacity=`${s}`,this._element.style.pointerEvents=s>0?"auto":"none",this._popup&&this._popup._setOpacity(s),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${O0[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${n.x}px,${n.y}px)\n        `}_calculateXYTransform(){const e=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!e||"map"!==i)return"";if(!n._showingGlobe()){const _=n.getPitch();return _?`rotateX(${_}deg)`:""}const s=dt(Ux(n.transform,this._lngLat)),c=e.sub(zD(n.transform)),d=Math.abs(c.x)+Math.abs(c.y);if(0===d)return"";const f=s/d;return`rotateX(${-c.y*f}deg) rotateY(${c.x*f}deg)`}_calculateZTransform(){const e=this._pos,n=this._map;if(!n||!e)return"";let i=0;const s=this.getRotationAlignment();if("map"===s)if(n._showingGlobe()){const c=n.project(new kr(this._lngLat.lng,this._lngLat.lat+.001)),d=n.project(new kr(this._lngLat.lng,this._lngLat.lat-.001)).sub(c);i=dt(Math.atan2(d.y,d.x))-90}else i=-n.getBearing();else if("horizon"===s){const c=sn(4,6,n.getZoom()),d=zD(n.transform);d.y+=c*n.transform.height;const f=e.sub(d),_=dt(Math.atan2(f.y,f.x));i=(_>90?_-270:_+90)*(1-c)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(e){ge.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=P0(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=ge.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=me.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const n=this._map;if(!n)return;const i=this._pointerdownPos,s=this._positionDelta;if(i&&s){if(!this._isDragging){const c=this._clickTolerance||n._clickTolerance;if(e.point.dist(i)<c)return;this._isDragging=!0}this._pos=e.point.sub(s),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new kt("dragstart"))),this.fire(new kt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new kt("dragend")),this._state="inactive"}_addDragHandler(e){const n=this._map,i=this._pos;n&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const n=this._map;return n&&(e?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const FC={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},RI=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function BC(t=new me(0,0),e="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new me(0,t);case"top-left":return new me(n,n);case"top-right":return new me(-n,n);case"bottom":return new me(0,-t);case"bottom-left":return new me(n,-n);case"bottom-right":return new me(-n,-n);case"left":return new me(t,0);case"right":return new me(-t,0)}return new me(0,0)}return t instanceof me||Array.isArray(t)?me.convert(t):me.convert(t[e]||[0,0])}class O1{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const n=Gt((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,n,i){this._start=this.getValue(n),this._end=e,this._startTime=n,this._endTime=n+i}}const VC={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},k1={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},PI={showCompass:!0,showZoom:!0,visualizePitch:!1};class zC{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Cl({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new $h({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),gr(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,n){this.mouseRotate.mousedown(e,n),this.mousePitch&&this.mousePitch.mousedown(e,n),q()}move(e,n){const i=this.map,s=this.mouseRotate.mousemoveWindow(e,n),c=s&&s.bearingDelta;if(c&&i.setBearing(i.getBearing()+c),this.mousePitch){const d=this.mousePitch.mousemoveWindow(e,n),f=d&&d.pitchDelta;f&&i.setPitch(i.getPitch()+f)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ce(),ge.removeEventListener("mousemove",this.mousemove),ge.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Ye({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),$t(this.element,e)),ge.addEventListener("mousemove",this.mousemove),ge.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,$t(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=bt(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=bt(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const L1={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uD={maxWidth:100,unit:"metric"},OI={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},kI={version:Ve,supported:Br,setRTLTextPlugin:function(t,e,n=!1){if(Nl===nx||Nl===cT||Nl===dd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Es=ne.resolveURL(t),Nl=nx,ew=e,lh(),n||yp()},getRTLTextPluginStatus:Fl,Map:class extends cD{constructor(t){if(Qi.mark(ds.create),null!=(t=Ye({},k1,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(e){const n=e.navigator?e.navigator.userAgent:null;return!!function(i){if(null==cn){const s=i.navigator?i.navigator.userAgent:null;cn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return cn}(e)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(ge)&&(t.antialias=!1,Me("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sa(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new MI,this._domRenderTaskQueue=new MI,this._controls=[],this._markers=[],this._popups=[],this._mapId=Gn(),this._locale=Ye({},VC,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new O1(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new qt(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=ge.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof ge.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&Me("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),gr(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==ge&&(this._fullscreenchangeEvent="onfullscreenchange"in ge.document?"fullscreenchange":"webkitfullscreenchange",ge.addEventListener("online",this._onWindowOnline,!1),ge.addEventListener("resize",this._onWindowResize,!1),ge.addEventListener("orientationchange",this._onWindowResize,!1),ge.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ge.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new P1(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||Be.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new _I("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const e=t.bounds;e&&(this.resize(),this.fitBounds(e,Ye({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new LC({customAttribution:t.customAttribution})),this._logoControl=new NC,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new kt(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new kt(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(t,e){if(void 0===e&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new wn(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[e];return-1!==e.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new wn(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new kt("movestart",t)).fire(new kt("move",t)),this.fire(new kt("resize",t)),e&&this.fire(new kt("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Mc.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new kt("zoomstart")).fire(new kt("zoom")).fire(new kt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new kt("zoomstart")).fire(new kt("zoom")).fire(new kt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new kt("pitchstart")).fire(new kt("pitch")).fire(new kt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new kt("pitchstart")).fire(new kt("pitch")).fire(new kt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?ge.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map(e=>"auto"===e?ge.navigator.language:e):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.clearSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,e=t.projection.name;let n;"globe"===e&&t.zoom>=_f?(t.setMercatorFromTransition(),n=!0):"mercator"===e&&t.zoom<_f&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e="globe"===t.name&&this.transform.zoom>=_f?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(kr.convert(t))}unproject(t){return this.transform.pointLocation3D(me.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const s=d=>{const f=e.filter(y=>this.getLayer(y)),_=f.length?this.queryRenderedFeatures(d.point,{layers:f}):[];_.length?i||(i=!0,n.call(this,new Al(t,this,d.originalEvent,{features:_}))):i=!1},c=()=>{i=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:s,mouseout:c}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const s=d=>{const f=e.filter(_=>this.getLayer(_));(f.length?this.queryRenderedFeatures(d.point,{layers:f}):[]).length?i=!0:i&&(i=!1,n.call(this,new Al(t,this,d.originalEvent)))},c=d=>{i&&(i=!1,n.call(this,new Al(t,this,d.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:s,mouseout:c}}}{const i=s=>{const c=e.filter(f=>this.getLayer(f)),d=c.length?this.queryRenderedFeatures(s.point,{layers:c}):[];d.length&&(s.features=d,n.call(this,s),delete s.features)};return{layers:new Set(e),listener:n,delegates:{[t]:i}}}}on(t,e,n){if(void 0===n)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const s of e)if(!this._isValidId(s))return this;const i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const s in i.delegates)this.on(s,i.delegates[s]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const s of e)if(!this._isValidId(s))return this;const i=this._createDelegatedListener(t,e,n);for(const s in i.delegates)this.once(s,i.delegates[s]);return this}off(t,e,n){if(void 0===n)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const c of e)if(!this._isValidId(c))return this;const i=(c,d)=>{if(c.size!==d.size)return!1;for(const f of c)if(!d.has(f))return!1;return!0},s=this._delegatedListeners?this._delegatedListeners[t]:void 0;return s&&(c=>{for(let d=0;d<c.length;d++){const f=c[d];if(f.listener===n&&i(f.layers,e)){for(const _ in f.delegates)this.off(_,f.delegates[_]);return c.splice(d,1),this}}})(s),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(void 0!==e||void 0===t||t instanceof me||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers))for(const n of e.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return"globe"!==e&&"mercator"!==e&&Me(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(me.convert(t))}setStyle(t,e){return!1!==(e=Ye({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new sl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new sl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),i=this._requestManager.transformRequest(n,Ht.Style);En(i,(s,c)=>{s?this.fire(new wn(s)):c&&this._updateDiff(c,e)})}else"object"==typeof t&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(n){Me(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Me("There is no style added to the map."),!1)}_isValidId(t){return!(e=t,e.indexOf("\x1f")>=0&&(this.fire(new wn(new Error(`IDs can't contain special symbols: "${t}".`))),1));var e}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const i in n){const s=n[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:n=1,sdf:i=!1,stretchX:s,stretchY:c,content:d}={}){if(this._lazyInitEmptyStyle(),e instanceof ge.HTMLImageElement||ge.ImageBitmap&&e instanceof ge.ImageBitmap){const{width:f,height:_,data:y}=ne.getImageData(e);this.style.addImage(t,{data:new Ki({width:f,height:_},y),pixelRatio:n,stretchX:s,stretchY:c,content:d,sdf:i,version:0})}else if(void 0===e.width||void 0===e.height)this.fire(new wn(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:f,height:_}=e,y=e;this.style.addImage(t,{data:new Ki({width:f,height:_},new Uint8Array(y.data)),pixelRatio:n,stretchX:s,stretchY:c,content:d,sdf:i,version:0,userImage:y}),y.onAdd&&y.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const n=this.style.getImage(t);if(!n)return void this.fire(new wn(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=e instanceof ge.HTMLImageElement||ge.ImageBitmap&&e instanceof ge.ImageBitmap?ne.getImageData(e):e,{width:s,height:c}=i;void 0!==s&&void 0!==c?s===n.data.width&&c===n.data.height?(n.data.replace(i.data,!(e instanceof ge.HTMLImageElement||ge.ImageBitmap&&e instanceof ge.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new wn(new Error(`The width and height of the updated image (${s}, ${c})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new wn(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new wn(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){rt(this._requestManager.transformRequest(t,Ht.Image),(n,i)=>{e(n,i instanceof ge.HTMLImageElement?ne.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new wn(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,n){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,n),this._update(!0)):this}setFilter(t,e,n={}){return this._isValidId(t)?(this.style.setFilter(t,e,n),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,n,i),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,n,i),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}setConfigProperty(t,e,n){return this.style.setConfigProperty(t,e,n),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(kr.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let n,i,s,c=this._container;for(;c&&(!i||!s);){const d=ge.getComputedStyle(c).transform;d&&"none"!==d&&(n=d.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(s=n[3])),c=c.parentElement}this._containerWidth=i?Math.abs(t/i):t,this._containerHeight=s?Math.abs(e/s):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==ge.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&Me("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=Z("div","mapboxgl-canvas-container",t);this._canvas=Z("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Z("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(s=>{i[s]=Z("div",`mapboxgl-ctrl-${s}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const n=ne.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const t=Ye({},Br.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(ti(e,!0),this.painter=new CC(e,this.transform),this.on("data",n=>{"source"===n.dataType&&this.painter.setTileLoadedFlag(!0)}),ze.testSupport(e)):this.fire(new wn(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new kt("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new kt("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new kt("renderstart"));const n=this.painter.context.extTimerQuery,i=ne.now(),s=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=s.createQuery(),s.beginQuery(n.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],ge.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],ge.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const c=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const _=this.transform.zoom,y=this.transform.pitch,v=ne.now(),w=new Vo(_,{now:v,fadeDuration:c,pitch:y,transition:this.style.transition});this.style.update(w)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new kt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new kt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const _=ne.now()-i;s.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const y=s.getQueryParameter(e,s.QUERY_RESULT)/1e6;s.deleteQuery(e),this.fire(new kt("gpu-timing-frame",{cpuTime:_,gpuTime:y})),ge.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:y}})},50)}if(this.listens("gpu-timing-layer")){const _=this.painter.collectGpuTimers();setTimeout(()=>{const y=this.painter.queryGpuTimers(_);this.fire(new kt("gpu-timing-layer",{layerTimes:y}))},50)}if(this.listens("gpu-timing-deferred-render")){const _=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const y=this.painter.queryGpuTimeDeferredRender(_);this.fire(new kt("gpu-timing-deferred-render",{gpuTime:y}))},50)}const f=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(f||this._repaint)this.triggerRepaint();else{const _=!this.isMoving()&&this.loaded();if(_&&(d=this._updateAverageElevation(i,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),_&&(this.fire(new kt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const y=this._calculateSpeedIndex();this.fire(new kt("speedindexcompleted",{speedIndex:y})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,Qi.mark(ds.fullLoad),this._performanceMetricsCollection&&us(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const n=s=>(this.transform.averageElevation=s,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const s=this.transform.averageElevation;let c=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(c)?c=0:this._averageElevationLastSampledAt=t;const d=Math.abs(s-c);if(d>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(c),n(c);this._averageElevation.easeTo(c,t,300)}else if(d>1e-4)return this._averageElevation.jumpTo(c),n(c)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){ns(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===Nt||401===t.status)){const e=this.painter.context.gl;ti(e,!1),this._logoControl instanceof NC&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new wn(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ts(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function s(c){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,c,0);const d=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,d),d}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(s(t),e.canvasCopies.map(s),e.timeStamps)}_canvasPixelComparison(t,e,n){let i=n[1]-n[0];const s=t.length/4;for(let c=0;c<e.length;c++){const d=e[c];let f=0;for(let _=0;_<d.length;_+=4)d[_]===t[_]&&d[_+1]===t[_+1]&&d[_+2]===t[_+2]&&d[_+3]===t[_+3]&&(f+=1);i+=(n[c+2]-n[c+1])*(1-f/s)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==ge&&(ge.removeEventListener("resize",this._onWindowResize,!1),ge.removeEventListener("orientationchange",this._onWindowResize,!1),ge.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ge.removeEventListener("online",this._onWindowOnline,!1),ge.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),po.delete(this.painter.context.gl),this._removed=!0,this.fire(new kt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=ne.frame(e=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(e)}))}_preloadTiles(t){return Xe(this.style?Object.values(this.style._sourceCaches):[],(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===ge.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){qi=t,ri=e}get version(){return Ve}},NavigationControl:class{constructor(t){this.options=Ye({},PI,t),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(gr(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(gr(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:e}):n.resetNorth({},{originalEvent:e}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),n=e===t.getMaxZoom(),i=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zC(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const n=Z("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends Kn{constructor(t){super(),this.options=Ye({geolocation:ge.navigator.geolocation},L1,t),gr(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=J_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,t(n)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==ge.navigator.permissions?ge.navigator.permissions.query({name:"geolocation"}).then(n=>e("denied"!==n.state)).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new kt("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new kt("geolocate",t)),this._finish()}}_updateCamera(t){const e=new kr(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=Ye({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(n),i,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new kr(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=Zi(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new kt("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){Me("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sy({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sy({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new kt("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Me("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new kt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new kt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new kt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{ge.addEventListener("ondeviceorientationabsolute"in ge?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==ge.DeviceMotionEvent&&"function"==typeof ge.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),ge.removeEventListener("deviceorientation",this._onDeviceOrientation),ge.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:LC,ScaleControl:class{constructor(t){this.options=Ye({},uD,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),gr(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,n=e._containerHeight/2,i=e._containerWidth/2-t/2,s=e.unproject([i,n]),c=e.unproject([i+t,n]),d=s.distanceTo(c);if("imperial"===this.options.unit){const f=3.2808*d;f>5280?this._setScale(t,f/5280,"mile"):this._setScale(t,f,"foot")}else"nautical"===this.options.unit?this._setScale(t,d/1852,"nautical-mile"):d>=1e3?this._setScale(t,d/1e3,"kilometer"):this._setScale(t,d,"meter")}_setScale(t,e,n){this._map._requestDomTask(()=>{const i=function(c){const d=Math.pow(10,`${Math.floor(c)}`.length-1);let f=c/d;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:f>=1?1:function(_){const y=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*y)/y}(f),d*f}(e),s=i/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):`${i}&nbsp;${OI[n]}`,this._container.style.width=t*s+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof ge.HTMLElement?this._container=t.container:Me("Full screen control 'container' must be a DOM element.")),gr(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in ge.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in ge.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Me("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,ge.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!ge.document.fullscreenEnabled&&!ge.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),ge.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(ge.document.fullscreenElement||ge.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?ge.document.exitFullscreen?ge.document.exitFullscreen():ge.document.webkitCancelFullScreen&&ge.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Kn{constructor(t){super(),this.options=Ye(Object.create(FC),t),gr(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new kt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new kt("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=kr.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(ge.document.createTextNode(t))}setHTML(t){const e=ge.document.createDocumentFragment(),n=ge.document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const n=this._closeButton=Z("button","mapboxgl-popup-close-button",e);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,n=this._container,i=this._pos;if(!e||!n||!i)return"bottom";const s=n.offsetWidth,c=n.offsetHeight,d=i.x<s/2,f=i.x>e.transform.width-s/2;if(i.y+t<c)return d?"top-left":f?"top-right":"top";if(i.y>e.transform.height-c){if(d)return"bottom-left";if(f)return"bottom-right"}return d?"left":f?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=Z("div","mapboxgl-popup",e.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=P0(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const s=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),c=BC(this.options.offset),d=this._anchor=this._getAnchor(c.y),f=BC(this.options.offset,d),_=s.add(f).round();e._requestDomTask(()=>{this._container&&d&&(this._container.style.transform=`${O0[d]} translate(${_.x}px,${_.y}px)`)})}if(!this._marker&&e._showingGlobe()){const s=Ew(e.transform,this._lngLat)?0:1;this._setOpacity(s)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(RI);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:sy,Style:sl,LngLat:kr,LngLatBounds:Mc,Point:me,MercatorCoordinate:Ri,FreeCameraOptions:RA,Evented:Kn,config:Be,prewarm:function(){mm().acquire(Zb)},clearPrewarmedResources:function(){const t=pm;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Zb),pm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Be.ACCESS_TOKEN},set accessToken(t){Be.ACCESS_TOKEN=t},get baseApiUrl(){return Be.API_URL},set baseApiUrl(t){Be.API_URL=t},get workerCount(){return Uc.workerCount},set workerCount(t){Uc.workerCount=t},get maxParallelImageRequests(){return Be.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){Be.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){!function(e){if(!io())return;const n=ge.caches.delete(Lr);e&&n.catch(e).then(()=>e())}(t)},workerUrl:"",workerClass:null,get dracoUrl(){return E_()},set dracoUrl(t){Hf=ne.resolveURL(t),ro||(ro=new qv(mm(),new Kn)),ro.broadcast("setDracoUrl",Hf)},setNow:ne.setNow,restoreNow:ne.restoreNow};Ie.A=Lh,Ie.D=Fu,Ie.E=Vt,Ie.F=Cf,Ie.K=i1,Ie.O=Bi,Ie.P=me,Ie.T=Vf,Ie.V=Ug,Ie.a=If,Ie.b=qw,Ie.c=zc,Ie.d=class extends Kn{constructor(t,e,n,i,s,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=s||Fh,this.loading={},this.loaded={},this.deduped=new xu(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler,this.brightness=c}loadTile(t,e){const n=t.uid,i=t&&t.request,s=i&&i.collectResourceTiming,c=this.loading[n]=new YS(t);c.abort=this.loadVectorData(t,(d,f)=>{const _=!this.loading[n];if(delete this.loading[n],_||d||!f)return c.status="done",_||(this.loaded[n]=c),e(d);const y=f.rawData,v={};f.expires&&(v.expires=f.expires),f.cacheControl&&(v.cacheControl=f.cacheControl),c.vectorTile=f.vectorTile||new Hw(new Af(y));const w=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,C)=>{if(I||!C)return e(I);const S={};if(s){const M=Wi(i);M.length>0&&(S.resourceTiming=JSON.parse(JSON.stringify(M)))}e(null,Ye({rawTileData:y.slice(0)},C,v,S))})};this.isSpriteLoaded?w():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(w,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):w()}),this.loaded=this.loaded||{},this.loaded[n]=c})}reloadTile(t,e){const n=this.loaded,i=t.uid,s=this;if(n&&n[i]){const c=n[i];c.showCollisionBoxes=t.showCollisionBoxes,c.projection=t.projection,c.brightness=t.brightness,c.tileTransform=Pd(t.tileID.canonical,t.projection),c.extraShadowCaster=t.extraShadowCaster;const d=(f,_)=>{const y=c.reloadCallback;y&&(delete c.reloadCallback,c.parse(c.vectorTile,s.layerIndex,this.availableImages,s.actor,y)),e(f,_)};"parsing"===c.status?c.reloadCallback=d:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(t,e){const n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},Ie.e=Zt,Ie.f=Wi,Ie.g=Jt,Ie.h=En,Ie.i=xn,Ie.j=function(t,e){const n=VE(t);for(const i of n){for(const s of i.meshes)aa(s);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(Jb(i.lights,e)))}return n},Ie.k=Vo,Ie.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==A_){const n=new Uint32Array(t,0,7),[,,i,s,c,d]=n;e=n.byteLength+s+c+d+c,(i!==t.byteLength||e>=t.byteLength)&&Me("Invalid b3dm header information.")}return WA(t,e)},Ie.m=rl,Ie.n=Bl,Ie.o=kt,Ie.p=hn,Ie.q=function(t){Io(),Ui&&Ui.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},Ie.r=ZA,Ie.s=kI,Ie.t=$x,Ie.v=tt,Ie.w=ge}),he(0,function(Ie){function ge(qe){if("number"==typeof qe||"boolean"==typeof qe||"string"==typeof qe||null==qe)return JSON.stringify(qe);if(Array.isArray(qe)){let ye="[";for(const Me of qe)ye+=`${ge(Me)},`;return`${ye}]`}let ue="{";for(const ye of Object.keys(qe).sort())ue+=`${ye}:${ge(qe[ye])},`;return`${ue}}`}function Ve(qe){let ue="";for(const ye of Ie.r)ue+=`/${ge(qe[ye])}`;return ue}class Le{constructor(ue){this.keyCache={},ue&&this.replace(ue)}replace(ue,ye){this._layerConfigs={},this._layers={},this.update(ue,[],ye)}update(ue,ye,Me){this._options=Me;for(const zt of ue){this._layerConfigs[zt.id]=zt;const nn=this._layers[zt.id]=Ie.c(zt,this._options);nn.setScope(this.scope),nn.compileFilter(),this.keyCache[zt.id]&&delete this.keyCache[zt.id]}for(const zt of ye)delete this.keyCache[zt],delete this._layerConfigs[zt],delete this._layers[zt];this.familiesBySource={};const Bt=function(zt,nn){const In={};for(let Zn=0;Zn<zt.length;Zn++){const cn=nn&&nn[zt[Zn].id]||Ve(zt[Zn]);nn&&(nn[zt[Zn].id]=cn);let Dn=In[cn];Dn||(Dn=In[cn]=[]),Dn.push(zt[Zn])}const Xt=[];for(const Zn in In)Xt.push(In[Zn]);return Xt}(Ie.v(this._layerConfigs),this.keyCache);for(const zt of Bt){const nn=zt.map(ir=>this._layers[ir.id]),In=nn[0];if("none"===In.visibility)continue;const Xt=In.source||"";let Zn=this.familiesBySource[Xt];Zn||(Zn=this.familiesBySource[Xt]={});const cn=In.sourceLayer||"_geojsonTileLayer";let Dn=Zn[cn];Dn||(Dn=Zn[cn]=[]),Dn.push(nn)}}}class Be{loadTile(ue,ye){const{uid:Me,encoding:Bt,rawImageData:zt,padding:nn}=ue,In=Ie.w.ImageBitmap&&zt instanceof Ie.w.ImageBitmap?this.getImageData(zt,nn):zt;ye(null,new Ie.D(Me,In,Bt,ue.convertToFloat,nn<1))}getImageData(ue,ye){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ue.width,ue.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ue.width,this.offscreenCanvas.height=ue.height,this.offscreenCanvasContext.drawImage(ue,0,0,ue.width,ue.height);const Me=this.offscreenCanvasContext.getImageData(-ye,-ye,ue.width+2*ye,ue.height+2*ye);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Me}}function ze(qe,ue){if(0!==qe.length){wt(qe[0],ue);for(var ye=1;ye<qe.length;ye++)wt(qe[ye],!ue)}}function wt(qe,ue){for(var ye=0,Me=0,Bt=0,zt=qe.length,nn=zt-1;Bt<zt;nn=Bt++){var In=(qe[Bt][0]-qe[nn][0])*(qe[nn][1]+qe[Bt][1]),Xt=ye+In;Me+=Math.abs(ye)>=Math.abs(In)?ye-Xt+In:In-Xt+ye,ye=Xt}ye+Me>=0!=!!ue&&qe.reverse()}var Ue=Ie.g(function qe(ue,ye){var Me,Bt=ue&&ue.type;if("FeatureCollection"===Bt)for(Me=0;Me<ue.features.length;Me++)qe(ue.features[Me],ye);else if("GeometryCollection"===Bt)for(Me=0;Me<ue.geometries.length;Me++)qe(ue.geometries[Me],ye);else if("Feature"===Bt)qe(ue.geometry,ye);else if("Polygon"===Bt)ze(ue.coordinates,ye);else if("MultiPolygon"===Bt)for(Me=0;Me<ue.coordinates.length;Me++)ze(ue.coordinates[Me],ye);return ue});const vt=Ie.V.prototype.toGeoJSON;var Mt={exports:{}},xt=Ie.p,gt=Ie.a.VectorTileFeature,Jt=Ot;function Ot(qe,ue){this.options=ue||{},this.features=qe,this.length=qe.length}function Rt(qe,ue){this.id="number"==typeof qe.id?qe.id:void 0,this.type=qe.type,this.rawGeometry=1===qe.type?[qe.geometry]:qe.geometry,this.properties=qe.tags,this.extent=ue||4096}Ot.prototype.feature=function(qe){return new Rt(this.features[qe],this.options.extent)},Rt.prototype.loadGeometry=function(){var qe=this.rawGeometry;this.geometry=[];for(var ue=0;ue<qe.length;ue++){for(var ye=qe[ue],Me=[],Bt=0;Bt<ye.length;Bt++)Me.push(new xt(ye[Bt][0],ye[Bt][1]));this.geometry.push(Me)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var qe=this.geometry,ue=1/0,ye=-1/0,Me=1/0,Bt=-1/0,zt=0;zt<qe.length;zt++)for(var nn=qe[zt],In=0;In<nn.length;In++){var Xt=nn[In];ue=Math.min(ue,Xt.x),ye=Math.max(ye,Xt.x),Me=Math.min(Me,Xt.y),Bt=Math.max(Bt,Xt.y)}return[ue,Me,ye,Bt]},Rt.prototype.toGeoJSON=gt.prototype.toGeoJSON;var Pt=Ie.b,hn=Jt;function lt(qe){var ue=new Pt;return function(ye,Me){for(var Bt in ye.layers)Me.writeMessage(3,me,ye.layers[Bt])}(qe,ue),ue.finish()}function me(qe,ue){var ye;ue.writeVarintField(15,qe.version||1),ue.writeStringField(1,qe.name||""),ue.writeVarintField(5,qe.extent||4096);var Me={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<qe.length;ye++)Me.feature=qe.feature(ye),ue.writeMessage(2,st,Me);var Bt=Me.keys;for(ye=0;ye<Bt.length;ye++)ue.writeStringField(3,Bt[ye]);var zt=Me.values;for(ye=0;ye<zt.length;ye++)ue.writeMessage(4,mt,zt[ye])}function st(qe,ue){var ye=qe.feature;void 0!==ye.id&&ue.writeVarintField(1,ye.id),ue.writeMessage(2,Ft,qe),ue.writeVarintField(3,ye.type),ue.writeMessage(4,dt,ye)}function Ft(qe,ue){var ye=qe.feature,Me=qe.keys,Bt=qe.values,zt=qe.keycache,nn=qe.valuecache;for(var In in ye.properties){var Xt=ye.properties[In],Zn=zt[In];if(null!==Xt){void 0===Zn&&(Me.push(In),zt[In]=Zn=Me.length-1),ue.writeVarint(Zn);var cn=typeof Xt;"string"!==cn&&"boolean"!==cn&&"number"!==cn&&(Xt=JSON.stringify(Xt));var Dn=cn+":"+Xt,ir=nn[Dn];void 0===ir&&(Bt.push(Xt),nn[Dn]=ir=Bt.length-1),ue.writeVarint(ir)}}}function Te(qe,ue){return(ue<<3)+(7&qe)}function De(qe){return qe<<1^qe>>31}function dt(qe,ue){for(var ye=qe.loadGeometry(),Me=qe.type,Bt=0,zt=0,nn=ye.length,In=0;In<nn;In++){var Xt=ye[In],Zn=1;1===Me&&(Zn=Xt.length),ue.writeVarint(Te(1,Zn));for(var cn=3===Me?Xt.length-1:Xt.length,Dn=0;Dn<cn;Dn++){1===Dn&&1!==Me&&ue.writeVarint(Te(2,cn-1));var ir=Xt[Dn].x-Bt,bi=Xt[Dn].y-zt;ue.writeVarint(De(ir)),ue.writeVarint(De(bi)),Bt+=ir,zt+=bi}3===Me&&ue.writeVarint(Te(7,1))}}function mt(qe,ue){var ye=typeof qe;"string"===ye?ue.writeStringField(1,qe):"boolean"===ye?ue.writeBooleanField(7,qe):"number"===ye&&(qe%1!=0?ue.writeDoubleField(3,qe):qe<0?ue.writeSVarintField(6,qe):ue.writeVarintField(5,qe))}Mt.exports=lt,Mt.exports.fromVectorTileJs=lt,Mt.exports.fromGeojsonVt=function(qe,ue){ue=ue||{};var ye={};for(var Me in qe)ye[Me]=new hn(qe[Me].features,ue),ye[Me].name=Me,ye[Me].version=ue.version,ye[Me].extent=ue.extent;return lt({layers:ye})},Mt.exports.GeoJSONWrapper=hn;var Gt=Ie.g(Mt.exports);const en={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},on=Math.fround||(Un=new Float32Array(1),qe=>(Un[0]=+qe,Un[0]));var Un;const nr=3,_n=5,sn=6;class yt{constructor(ue){this.options=Object.assign(Object.create(en),ue),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ue){const{log:ye,minZoom:Me,maxZoom:Bt}=this.options;ye&&console.time("total time");const zt=`prepare ${ue.length} points`;ye&&console.time(zt),this.points=ue;const nn=[];for(let Xt=0;Xt<ue.length;Xt++){const Zn=ue[Xt];if(!Zn.geometry)continue;const[cn,Dn]=Zn.geometry.coordinates,ir=on(Ye(cn)),bi=on(_t(Dn));nn.push(ir,bi,1/0,Xt,-1,1),this.options.reduce&&nn.push(0)}let In=this.trees[Bt+1]=this._createTree(nn);ye&&console.timeEnd(zt);for(let Xt=Bt;Xt>=Me;Xt--){const Zn=+Date.now();In=this.trees[Xt]=this._createTree(this._cluster(In,Xt)),ye&&console.log("z%d: %d clusters in %dms",Xt,In.numItems,+Date.now()-Zn)}return ye&&console.timeEnd("total time"),this}getClusters(ue,ye){let Me=((ue[0]+180)%360+360)%360-180;const Bt=Math.max(-90,Math.min(90,ue[1]));let zt=180===ue[2]?180:((ue[2]+180)%360+360)%360-180;const nn=Math.max(-90,Math.min(90,ue[3]));if(ue[2]-ue[0]>=360)Me=-180,zt=180;else if(Me>zt){const Dn=this.getClusters([Me,Bt,180,nn],ye),ir=this.getClusters([-180,Bt,zt,nn],ye);return Dn.concat(ir)}const In=this.trees[this._limitZoom(ye)],Xt=In.range(Ye(Me),_t(nn),Ye(zt),_t(Bt)),Zn=In.data,cn=[];for(const Dn of Xt){const ir=this.stride*Dn;cn.push(Zn[ir+_n]>1?Xe(Zn,ir,this.clusterProps):this.points[Zn[ir+nr]])}return cn}getChildren(ue){const ye=this._getOriginId(ue),Me=this._getOriginZoom(ue),Bt="No cluster with the specified id.",zt=this.trees[Me];if(!zt)throw new Error(Bt);const nn=zt.data;if(ye*this.stride>=nn.length)throw new Error(Bt);const In=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),Xt=zt.within(nn[ye*this.stride],nn[ye*this.stride+1],In),Zn=[];for(const cn of Xt){const Dn=cn*this.stride;nn[Dn+4]===ue&&Zn.push(nn[Dn+_n]>1?Xe(nn,Dn,this.clusterProps):this.points[nn[Dn+nr]])}if(0===Zn.length)throw new Error(Bt);return Zn}getLeaves(ue,ye,Me){const Bt=[];return this._appendLeaves(Bt,ue,ye=ye||10,Me=Me||0,0),Bt}getTile(ue,ye,Me){const Bt=this.trees[this._limitZoom(ue)],zt=Math.pow(2,ue),{extent:nn,radius:In}=this.options,Xt=In/nn,Zn=(Me-Xt)/zt,cn=(Me+1+Xt)/zt,Dn={features:[]};return this._addTileFeatures(Bt.range((ye-Xt)/zt,Zn,(ye+1+Xt)/zt,cn),Bt.data,ye,Me,zt,Dn),0===ye&&this._addTileFeatures(Bt.range(1-Xt/zt,Zn,1,cn),Bt.data,zt,Me,zt,Dn),ye===zt-1&&this._addTileFeatures(Bt.range(0,Zn,Xt/zt,cn),Bt.data,-1,Me,zt,Dn),Dn.features.length?Dn:null}getClusterExpansionZoom(ue){let ye=this._getOriginZoom(ue)-1;for(;ye<=this.options.maxZoom;){const Me=this.getChildren(ue);if(ye++,1!==Me.length)break;ue=Me[0].properties.cluster_id}return ye}_appendLeaves(ue,ye,Me,Bt,zt){const nn=this.getChildren(ye);for(const In of nn){const Xt=In.properties;if(Xt&&Xt.cluster?zt+Xt.point_count<=Bt?zt+=Xt.point_count:zt=this._appendLeaves(ue,Xt.cluster_id,Me,Bt,zt):zt<Bt?zt++:ue.push(In),ue.length===Me)break}return zt}_createTree(ue){const ye=new Ie.K(ue.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Me=0;Me<ue.length;Me+=this.stride)ye.add(ue[Me],ue[Me+1]);return ye.finish(),ye.data=ue,ye}_addTileFeatures(ue,ye,Me,Bt,zt,nn){for(const In of ue){const Xt=In*this.stride,Zn=ye[Xt+_n]>1;let cn,Dn,ir;if(Zn)cn=tt(ye,Xt,this.clusterProps),Dn=ye[Xt],ir=ye[Xt+1];else{const Nn=this.points[ye[Xt+nr]];cn=Nn.properties;const[Kr,Lr]=Nn.geometry.coordinates;Dn=Ye(Kr),ir=_t(Lr)}const bi={type:1,geometry:[[Math.round(this.options.extent*(Dn*zt-Me)),Math.round(this.options.extent*(ir*zt-Bt))]],tags:cn};let Mi;Mi=Zn||this.options.generateId?ye[Xt+nr]:this.points[ye[Xt+nr]].id,void 0!==Mi&&(bi.id=Mi),nn.features.push(bi)}}_limitZoom(ue){return Math.max(this.options.minZoom,Math.min(Math.floor(+ue),this.options.maxZoom+1))}_cluster(ue,ye){const{radius:Me,extent:Bt,reduce:zt,minPoints:nn}=this.options,In=Me/(Bt*Math.pow(2,ye)),Xt=ue.data,Zn=[],cn=this.stride;for(let Dn=0;Dn<Xt.length;Dn+=cn){if(Xt[Dn+2]<=ye)continue;Xt[Dn+2]=ye;const ir=Xt[Dn],bi=Xt[Dn+1],Mi=ue.within(Xt[Dn],Xt[Dn+1],In),Nn=Xt[Dn+_n];let Kr=Nn;for(const Lr of Mi){const qi=Lr*cn;Xt[qi+2]>ye&&(Kr+=Xt[qi+_n])}if(Kr>Nn&&Kr>=nn){let Lr,qi=ir*Nn,ri=bi*Nn,Ui=-1;const fr=((Dn/cn|0)<<5)+(ye+1)+this.points.length;for(const io of Mi){const Io=io*cn;if(Xt[Io+2]<=ye)continue;Xt[Io+2]=ye;const Tr=Xt[Io+_n];qi+=Xt[Io]*Tr,ri+=Xt[Io+1]*Tr,Xt[Io+4]=fr,zt&&(Lr||(Lr=this._map(Xt,Dn,!0),Ui=this.clusterProps.length,this.clusterProps.push(Lr)),zt(Lr,this._map(Xt,Io)))}Xt[Dn+4]=fr,Zn.push(qi/Kr,ri/Kr,1/0,fr,-1,Kr),zt&&Zn.push(Ui)}else{for(let Lr=0;Lr<cn;Lr++)Zn.push(Xt[Dn+Lr]);if(Kr>1)for(const Lr of Mi){const qi=Lr*cn;if(!(Xt[qi+2]<=ye)){Xt[qi+2]=ye;for(let ri=0;ri<cn;ri++)Zn.push(Xt[qi+ri])}}}}return Zn}_getOriginId(ue){return ue-this.points.length>>5}_getOriginZoom(ue){return(ue-this.points.length)%32}_map(ue,ye,Me){if(ue[ye+_n]>1){const nn=this.clusterProps[ue[ye+sn]];return Me?Object.assign({},nn):nn}const Bt=this.points[ue[ye+nr]].properties,zt=this.options.map(Bt);return Me&&zt===Bt?Object.assign({},zt):zt}}function Xe(qe,ue,ye){return{type:"Feature",id:qe[ue+nr],properties:tt(qe,ue,ye),geometry:{type:"Point",coordinates:[(Me=qe[ue],360*(Me-.5)),rn(qe[ue+1])]}};var Me}function tt(qe,ue,ye){const Me=qe[ue+_n],Bt=Me>=1e4?`${Math.round(Me/1e3)}k`:Me>=1e3?Math.round(Me/100)/10+"k":Me,zt=qe[ue+sn],nn=-1===zt?{}:Object.assign({},ye[zt]);return Object.assign(nn,{cluster:!0,cluster_id:qe[ue+nr],point_count:Me,point_count_abbreviated:Bt})}function Ye(qe){return qe/360+.5}function _t(qe){const ue=Math.sin(qe*Math.PI/180),ye=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return ye<0?0:ye>1?1:ye}function rn(qe){const ue=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(ue))/Math.PI-90}var Gn={exports:{}};Gn.exports=function(){function qe(Ht,an,yn,vn){for(var En,xn=vn,Ln=yn-an>>1,ht=yn-an,Ke=Ht[an],ot=Ht[an+1],rt=Ht[yn],Nt=Ht[yn+1],qt=an+3;qt<yn;qt+=3){var Rn=ue(Ht[qt],Ht[qt+1],Ke,ot,rt,Nt);if(Rn>xn)En=qt,xn=Rn;else if(Rn===xn){var cr=Math.abs(qt-Ln);cr<ht&&(En=qt,ht=cr)}}xn>vn&&(En-an>3&&qe(Ht,an,En,vn),Ht[En+2]=xn,yn-En>3&&qe(Ht,En,yn,vn))}function ue(Ht,an,yn,vn,En,xn){var Ln=En-yn,ht=xn-vn;if(0!==Ln||0!==ht){var Ke=((Ht-yn)*Ln+(an-vn)*ht)/(Ln*Ln+ht*ht);Ke>1?(yn=En,vn=xn):Ke>0&&(yn+=Ln*Ke,vn+=ht*Ke)}return(Ln=Ht-yn)*Ln+(ht=an-vn)*ht}function ye(Ht,an,yn,vn){var En={id:void 0===Ht?null:Ht,type:an,geometry:yn,tags:vn,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xn){var Ln=xn.geometry,ht=xn.type;if("Point"===ht||"MultiPoint"===ht||"LineString"===ht)Me(xn,Ln);else if("Polygon"===ht||"MultiLineString"===ht)for(var Ke=0;Ke<Ln.length;Ke++)Me(xn,Ln[Ke]);else if("MultiPolygon"===ht)for(Ke=0;Ke<Ln.length;Ke++)for(var ot=0;ot<Ln[Ke].length;ot++)Me(xn,Ln[Ke][ot])}(En),En}function Me(Ht,an){for(var yn=0;yn<an.length;yn+=3)Ht.minX=Math.min(Ht.minX,an[yn]),Ht.minY=Math.min(Ht.minY,an[yn+1]),Ht.maxX=Math.max(Ht.maxX,an[yn]),Ht.maxY=Math.max(Ht.maxY,an[yn+1])}function Bt(Ht,an,yn,vn){if(an.geometry){var En=an.geometry.coordinates,xn=an.geometry.type,Ln=Math.pow(yn.tolerance/((1<<yn.maxZoom)*yn.extent),2),ht=[],Ke=an.id;if(yn.promoteId?Ke=an.properties[yn.promoteId]:yn.generateId&&(Ke=vn||0),"Point"===xn)zt(En,ht);else if("MultiPoint"===xn)for(var ot=0;ot<En.length;ot++)zt(En[ot],ht);else if("LineString"===xn)nn(En,ht,Ln,!1);else if("MultiLineString"===xn){if(yn.lineMetrics){for(ot=0;ot<En.length;ot++)nn(En[ot],ht=[],Ln,!1),Ht.push(ye(Ke,"LineString",ht,an.properties));return}In(En,ht,Ln,!1)}else if("Polygon"===xn)In(En,ht,Ln,!0);else{if("MultiPolygon"!==xn){if("GeometryCollection"===xn){for(ot=0;ot<an.geometry.geometries.length;ot++)Bt(Ht,{id:Ke,geometry:an.geometry.geometries[ot],properties:an.properties},yn,vn);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ot=0;ot<En.length;ot++){var rt=[];In(En[ot],rt,Ln,!0),ht.push(rt)}}Ht.push(ye(Ke,xn,ht,an.properties))}}function zt(Ht,an){an.push(Xt(Ht[0])),an.push(Zn(Ht[1])),an.push(0)}function nn(Ht,an,yn,vn){for(var En,xn,Ln=0,ht=0;ht<Ht.length;ht++){var Ke=Xt(Ht[ht][0]),ot=Zn(Ht[ht][1]);an.push(Ke),an.push(ot),an.push(0),ht>0&&(Ln+=vn?(En*ot-Ke*xn)/2:Math.sqrt(Math.pow(Ke-En,2)+Math.pow(ot-xn,2))),En=Ke,xn=ot}var rt=an.length-3;an[2]=1,qe(an,0,rt,yn),an[rt+2]=1,an.size=Math.abs(Ln),an.start=0,an.end=an.size}function In(Ht,an,yn,vn){for(var En=0;En<Ht.length;En++){var xn=[];nn(Ht[En],xn,yn,vn),an.push(xn)}}function Xt(Ht){return Ht/360+.5}function Zn(Ht){var an=Math.sin(Ht*Math.PI/180),yn=.5-.25*Math.log((1+an)/(1-an))/Math.PI;return yn<0?0:yn>1?1:yn}function cn(Ht,an,yn,vn,En,xn,Ln,ht){if(vn/=an,xn>=(yn/=an)&&Ln<vn)return Ht;if(Ln<yn||xn>=vn)return null;for(var Ke=[],ot=0;ot<Ht.length;ot++){var rt=Ht[ot],Nt=rt.geometry,qt=rt.type,Rn=0===En?rt.minX:rt.minY,cr=0===En?rt.maxX:rt.maxY;if(Rn>=yn&&cr<vn)Ke.push(rt);else if(!(cr<yn||Rn>=vn)){var Sr=[];if("Point"===qt||"MultiPoint"===qt)Dn(Nt,Sr,yn,vn,En);else if("LineString"===qt)ir(Nt,Sr,yn,vn,En,!1,ht.lineMetrics);else if("MultiLineString"===qt)Mi(Nt,Sr,yn,vn,En,!1);else if("Polygon"===qt)Mi(Nt,Sr,yn,vn,En,!0);else if("MultiPolygon"===qt)for(var ii=0;ii<Nt.length;ii++){var ji=[];Mi(Nt[ii],ji,yn,vn,En,!0),ji.length&&Sr.push(ji)}if(Sr.length){if(ht.lineMetrics&&"LineString"===qt){for(ii=0;ii<Sr.length;ii++)Ke.push(ye(rt.id,qt,Sr[ii],rt.tags));continue}"LineString"!==qt&&"MultiLineString"!==qt||(1===Sr.length?(qt="LineString",Sr=Sr[0]):qt="MultiLineString"),"Point"!==qt&&"MultiPoint"!==qt||(qt=3===Sr.length?"Point":"MultiPoint"),Ke.push(ye(rt.id,qt,Sr,rt.tags))}}}return Ke.length?Ke:null}function Dn(Ht,an,yn,vn,En){for(var xn=0;xn<Ht.length;xn+=3){var Ln=Ht[xn+En];Ln>=yn&&Ln<=vn&&(an.push(Ht[xn]),an.push(Ht[xn+1]),an.push(Ht[xn+2]))}}function ir(Ht,an,yn,vn,En,xn,Ln){for(var ht,Ke,ot=bi(Ht),rt=0===En?Kr:Lr,Nt=Ht.start,qt=0;qt<Ht.length-3;qt+=3){var Rn=Ht[qt],cr=Ht[qt+1],Sr=Ht[qt+2],ii=Ht[qt+3],ji=Ht[qt+4],wi=0===En?Rn:cr,dr=0===En?ii:ji,Oo=!1;Ln&&(ht=Math.sqrt(Math.pow(Rn-ii,2)+Math.pow(cr-ji,2))),wi<yn?dr>yn&&(Ke=rt(ot,Rn,cr,ii,ji,yn),Ln&&(ot.start=Nt+ht*Ke)):wi>vn?dr<vn&&(Ke=rt(ot,Rn,cr,ii,ji,vn),Ln&&(ot.start=Nt+ht*Ke)):Nn(ot,Rn,cr,Sr),dr<yn&&wi>=yn&&(Ke=rt(ot,Rn,cr,ii,ji,yn),Oo=!0),dr>vn&&wi<=vn&&(Ke=rt(ot,Rn,cr,ii,ji,vn),Oo=!0),!xn&&Oo&&(Ln&&(ot.end=Nt+ht*Ke),an.push(ot),ot=bi(Ht)),Ln&&(Nt+=ht)}var ho=Ht.length-3;Rn=Ht[ho],cr=Ht[ho+1],Sr=Ht[ho+2],(wi=0===En?Rn:cr)>=yn&&wi<=vn&&Nn(ot,Rn,cr,Sr),ho=ot.length-3,xn&&ho>=3&&(ot[ho]!==ot[0]||ot[ho+1]!==ot[1])&&Nn(ot,ot[0],ot[1],ot[2]),ot.length&&an.push(ot)}function bi(Ht){var an=[];return an.size=Ht.size,an.start=Ht.start,an.end=Ht.end,an}function Mi(Ht,an,yn,vn,En,xn){for(var Ln=0;Ln<Ht.length;Ln++)ir(Ht[Ln],an,yn,vn,En,xn,!1)}function Nn(Ht,an,yn,vn){Ht.push(an),Ht.push(yn),Ht.push(vn)}function Kr(Ht,an,yn,vn,En,xn){var Ln=(xn-an)/(vn-an);return Ht.push(xn),Ht.push(yn+(En-yn)*Ln),Ht.push(1),Ln}function Lr(Ht,an,yn,vn,En,xn){var Ln=(xn-yn)/(En-yn);return Ht.push(an+(vn-an)*Ln),Ht.push(xn),Ht.push(1),Ln}function qi(Ht,an){for(var yn=[],vn=0;vn<Ht.length;vn++){var En,xn=Ht[vn],Ln=xn.type;if("Point"===Ln||"MultiPoint"===Ln||"LineString"===Ln)En=ri(xn.geometry,an);else if("MultiLineString"===Ln||"Polygon"===Ln){En=[];for(var ht=0;ht<xn.geometry.length;ht++)En.push(ri(xn.geometry[ht],an))}else if("MultiPolygon"===Ln)for(En=[],ht=0;ht<xn.geometry.length;ht++){for(var Ke=[],ot=0;ot<xn.geometry[ht].length;ot++)Ke.push(ri(xn.geometry[ht][ot],an));En.push(Ke)}yn.push(ye(xn.id,Ln,En,xn.tags))}return yn}function ri(Ht,an){var yn=[];yn.size=Ht.size,void 0!==Ht.start&&(yn.start=Ht.start,yn.end=Ht.end);for(var vn=0;vn<Ht.length;vn+=3)yn.push(Ht[vn]+an,Ht[vn+1],Ht[vn+2]);return yn}function Ui(Ht,an){if(Ht.transformed)return Ht;var yn,vn,En,xn=1<<Ht.z,Ln=Ht.x,ht=Ht.y;for(yn=0;yn<Ht.features.length;yn++){var Ke=Ht.features[yn],ot=Ke.geometry,rt=Ke.type;if(Ke.geometry=[],1===rt)for(vn=0;vn<ot.length;vn+=2)Ke.geometry.push(fr(ot[vn],ot[vn+1],an,xn,Ln,ht));else for(vn=0;vn<ot.length;vn++){var Nt=[];for(En=0;En<ot[vn].length;En+=2)Nt.push(fr(ot[vn][En],ot[vn][En+1],an,xn,Ln,ht));Ke.geometry.push(Nt)}}return Ht.transformed=!0,Ht}function fr(Ht,an,yn,vn,En,xn){return[Math.round(yn*(Ht*vn-En)),Math.round(yn*(an*vn-xn))]}function io(Ht,an,yn,vn,En){for(var xn=an===En.maxZoom?0:En.tolerance/((1<<an)*En.extent),Ln={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:yn,y:vn,z:an,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ht=0;ht<Ht.length;ht++){Ln.numFeatures++,Io(Ln,Ht[ht],xn,En);var Ke=Ht[ht].minX,ot=Ht[ht].minY,rt=Ht[ht].maxX,Nt=Ht[ht].maxY;Ke<Ln.minX&&(Ln.minX=Ke),ot<Ln.minY&&(Ln.minY=ot),rt>Ln.maxX&&(Ln.maxX=rt),Nt>Ln.maxY&&(Ln.maxY=Nt)}return Ln}function Io(Ht,an,yn,vn){var En=an.geometry,xn=an.type,Ln=[];if("Point"===xn||"MultiPoint"===xn)for(var ht=0;ht<En.length;ht+=3)Ln.push(En[ht]),Ln.push(En[ht+1]),Ht.numPoints++,Ht.numSimplified++;else if("LineString"===xn)Tr(Ln,En,Ht,yn,!1,!1);else if("MultiLineString"===xn||"Polygon"===xn)for(ht=0;ht<En.length;ht++)Tr(Ln,En[ht],Ht,yn,"Polygon"===xn,0===ht);else if("MultiPolygon"===xn)for(var Ke=0;Ke<En.length;Ke++){var ot=En[Ke];for(ht=0;ht<ot.length;ht++)Tr(Ln,ot[ht],Ht,yn,!0,0===ht)}if(Ln.length){var rt=an.tags||null;if("LineString"===xn&&vn.lineMetrics){for(var Nt in rt={},an.tags)rt[Nt]=an.tags[Nt];rt.mapbox_clip_start=En.start/En.size,rt.mapbox_clip_end=En.end/En.size}var qt={geometry:Ln,type:"Polygon"===xn||"MultiPolygon"===xn?3:"LineString"===xn||"MultiLineString"===xn?2:1,tags:rt};null!==an.id&&(qt.id=an.id),Ht.features.push(qt)}}function Tr(Ht,an,yn,vn,En,xn){var Ln=vn*vn;if(vn>0&&an.size<(En?Ln:vn))yn.numPoints+=an.length/3;else{for(var ht=[],Ke=0;Ke<an.length;Ke+=3)(0===vn||an[Ke+2]>Ln)&&(yn.numSimplified++,ht.push(an[Ke]),ht.push(an[Ke+1])),yn.numPoints++;En&&function(ot,rt){for(var Nt=0,qt=0,Rn=ot.length,cr=Rn-2;qt<Rn;cr=qt,qt+=2)Nt+=(ot[qt]-ot[cr])*(ot[qt+1]+ot[cr+1]);if(Nt>0===rt)for(qt=0,Rn=ot.length;qt<Rn/2;qt+=2){var Sr=ot[qt],ii=ot[qt+1];ot[qt]=ot[Rn-2-qt],ot[qt+1]=ot[Rn-1-qt],ot[Rn-2-qt]=Sr,ot[Rn-1-qt]=ii}}(ht,xn),Ht.push(ht)}}function Gr(Ht,an){var yn=(an=this.options=function(En,xn){for(var Ln in xn)En[Ln]=xn[Ln];return En}(Object.create(this.options),an)).debug;if(yn&&console.time("preprocess data"),an.maxZoom<0||an.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(an.promoteId&&an.generateId)throw new Error("promoteId and generateId cannot be used together.");var En,xn,Ln,ht,Ke,ot,vn=function(En,xn){var Ln=[];if("FeatureCollection"===En.type)for(var ht=0;ht<En.features.length;ht++)Bt(Ln,En.features[ht],xn,ht);else Bt(Ln,"Feature"===En.type?En:{geometry:En},xn);return Ln}(Ht,an);this.tiles={},this.tileCoords=[],yn&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",an.indexMaxZoom,an.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(En=vn,xn=an,Ln=xn.buffer/xn.extent,ht=En,Ke=cn(En,1,-1-Ln,Ln,0,-1,2,xn),ot=cn(En,1,1-Ln,2+Ln,0,-1,2,xn),(Ke||ot)&&(ht=cn(En,1,-Ln,1+Ln,0,-1,2,xn)||[],Ke&&(ht=qi(Ke,1).concat(ht)),ot&&(ht=ht.concat(qi(ot,-1)))),vn=ht).length&&this.splitTile(vn,0,0,0),yn&&(vn.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mo(Ht,an,yn){return 32*((1<<Ht)*yn+an)+Ht}return Gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gr.prototype.splitTile=function(Ht,an,yn,vn,En,xn,Ln){for(var ht=[Ht,an,yn,vn],Ke=this.options,ot=Ke.debug;ht.length;){vn=ht.pop(),yn=ht.pop(),an=ht.pop(),Ht=ht.pop();var rt=1<<an,Nt=Mo(an,yn,vn),qt=this.tiles[Nt];if(!qt&&(ot>1&&console.time("creation"),qt=this.tiles[Nt]=io(Ht,an,yn,vn,Ke),this.tileCoords.push({z:an,x:yn,y:vn}),ot)){ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",an,yn,vn,qt.numFeatures,qt.numPoints,qt.numSimplified),console.timeEnd("creation"));var Rn="z"+an;this.stats[Rn]=(this.stats[Rn]||0)+1,this.total++}if(qt.source=Ht,En){if(an===Ke.maxZoom||an===En)continue;var cr=1<<En-an;if(yn!==Math.floor(xn/cr)||vn!==Math.floor(Ln/cr))continue}else if(an===Ke.indexMaxZoom||qt.numPoints<=Ke.indexMaxPoints)continue;if(qt.source=null,0!==Ht.length){ot>1&&console.time("clipping");var Sr,ii,ji,wi,dr,Oo,ho=.5*Ke.buffer/Ke.extent,vs=.5-ho,cs=.5+ho,Ei=1+ho;Sr=ii=ji=wi=null,dr=cn(Ht,rt,yn-ho,yn+cs,0,qt.minX,qt.maxX,Ke),Oo=cn(Ht,rt,yn+vs,yn+Ei,0,qt.minX,qt.maxX,Ke),Ht=null,dr&&(Sr=cn(dr,rt,vn-ho,vn+cs,1,qt.minY,qt.maxY,Ke),ii=cn(dr,rt,vn+vs,vn+Ei,1,qt.minY,qt.maxY,Ke),dr=null),Oo&&(ji=cn(Oo,rt,vn-ho,vn+cs,1,qt.minY,qt.maxY,Ke),wi=cn(Oo,rt,vn+vs,vn+Ei,1,qt.minY,qt.maxY,Ke),Oo=null),ot>1&&console.timeEnd("clipping"),ht.push(Sr||[],an+1,2*yn,2*vn),ht.push(ii||[],an+1,2*yn,2*vn+1),ht.push(ji||[],an+1,2*yn+1,2*vn),ht.push(wi||[],an+1,2*yn+1,2*vn+1)}}},Gr.prototype.getTile=function(Ht,an,yn){var vn=this.options,En=vn.extent,xn=vn.debug;if(Ht<0||Ht>24)return null;var Ln=1<<Ht,ht=Mo(Ht,an=(an%Ln+Ln)%Ln,yn);if(this.tiles[ht])return Ui(this.tiles[ht],En);xn>1&&console.log("drilling down to z%d-%d-%d",Ht,an,yn);for(var Ke,ot=Ht,rt=an,Nt=yn;!Ke&&ot>0;)ot--,rt=Math.floor(rt/2),Nt=Math.floor(Nt/2),Ke=this.tiles[Mo(ot,rt,Nt)];return Ke&&Ke.source?(xn>1&&console.log("found parent tile z%d-%d-%d",ot,rt,Nt),xn>1&&console.time("drilling down"),this.splitTile(Ke.source,ot,rt,Nt,Ht,an,yn),xn>1&&console.timeEnd("drilling down"),this.tiles[ht]?Ui(this.tiles[ht],En):null):null},function(Ht,an){return new Gr(Ht,an)}}();var rr=Ie.g(Gn.exports);function Hn(qe,ue){const ye=qe.tileID.canonical;if(!this._geoJSONIndex)return ue(null,null);const Me=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!Me)return ue(null,null);const Bt=new class{constructor(nn){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Ie.E,this.length=nn.length,this._features=nn}feature(nn){return new class{constructor(In){this._feature=In,this.extent=Ie.E,this.type=In.type,this.properties=In.tags,"id"in In&&!isNaN(In.id)&&(this.id=parseInt(In.id,10))}loadGeometry(){if(1===this._feature.type){const In=[];for(const Xt of this._feature.geometry)In.push([new Ie.P(Xt[0],Xt[1])]);return In}{const In=[];for(const Xt of this._feature.geometry){const Zn=[];for(const cn of Xt)Zn.push(new Ie.P(cn[0],cn[1]));In.push(Zn)}return In}}toGeoJSON(In,Xt,Zn){return vt.call(this,In,Xt,Zn)}}(this._features[nn])}}(Me.features);let zt=Gt(Bt);0===zt.byteOffset&&zt.byteLength===zt.buffer.byteLength||(zt=new Uint8Array(zt)),ue(null,{vectorTile:Bt,rawData:zt.buffer})}class mr extends Ie.d{constructor(ue,ye,Me,Bt,zt,nn){super(ue,ye,Me,Bt,Hn,nn),zt&&(this.loadGeoJSON=zt)}loadData(ue,ye){const Me=ue&&ue.request,Bt=Me&&Me.collectResourceTiming;this.loadGeoJSON(ue,(zt,nn)=>{if(zt||!nn)return ye(zt);if("object"!=typeof nn)return ye(new Error(`Input data given to '${ue.source}' is not a valid GeoJSON object.`));{Ue(nn,!0);try{if(ue.filter){const Xt=Ie.e(ue.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Xt.result)throw new Error(Xt.value.map(cn=>`${cn.key}: ${cn.message}`).join(", "));nn={type:"FeatureCollection",features:nn.features.filter(cn=>Xt.value.evaluate({zoom:0},cn))}}this._geoJSONIndex=ue.cluster?new yt(function({superclusterOptions:Xt,clusterProperties:Zn}){if(!Zn||!Xt)return Xt;const cn={},Dn={},ir={accumulated:null,zoom:0},bi={properties:null},Mi=Object.keys(Zn);for(const Nn of Mi){const[Kr,Lr]=Zn[Nn],qi=Ie.e(Lr),ri=Ie.e("string"==typeof Kr?[Kr,["accumulated"],["get",Nn]]:Kr);cn[Nn]=qi.value,Dn[Nn]=ri.value}return Xt.map=Nn=>{bi.properties=Nn;const Kr={};for(const Lr of Mi)Kr[Lr]=cn[Lr].evaluate(ir,bi);return Kr},Xt.reduce=(Nn,Kr)=>{bi.properties=Kr;for(const Lr of Mi)ir.accumulated=Nn[Lr],Nn[Lr]=Dn[Lr].evaluate(ir,bi)},Xt}(ue)).load(nn.features):rr(nn,ue.geojsonVtOptions)}catch(Xt){return ye(Xt)}this.loaded={};const In={};if(Bt){const Xt=Ie.f(Me);Xt&&(In.resourceTiming={},In.resourceTiming[ue.source]=JSON.parse(JSON.stringify(Xt)))}ye(null,In)}})}reloadTile(ue,ye){const Me=this.loaded;return Me&&Me[ue.uid]?super.reloadTile(ue,ye):this.loadTile(ue,ye)}loadGeoJSON(ue,ye){if(ue.request)Ie.h(ue.request,ye);else{if("string"!=typeof ue.data)return ye(new Error(`Input data given to '${ue.source}' is not a valid GeoJSON object.`));try{return ye(null,JSON.parse(ue.data))}catch{return ye(new Error(`Input data given to '${ue.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ue,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ue.clusterId))}catch(Me){ye(Me)}}getClusterChildren(ue,ye){try{ye(null,this._geoJSONIndex.getChildren(ue.clusterId))}catch(Me){ye(Me)}}getClusterLeaves(ue,ye){try{ye(null,this._geoJSONIndex.getLeaves(ue.clusterId,ue.limit,ue.offset))}catch(Me){ye(Me)}}}class gr{constructor(ue,ye){this.tileID=new Ie.O(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),this.tileZoom=ue.tileZoom,this.uid=ue.uid,this.zoom=ue.zoom,this.canonical=ue.tileID.canonical,this.pixelRatio=ue.pixelRatio,this.tileSize=ue.tileSize,this.source=ue.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ue.projection,this.brightness=ye}parse(ue,ye,Me,Bt){this.status="parsing";const zt=new Ie.O(Me.tileID.overscaledZ,Me.tileID.wrap,Me.tileID.canonical.z,Me.tileID.canonical.x,Me.tileID.canonical.y),nn={},In=ye.familiesBySource[Me.source],Xt=new Ie.F(zt,Me.promoteId);return Xt.bucketLayerIDs=[],Ie.l(ue).then(Zn=>{if(!Zn)return Bt(new Error("Could not parse tile"));const cn=Ie.j(Zn,1/Ie.t(Me.tileID.canonical)),Dn=Zn.json.extensionsUsed&&Zn.json.extensionsUsed.includes("MAPBOX_mesh_features"),ir=new Ie.k(this.zoom,{brightness:this.brightness});for(const bi in In)for(const Mi of In[bi]){const Nn=Mi[0],Kr=Zn.json.extensionsUsed;Nn.recalculate(ir,[]);const Lr=new Ie.T(cn,zt,Kr&&Kr.includes("MAPBOX_mesh_features"),this.brightness);Dn||(Lr.needsUpload=!0),nn[Nn.fqid]=Lr,Lr.evaluate(Nn)}this.status="done",Bt(null,{buckets:nn,featureIndex:Xt})}).catch(Zn=>Bt(new Error(Zn.message)))}}class ei{constructor(ue,ye,Me,Bt,zt,nn){this.actor=ue,this.layerIndex=ye,this.brightness=nn,this.loading={},this.loaded={}}loadTile(ue,ye){const Me=ue.uid,Bt=this.loading[Me]=new gr(ue,this.brightness);Ie.i(ue.request,(zt,nn)=>{const In=!this.loading[Me];return delete this.loading[Me],In||zt?(Bt.status="done",In||(this.loaded[Me]=Bt),ye(zt)):nn&&0!==nn.byteLength?void Bt.parse(nn,this.layerIndex,ue,(Xt,Zn)=>{Bt.status="done",this.loaded=this.loaded||{},this.loaded[Me]=Bt,Xt||!Zn?ye(Xt):ye(null,Zn)}):(Bt.status="done",this.loaded[Me]=Bt,ye())})}reloadTile(ue,ye){const Me=this.loaded,Bt=ue.uid;if(Me&&Me[Bt]){const zt=Me[Bt];zt.projection=ue.projection,zt.brightness=ue.brightness;const nn=(In,Xt)=>{zt.reloadCallback&&(delete zt.reloadCallback,this.loadTile(ue,ye)),ye(In,Xt)};"parsing"===zt.status?zt.reloadCallback=nn:"done"===zt.status&&this.loadTile(ue,ye)}}abortTile(ue,ye){const Me=ue.uid;this.loading[Me]&&delete this.loading[Me],ye()}removeTile(ue,ye){const Me=this.loaded,Bt=ue.uid;Me&&Me[Bt]&&delete Me[Bt],ye()}}class An{constructor(ue){this.self=ue,this.actor=new Ie.A(ue,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Ie.m({name:"mercator"}),this.workerSourceTypes={vector:Ie.d,geojson:mr,"batched-model":ei},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ye,Me)=>{if(this.workerSourceTypes[ye])throw new Error(`Worker source with name "${ye}" already registered.`);this.workerSourceTypes[ye]=Me},this.self.registerRTLTextPlugin=ye=>{if(Ie.n.isParsed())throw new Error("RTL text plugin already registered.");Ie.n.applyArabicShaping=ye.applyArabicShaping,Ie.n.processBidirectionalText=ye.processBidirectionalText,Ie.n.processStyledBidirectionalText=ye.processStyledBidirectionalText}}clearCaches(ue,ye,Me){delete this.layerIndexes[ue],delete this.availableImages[ue],delete this.workerSources[ue],delete this.demWorkerSources[ue],Me()}checkIfReady(ue,ye,Me){Me()}setReferrer(ue,ye){this.referrer=ye}spriteLoaded(ue,{scope:ye,isLoaded:Me}){if(this.isSpriteLoaded[ue]||(this.isSpriteLoaded[ue]={}),this.isSpriteLoaded[ue][ye]=Me,this.workerSources[ue]&&this.workerSources[ue][ye])for(const Bt in this.workerSources[ue][ye]){const zt=this.workerSources[ue][ye][Bt];for(const nn in zt)zt[nn]instanceof Ie.d&&(zt[nn].isSpriteLoaded=Me,zt[nn].fire(new Ie.o("isSpriteLoaded")))}}setImages(ue,{scope:ye,images:Me},Bt){if(this.availableImages[ue]||(this.availableImages[ue]={}),this.availableImages[ue][ye]=Me,this.workerSources[ue]&&this.workerSources[ue][ye]){for(const zt in this.workerSources[ue][ye]){const nn=this.workerSources[ue][ye][zt];for(const In in nn)nn[In].availableImages=Me}Bt()}else Bt()}setProjection(ue,ye){this.projections[ue]=Ie.m(ye)}setBrightness(ue,ye,Me){this.brightness=ye,Me()}setLayers(ue,ye,Me){this.getLayerIndex(ue,ye.scope).replace(ye.layers,ye.options),Me()}updateLayers(ue,ye,Me){this.getLayerIndex(ue,ye.scope).update(ye.layers,ye.removedIds,ye.options),Me()}loadTile(ue,ye,Me){ye.projection=this.projections[ue]||this.defaultProjection,this.getWorkerSource(ue,ye.type,ye.source,ye.scope).loadTile(ye,Me)}loadDEMTile(ue,ye,Me){this.getDEMWorkerSource(ue,ye.source,ye.scope).loadTile(ye,Me)}reloadTile(ue,ye,Me){ye.projection=this.projections[ue]||this.defaultProjection,this.getWorkerSource(ue,ye.type,ye.source,ye.scope).reloadTile(ye,Me)}abortTile(ue,ye,Me){this.getWorkerSource(ue,ye.type,ye.source,ye.scope).abortTile(ye,Me)}removeTile(ue,ye,Me){this.getWorkerSource(ue,ye.type,ye.source,ye.scope).removeTile(ye,Me)}removeSource(ue,ye,Me){if(!(this.workerSources[ue]&&this.workerSources[ue][ye.scope]&&this.workerSources[ue][ye.scope][ye.type]&&this.workerSources[ue][ye.scope][ye.type][ye.source]))return;const Bt=this.workerSources[ue][ye.scope][ye.type][ye.source];delete this.workerSources[ue][ye.scope][ye.type][ye.source],void 0!==Bt.removeSource?Bt.removeSource(ye,Me):Me()}loadWorkerSource(ue,ye,Me){try{this.self.importScripts(ye.url),Me()}catch(Bt){Me(Bt.toString())}}syncRTLPluginState(ue,ye,Me){try{Ie.n.setState(ye);const Bt=Ie.n.getPluginURL();if(Ie.n.isLoaded()&&!Ie.n.isParsed()&&null!=Bt){this.self.importScripts(Bt);const zt=Ie.n.isParsed();Me(zt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Bt}`),zt)}}catch(Bt){Me(Bt.toString())}}setDracoUrl(ue,ye){this.dracoUrl=ye}getAvailableImages(ue,ye){this.availableImages[ue]||(this.availableImages[ue]={});let Me=this.availableImages[ue][ye];return Me||(Me=[]),Me}getLayerIndex(ue,ye){this.layerIndexes[ue]||(this.layerIndexes[ue]={});let Me=this.layerIndexes[ue][ye];return Me||(Me=this.layerIndexes[ue][ye]=new Le,Me.scope=ye),Me}getWorkerSource(ue,ye,Me,Bt){return this.workerSources[ue]||(this.workerSources[ue]={}),this.workerSources[ue][Bt]||(this.workerSources[ue][Bt]={}),this.workerSources[ue][Bt][ye]||(this.workerSources[ue][Bt][ye]={}),this.isSpriteLoaded[ue]||(this.isSpriteLoaded[ue]={}),this.workerSources[ue][Bt][ye][Me]||(this.workerSources[ue][Bt][ye][Me]=new this.workerSourceTypes[ye]({send:(nn,In,Xt,Zn,cn,Dn)=>{this.actor.send(nn,In,Xt,ue,cn,Dn)},scheduler:this.actor.scheduler},this.getLayerIndex(ue,Bt),this.getAvailableImages(ue,Bt),this.isSpriteLoaded[ue][Bt],void 0,this.brightness)),this.workerSources[ue][Bt][ye][Me]}getDEMWorkerSource(ue,ye,Me){return this.demWorkerSources[ue]||(this.demWorkerSources[ue]={}),this.demWorkerSources[ue][Me]||(this.demWorkerSources[ue][Me]={}),this.demWorkerSources[ue][Me][ye]||(this.demWorkerSources[ue][Me][ye]=new Be),this.demWorkerSources[ue][Me][ye]}enforceCacheSizeLimit(ue,ye){Ie.q(ye)}getWorkerPerformanceMetrics(ue,ye,Me){Me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new An(self)),An}),he(0,function(Ie){return Ie.s}),E}()},5619:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{X:()=>he});var E=ae(8645);class he extends E.x{constructor(Ie){super(),this._value=Ie}get value(){return this.getValue()}_subscribe(Ie){const ge=super._subscribe(Ie);return!ge.closed&&Ie.next(this._value),ge}getValue(){const{hasError:Ie,thrownError:ge,_value:Ve}=this;if(Ie)throw ge;return this._throwIfClosed(),Ve}next(Ie){super.next(this._value=Ie)}}},5592:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{y:()=>Be});var E=ae(305),he=ae(7394),at=ae(4850),Ie=ae(8407),ge=ae(2653),Ve=ae(4674),Le=ae(1441);let Be=(()=>{class vt{constructor(xt){xt&&(this._subscribe=xt)}lift(xt){const gt=new vt;return gt.source=this,gt.operator=xt,gt}subscribe(xt,gt,Jt){const Ot=function Ue(vt){return vt&&vt instanceof E.Lv||function wt(vt){return vt&&(0,Ve.m)(vt.next)&&(0,Ve.m)(vt.error)&&(0,Ve.m)(vt.complete)}(vt)&&(0,he.Nn)(vt)}(xt)?xt:new E.Hp(xt,gt,Jt);return(0,Le.x)(()=>{const{operator:Rt,source:Pt}=this;Ot.add(Rt?Rt.call(Ot,Pt):Pt?this._subscribe(Ot):this._trySubscribe(Ot))}),Ot}_trySubscribe(xt){try{return this._subscribe(xt)}catch(gt){xt.error(gt)}}forEach(xt,gt){return new(gt=ze(gt))((Jt,Ot)=>{const Rt=new E.Hp({next:Pt=>{try{xt(Pt)}catch(hn){Ot(hn),Rt.unsubscribe()}},error:Ot,complete:Jt});this.subscribe(Rt)})}_subscribe(xt){var gt;return null===(gt=this.source)||void 0===gt?void 0:gt.subscribe(xt)}[at.L](){return this}pipe(...xt){return(0,Ie.U)(xt)(this)}toPromise(xt){return new(xt=ze(xt))((gt,Jt)=>{let Ot;this.subscribe(Rt=>Ot=Rt,Rt=>Jt(Rt),()=>gt(Ot))})}}return vt.create=Mt=>new vt(Mt),vt})();function ze(vt){var Mt;return null!==(Mt=null!=vt?vt:ge.config.Promise)&&void 0!==Mt?Mt:Promise}},8645:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{x:()=>Le});var E=ae(5592),he=ae(7394);const Ie=(0,ae(2306).d)(ze=>function(){ze(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ge=ae(9039),Ve=ae(1441);let Le=(()=>{class ze extends E.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(Ue){const vt=new Be(this,this);return vt.operator=Ue,vt}_throwIfClosed(){if(this.closed)throw new Ie}next(Ue){(0,Ve.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const vt of this.currentObservers)vt.next(Ue)}})}error(Ue){(0,Ve.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=Ue;const{observers:vt}=this;for(;vt.length;)vt.shift().error(Ue)}})}complete(){(0,Ve.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:Ue}=this;for(;Ue.length;)Ue.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var Ue;return(null===(Ue=this.observers)||void 0===Ue?void 0:Ue.length)>0}_trySubscribe(Ue){return this._throwIfClosed(),super._trySubscribe(Ue)}_subscribe(Ue){return this._throwIfClosed(),this._checkFinalizedStatuses(Ue),this._innerSubscribe(Ue)}_innerSubscribe(Ue){const{hasError:vt,isStopped:Mt,observers:xt}=this;return vt||Mt?he.Lc:(this.currentObservers=null,xt.push(Ue),new he.w0(()=>{this.currentObservers=null,(0,ge.P)(xt,Ue)}))}_checkFinalizedStatuses(Ue){const{hasError:vt,thrownError:Mt,isStopped:xt}=this;vt?Ue.error(Mt):xt&&Ue.complete()}asObservable(){const Ue=new E.y;return Ue.source=this,Ue}}return ze.create=(wt,Ue)=>new Be(wt,Ue),ze})();class Be extends Le{constructor(wt,Ue){super(),this.destination=wt,this.source=Ue}next(wt){var Ue,vt;null===(vt=null===(Ue=this.destination)||void 0===Ue?void 0:Ue.next)||void 0===vt||vt.call(Ue,wt)}error(wt){var Ue,vt;null===(vt=null===(Ue=this.destination)||void 0===Ue?void 0:Ue.error)||void 0===vt||vt.call(Ue,wt)}complete(){var wt,Ue;null===(Ue=null===(wt=this.destination)||void 0===wt?void 0:wt.complete)||void 0===Ue||Ue.call(wt)}_subscribe(wt){var Ue,vt;return null!==(vt=null===(Ue=this.source)||void 0===Ue?void 0:Ue.subscribe(wt))&&void 0!==vt?vt:he.Lc}}},305:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Hp:()=>Jt,Lv:()=>vt});var E=ae(4674),he=ae(7394),at=ae(2653),Ie=ae(3894),ge=ae(2420);const Ve=ze("C",void 0,void 0);function ze(lt,me,st){return{kind:lt,value:me,error:st}}var wt=ae(7599),Ue=ae(1441);class vt extends he.w0{constructor(me){super(),this.isStopped=!1,me?(this.destination=me,(0,he.Nn)(me)&&me.add(this)):this.destination=hn}static create(me,st,Ft){return new Jt(me,st,Ft)}next(me){this.isStopped?Pt(function Be(lt){return ze("N",lt,void 0)}(me),this):this._next(me)}error(me){this.isStopped?Pt(function Le(lt){return ze("E",void 0,lt)}(me),this):(this.isStopped=!0,this._error(me))}complete(){this.isStopped?Pt(Ve,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(me){this.destination.next(me)}_error(me){try{this.destination.error(me)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Mt=Function.prototype.bind;function xt(lt,me){return Mt.call(lt,me)}class gt{constructor(me){this.partialObserver=me}next(me){const{partialObserver:st}=this;if(st.next)try{st.next(me)}catch(Ft){Ot(Ft)}}error(me){const{partialObserver:st}=this;if(st.error)try{st.error(me)}catch(Ft){Ot(Ft)}else Ot(me)}complete(){const{partialObserver:me}=this;if(me.complete)try{me.complete()}catch(st){Ot(st)}}}class Jt extends vt{constructor(me,st,Ft){let Te;if(super(),(0,E.m)(me)||!me)Te={next:null!=me?me:void 0,error:null!=st?st:void 0,complete:null!=Ft?Ft:void 0};else{let De;this&&at.config.useDeprecatedNextContext?(De=Object.create(me),De.unsubscribe=()=>this.unsubscribe(),Te={next:me.next&&xt(me.next,De),error:me.error&&xt(me.error,De),complete:me.complete&&xt(me.complete,De)}):Te=me}this.destination=new gt(Te)}}function Ot(lt){at.config.useDeprecatedSynchronousErrorHandling?(0,Ue.O)(lt):(0,Ie.h)(lt)}function Pt(lt,me){const{onStoppedNotification:st}=at.config;st&&wt.z.setTimeout(()=>st(lt,me))}const hn={closed:!0,next:ge.Z,error:function Rt(lt){throw lt},complete:ge.Z}},7394:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Lc:()=>Ve,w0:()=>ge,Nn:()=>Le});var E=ae(4674);const at=(0,ae(2306).d)(ze=>function(Ue){ze(this),this.message=Ue?`${Ue.length} errors occurred during unsubscription:\n${Ue.map((vt,Mt)=>`${Mt+1}) ${vt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Ue});var Ie=ae(9039);class ge{constructor(wt){this.initialTeardown=wt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let wt;if(!this.closed){this.closed=!0;const{_parentage:Ue}=this;if(Ue)if(this._parentage=null,Array.isArray(Ue))for(const xt of Ue)xt.remove(this);else Ue.remove(this);const{initialTeardown:vt}=this;if((0,E.m)(vt))try{vt()}catch(xt){wt=xt instanceof at?xt.errors:[xt]}const{_finalizers:Mt}=this;if(Mt){this._finalizers=null;for(const xt of Mt)try{Be(xt)}catch(gt){wt=null!=wt?wt:[],gt instanceof at?wt=[...wt,...gt.errors]:wt.push(gt)}}if(wt)throw new at(wt)}}add(wt){var Ue;if(wt&&wt!==this)if(this.closed)Be(wt);else{if(wt instanceof ge){if(wt.closed||wt._hasParent(this))return;wt._addParent(this)}(this._finalizers=null!==(Ue=this._finalizers)&&void 0!==Ue?Ue:[]).push(wt)}}_hasParent(wt){const{_parentage:Ue}=this;return Ue===wt||Array.isArray(Ue)&&Ue.includes(wt)}_addParent(wt){const{_parentage:Ue}=this;this._parentage=Array.isArray(Ue)?(Ue.push(wt),Ue):Ue?[Ue,wt]:wt}_removeParent(wt){const{_parentage:Ue}=this;Ue===wt?this._parentage=null:Array.isArray(Ue)&&(0,Ie.P)(Ue,wt)}remove(wt){const{_finalizers:Ue}=this;Ue&&(0,Ie.P)(Ue,wt),wt instanceof ge&&wt._removeParent(this)}}ge.EMPTY=(()=>{const ze=new ge;return ze.closed=!0,ze})();const Ve=ge.EMPTY;function Le(ze){return ze instanceof ge||ze&&"closed"in ze&&(0,E.m)(ze.remove)&&(0,E.m)(ze.add)&&(0,E.m)(ze.unsubscribe)}function Be(ze){(0,E.m)(ze)?ze():ze.unsubscribe()}},2653:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{config:()=>E});const E={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},3168:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{c:()=>Ve});var E=ae(5592),he=ae(7394),at=ae(6196),Ie=ae(8251),ge=ae(9360);class Ve extends E.y{constructor(Be,ze){super(),this.source=Be,this.subjectFactory=ze,this._subject=null,this._refCount=0,this._connection=null,(0,ge.A)(Be)&&(this.lift=Be.lift)}_subscribe(Be){return this.getSubject().subscribe(Be)}getSubject(){const Be=this._subject;return(!Be||Be.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:Be}=this;this._subject=this._connection=null,null==Be||Be.unsubscribe()}connect(){let Be=this._connection;if(!Be){Be=this._connection=new he.w0;const ze=this.getSubject();Be.add(this.source.subscribe((0,Ie.x)(ze,void 0,()=>{this._teardown(),ze.complete()},wt=>{this._teardown(),ze.error(wt)},()=>this._teardown()))),Be.closed&&(this._connection=null,Be=he.w0.EMPTY)}return Be}refCount(){return(0,at.x)()(this)}}},2572:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{a:()=>wt});var E=ae(5592),he=ae(7453),at=ae(2459),Ie=ae(2737),ge=ae(7400),Ve=ae(9940),Le=ae(2714),Be=ae(8251),ze=ae(7103);function wt(...Mt){const xt=(0,Ve.yG)(Mt),gt=(0,Ve.jO)(Mt),{args:Jt,keys:Ot}=(0,he.D)(Mt);if(0===Jt.length)return(0,at.D)([],xt);const Rt=new E.y(function Ue(Mt,xt,gt=Ie.y){return Jt=>{vt(xt,()=>{const{length:Ot}=Mt,Rt=new Array(Ot);let Pt=Ot,hn=Ot;for(let lt=0;lt<Ot;lt++)vt(xt,()=>{const me=(0,at.D)(Mt[lt],xt);let st=!1;me.subscribe((0,Be.x)(Jt,Ft=>{Rt[lt]=Ft,st||(st=!0,hn--),hn||Jt.next(gt(Rt.slice()))},()=>{--Pt||Jt.complete()}))},Jt)},Jt)}}(Jt,xt,Ot?Pt=>(0,Le.n)(Ot,Pt):Ie.y));return gt?Rt.pipe((0,ge.Z)(gt)):Rt}function vt(Mt,xt,gt){Mt?(0,ze.f)(gt,Mt,xt):xt()}},5211:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{z:()=>ge});var E=ae(7537),at=ae(9940),Ie=ae(2459);function ge(...Ve){return function he(){return(0,E.J)(1)}()((0,Ie.D)(Ve,(0,at.yG)(Ve)))}},4911:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{P:()=>at});var E=ae(5592),he=ae(4829);function at(Ie){return new E.y(ge=>{(0,he.Xf)(Ie()).subscribe(ge)})}},6232:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{E:()=>he});const he=new(ae(5592).y)(ge=>ge.complete())},2459:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{D:()=>me});var E=ae(4829),he=ae(3093),at=ae(5137),Ve=ae(5592),Be=ae(4971),ze=ae(4674),wt=ae(7103);function vt(st,Ft){if(!st)throw new Error("Iterable cannot be null");return new Ve.y(Te=>{(0,wt.f)(Te,Ft,()=>{const De=st[Symbol.asyncIterator]();(0,wt.f)(Te,Ft,()=>{De.next().then(dt=>{dt.done?Te.complete():Te.next(dt.value)})},0,!0)})})}var Mt=ae(8382),xt=ae(4026),gt=ae(4266),Jt=ae(3664),Ot=ae(5726),Rt=ae(9853),Pt=ae(541);function me(st,Ft){return Ft?function lt(st,Ft){if(null!=st){if((0,Mt.c)(st))return function Ie(st,Ft){return(0,E.Xf)(st).pipe((0,at.R)(Ft),(0,he.Q)(Ft))}(st,Ft);if((0,gt.z)(st))return function Le(st,Ft){return new Ve.y(Te=>{let De=0;return Ft.schedule(function(){De===st.length?Te.complete():(Te.next(st[De++]),Te.closed||this.schedule())})})}(st,Ft);if((0,xt.t)(st))return function ge(st,Ft){return(0,E.Xf)(st).pipe((0,at.R)(Ft),(0,he.Q)(Ft))}(st,Ft);if((0,Ot.D)(st))return vt(st,Ft);if((0,Jt.T)(st))return function Ue(st,Ft){return new Ve.y(Te=>{let De;return(0,wt.f)(Te,Ft,()=>{De=st[Be.h](),(0,wt.f)(Te,Ft,()=>{let dt,mt;try{({value:dt,done:mt}=De.next())}catch(Gt){return void Te.error(Gt)}mt?Te.complete():Te.next(dt)},0,!0)}),()=>(0,ze.m)(null==De?void 0:De.return)&&De.return()})}(st,Ft);if((0,Pt.L)(st))return function hn(st,Ft){return vt((0,Pt.Q)(st),Ft)}(st,Ft)}throw(0,Rt.z)(st)}(st,Ft):(0,E.Xf)(st)}},2438:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{R:()=>wt});var E=ae(4829),he=ae(5592),at=ae(1631),Ie=ae(4266),ge=ae(4674),Ve=ae(7400);const Le=["addListener","removeListener"],Be=["addEventListener","removeEventListener"],ze=["on","off"];function wt(gt,Jt,Ot,Rt){if((0,ge.m)(Ot)&&(Rt=Ot,Ot=void 0),Rt)return wt(gt,Jt,Ot).pipe((0,Ve.Z)(Rt));const[Pt,hn]=function xt(gt){return(0,ge.m)(gt.addEventListener)&&(0,ge.m)(gt.removeEventListener)}(gt)?Be.map(lt=>me=>gt[lt](Jt,me,Ot)):function vt(gt){return(0,ge.m)(gt.addListener)&&(0,ge.m)(gt.removeListener)}(gt)?Le.map(Ue(gt,Jt)):function Mt(gt){return(0,ge.m)(gt.on)&&(0,ge.m)(gt.off)}(gt)?ze.map(Ue(gt,Jt)):[];if(!Pt&&(0,Ie.z)(gt))return(0,at.z)(lt=>wt(lt,Jt,Ot))((0,E.Xf)(gt));if(!Pt)throw new TypeError("Invalid event target");return new he.y(lt=>{const me=(...st)=>lt.next(1<st.length?st:st[0]);return Pt(me),()=>hn(me)})}function Ue(gt,Jt){return Ot=>Rt=>gt[Ot](Jt,Rt)}},4829:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Xf:()=>Mt});var E=ae(7582),he=ae(4266),at=ae(4026),Ie=ae(5592),ge=ae(8382),Ve=ae(5726),Le=ae(9853),Be=ae(3664),ze=ae(541),wt=ae(4674),Ue=ae(3894),vt=ae(4850);function Mt(lt){if(lt instanceof Ie.y)return lt;if(null!=lt){if((0,ge.c)(lt))return function xt(lt){return new Ie.y(me=>{const st=lt[vt.L]();if((0,wt.m)(st.subscribe))return st.subscribe(me);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(lt);if((0,he.z)(lt))return function gt(lt){return new Ie.y(me=>{for(let st=0;st<lt.length&&!me.closed;st++)me.next(lt[st]);me.complete()})}(lt);if((0,at.t)(lt))return function Jt(lt){return new Ie.y(me=>{lt.then(st=>{me.closed||(me.next(st),me.complete())},st=>me.error(st)).then(null,Ue.h)})}(lt);if((0,Ve.D)(lt))return Rt(lt);if((0,Be.T)(lt))return function Ot(lt){return new Ie.y(me=>{for(const st of lt)if(me.next(st),me.closed)return;me.complete()})}(lt);if((0,ze.L)(lt))return function Pt(lt){return Rt((0,ze.Q)(lt))}(lt)}throw(0,Le.z)(lt)}function Rt(lt){return new Ie.y(me=>{(function hn(lt,me){var st,Ft,Te,De;return(0,E.mG)(this,void 0,void 0,function*(){try{for(st=(0,E.KL)(lt);!(Ft=yield st.next()).done;)if(me.next(Ft.value),me.closed)return}catch(dt){Te={error:dt}}finally{try{Ft&&!Ft.done&&(De=st.return)&&(yield De.call(st))}finally{if(Te)throw Te.error}}me.complete()})})(lt,me).catch(st=>me.error(st))})}},2096:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{of:()=>at});var E=ae(9940),he=ae(2459);function at(...Ie){const ge=(0,E.yG)(Ie);return(0,he.D)(Ie,ge)}},8504:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{_:()=>at});var E=ae(5592),he=ae(4674);function at(Ie,ge){const Ve=(0,he.m)(Ie)?Ie:()=>Ie,Le=Be=>Be.error(Ve());return new E.y(ge?Be=>ge.schedule(Le,0,Be):Le)}},4825:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{H:()=>ge});var E=ae(5592),he=ae(6321),at=ae(671);function ge(Ve=0,Le,Be=he.P){let ze=-1;return null!=Le&&((0,at.K)(Le)?Be=Le:ze=Le),new E.y(wt=>{let Ue=function Ie(Ve){return Ve instanceof Date&&!isNaN(Ve)}(Ve)?+Ve-Be.now():Ve;Ue<0&&(Ue=0);let vt=0;return Be.schedule(function(){wt.closed||(wt.next(vt++),0<=ze?this.schedule(void 0,ze):wt.complete())},Ue)})}},8251:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{x:()=>he});var E=ae(305);function he(Ie,ge,Ve,Le,Be){return new at(Ie,ge,Ve,Le,Be)}class at extends E.Lv{constructor(ge,Ve,Le,Be,ze,wt){super(ge),this.onFinalize=ze,this.shouldUnsubscribe=wt,this._next=Ve?function(Ue){try{Ve(Ue)}catch(vt){ge.error(vt)}}:super._next,this._error=Be?function(Ue){try{Be(Ue)}catch(vt){ge.error(vt)}finally{this.unsubscribe()}}:super._error,this._complete=Le?function(){try{Le()}catch(Ue){ge.error(Ue)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ge;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Ve}=this;super.unsubscribe(),!Ve&&(null===(ge=this.onFinalize)||void 0===ge||ge.call(this))}}}},6306:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{K:()=>Ie});var E=ae(4829),he=ae(8251),at=ae(9360);function Ie(ge){return(0,at.e)((Ve,Le)=>{let wt,Be=null,ze=!1;Be=Ve.subscribe((0,he.x)(Le,void 0,void 0,Ue=>{wt=(0,E.Xf)(ge(Ue,Ie(ge)(Ve))),Be?(Be.unsubscribe(),Be=null,wt.subscribe(Le)):ze=!0})),ze&&(Be.unsubscribe(),Be=null,wt.subscribe(Le))})}},2181:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{h:()=>at});var E=ae(9360),he=ae(8251);function at(Ie,ge){return(0,E.e)((Ve,Le)=>{let Be=0;Ve.subscribe((0,he.x)(Le,ze=>Ie.call(ge,ze,Be++)&&Le.next(ze)))})}},7398:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{U:()=>at});var E=ae(9360),he=ae(8251);function at(Ie,ge){return(0,E.e)((Ve,Le)=>{let Be=0;Ve.subscribe((0,he.x)(Le,ze=>{Le.next(Ie.call(ge,ze,Be++))}))})}},975:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{h:()=>he});var E=ae(7398);function he(at){return(0,E.U)(()=>at)}},7537:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{J:()=>at});var E=ae(1631),he=ae(2737);function at(Ie=1/0){return(0,E.z)(he.y,Ie)}},1631:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{z:()=>Be});var E=ae(7398),he=ae(4829),at=ae(9360),Ie=ae(7103),ge=ae(8251),Le=ae(4674);function Be(ze,wt,Ue=1/0){return(0,Le.m)(wt)?Be((vt,Mt)=>(0,E.U)((xt,gt)=>wt(vt,xt,Mt,gt))((0,he.Xf)(ze(vt,Mt))),Ue):("number"==typeof wt&&(Ue=wt),(0,at.e)((vt,Mt)=>function Ve(ze,wt,Ue,vt,Mt,xt,gt,Jt){const Ot=[];let Rt=0,Pt=0,hn=!1;const lt=()=>{hn&&!Ot.length&&!Rt&&wt.complete()},me=Ft=>Rt<vt?st(Ft):Ot.push(Ft),st=Ft=>{xt&&wt.next(Ft),Rt++;let Te=!1;(0,he.Xf)(Ue(Ft,Pt++)).subscribe((0,ge.x)(wt,De=>{null==Mt||Mt(De),xt?me(De):wt.next(De)},()=>{Te=!0},void 0,()=>{if(Te)try{for(Rt--;Ot.length&&Rt<vt;){const De=Ot.shift();gt?(0,Ie.f)(wt,gt,()=>st(De)):st(De)}lt()}catch(De){wt.error(De)}}))};return ze.subscribe((0,ge.x)(wt,me,()=>{hn=!0,lt()})),()=>{null==Jt||Jt()}}(vt,Mt,ze,Ue)))}},3093:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Q:()=>Ie});var E=ae(7103),he=ae(9360),at=ae(8251);function Ie(ge,Ve=0){return(0,he.e)((Le,Be)=>{Le.subscribe((0,at.x)(Be,ze=>(0,E.f)(Be,ge,()=>Be.next(ze),Ve),()=>(0,E.f)(Be,ge,()=>Be.complete(),Ve),ze=>(0,E.f)(Be,ge,()=>Be.error(ze),Ve)))})}},6196:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{x:()=>at});var E=ae(9360),he=ae(8251);function at(){return(0,E.e)((Ie,ge)=>{let Ve=null;Ie._refCount++;const Le=(0,he.x)(ge,void 0,void 0,void 0,()=>{if(!Ie||Ie._refCount<=0||0<--Ie._refCount)return void(Ve=null);const Be=Ie._connection,ze=Ve;Ve=null,Be&&(!ze||Be===ze)&&Be.unsubscribe(),ge.unsubscribe()});Ie.subscribe(Le),Le.closed||(Ve=Ie.connect())})}},5137:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{R:()=>he});var E=ae(9360);function he(at,Ie=0){return(0,E.e)((ge,Ve)=>{Ve.add(at.schedule(()=>ge.subscribe(Ve),Ie))})}},4664:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{w:()=>Ie});var E=ae(4829),he=ae(9360),at=ae(8251);function Ie(ge,Ve){return(0,he.e)((Le,Be)=>{let ze=null,wt=0,Ue=!1;const vt=()=>Ue&&!ze&&Be.complete();Le.subscribe((0,at.x)(Be,Mt=>{null==ze||ze.unsubscribe();let xt=0;const gt=wt++;(0,E.Xf)(ge(Mt,gt)).subscribe(ze=(0,at.x)(Be,Jt=>Be.next(Ve?Ve(Mt,Jt,gt,xt++):Jt),()=>{ze=null,vt()}))},()=>{Ue=!0,vt()}))})}},8180:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{q:()=>Ie});var E=ae(6232),he=ae(9360),at=ae(8251);function Ie(ge){return ge<=0?()=>E.E:(0,he.e)((Ve,Le)=>{let Be=0;Ve.subscribe((0,at.x)(Le,ze=>{++Be<=ge&&(Le.next(ze),ge<=Be&&Le.complete())}))})}},9397:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{b:()=>ge});var E=ae(4674),he=ae(9360),at=ae(8251),Ie=ae(2737);function ge(Ve,Le,Be){const ze=(0,E.m)(Ve)||Le||Be?{next:Ve,error:Le,complete:Be}:Ve;return ze?(0,he.e)((wt,Ue)=>{var vt;null===(vt=ze.subscribe)||void 0===vt||vt.call(ze);let Mt=!0;wt.subscribe((0,at.x)(Ue,xt=>{var gt;null===(gt=ze.next)||void 0===gt||gt.call(ze,xt),Ue.next(xt)},()=>{var xt;Mt=!1,null===(xt=ze.complete)||void 0===xt||xt.call(ze),Ue.complete()},xt=>{var gt;Mt=!1,null===(gt=ze.error)||void 0===gt||gt.call(ze,xt),Ue.error(xt)},()=>{var xt,gt;Mt&&(null===(xt=ze.unsubscribe)||void 0===xt||xt.call(ze)),null===(gt=ze.finalize)||void 0===gt||gt.call(ze)}))}):Ie.y}},1954:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{o:()=>ge});var E=ae(7394);class he extends E.w0{constructor(Le,Be){super()}schedule(Le,Be=0){return this}}const at={setInterval(Ve,Le,...Be){const{delegate:ze}=at;return null!=ze&&ze.setInterval?ze.setInterval(Ve,Le,...Be):setInterval(Ve,Le,...Be)},clearInterval(Ve){const{delegate:Le}=at;return((null==Le?void 0:Le.clearInterval)||clearInterval)(Ve)},delegate:void 0};var Ie=ae(9039);class ge extends he{constructor(Le,Be){super(Le,Be),this.scheduler=Le,this.work=Be,this.pending=!1}schedule(Le,Be=0){var ze;if(this.closed)return this;this.state=Le;const wt=this.id,Ue=this.scheduler;return null!=wt&&(this.id=this.recycleAsyncId(Ue,wt,Be)),this.pending=!0,this.delay=Be,this.id=null!==(ze=this.id)&&void 0!==ze?ze:this.requestAsyncId(Ue,this.id,Be),this}requestAsyncId(Le,Be,ze=0){return at.setInterval(Le.flush.bind(Le,this),ze)}recycleAsyncId(Le,Be,ze=0){if(null!=ze&&this.delay===ze&&!1===this.pending)return Be;null!=Be&&at.clearInterval(Be)}execute(Le,Be){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const ze=this._execute(Le,Be);if(ze)return ze;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Le,Be){let wt,ze=!1;try{this.work(Le)}catch(Ue){ze=!0,wt=Ue||new Error("Scheduled action threw falsy error")}if(ze)return this.unsubscribe(),wt}unsubscribe(){if(!this.closed){const{id:Le,scheduler:Be}=this,{actions:ze}=Be;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Ie.P)(ze,this),null!=Le&&(this.id=this.recycleAsyncId(Be,Le,null)),this.delay=null,super.unsubscribe()}}}},9931:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{v:()=>at});const E={now:()=>(E.delegate||Date).now(),delegate:void 0};class he{constructor(ge,Ve=he.now){this.schedulerActionCtor=ge,this.now=Ve}schedule(ge,Ve=0,Le){return new this.schedulerActionCtor(this,ge).schedule(Le,Ve)}}he.now=E.now;class at extends he{constructor(ge,Ve=he.now){super(ge,Ve),this.actions=[],this._active=!1}flush(ge){const{actions:Ve}=this;if(this._active)return void Ve.push(ge);let Le;this._active=!0;do{if(Le=ge.execute(ge.state,ge.delay))break}while(ge=Ve.shift());if(this._active=!1,Le){for(;ge=Ve.shift();)ge.unsubscribe();throw Le}}}},6321:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{P:()=>Ie,z:()=>at});var E=ae(1954);const at=new(ae(9931).v)(E.o),Ie=at},7599:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{z:()=>E});const E={setTimeout(he,at,...Ie){const{delegate:ge}=E;return null!=ge&&ge.setTimeout?ge.setTimeout(he,at,...Ie):setTimeout(he,at,...Ie)},clearTimeout(he){const{delegate:at}=E;return((null==at?void 0:at.clearTimeout)||clearTimeout)(he)},delegate:void 0}},4971:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{h:()=>he});const he=function E(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{L:()=>E});const E="function"==typeof Symbol&&Symbol.observable||"@@observable"},9940:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{_6:()=>Ve,jO:()=>Ie,yG:()=>ge});var E=ae(4674),he=ae(671);function at(Le){return Le[Le.length-1]}function Ie(Le){return(0,E.m)(at(Le))?Le.pop():void 0}function ge(Le){return(0,he.K)(at(Le))?Le.pop():void 0}function Ve(Le,Be){return"number"==typeof at(Le)?Le.pop():Be}},7453:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{D:()=>ge});const{isArray:E}=Array,{getPrototypeOf:he,prototype:at,keys:Ie}=Object;function ge(Le){if(1===Le.length){const Be=Le[0];if(E(Be))return{args:Be,keys:null};if(function Ve(Le){return Le&&"object"==typeof Le&&he(Le)===at}(Be)){const ze=Ie(Be);return{args:ze.map(wt=>Be[wt]),keys:ze}}}return{args:Le,keys:null}}},9039:(ur,Kt,ae)=>{"use strict";function E(he,at){if(he){const Ie=he.indexOf(at);0<=Ie&&he.splice(Ie,1)}}ae.d(Kt,{P:()=>E})},2306:(ur,Kt,ae)=>{"use strict";function E(he){const Ie=he(ge=>{Error.call(ge),ge.stack=(new Error).stack});return Ie.prototype=Object.create(Error.prototype),Ie.prototype.constructor=Ie,Ie}ae.d(Kt,{d:()=>E})},2714:(ur,Kt,ae)=>{"use strict";function E(he,at){return he.reduce((Ie,ge,Ve)=>(Ie[ge]=at[Ve],Ie),{})}ae.d(Kt,{n:()=>E})},1441:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{O:()=>Ie,x:()=>at});var E=ae(2653);let he=null;function at(ge){if(E.config.useDeprecatedSynchronousErrorHandling){const Ve=!he;if(Ve&&(he={errorThrown:!1,error:null}),ge(),Ve){const{errorThrown:Le,error:Be}=he;if(he=null,Le)throw Be}}else ge()}function Ie(ge){E.config.useDeprecatedSynchronousErrorHandling&&he&&(he.errorThrown=!0,he.error=ge)}},7103:(ur,Kt,ae)=>{"use strict";function E(he,at,Ie,ge=0,Ve=!1){const Le=at.schedule(function(){Ie(),Ve?he.add(this.schedule(null,ge)):this.unsubscribe()},ge);if(he.add(Le),!Ve)return Le}ae.d(Kt,{f:()=>E})},2737:(ur,Kt,ae)=>{"use strict";function E(he){return he}ae.d(Kt,{y:()=>E})},4266:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{z:()=>E});const E=he=>he&&"number"==typeof he.length&&"function"!=typeof he},5726:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{D:()=>he});var E=ae(4674);function he(at){return Symbol.asyncIterator&&(0,E.m)(null==at?void 0:at[Symbol.asyncIterator])}},4674:(ur,Kt,ae)=>{"use strict";function E(he){return"function"==typeof he}ae.d(Kt,{m:()=>E})},8382:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{c:()=>at});var E=ae(4850),he=ae(4674);function at(Ie){return(0,he.m)(Ie[E.L])}},3664:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{T:()=>at});var E=ae(4971),he=ae(4674);function at(Ie){return(0,he.m)(null==Ie?void 0:Ie[E.h])}},4026:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{t:()=>he});var E=ae(4674);function he(at){return(0,E.m)(null==at?void 0:at.then)}},541:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{L:()=>Ie,Q:()=>at});var E=ae(7582),he=ae(4674);function at(ge){return(0,E.FC)(this,arguments,function*(){const Le=ge.getReader();try{for(;;){const{value:Be,done:ze}=yield(0,E.qq)(Le.read());if(ze)return yield(0,E.qq)(void 0);yield yield(0,E.qq)(Be)}}finally{Le.releaseLock()}})}function Ie(ge){return(0,he.m)(null==ge?void 0:ge.getReader)}},671:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{K:()=>he});var E=ae(4674);function he(at){return at&&(0,E.m)(at.schedule)}},9360:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{A:()=>he,e:()=>at});var E=ae(4674);function he(Ie){return(0,E.m)(null==Ie?void 0:Ie.lift)}function at(Ie){return ge=>{if(he(ge))return ge.lift(function(Ve){try{return Ie(Ve,this)}catch(Le){this.error(Le)}});throw new TypeError("Unable to lift unknown Observable type")}}},7400:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Z:()=>Ie});var E=ae(7398);const{isArray:he}=Array;function Ie(ge){return(0,E.U)(Ve=>function at(ge,Ve){return he(Ve)?ge(...Ve):ge(Ve)}(ge,Ve))}},2420:(ur,Kt,ae)=>{"use strict";function E(){}ae.d(Kt,{Z:()=>E})},8407:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{U:()=>at,z:()=>he});var E=ae(2737);function he(...Ie){return at(Ie)}function at(Ie){return 0===Ie.length?E.y:1===Ie.length?Ie[0]:function(Ve){return Ie.reduce((Le,Be)=>Be(Le),Ve)}}},3894:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{h:()=>at});var E=ae(2653),he=ae(7599);function at(Ie){he.z.setTimeout(()=>{const{onUnhandledError:ge}=E.config;if(!ge)throw Ie;ge(Ie)})}},9853:(ur,Kt,ae)=>{"use strict";function E(he){return new TypeError(`You provided ${null!==he&&"object"==typeof he?"an invalid object":`'${he}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}ae.d(Kt,{z:()=>E})},863:(ur,Kt,ae)=>{var E={"./ion-accordion_2.entry.js":[8484,8592,8484],"./ion-action-sheet.entry.js":[9882,8592,9882],"./ion-alert.entry.js":[6304,8592,6304],"./ion-app_8.entry.js":[5860,8592,5860],"./ion-avatar_3.entry.js":[3544,3544],"./ion-back-button.entry.js":[505,8592,505],"./ion-backdrop.entry.js":[469,469],"./ion-breadcrumb_2.entry.js":[9857,8592,9857],"./ion-button_2.entry.js":[1372,1372],"./ion-card_5.entry.js":[3150,3150],"./ion-checkbox.entry.js":[7635,8592,7635],"./ion-chip.entry.js":[6673,6673],"./ion-col_3.entry.js":[1315,1315],"./ion-datetime-button.entry.js":[433,5248,433],"./ion-datetime_3.entry.js":[7059,5248,8592,7059],"./ion-fab_3.entry.js":[4087,8592,4087],"./ion-img.entry.js":[1745,1745],"./ion-infinite-scroll_2.entry.js":[9352,8592,9352],"./ion-input.entry.js":[4530,8592,4530],"./ion-item-option_3.entry.js":[8633,8592,8633],"./ion-item_8.entry.js":[5962,8592,5962],"./ion-loading.entry.js":[3483,8592,3483],"./ion-menu_3.entry.js":[2939,8592,8382],"./ion-modal.entry.js":[8577,8592,8577],"./ion-nav_2.entry.js":[5675,5675],"./ion-picker-column-internal.entry.js":[9992,8592,9992],"./ion-picker-internal.entry.js":[9820,9820],"./ion-popover.entry.js":[185,8592,185],"./ion-progress-bar.entry.js":[5454,5454],"./ion-radio_2.entry.js":[4458,8592,4458],"./ion-range.entry.js":[7666,8592,7666],"./ion-refresher_2.entry.js":[7219,8592,7219],"./ion-reorder_2.entry.js":[2975,8592,2975],"./ion-ripple-effect.entry.js":[7465,7465],"./ion-route_4.entry.js":[4764,4764],"./ion-searchbar.entry.js":[3998,8592,3998],"./ion-segment_2.entry.js":[3672,8592,3672],"./ion-select_3.entry.js":[6754,8592,6754],"./ion-spinner.entry.js":[9588,8592,9588],"./ion-split-pane.entry.js":[9793,9793],"./ion-tab-bar_2.entry.js":[4090,8592,4090],"./ion-tab_2.entry.js":[2841,2841],"./ion-text.entry.js":[8811,8811],"./ion-textarea.entry.js":[3734,8592,3734],"./ion-toast.entry.js":[6642,8592,6642],"./ion-toggle.entry.js":[8866,8592,8866]};function he(at){if(!ae.o(E,at))return Promise.resolve().then(()=>{var Ve=new Error("Cannot find module '"+at+"'");throw Ve.code="MODULE_NOT_FOUND",Ve});var Ie=E[at],ge=Ie[0];return Promise.all(Ie.slice(1).map(ae.e)).then(()=>ae(ge))}he.keys=()=>Object.keys(E),he.id=863,ur.exports=he},6814:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Do:()=>Jt,EM:()=>Zc,HT:()=>Ie,JF:()=>Ml,K0:()=>Ve,Mx:()=>ti,NF:()=>eh,O5:()=>Et,PM:()=>Yc,S$:()=>Mt,V_:()=>Be,Ye:()=>Ot,b0:()=>gt,bD:()=>td,ez:()=>go,gd:()=>Ji,mk:()=>pi,q:()=>at,sg:()=>Bs,tP:()=>$t,w_:()=>ge});var E=ae(9212);let he=null;function at(){return he}function Ie(V){he||(he=V)}class ge{}const Ve=new E.OlP("DocumentToken");let Le=(()=>{var V;class ie{historyGo(ee){throw new Error("Not implemented")}}return(V=ie).\u0275fac=function(ee){return new(ee||V)},V.\u0275prov=E.Yz7({token:V,factory:()=>(0,E.f3M)(ze),providedIn:"platform"}),ie})();const Be=new E.OlP("Location Initialized");let ze=(()=>{var V;class ie extends Le{constructor(){super(),this._doc=(0,E.f3M)(Ve),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return at().getBaseHref(this._doc)}onPopState(ee){const Ne=at().getGlobalEventTarget(this._doc,"window");return Ne.addEventListener("popstate",ee,!1),()=>Ne.removeEventListener("popstate",ee)}onHashChange(ee){const Ne=at().getGlobalEventTarget(this._doc,"window");return Ne.addEventListener("hashchange",ee,!1),()=>Ne.removeEventListener("hashchange",ee)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(ee){this._location.pathname=ee}pushState(ee,Ne,pt){this._history.pushState(ee,Ne,pt)}replaceState(ee,Ne,pt){this._history.replaceState(ee,Ne,pt)}forward(){this._history.forward()}back(){this._history.back()}historyGo(ee=0){this._history.go(ee)}getState(){return this._history.state}}return(V=ie).\u0275fac=function(ee){return new(ee||V)},V.\u0275prov=E.Yz7({token:V,factory:()=>new V,providedIn:"platform"}),ie})();function wt(V,ie){if(0==V.length)return ie;if(0==ie.length)return V;let Qe=0;return V.endsWith("/")&&Qe++,ie.startsWith("/")&&Qe++,2==Qe?V+ie.substring(1):1==Qe?V+ie:V+"/"+ie}function Ue(V){const ie=V.match(/#|\?|$/),Qe=ie&&ie.index||V.length;return V.slice(0,Qe-("/"===V[Qe-1]?1:0))+V.slice(Qe)}function vt(V){return V&&"?"!==V[0]?"?"+V:V}let Mt=(()=>{var V;class ie{historyGo(ee){throw new Error("Not implemented")}}return(V=ie).\u0275fac=function(ee){return new(ee||V)},V.\u0275prov=E.Yz7({token:V,factory:()=>(0,E.f3M)(gt),providedIn:"root"}),ie})();const xt=new E.OlP("appBaseHref");let gt=(()=>{var V;class ie extends Mt{constructor(ee,Ne){var pt,Cn,er;super(),this._platformLocation=ee,this._removeListenerFns=[],this._baseHref=null!==(pt=null!==(Cn=null!=Ne?Ne:this._platformLocation.getBaseHrefFromDOM())&&void 0!==Cn?Cn:null===(er=(0,E.f3M)(Ve).location)||void 0===er?void 0:er.origin)&&void 0!==pt?pt:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ee){this._removeListenerFns.push(this._platformLocation.onPopState(ee),this._platformLocation.onHashChange(ee))}getBaseHref(){return this._baseHref}prepareExternalUrl(ee){return wt(this._baseHref,ee)}path(ee=!1){const Ne=this._platformLocation.pathname+vt(this._platformLocation.search),pt=this._platformLocation.hash;return pt&&ee?`${Ne}${pt}`:Ne}pushState(ee,Ne,pt,Cn){const er=this.prepareExternalUrl(pt+vt(Cn));this._platformLocation.pushState(ee,Ne,er)}replaceState(ee,Ne,pt,Cn){const er=this.prepareExternalUrl(pt+vt(Cn));this._platformLocation.replaceState(ee,Ne,er)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(ee=0){var Ne,pt;null===(Ne=(pt=this._platformLocation).historyGo)||void 0===Ne||Ne.call(pt,ee)}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.LFG(Le),E.LFG(xt,8))},V.\u0275prov=E.Yz7({token:V,factory:V.\u0275fac,providedIn:"root"}),ie})(),Jt=(()=>{var V;class ie extends Mt{constructor(ee,Ne){super(),this._platformLocation=ee,this._baseHref="",this._removeListenerFns=[],null!=Ne&&(this._baseHref=Ne)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ee){this._removeListenerFns.push(this._platformLocation.onPopState(ee),this._platformLocation.onHashChange(ee))}getBaseHref(){return this._baseHref}path(ee=!1){let Ne=this._platformLocation.hash;return null==Ne&&(Ne="#"),Ne.length>0?Ne.substring(1):Ne}prepareExternalUrl(ee){const Ne=wt(this._baseHref,ee);return Ne.length>0?"#"+Ne:Ne}pushState(ee,Ne,pt,Cn){let er=this.prepareExternalUrl(pt+vt(Cn));0==er.length&&(er=this._platformLocation.pathname),this._platformLocation.pushState(ee,Ne,er)}replaceState(ee,Ne,pt,Cn){let er=this.prepareExternalUrl(pt+vt(Cn));0==er.length&&(er=this._platformLocation.pathname),this._platformLocation.replaceState(ee,Ne,er)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(ee=0){var Ne,pt;null===(Ne=(pt=this._platformLocation).historyGo)||void 0===Ne||Ne.call(pt,ee)}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.LFG(Le),E.LFG(xt,8))},V.\u0275prov=E.Yz7({token:V,factory:V.\u0275fac}),ie})(),Ot=(()=>{var V;class ie{constructor(ee){this._subject=new E.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=ee;const Ne=this._locationStrategy.getBaseHref();this._basePath=function lt(V){if(new RegExp("^(https?:)?//").test(V)){const[,Qe]=V.split(/\/\/[^\/]+/);return Qe}return V}(Ue(hn(Ne))),this._locationStrategy.onPopState(pt=>{this._subject.emit({url:this.path(!0),pop:!0,state:pt.state,type:pt.type})})}ngOnDestroy(){var ee;null===(ee=this._urlChangeSubscription)||void 0===ee||ee.unsubscribe(),this._urlChangeListeners=[]}path(ee=!1){return this.normalize(this._locationStrategy.path(ee))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(ee,Ne=""){return this.path()==this.normalize(ee+vt(Ne))}normalize(ee){return ie.stripTrailingSlash(function Pt(V,ie){if(!V||!ie.startsWith(V))return ie;const Qe=ie.substring(V.length);return""===Qe||["/",";","?","#"].includes(Qe[0])?Qe:ie}(this._basePath,hn(ee)))}prepareExternalUrl(ee){return ee&&"/"!==ee[0]&&(ee="/"+ee),this._locationStrategy.prepareExternalUrl(ee)}go(ee,Ne="",pt=null){this._locationStrategy.pushState(pt,"",ee,Ne),this._notifyUrlChangeListeners(this.prepareExternalUrl(ee+vt(Ne)),pt)}replaceState(ee,Ne="",pt=null){this._locationStrategy.replaceState(pt,"",ee,Ne),this._notifyUrlChangeListeners(this.prepareExternalUrl(ee+vt(Ne)),pt)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(ee=0){var Ne,pt;null===(Ne=(pt=this._locationStrategy).historyGo)||void 0===Ne||Ne.call(pt,ee)}onUrlChange(ee){return this._urlChangeListeners.push(ee),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Ne=>{this._notifyUrlChangeListeners(Ne.url,Ne.state)})),()=>{const Ne=this._urlChangeListeners.indexOf(ee);var pt;this._urlChangeListeners.splice(Ne,1),0===this._urlChangeListeners.length&&(null===(pt=this._urlChangeSubscription)||void 0===pt||pt.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(ee="",Ne){this._urlChangeListeners.forEach(pt=>pt(ee,Ne))}subscribe(ee,Ne,pt){return this._subject.subscribe({next:ee,error:Ne,complete:pt})}}return(V=ie).normalizeQueryParams=vt,V.joinWithSlash=wt,V.stripTrailingSlash=Ue,V.\u0275fac=function(ee){return new(ee||V)(E.LFG(Mt))},V.\u0275prov=E.Yz7({token:V,factory:()=>function Rt(){return new Ot((0,E.LFG)(Mt))}(),providedIn:"root"}),ie})();function hn(V){return V.replace(/\/index.html$/,"")}function ti(V,ie){ie=encodeURIComponent(ie);for(const Qe of V.split(";")){const ee=Qe.indexOf("="),[Ne,pt]=-1==ee?[Qe,""]:[Qe.slice(0,ee),Qe.slice(ee+1)];if(Ne.trim()===ie)return decodeURIComponent(pt)}return null}const ds=/\s+/,Qi=[];let pi=(()=>{var V;class ie{constructor(ee,Ne,pt,Cn){this._iterableDiffers=ee,this._keyValueDiffers=Ne,this._ngEl=pt,this._renderer=Cn,this.initialClasses=Qi,this.stateMap=new Map}set klass(ee){this.initialClasses=null!=ee?ee.trim().split(ds):Qi}set ngClass(ee){this.rawClass="string"==typeof ee?ee.trim().split(ds):ee}ngDoCheck(){for(const Ne of this.initialClasses)this._updateState(Ne,!0);const ee=this.rawClass;if(Array.isArray(ee)||ee instanceof Set)for(const Ne of ee)this._updateState(Ne,!0);else if(null!=ee)for(const Ne of Object.keys(ee))this._updateState(Ne,!!ee[Ne]);this._applyStateDiff()}_updateState(ee,Ne){const pt=this.stateMap.get(ee);void 0!==pt?(pt.enabled!==Ne&&(pt.changed=!0,pt.enabled=Ne),pt.touched=!0):this.stateMap.set(ee,{enabled:Ne,changed:!0,touched:!0})}_applyStateDiff(){for(const ee of this.stateMap){const Ne=ee[0],pt=ee[1];pt.changed?(this._toggleClass(Ne,pt.enabled),pt.changed=!1):pt.touched||(pt.enabled&&this._toggleClass(Ne,!1),this.stateMap.delete(Ne)),pt.touched=!1}}_toggleClass(ee,Ne){(ee=ee.trim()).length>0&&ee.split(ds).forEach(pt=>{Ne?this._renderer.addClass(this._ngEl.nativeElement,pt):this._renderer.removeClass(this._ngEl.nativeElement,pt)})}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.Y36(E.ZZ4),E.Y36(E.aQg),E.Y36(E.SBq),E.Y36(E.Qsj))},V.\u0275dir=E.lG2({type:V,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),ie})();class Br{constructor(ie,Qe,ee,Ne){this.$implicit=ie,this.ngForOf=Qe,this.index=ee,this.count=Ne}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Bs=(()=>{var V;class ie{set ngForOf(ee){this._ngForOf=ee,this._ngForOfDirty=!0}set ngForTrackBy(ee){this._trackByFn=ee}get ngForTrackBy(){return this._trackByFn}constructor(ee,Ne,pt){this._viewContainer=ee,this._template=Ne,this._differs=pt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(ee){ee&&(this._template=ee)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const ee=this._ngForOf;!this._differ&&ee&&(this._differ=this._differs.find(ee).create(this.ngForTrackBy))}if(this._differ){const ee=this._differ.diff(this._ngForOf);ee&&this._applyChanges(ee)}}_applyChanges(ee){const Ne=this._viewContainer;ee.forEachOperation((pt,Cn,er)=>{if(null==pt.previousIndex)Ne.createEmbeddedView(this._template,new Br(pt.item,this._ngForOf,-1,-1),null===er?void 0:er);else if(null==er)Ne.remove(null===Cn?void 0:Cn);else if(null!==Cn){const yi=Ne.get(Cn);Ne.move(yi,er),Vs(yi,pt)}});for(let pt=0,Cn=Ne.length;pt<Cn;pt++){const yi=Ne.get(pt).context;yi.index=pt,yi.count=Cn,yi.ngForOf=this._ngForOf}ee.forEachIdentityChange(pt=>{Vs(Ne.get(pt.currentIndex),pt)})}static ngTemplateContextGuard(ee,Ne){return!0}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.Y36(E.s_b),E.Y36(E.Rgc),E.Y36(E.ZZ4))},V.\u0275dir=E.lG2({type:V,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),ie})();function Vs(V,ie){V.context.$implicit=ie.item}let Et=(()=>{var V;class ie{constructor(ee,Ne){this._viewContainer=ee,this._context=new Ze,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Ne}set ngIf(ee){this._context.$implicit=this._context.ngIf=ee,this._updateView()}set ngIfThen(ee){re("ngIfThen",ee),this._thenTemplateRef=ee,this._thenViewRef=null,this._updateView()}set ngIfElse(ee){re("ngIfElse",ee),this._elseTemplateRef=ee,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(ee,Ne){return!0}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.Y36(E.s_b),E.Y36(E.Rgc))},V.\u0275dir=E.lG2({type:V,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),ie})();class Ze{constructor(){this.$implicit=null,this.ngIf=null}}function re(V,ie){if(ie&&!ie.createEmbeddedView)throw new Error(`${V} must be a TemplateRef, but received '${(0,E.AaK)(ie)}'.`)}let $t=(()=>{var V;class ie{constructor(ee){this._viewContainerRef=ee,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(ee){if(this._shouldRecreateView(ee)){var Ne;const pt=this._viewContainerRef;if(this._viewRef&&pt.remove(pt.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const Cn=this._createContextForwardProxy();this._viewRef=pt.createEmbeddedView(this.ngTemplateOutlet,Cn,{injector:null!==(Ne=this.ngTemplateOutletInjector)&&void 0!==Ne?Ne:void 0})}}_shouldRecreateView(ee){return!!ee.ngTemplateOutlet||!!ee.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(ee,Ne,pt)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,Ne,pt),get:(ee,Ne,pt)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,Ne,pt)}})}}return(V=ie).\u0275fac=function(ee){return new(ee||V)(E.Y36(E.s_b))},V.\u0275dir=E.lG2({type:V,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[E.TTD]}),ie})();let Ji=(()=>{var V;class ie{transform(ee){if(null==ee)return null;if("string"!=typeof ee)throw function fn(V,ie){return new E.vHH(2100,!1)}();return ee.toUpperCase()}}return(V=ie).\u0275fac=function(ee){return new(ee||V)},V.\u0275pipe=E.Yjl({name:"uppercase",type:V,pure:!0,standalone:!0}),ie})(),go=(()=>{var V;class ie{}return(V=ie).\u0275fac=function(ee){return new(ee||V)},V.\u0275mod=E.oAB({type:V}),V.\u0275inj=E.cJS({}),ie})();const td="browser",xc="server";function eh(V){return V===td}function Yc(V){return V===xc}let Zc=(()=>{var V;class ie{}return(V=ie).\u0275prov=(0,E.Yz7)({token:V,providedIn:"root",factory:()=>new hs((0,E.LFG)(Ve),window)}),ie})();class hs{constructor(ie,Qe){this.document=ie,this.window=Qe,this.offset=()=>[0,0]}setOffset(ie){this.offset=Array.isArray(ie)?()=>ie:ie}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(ie){this.supportsScrolling()&&this.window.scrollTo(ie[0],ie[1])}scrollToAnchor(ie){if(!this.supportsScrolling())return;const Qe=function Ur(V,ie){const Qe=V.getElementById(ie)||V.getElementsByName(ie)[0];if(Qe)return Qe;if("function"==typeof V.createTreeWalker&&V.body&&"function"==typeof V.body.attachShadow){const ee=V.createTreeWalker(V.body,NodeFilter.SHOW_ELEMENT);let Ne=ee.currentNode;for(;Ne;){const pt=Ne.shadowRoot;if(pt){const Cn=pt.getElementById(ie)||pt.querySelector(`[name="${ie}"]`);if(Cn)return Cn}Ne=ee.nextNode()}}return null}(this.document,ie);Qe&&(this.scrollToElement(Qe),Qe.focus())}setHistoryScrollRestoration(ie){this.supportsScrolling()&&(this.window.history.scrollRestoration=ie)}scrollToElement(ie){const Qe=ie.getBoundingClientRect(),ee=Qe.left+this.window.pageXOffset,Ne=Qe.top+this.window.pageYOffset,pt=this.offset();this.window.scrollTo(ee-pt[0],Ne-pt[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Ml{}},9212:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{tb:()=>Xi,AFp:()=>fh,ip1:()=>Pi,hGG:()=>eM,z2F:()=>la,Ojb:()=>Ap,sBO:()=>tE,Sil:()=>S,EJc:()=>uo,Xts:()=>Sc,SBq:()=>Sg,lqb:()=>Dc,qLn:()=>Td,vpe:()=>du,XFs:()=>pi,OlP:()=>re,zs3:()=>Os,ZZ4:()=>cu,aQg:()=>Lp,soG:()=>rp,YKP:()=>Kf,h0i:()=>ed,R0b:()=>ya,FiY:()=>To,Lbi:()=>hf,g9A:()=>df,Qsj:()=>ES,FYo:()=>Ow,JOm:()=>vx,tp0:()=>ix,Rgc:()=>Dm,dDg:()=>zr,eoX:()=>Pr,q4F:()=>v,GfV:()=>y,s_b:()=>d_,ifc:()=>rs,T8G:()=>gv,VuI:()=>oR,LMc:()=>MM,MMx:()=>_0,Lck:()=>g1,eFA:()=>UI,G48:()=>Zs,Gpc:()=>Zn,f3M:()=>K,X6Q:()=>BM,$WT:()=>is,MR2:()=>hh,_c5:()=>JD,qFp:()=>RM,r_H:()=>px,rg0:()=>Ar,c2e:()=>I,zSh:()=>sg,wAp:()=>Uc,I6F:()=>R,vHH:()=>Nn,lri:()=>Ci,rWj:()=>Zr,cg1:()=>Zv,kuF:()=>Kr,kL8:()=>Xv,dqk:()=>Se,Z0I:()=>fo,eJc:()=>uf,QGY:()=>a1,F4k:()=>qE,RDi:()=>Ny,AaK:()=>zt,qOj:()=>Gp,Xq5:()=>Lc,TTD:()=>to,_Bn:()=>g0,jDz:()=>y0,xp6:()=>Ng,uIk:()=>Pd,ekj:()=>ba,um2:()=>Lf,Suo:()=>bI,Xpm:()=>bc,lG2:()=>fs,Yz7:()=>Ei,cJS:()=>es,oAB:()=>ql,Yjl:()=>oc,Y36:()=>Ad,_UZ:()=>Gb,GkF:()=>Yv,qZA:()=>jd,TgZ:()=>kh,EpF:()=>Wb,n5z:()=>Tc,LFG:()=>N,$8M:()=>Xm,$Z:()=>Fg,NdJ:()=>V_,CRH:()=>wI,oxw:()=>z_,ALo:()=>Jf,lcZ:()=>w0,Hsn:()=>U_,F$t:()=>bm,Q6J:()=>Dv,DdM:()=>E1,WLB:()=>Y_,kEZ:()=>Z_,iGM:()=>D0,wJu:()=>Vd,SjG:()=>SE,x6l:()=>im,KtG:()=>q0,CHM:()=>up,LSH:()=>Ag,P3R:()=>YT,YNc:()=>Fd,_uU:()=>rI,Oqu:()=>p0,hij:()=>m0,Gf:()=>DC});let he=null,Ie=1;function Ve(a){const u=he;return he=a,u}function Mt(a){if((!st(a)||a.dirty)&&(a.dirty||a.lastCleanEpoch!==Ie)){if(!a.producerMustRecompute(a)&&!Pt(a))return a.dirty=!1,void(a.lastCleanEpoch=Ie);a.producerRecomputeValue(a),a.dirty=!1,a.lastCleanEpoch=Ie}}function Pt(a){Ft(a);for(let u=0;u<a.producerNode.length;u++){const p=a.producerNode[u],g=a.producerLastReadVersion[u];if(g!==p.version||(Mt(p),g!==p.version))return!0}return!1}function me(a,u){if(function Te(a){var u,p;null!==(u=a.liveConsumerNode)&&void 0!==u||(a.liveConsumerNode=[]),null!==(p=a.liveConsumerIndexOfThis)&&void 0!==p||(a.liveConsumerIndexOfThis=[])}(a),Ft(a),1===a.liveConsumerNode.length)for(let g=0;g<a.producerNode.length;g++)me(a.producerNode[g],a.producerIndexOfThis[g]);const p=a.liveConsumerNode.length-1;if(a.liveConsumerNode[u]=a.liveConsumerNode[p],a.liveConsumerIndexOfThis[u]=a.liveConsumerIndexOfThis[p],a.liveConsumerNode.length--,a.liveConsumerIndexOfThis.length--,u<a.liveConsumerNode.length){const g=a.liveConsumerIndexOfThis[u],b=a.liveConsumerNode[u];Ft(b),b.producerIndexOfThis[g]=u}}function st(a){var u,p;return a.consumerIsAlwaysLive||(null!==(u=null==a||null===(p=a.liveConsumerNode)||void 0===p?void 0:p.length)&&void 0!==u?u:0)>0}function Ft(a){var u,p,g;null!==(u=a.producerNode)&&void 0!==u||(a.producerNode=[]),null!==(p=a.producerIndexOfThis)&&void 0!==p||(a.producerIndexOfThis=[]),null!==(g=a.producerLastReadVersion)&&void 0!==g||(a.producerLastReadVersion=[])}let Un=null;var An=ae(8645),qe=ae(7394),ue=ae(5619),ye=ae(7398);function Me(a){for(let u in a)if(a[u]===Me)return u;throw Error("Could not find renamed property on target object.")}function Bt(a,u){for(const p in u)u.hasOwnProperty(p)&&!a.hasOwnProperty(p)&&(a[p]=u[p])}function zt(a){if("string"==typeof a)return a;if(Array.isArray(a))return"["+a.map(zt).join(", ")+"]";if(null==a)return""+a;if(a.overriddenName)return`${a.overriddenName}`;if(a.name)return`${a.name}`;const u=a.toString();if(null==u)return""+u;const p=u.indexOf("\n");return-1===p?u:u.substring(0,p)}function nn(a,u){return null==a||""===a?null===u?"":u:null==u||""===u?a:a+" "+u}const Xt=Me({__forward_ref__:Me});function Zn(a){return a.__forward_ref__=Zn,a.toString=function(){return zt(this())},a}function cn(a){return Dn(a)?a():a}function Dn(a){return"function"==typeof a&&a.hasOwnProperty(Xt)&&a.__forward_ref__===Zn}function ir(a){return a&&!!a.\u0275providers}const Mi="https://g.co/ng/security#xss";class Nn extends Error{constructor(u,p){super(Kr(u,p)),this.code=u}}function Kr(a,u){return`NG0${Math.abs(a)}${u?": "+u:""}`}const Lr=Me({\u0275cmp:Me}),qi=Me({\u0275dir:Me}),ri=Me({\u0275pipe:Me}),Ui=Me({\u0275mod:Me}),fr=Me({\u0275fac:Me}),io=Me({__NG_ELEMENT_ID__:Me}),Io=Me({__NG_ENV_ID__:Me});function Tr(a){return"string"==typeof a?a:null==a?"":String(a)}function En(a,u){throw new Nn(-201,!1)}function wi(a,u){null==a&&function dr(a,u,p,g){throw new Error(`ASSERTION ERROR: ${a}`+(null==g?"":` [Expected=> ${p} ${g} ${u} <=Actual]`))}(u,a,null,"!=")}function Ei(a){return{token:a.token,providedIn:a.providedIn||null,factory:a.factory,value:void 0}}function es(a){return{providers:a.providers||[],imports:a.imports||[]}}function ts(a){return us(a,po)||us(a,ds)}function fo(a){return null!==ts(a)}function us(a,u){return a.hasOwnProperty(u)?a[u]:null}function ns(a){return a&&(a.hasOwnProperty(ti)||a.hasOwnProperty(Qi))?a[ti]:null}const po=Me({\u0275prov:Me}),ti=Me({\u0275inj:Me}),ds=Me({ngInjectableDef:Me}),Qi=Me({ngInjectorDef:Me});var pi=function(a){return a[a.Default=0]="Default",a[a.Host=1]="Host",a[a.Self=2]="Self",a[a.SkipSelf=4]="SkipSelf",a[a.Optional=8]="Optional",a}(pi||{});let xs;function Wi(){return xs}function Br(a){const u=xs;return xs=a,u}function Bs(a,u,p){const g=ts(a);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:p&pi.Optional?null:void 0!==u?u:void En(zt(a))}const Se=globalThis;class re{constructor(u,p){this._desc=u,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof p?this.__NG_ELEMENT_ID__=p:void 0!==p&&(this.\u0275prov=Ei({token:this,providedIn:p.providedIn||"root",factory:p.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const bt={},fn="__NG_DI_FLAG__",bn="ngTempTokenPath",Pn=/\n/gm,wn="__source";let Kn;function Sn(a){const u=Kn;return Kn=a,u}function Ji(a,u=pi.Default){if(void 0===Kn)throw new Nn(-203,!1);return null===Kn?Bs(a,void 0,u):Kn.get(a,u&pi.Optional?null:void 0,u)}function N(a,u=pi.Default){return(Wi()||Ji)(cn(a),u)}function K(a,u=pi.Default){return N(a,Fe(u))}function Fe(a){return typeof a>"u"||"number"==typeof a?a:0|(a.optional&&8)|(a.host&&1)|(a.self&&2)|(a.skipSelf&&4)}function Lt(a){const u=[];for(let p=0;p<a.length;p++){const g=cn(a[p]);if(Array.isArray(g)){if(0===g.length)throw new Nn(900,!1);let b,A=pi.Default;for(let D=0;D<g.length;D++){const O=g[D],F=$o(O);"number"==typeof F?-1===F?b=O.token:A|=F:b=O}u.push(N(b,A))}else u.push(N(g))}return u}function Hr(a,u){return a[fn]=u,a.prototype[fn]=u,a}function $o(a){return a[fn]}function Yr(a){return{toString:a}.toString()}var ui=function(a){return a[a.OnPush=0]="OnPush",a[a.Default=1]="Default",a}(ui||{}),rs=function(a){return a[a.Emulated=0]="Emulated",a[a.None=2]="None",a[a.ShadowDom=3]="ShadowDom",a}(rs||{});const Ks={},br=[];function Hl(a,u,p){let g=a.length;for(;;){const b=a.indexOf(u,p);if(-1===b)return b;if(0===b||a.charCodeAt(b-1)<=32){const A=u.length;if(b+A===g||a.charCodeAt(b+A)<=32)return b}p=b+1}}function $a(a,u,p){let g=0;for(;g<p.length;){const b=p[g];if("number"==typeof b){if(0!==b)break;g++;const A=p[g++],D=p[g++],O=p[g++];a.setAttribute(u,D,O,A)}else{const A=b,D=p[++g];Js(A)?a.setProperty(u,A,D):a.setAttribute(u,A,D),g++}}return g}function rc(a){return 3===a||4===a||6===a}function Js(a){return 64===a.charCodeAt(0)}function go(a,u){if(null!==u&&0!==u.length)if(null===a||0===a.length)a=u.slice();else{let p=-1;for(let g=0;g<u.length;g++){const b=u[g];"number"==typeof b?p=b:0===p||td(a,p,b,null,-1===p||2===p?u[++g]:null)}}return a}function td(a,u,p,g,b){let A=0,D=a.length;if(-1===u)D=-1;else for(;A<a.length;){const O=a[A++];if("number"==typeof O){if(O===u){D=-1;break}if(O>u){D=A-1;break}}}for(;A<a.length;){const O=a[A];if("number"==typeof O)break;if(O===p){if(null===g)return void(null!==b&&(a[A+1]=b));if(g===a[A+1])return void(a[A+2]=b)}A++,null!==g&&A++,null!==b&&A++}-1!==D&&(a.splice(D,0,u),A=D+1),a.splice(A++,0,p),null!==g&&a.splice(A++,0,g),null!==b&&a.splice(A++,0,b)}const xc="ng-template";function qc(a,u,p){let g=0,b=!0;for(;g<a.length;){let A=a[g++];if("string"==typeof A&&b){const D=a[g++];if(p&&"class"===A&&-1!==Hl(D.toLowerCase(),u,0))return!0}else{if(1===A){for(;g<a.length&&"string"==typeof(A=a[g++]);)if(A.toLowerCase()===u)return!0;return!1}"number"==typeof A&&(b=!1)}}return!1}function Wl(a){return 4===a.type&&a.value!==xc}function eh(a,u,p){return u===(4!==a.type||p?a.value:xc)}function Yc(a,u,p){let g=4;const b=a.attrs||[],A=function hs(a){for(let u=0;u<a.length;u++)if(rc(a[u]))return u;return a.length}(b);let D=!1;for(let O=0;O<u.length;O++){const F=u[O];if("number"!=typeof F){if(!D)if(4&g){if(g=2|1&g,""!==F&&!eh(a,F,p)||""===F&&1===u.length){if(Ea(g))return!1;D=!0}}else{const J=8&g?F:u[++O];if(8&g&&null!==a.attrs){if(!qc(a.attrs,J,p)){if(Ea(g))return!1;D=!0}continue}const we=Gh(8&g?"class":F,b,Wl(a),p);if(-1===we){if(Ea(g))return!1;D=!0;continue}if(""!==J){let Je;Je=we>A?"":b[we+1].toLowerCase();const At=8&g?Je:null;if(At&&-1!==Hl(At,J,0)||2&g&&J!==Je){if(Ea(g))return!1;D=!0}}}}else{if(!D&&!Ea(g)&&!Ea(F))return!1;if(D&&Ea(F))continue;D=!1,g=F|1&g}}return Ea(g)||D}function Ea(a){return 0==(1&a)}function Gh(a,u,p,g){if(null===u)return-1;let b=0;if(g||!p){let A=!1;for(;b<u.length;){const D=u[b];if(D===a)return b;if(3===D||6===D)A=!0;else{if(1===D||2===D){let O=u[++b];for(;"string"==typeof O;)O=u[++b];continue}if(4===D)break;if(0===D){b+=4;continue}}b+=A?1:2}return-1}return function Ur(a,u){let p=a.indexOf(4);if(p>-1)for(p++;p<a.length;){const g=a[p];if("number"==typeof g)return-1;if(g===u)return p;p++}return-1}(u,a)}function ic(a,u,p=!1){for(let g=0;g<u.length;g++)if(Yc(a,u[g],p))return!0;return!1}function nd(a,u){e:for(let p=0;p<u.length;p++){const g=u[p];if(a.length===g.length){for(let b=0;b<a.length;b++)if(a[b]!==g[b])continue e;return!0}}return!1}function Ml(a,u){return a?":not("+u.trim()+")":u}function Us(a){let u=a[0],p=1,g=2,b="",A=!1;for(;p<a.length;){let D=a[p];if("string"==typeof D)if(2&g){const O=a[++p];b+="["+D+(O.length>0?'="'+O+'"':"")+"]"}else 8&g?b+="."+D:4&g&&(b+=" "+D);else""!==b&&!Ea(D)&&(u+=Ml(A,b),b=""),g=D,A=A||!Ea(g);p++}return""!==b&&(u+=Ml(A,b)),u}function bc(a){return Yr(()=>{var u;const p=Hh(a),g={...p,decls:a.decls,vars:a.vars,template:a.template,consts:a.consts||null,ngContentSelectors:a.ngContentSelectors,onPush:a.changeDetection===ui.OnPush,directiveDefs:null,pipeDefs:null,dependencies:p.standalone&&a.dependencies||null,getStandaloneInjector:null,signals:null!==(u=a.signals)&&void 0!==u&&u,data:a.data||{},encapsulation:a.encapsulation||rs.Emulated,styles:a.styles||br,_:null,schemas:a.schemas||null,tView:null,id:""};th(g);const b=a.dependencies;return g.directiveDefs=cl(b,!1),g.pipeDefs=cl(b,!0),g.id=function id(a){let u=0;const p=[a.selectors,a.ngContentSelectors,a.hostVars,a.hostAttrs,a.consts,a.vars,a.decls,a.encapsulation,a.standalone,a.signals,a.exportAs,JSON.stringify(a.inputs),JSON.stringify(a.outputs),Object.getOwnPropertyNames(a.type.prototype),!!a.contentQueries,!!a.viewQuery].join("|");for(const b of p)u=Math.imul(31,u)+b.charCodeAt(0)<<0;return u+=2147483648,"c"+u}(g),g})}function bs(a){return di(a)||Lo(a)}function Oa(a){return null!==a}function ql(a){return Yr(()=>({type:a.type,bootstrap:a.bootstrap||br,declarations:a.declarations||br,imports:a.imports||br,exports:a.exports||br,transitiveCompileScopes:null,schemas:a.schemas||null,id:a.id||null}))}function Rl(a,u){if(null==a)return Ks;const p={};for(const g in a)if(a.hasOwnProperty(g)){let b=a[g],A=b;Array.isArray(b)&&(A=b[1],b=b[0]),p[b]=g,u&&(u[b]=A)}return p}function fs(a){return Yr(()=>{const u=Hh(a);return th(u),u})}function oc(a){return{type:a.type,name:a.name,factory:null,pure:!1!==a.pure,standalone:!0===a.standalone,onDestroy:a.type.prototype.ngOnDestroy||null}}function di(a){return a[Lr]||null}function Lo(a){return a[qi]||null}function No(a){return a[ri]||null}function is(a){const u=di(a)||Lo(a)||No(a);return null!==u&&u.standalone}function oi(a,u){const p=a[Ui]||null;if(!p&&!0===u)throw new Error(`Type ${zt(a)} does not have '\u0275mod' property.`);return p}function Hh(a){const u={};return{type:a.type,providersResolver:null,factory:null,hostBindings:a.hostBindings||null,hostVars:a.hostVars||0,hostAttrs:a.hostAttrs||null,contentQueries:a.contentQueries||null,declaredInputs:u,inputTransforms:null,inputConfig:a.inputs||Ks,exportAs:a.exportAs||null,standalone:!0===a.standalone,signals:!0===a.signals,selectors:a.selectors||br,viewQuery:a.viewQuery||null,features:a.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Rl(a.inputs,u),outputs:Rl(a.outputs),debugInfo:null}}function th(a){var u;null===(u=a.features)||void 0===u||u.forEach(p=>p(a))}function cl(a,u){if(!a)return null;const p=u?No:bs;return()=>("function"==typeof a?a():a).map(g=>p(g)).filter(Oa)}const eo=0,Qn=1,$r=2,jo=3,ta=4,ws=5,ka=6,sc=7,_i=8,Ps=9,se=10,Y=11,Re=12,le=13,Ge=14,Mn=15,Nr=16,Fo=17,as=18,ul=19,dl=20,Pl=21,wc=22,Ia=23,hi=25,Wh=1,ja=7,Vt=9,Bo=10;var wu=function(a){return a[a.None=0]="None",a[a.HasTransplantedViews=2]="HasTransplantedViews",a[a.HasChildViewsToRefresh=4]="HasChildViewsToRefresh",a}(wu||{});function na(a){return Array.isArray(a)&&"object"==typeof a[Wh]}function ps(a){return Array.isArray(a)&&!0===a[Wh]}function od(a){return 0!=(4&a.flags)}function Ta(a){return a.componentOffset>-1}function sd(a){return 1==(1&a.flags)}function ms(a){return!!a.template}function nh(a){return 0!=(512&a[$r])}function yi(a,u){return a.hasOwnProperty(fr)?a[fr]:null}class Yi{constructor(u,p,g){this.previousValue=u,this.currentValue=p,this.firstChange=g}isFirstChange(){return this.firstChange}}function to(){return Ii}function Ii(a){return a.type.prototype.ngOnChanges&&(a.setInput=oo),_o}function _o(){const a=Ol(this),u=null==a?void 0:a.current;if(u){const p=a.previous;if(p===Ks)a.previous=u;else for(let g in u)p[g]=u[g];a.current=null,this.ngOnChanges(u)}}function oo(a,u,p,g){const b=this.declaredInputs[p],A=Ol(a)||function Er(a,u){return a[$s]=u}(a,{previous:Ks,current:null}),D=A.current||(A.current={}),O=A.previous,F=O[b];D[b]=new Yi(F&&F.currentValue,u,O===Ks),a[g]=u}to.ngInherit=!0;const $s="__ngSimpleChanges__";function Ol(a){return a[$s]||null}const ca=function(a,u,p){};let Ll=!1;function Yo(a){for(;Array.isArray(a);)a=a[eo];return a}function Tu(a,u){return Yo(u[a])}function tr(a,u){return Yo(u[a.index])}function Ca(a,u){return a.data[u]}function Ha(a,u){const p=u[a];return na(p)?p:p[eo]}function ih(a){return 128==(128&a[$r])}function fl(a,u){return null==u?null:a[u]}function oh(a){a[Fo]=0}function sh(a){1024&a[$r]||(a[$r]|=1024,ih(a)&&Ro(a))}function Fm(a){var u;return 9216&a[$r]||(null===(u=a[Ia])||void 0===u?void 0:u.dirty)}function Go(a){if(Fm(a))Ro(a);else if(64&a[$r])if(function Aa(){return Ll}())a[$r]|=1024,Ro(a);else{var u;null===(u=a[se].changeDetectionScheduler)||void 0===u||u.notify()}}function Ro(a){var u;null===(u=a[se].changeDetectionScheduler)||void 0===u||u.notify();let p=a[jo];for(;null!==p&&!(ps(p)&&p[$r]&wu.HasChildViewsToRefresh||na(p)&&8192&p[$r]);){if(ps(p))p[$r]|=wu.HasChildViewsToRefresh;else if(p[$r]|=8192,!ih(p))break;p=p[jo]}}function qh(a,u){if(256==(256&a[$r]))throw new Nn(911,!1);null===a[Pl]&&(a[Pl]=[]),a[Pl].push(u)}const mi={lFrame:Q(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function cp(){return mi.bindingsEnabled}function ld(){return null!==mi.skipHydrationRootTNode}function Tn(){return mi.lFrame.lView}function yo(){return mi.lFrame.tView}function up(a){return mi.lFrame.contextLView=a,a[_i]}function q0(a){return mi.lFrame.contextLView=null,a}function Ho(){let a=Y1();for(;null!==a&&64===a.type;)a=a.parent;return a}function Y1(){return mi.lFrame.currentTNode}function qa(a,u){const p=mi.lFrame;p.currentTNode=a,p.isParent=u}function Bm(){return mi.lFrame.isParent}function Vm(){mi.lFrame.isParent=!1}function Ya(){const a=mi.lFrame;let u=a.bindingRootIndex;return-1===u&&(u=a.bindingRootIndex=a.tView.bindingStartIndex),u}function Za(){return mi.lFrame.bindingIndex++}function yy(a,u){const p=mi.lFrame;p.bindingIndex=p.bindingRootIndex=a,fp(u)}function fp(a){mi.lFrame.currentDirectiveIndex=a}function vy(){return mi.lFrame.currentQueryIndex}function pp(a){mi.lFrame.currentQueryIndex=a}function L(a){const u=a[Qn];return 2===u.type?u.declTNode:1===u.type?a[ws]:null}function $(a,u,p){if(p&pi.SkipSelf){let b=u,A=a;for(;!(b=b.parent,null!==b||p&pi.Host||(b=L(A),null===b||(A=A[Ge],10&b.type))););if(null===b)return!1;u=b,a=A}const g=mi.lFrame=B();return g.currentTNode=u,g.lView=a,!0}function X(a){const u=B(),p=a[Qn];mi.lFrame=u,u.currentTNode=p.firstChild,u.lView=a,u.tView=p,u.contextLView=a,u.bindingIndex=p.bindingStartIndex,u.inI18n=!1}function B(){const a=mi.lFrame,u=null===a?null:a.child;return null===u?Q(a):u}function Q(a){const u={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:a,child:null,inI18n:!1};return null!==a&&(a.child=u),u}function Ee(){const a=mi.lFrame;return mi.lFrame=a.parent,a.currentTNode=null,a.lView=null,a}const je=Ee;function jt(){const a=Ee();a.isParent=!0,a.tView=null,a.selectedIndex=-1,a.contextLView=null,a.elementDepthCount=0,a.currentDirectiveIndex=-1,a.currentNamespace=null,a.bindingRootIndex=-1,a.bindingIndex=-1,a.currentQueryIndex=0}function Zt(){return mi.lFrame.selectedIndex}function ar(a){mi.lFrame.selectedIndex=a}function _r(){const a=mi.lFrame;return Ca(a.tView,a.selectedIndex)}let ud=!0;function eu(){return ud}function ha(a){ud=a}function tu(a,u){for(let J=u.directiveStart,de=u.directiveEnd;J<de;J++){const Je=a.data[J].type.prototype,{ngAfterContentInit:At,ngAfterContentChecked:mn,ngAfterViewInit:$n,ngAfterViewChecked:or,ngOnDestroy:wr}=Je;var p,g,b,A,D,O,F;At&&(null!==(p=a.contentHooks)&&void 0!==p?p:a.contentHooks=[]).push(-J,At),mn&&((null!==(g=a.contentHooks)&&void 0!==g?g:a.contentHooks=[]).push(J,mn),(null!==(b=a.contentCheckHooks)&&void 0!==b?b:a.contentCheckHooks=[]).push(J,mn)),$n&&(null!==(A=a.viewHooks)&&void 0!==A?A:a.viewHooks=[]).push(-J,$n),or&&((null!==(D=a.viewHooks)&&void 0!==D?D:a.viewHooks=[]).push(J,or),(null!==(O=a.viewCheckHooks)&&void 0!==O?O:a.viewCheckHooks=[]).push(J,or)),null!=wr&&(null!==(F=a.destroyHooks)&&void 0!==F?F:a.destroyHooks=[]).push(J,wr)}}function $m(a,u,p){eT(a,u,3,p)}function jm(a,u,p,g){(3&a[$r])===p&&eT(a,u,p,g)}function Y0(a,u){let p=a[$r];(3&p)===u&&(p&=16383,p+=1,a[$r]=p)}function eT(a,u,p,g){const A=null!=g?g:-1,D=u.length-1;let O=0;for(let F=void 0!==g?65535&a[Fo]:0;F<D;F++)if("number"==typeof u[F+1]){if(O=u[F],null!=g&&O>=g)break}else u[F]<0&&(a[Fo]+=65536),(O<A||-1==A)&&(YC(a,p,u,F),a[Fo]=(4294901760&a[Fo])+F+2),F++}function tf(a,u){ca(4,a,u);const p=Ve(null);try{u.call(a)}finally{Ve(p),ca(5,a,u)}}function YC(a,u,p,g){const b=p[g]<0,A=p[g+1],O=a[b?-p[g]:p[g]];b?a[$r]>>14<a[Fo]>>16&&(3&a[$r])===u&&(a[$r]+=16384,tf(O,A)):tf(O,A)}const Gm=-1;class nf{constructor(u,p,g){this.factory=u,this.resolving=!1,this.canSeeViewProviders=p,this.injectImpl=g}}function wy(a){return a!==Gm}function Hm(a){return 32767&a}function Wm(a,u){let p=function rT(a){return a>>16}(a),g=u;for(;p>0;)g=g[Ge],p--;return g}let ah=!0;function qm(a){const u=ah;return ah=a,u}const Ym=255,Ey=5;let iT=0;const Ic={};function Iy(a,u){const p=fa(a,u);if(-1!==p)return p;const g=u[Qn];g.firstCreatePass&&(a.injectorIndex=u.length,K0(g.data,a),K0(u,null),K0(g.blueprint,null));const b=X0(a,u),A=a.injectorIndex;if(wy(b)){const D=Hm(b),O=Wm(b,u),F=O[Qn].data;for(let J=0;J<8;J++)u[A+J]=O[D+J]|F[D+J]}return u[A+8]=b,A}function K0(a,u){a.push(0,0,0,0,0,0,0,0,u)}function fa(a,u){return-1===a.injectorIndex||a.parent&&a.parent.injectorIndex===a.injectorIndex||null===u[a.injectorIndex+8]?-1:a.injectorIndex}function X0(a,u){if(a.parent&&-1!==a.parent.injectorIndex)return a.parent.injectorIndex;let p=0,g=null,b=u;for(;null!==b;){if(g=lr(b),null===g)return Gm;if(p++,b=b[Ge],-1!==g.injectorIndex)return g.injectorIndex|p<<16}return Gm}function Ty(a,u,p){!function oT(a,u,p){let g;"string"==typeof p?g=p.charCodeAt(0)||0:p.hasOwnProperty(io)&&(g=p[io]),null==g&&(g=p[io]=iT++);const b=g&Ym;u.data[a+(b>>Ey)]|=1<<b}(a,u,p)}function ZC(a,u,p){if(p&pi.Optional||void 0!==a)return a;En()}function X1(a,u,p,g){if(p&pi.Optional&&void 0===g&&(g=null),!(p&(pi.Self|pi.Host))){const b=a[Ps],A=Br(void 0);try{return b?b.get(u,g,p&pi.Optional):Bs(u,g,p&pi.Optional)}finally{Br(A)}}return ZC(g,0,p)}function Q0(a,u,p,g=pi.Default,b){if(null!==a){if(2048&u[$r]&&!(g&pi.Self)){const D=function Km(a,u,p,g,b){let A=a,D=u;for(;null!==A&&null!==D&&2048&D[$r]&&!(512&D[$r]);){const O=sT(A,D,p,g|pi.Self,Ic);if(O!==Ic)return O;let F=A.parent;if(!F){const J=D[dl];if(J){const de=J.get(p,Ic,g);if(de!==Ic)return de}F=lr(D),D=D[Ge]}A=F}return b}(a,u,p,g,Ic);if(D!==Ic)return D}const A=sT(a,u,p,g,Ic);if(A!==Ic)return A}return X1(u,p,g,b)}function sT(a,u,p,g,b){const A=function KC(a){if("string"==typeof a)return a.charCodeAt(0)||0;const u=a.hasOwnProperty(io)?a[io]:void 0;return"number"==typeof u?u>=0?u&Ym:rf:u}(p);if("function"==typeof A){if(!$(u,a,g))return g&pi.Host?ZC(b,0,g):X1(u,p,g,b);try{let D;if(D=A(g),null!=D||g&pi.Optional)return D;En()}finally{je()}}else if("number"==typeof A){let D=null,O=fa(a,u),F=Gm,J=g&pi.Host?u[Mn][ws]:null;for((-1===O||g&pi.SkipSelf)&&(F=-1===O?X0(a,u):u[O+8],F!==Gm&&aT(g,!1)?(D=u[Qn],O=Hm(F),u=Wm(F,u)):O=-1);-1!==O;){const de=u[Qn];if(ex(A,O,de.data)){const we=Q1(O,u,p,D,g,J);if(we!==Ic)return we}F=u[O+8],F!==Gm&&aT(g,u[Qn].data[O+8]===J)&&ex(A,O,u)?(D=de,O=Hm(F),u=Wm(F,u)):O=-1}}return b}function Q1(a,u,p,g,b,A){const D=u[Qn],O=D.data[a+8],de=J0(O,D,p,null==g?Ta(O)&&ah:g!=D&&0!=(3&O.type),b&pi.Host&&A===O);return null!==de?Au(u,D,de,O):Ic}function J0(a,u,p,g,b){const A=a.providerIndexes,D=u.data,O=1048575&A,F=a.directiveStart,de=A>>20,Je=b?O+de:a.directiveEnd;for(let At=g?O:O+de;At<Je;At++){const mn=D[At];if(At<F&&p===mn||At>=F&&mn.type===p)return At}if(b){const At=D[F];if(At&&ms(At)&&At.type===p)return F}return null}function Au(a,u,p,g){let b=a[p];const A=u.data;if(function Z0(a){return a instanceof nf}(b)){const D=b;D.resolving&&function an(a,u){const p=u?`. Dependency path: ${u.join(" > ")} > ${a}`:"";throw new Nn(-200,`Circular dependency in DI detected for ${a}${p}`)}(function Gr(a){return"function"==typeof a?a.name||a.toString():"object"==typeof a&&null!=a&&"function"==typeof a.type?a.type.name||a.type.toString():Tr(a)}(A[p]));const O=qm(D.canSeeViewProviders);D.resolving=!0;const J=D.injectImpl?Br(D.injectImpl):null;$(a,g,pi.Default);try{b=a[p]=D.factory(void 0,A,a,g),u.firstCreatePass&&p>=g.directiveStart&&function mp(a,u,p){const{ngOnChanges:g,ngOnInit:b,ngDoCheck:A}=u.type.prototype;if(g){var D,O;const we=Ii(u);(null!==(D=p.preOrderHooks)&&void 0!==D?D:p.preOrderHooks=[]).push(a,we),(null!==(O=p.preOrderCheckHooks)&&void 0!==O?O:p.preOrderCheckHooks=[]).push(a,we)}var F,J,de;b&&(null!==(F=p.preOrderHooks)&&void 0!==F?F:p.preOrderHooks=[]).push(0-a,b),A&&((null!==(J=p.preOrderHooks)&&void 0!==J?J:p.preOrderHooks=[]).push(a,A),(null!==(de=p.preOrderCheckHooks)&&void 0!==de?de:p.preOrderCheckHooks=[]).push(a,A))}(p,A[p],u)}finally{null!==J&&Br(J),qm(O),D.resolving=!1,je()}}return b}function ex(a,u,p){return!!(p[u+(a>>Ey)]&1<<a)}function aT(a,u){return!(a&pi.Self||a&pi.Host&&u)}class pa{constructor(u,p){this._tNode=u,this._lView=p}get(u,p,g){return Q0(this._tNode,this._lView,u,Fe(g),p)}}function rf(){return new pa(Ho(),Tn())}function Tc(a){return Yr(()=>{const u=a.prototype.constructor,p=u[fr]||sf(u),g=Object.prototype;let b=Object.getPrototypeOf(a.prototype).constructor;for(;b&&b!==g;){const A=b[fr]||sf(b);if(A&&A!==p)return A;b=Object.getPrototypeOf(b)}return A=>new A})}function sf(a){return Dn(a)?()=>{const u=sf(cn(a));return u&&u()}:yi(a)}function lr(a){const u=a[Qn],p=u.type;return 2===p?u.declTNode:1===p?a[ws]:null}function Xm(a){return function Zm(a,u){if("class"===u)return a.classes;if("style"===u)return a.styles;const p=a.attrs;if(p){const g=p.length;let b=0;for(;b<g;){const A=p[b];if(rc(A))break;if(0===A)b+=2;else if("number"==typeof A)for(b++;b<g&&"string"==typeof p[b];)b++;else{if(A===u)return p[b+1];b+=2}}}return null}(Ho(),a)}const Ac="__parameters__";function af(a,u,p){return Yr(()=>{const g=function Ay(a){return function(...p){if(a){const g=a(...p);for(const b in g)this[b]=g[b]}}}(u);function b(...A){if(this instanceof b)return g.apply(this,A),this;const D=new b(...A);return O.annotation=D,O;function O(F,J,de){const we=F.hasOwnProperty(Ac)?F[Ac]:Object.defineProperty(F,Ac,{value:[]})[Ac];for(;we.length<=de;)we.push(null);return(we[de]=we[de]||[]).push(D),F}}return p&&(b.prototype=Object.create(p.prototype)),b.prototype.ngMetadataName=a,b.annotationCls=b,b})}function yp(a,u){a.forEach(p=>Array.isArray(p)?yp(p,u):u(p))}function Bl(a,u,p){u>=a.length?a.push(p):a.splice(u,0,p)}function Vo(a,u){return u>=a.length-1?a.pop():a.splice(u,1)[0]}function ch(a,u){const p=[];for(let g=0;g<a;g++)p.push(u);return p}function ru(a,u,p){let g=hd(a,u);return g>=0?a[1|g]=p:(g=~g,function Qm(a,u,p,g){let b=a.length;if(b==u)a.push(p,g);else if(1===b)a.push(g,a[0]),a[0]=p;else{for(b--,a.push(a[b-1],a[b]);b>u;)a[b]=a[b-2],b--;a[u]=p,a[u+1]=g}}(a,g,u,p)),g}function vp(a,u){const p=hd(a,u);if(p>=0)return a[1|p]}function hd(a,u){return function Ir(a,u,p){let g=0,b=a.length>>p;for(;b!==g;){const A=g+(b-g>>1),D=a[A<<p];if(u===D)return A<<p;D>u?b=A:g=A+1}return~(b<<p)}(a,u,1)}const To=Hr(af("Optional"),8),ix=Hr(af("SkipSelf"),4),Sc=new re("ENVIRONMENT_INITIALIZER"),Is=new re("INJECTOR",-1),Ep=new re("INJECTOR_DEF_TYPES");class lf{get(u,p=bt){if(p===bt){const g=new Error(`NullInjectorError: No provider for ${zt(u)}!`);throw g.name="NullInjectorError",g}return p}}function hh(a){return{\u0275providers:a}}function _d(...a){return{\u0275providers:ng(0,a),\u0275fromNgModule:!0}}function ng(a,...u){const p=[],g=new Set;let b;const A=D=>{p.push(D)};return yp(u,D=>{const O=D;Ip(O,A,[],g)&&(b||(b=[]),b.push(O))}),void 0!==b&&rg(b,A),p}function rg(a,u){for(let p=0;p<a.length;p++){const{ngModule:g,providers:b}=a[p];ax(b,A=>{u(A,g)})}}function Ip(a,u,p,g){if(!(a=cn(a)))return!1;let b=null,A=ns(a);const D=!A&&di(a);if(A||D){if(D&&!D.standalone)return!1;b=a}else{const F=a.ngModule;if(A=ns(F),!A)return!1;b=F}const O=g.has(b);if(D){if(O)return!1;if(g.add(b),D.dependencies){const F="function"==typeof D.dependencies?D.dependencies():D.dependencies;for(const J of F)Ip(J,u,p,g)}}else{if(!A)return!1;{if(null!=A.imports&&!O){let J;g.add(b);try{yp(A.imports,de=>{Ip(de,u,p,g)&&(J||(J=[]),J.push(de))})}finally{}void 0!==J&&rg(J,u)}if(!O){const J=yi(b)||(()=>new b);u({provide:b,useFactory:J,deps:br},b),u({provide:Ep,useValue:b,multi:!0},b),u({provide:Sc,useValue:()=>N(b),multi:!0},b)}const F=A.providers;if(null!=F&&!O){const J=a;ax(F,de=>{u(de,J)})}}}return b!==a&&void 0!==a.providers}function ax(a,u){for(let p of a)ir(p)&&(p=p.\u0275providers),Array.isArray(p)?ax(p,u):u(p)}const og=Me({provide:String,useValue:Me});function lx(a){return null!==a&&"object"==typeof a&&og in a}function yd(a){return"function"==typeof a}const sg=new re("Set Injector scope."),ux={},dx={};let nw;function hx(){return void 0===nw&&(nw=new lf),nw}class Dc{}class ag extends Dc{get destroyed(){return this._destroyed}constructor(u,p,g,b){super(),this.parent=p,this.source=g,this.scopes=b,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,pT(u,D=>this.processProvider(D)),this.records.set(Is,Py(void 0,this)),b.has("environment")&&this.records.set(Dc,Py(void 0,this));const A=this.records.get(sg);null!=A&&"string"==typeof A.value&&this.scopes.add(A.value),this.injectorDefTypes=new Set(this.get(Ep,br,pi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const p of this._ngOnDestroyHooks)p.ngOnDestroy();const u=this._onDestroyHooks;this._onDestroyHooks=[];for(const p of u)p()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(u){return this.assertNotDestroyed(),this._onDestroyHooks.push(u),()=>this.removeOnDestroy(u)}runInContext(u){this.assertNotDestroyed();const p=Sn(this),g=Br(void 0);try{return u()}finally{Sn(p),Br(g)}}get(u,p=bt,g=pi.Default){if(this.assertNotDestroyed(),u.hasOwnProperty(Io))return u[Io](this);g=Fe(g);const A=Sn(this),D=Br(void 0);try{if(!(g&pi.SkipSelf)){let F=this.records.get(u);if(void 0===F){const J=function fx(a){return"function"==typeof a||"object"==typeof a&&a instanceof re}(u)&&ts(u);F=J&&this.injectableDefInScope(J)?Py(fT(u),ux):null,this.records.set(u,F)}if(null!=F)return this.hydrate(u,F)}return(g&pi.Self?hx():this.parent).get(u,p=g&pi.Optional&&p===bt?null:p)}catch(O){if("NullInjectorError"===O.name){if((O[bn]=O[bn]||[]).unshift(zt(u)),A)throw O;return function zs(a,u,p,g){const b=a[bn];throw u[wn]&&b.unshift(u[wn]),a.message=function Wn(a,u,p,g=null){a=a&&"\n"===a.charAt(0)&&"\u0275"==a.charAt(1)?a.slice(2):a;let b=zt(u);if(Array.isArray(u))b=u.map(zt).join(" -> ");else if("object"==typeof u){let A=[];for(let D in u)if(u.hasOwnProperty(D)){let O=u[D];A.push(D+":"+("string"==typeof O?JSON.stringify(O):zt(O)))}b=`{${A.join(", ")}}`}return`${p}${g?"("+g+")":""}[${b}]: ${a.replace(Pn,"\n  ")}`}("\n"+a.message,b,p,g),a.ngTokenPath=b,a[bn]=null,a}(O,u,"R3InjectorError",this.source)}throw O}finally{Br(D),Sn(A)}}resolveInjectorInitializers(){const u=Sn(this),p=Br(void 0);try{const b=this.get(Sc,br,pi.Self);for(const A of b)A()}finally{Sn(u),Br(p)}}toString(){const u=[],p=this.records;for(const g of p.keys())u.push(zt(g));return`R3Injector[${u.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Nn(205,!1)}processProvider(u){let p=yd(u=cn(u))?u:cn(u&&u.provide);const g=function so(a){return lx(a)?Py(void 0,a.useValue):Py(Ry(a),ux)}(u);if(yd(u)||!0!==u.multi)this.records.get(p);else{let b=this.records.get(p);b||(b=Py(void 0,ux,!0),b.factory=()=>Lt(b.multi),this.records.set(p,b)),p=u,b.multi.push(u)}this.records.set(p,g)}hydrate(u,p){return p.value===ux&&(p.value=dx,p.value=p.factory()),"object"==typeof p.value&&p.value&&function ow(a){return null!==a&&"object"==typeof a&&"function"==typeof a.ngOnDestroy}(p.value)&&this._ngOnDestroyHooks.add(p.value),p.value}injectableDefInScope(u){if(!u.providedIn)return!1;const p=cn(u.providedIn);return"string"==typeof p?"any"===p||this.scopes.has(p):this.injectorDefTypes.has(p)}removeOnDestroy(u){const p=this._onDestroyHooks.indexOf(u);-1!==p&&this._onDestroyHooks.splice(p,1)}}function fT(a){const u=ts(a),p=null!==u?u.factory:yi(a);if(null!==p)return p;if(a instanceof re)throw new Nn(204,!1);if(a instanceof Function)return function rw(a){const u=a.length;if(u>0)throw ch(u,"?"),new Nn(204,!1);const p=function Fs(a){return a&&(a[po]||a[ds])||null}(a);return null!==p?()=>p.factory(a):()=>new a}(a);throw new Nn(204,!1)}function Ry(a,u,p){let g;if(yd(a)){const b=cn(a);return yi(b)||fT(b)}if(lx(a))g=()=>cn(a.useValue);else if(function cx(a){return!(!a||!a.useFactory)}(a))g=()=>a.useFactory(...Lt(a.deps||[]));else if(function My(a){return!(!a||!a.useExisting)}(a))g=()=>N(cn(a.useExisting));else{const b=cn(a&&(a.useClass||a.provide));if(!function iw(a){return!!a.deps}(a))return yi(b)||fT(b);g=()=>new b(...Lt(a.deps))}return g}function Py(a,u,p=!1){return{factory:a,value:u,multi:p?[]:void 0}}function pT(a,u){for(const p of a)Array.isArray(p)?pT(p,u):p&&ir(p)?pT(p.\u0275providers,u):u(p)}function px(a,u){a instanceof ag&&a.assertNotDestroyed();const g=Sn(a),b=Br(void 0);try{return u()}finally{Sn(g),Br(b)}}function Ti(a,u=null,p=null,g){const b=ni(a,u,p,g);return b.resolveInjectorInitializers(),b}function ni(a,u=null,p=null,g,b=new Set){const A=[p||br,_d(a)];return g=g||("object"==typeof a?void 0:zt(a)),new ag(A,u||hx(),g||null,b)}let Ly,Os=(()=>{var a;class u{static create(g,b){if(Array.isArray(g))return Ti({name:""},b,g,"");{var A;const D=null!==(A=g.name)&&void 0!==A?A:"";return Ti({name:D},g.parent,g.providers,D)}}}return(a=u).THROW_IF_NOT_FOUND=bt,a.NULL=new lf,a.\u0275prov=Ei({token:a,providedIn:"any",factory:()=>N(Is)}),a.__NG_ELEMENT_ID__=-1,u})();function uf(a){return!!oi(a)}function Ny(a){Ly=a}const fh=new re("AppId",{providedIn:"root",factory:()=>vd}),vd="ng",df=new re("Platform Initializer"),hf=new re("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Ap=new re("CSP nonce",{providedIn:"root",factory:()=>{var a;return(null===(a=function iu(){if(void 0!==Ly)return Ly;if(typeof document<"u")return document;throw new Nn(210,!1)}().body)||void 0===a||null===(a=a.querySelector("[ngCspNonce]"))||void 0===a?void 0:a.getAttribute("ngCspNonce"))||null}});function dc(a){return a instanceof Function?a():a}function pf(a){return 128==(128&a.flags)}var vx=function(a){return a[a.Important=1]="Important",a[a.DashCase=2]="DashCase",a}(vx||{});const sS=/^>|^->|<!--|-->|--!>|<!-$/g,aS=/(<|>)/g,wT="\u200b$1\u200b";const xx=new Map;let ET=0;const bx="__ngContext__";function pl(a,u){na(u)?(a[bx]=u[ul],function TT(a){xx.set(a[ul],a)}(u)):a[bx]=u}let xd;function ml(a,u){return xd(a,u)}function bd(a){const u=a[jo];return ps(u)?u[jo]:u}function MT(a){return Uy(a[Re])}function mh(a){return Uy(a[ta])}function Uy(a){for(;null!==a&&!ps(a);)a=a[ta];return a}function gh(a,u,p,g,b){if(null!=g){let A,D=!1;ps(g)?A=g:na(g)&&(D=!0,g=g[eo]);const O=Yo(g);0===a&&null!==p?null==b?PT(u,p,O):_l(u,p,O,b||null,!0):1===a&&null!==p?_l(u,p,O,b||null,!0):2===a?function bg(a,u,p){const g=Dx(a,u);g&&function Sx(a,u,p,g){a.removeChild(u,p,g)}(a,g,u,p)}(u,O,D):3===a&&u.destroyNode(O),null!=A&&function BT(a,u,p,g,b){const A=p[ja];A!==Yo(p)&&gh(u,a,g,A,b);for(let O=Bo;O<p.length;O++){const F=p[O];gf(F[Qn],F,a,u,g,A)}}(u,a,A,p,b)}}function yg(a,u){return a.createComment(function cw(a){return a.replace(sS,u=>u.replace(aS,wT))}(u))}function Tx(a,u,p){return a.createElement(u,p)}function vg(a,u){const p=a[Vt],g=p.indexOf(u);p.splice(g,1)}function _h(a,u){if(a.length<=Bo)return;const p=Bo+u,g=a[p];if(g){const b=g[Nr];null!==b&&b!==a&&vg(b,g),u>0&&(a[p-1][ta]=g[ta]);const A=Vo(a,Bo+u);!function cS(a,u){gf(a,u,u[Y],2,null,null),u[eo]=null,u[ws]=null}(g[Qn],g);const D=A[as];null!==D&&D.detachView(A[Qn]),g[jo]=null,g[ta]=null,g[$r]&=-129}return g}function Cx(a,u){if(!(256&u[$r])){const p=u[Y];p.destroyNode&&gf(a,u,p,3,null,null),function uS(a){let u=a[Re];if(!u)return gl(a[Qn],a);for(;u;){let p=null;if(na(u))p=u[Re];else{const g=u[Bo];g&&(p=g)}if(!p){for(;u&&!u[ta]&&u!==a;)na(u)&&gl(u[Qn],u),u=u[jo];null===u&&(u=a),na(u)&&gl(u[Qn],u),p=u&&u[ta]}u=p}}(u)}}function gl(a,u){if(!(256&u[$r])){u[$r]&=-129,u[$r]|=256,u[Ia]&&function hn(a){if(Ft(a),st(a))for(let u=0;u<a.producerNode.length;u++)me(a.producerNode[u],a.producerIndexOfThis[u]);a.producerNode.length=a.producerLastReadVersion.length=a.producerIndexOfThis.length=0,a.liveConsumerNode&&(a.liveConsumerNode.length=a.liveConsumerIndexOfThis.length=0)}(u[Ia]),function Si(a,u){let p;if(null!=a&&null!=(p=a.destroyHooks))for(let g=0;g<p.length;g+=2){const b=u[p[g]];if(!(b instanceof nf)){const A=p[g+1];if(Array.isArray(A))for(let D=0;D<A.length;D+=2){const O=b[A[D]],F=A[D+1];ca(4,O,F);try{F.call(O)}finally{ca(5,O,F)}}else{ca(4,b,A);try{A.call(b)}finally{ca(5,b,A)}}}}}(a,u),function dS(a,u){const p=a.cleanup,g=u[sc];if(null!==p)for(let A=0;A<p.length-1;A+=2)if("string"==typeof p[A]){const D=p[A+3];D>=0?g[D]():g[-D].unsubscribe(),A+=2}else p[A].call(g[p[A+1]]);null!==g&&(u[sc]=null);const b=u[Pl];if(null!==b){u[Pl]=null;for(let A=0;A<b.length;A++)(0,b[A])()}}(a,u),1===u[Qn].type&&u[Y].destroy();const p=u[Nr];if(null!==p&&ps(u[jo])){p!==u[jo]&&vg(p,u);const g=u[as];null!==g&&g.detachView(a)}!function ph(a){xx.delete(a[ul])}(u)}}function Dp(a,u,p){return function Qa(a,u,p){let g=u;for(;null!==g&&40&g.type;)g=(u=g).parent;if(null===g)return p[eo];{const{componentOffset:b}=g;if(b>-1){const{encapsulation:A}=a.data[g.directiveStart+b];if(A===rs.None||A===rs.Emulated)return null}return tr(g,p)}}(a,u.parent,p)}function _l(a,u,p,g,b){a.insertBefore(u,p,g,b)}function PT(a,u,p){a.appendChild(u,p)}function fw(a,u,p,g,b){null!==g?_l(a,u,p,g,b):PT(a,u,p)}function Dx(a,u){return a.parentNode(u)}function jy(a,u,p){return Gy(a,u,p)}let ai,ia,Gy=function LT(a,u,p){return 40&a.type?tr(a,p):null};function wd(a,u,p,g){const b=Dp(a,g,u),A=u[Y],O=jy(g.parent||u[ws],g,u);if(null!=b)if(Array.isArray(p))for(let F=0;F<p.length;F++)fw(A,b,p[F],O,!1);else fw(A,b,p,O,!1);void 0!==ai&&ai(A,g,u,p,b)}function mf(a,u){if(null!==u){const p=u.type;if(3&p)return tr(u,a);if(4&p)return xg(-1,a[u.index]);if(8&p){const g=u.child;if(null!==g)return mf(a,g);{const b=a[u.index];return ps(b)?xg(-1,b):Yo(b)}}if(32&p)return ml(u,a)()||Yo(a[u.index]);{const g=NT(a,u);return null!==g?Array.isArray(g)?g[0]:mf(bd(a[Mn]),g):mf(a,u.next)}}return null}function NT(a,u){return null!==u?a[Mn][ws].projection[u.projection]:null}function xg(a,u){const p=Bo+a+1;if(p<u.length){const g=u[p],b=g[Qn].firstChild;if(null!==b)return mf(g,b)}return u[ja]}function Wy(a,u,p,g,b,A,D){for(;null!=p;){const O=g[p.index],F=p.type;if(D&&0===u&&(O&&pl(Yo(O),g),p.flags|=2),32!=(32&p.flags))if(8&F)Wy(a,u,p.child,g,b,A,!1),gh(u,a,b,O,A);else if(32&F){const J=ml(p,g);let de;for(;de=J();)gh(u,a,b,de,A);gh(u,a,b,O,A)}else 16&F?mw(a,u,g,p,b,A):gh(u,a,b,O,A);p=D?p.projectionNext:p.next}}function gf(a,u,p,g,b,A){Wy(p,g,a.firstChild,u,b,A,!1)}function mw(a,u,p,g,b,A){const D=p[Mn],F=D[ws].projection[g.projection];if(Array.isArray(F))for(let J=0;J<F.length;J++)gh(u,a,b,F[J],A);else{let J=F;const de=D[jo];pf(g)&&(J.flags|=128),Wy(a,u,J,de,b,A,!0)}}function VT(a,u,p){""===p?a.removeAttribute(u,"class"):a.setAttribute(u,"class",p)}function Rx(a,u,p){const{mergedAttrs:g,classes:b,styles:A}=p;null!==g&&$a(a,u,g),null!==b&&VT(a,u,b),null!==A&&function no(a,u,p){a.setAttribute(u,"style",p)}(a,u,A)}function He(a){var u;return(null===(u=function Eg(){if(void 0===ia&&(ia=null,Se.trustedTypes))try{ia=Se.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:a=>a,createScript:a=>a,createScriptURL:a=>a})}catch{}return ia}())||void 0===u?void 0:u.createScriptURL(a))||a}class jT{constructor(u){this.changingThisBreaksApplicationSecurity=u}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Mi})`}}function Xl(a){return a instanceof jT?a.changingThisBreaksApplicationSecurity:a}function Ig(a,u){const p=function pS(a){return a instanceof jT&&a.getTypeName()||null}(a);if(null!=p&&p!==u){if("ResourceURL"===p&&"URL"===u)return!0;throw new Error(`Required a safe ${u}, got a ${p} (see ${Mi})`)}return p===u}const Lx=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var lu=function(a){return a[a.NONE=0]="NONE",a[a.HTML=1]="HTML",a[a.STYLE=2]="STYLE",a[a.SCRIPT=3]="SCRIPT",a[a.URL=4]="URL",a[a.RESOURCE_URL=5]="RESOURCE_URL",a}(lu||{});function Ag(a){const u=Xy();return u?u.sanitize(lu.URL,a)||"":Ig(a,"URL")?Xl(a):function Nx(a){return(a=String(a)).match(Lx)?a:"unsafe:"+a}(Tr(a))}function bw(a){const u=Xy();if(u)return He(u.sanitize(lu.RESOURCE_URL,a)||"");if(Ig(a,"ResourceURL"))return He(Xl(a));throw new Nn(904,!1)}function YT(a,u,p){return function yS(a,u){return"src"===u&&("embed"===a||"frame"===a||"iframe"===a||"media"===a||"script"===a)||"href"===u&&("base"===a||"link"===a)?bw:Ag}(u,p)(a)}function Xy(){const a=Tn();return a&&a[se].sanitizer}class VD{}let Gs=(a,u,p)=>null;function Cw(a,u,p=!1){return Gs(a,u,p)}class bh{}class xf{}class bS{resolveComponentFactory(u){throw function Rw(a){const u=Error(`No component factory found for ${zt(a)}.`);return u.ngComponent=a,u}(u)}}let Pw=(()=>{class u{}return u.NULL=new bS,u})();function wS(){return Jy(Ho(),Tn())}function Jy(a,u){return new Sg(tr(a,u))}let Sg=(()=>{class u{constructor(g){this.nativeElement=g}}return u.__NG_ELEMENT_ID__=wS,u})();function $D(a){return a instanceof Sg?a.nativeElement:a}class Ow{}let ES=(()=>{class u{constructor(){this.destroyNode=null}}return u.__NG_ELEMENT_ID__=()=>function IS(){const a=Tn(),p=Ha(Ho().index,a);return(na(p)?p:a)[Y]}(),u})(),kp=(()=>{var a;class u{}return(a=u).\u0275prov=Ei({token:a,providedIn:"root",factory:()=>null}),u})();const kw={};function Ar(a){const u=Ve(null);try{return a()}finally{Ve(u)}}function Di(a){return!!Nw(a)&&(Array.isArray(a)||!(a instanceof Map)&&Symbol.iterator in a)}function Nw(a){return null!==a&&("function"==typeof a||"object"==typeof a)}class Yx{constructor(){}supports(u){return Di(u)}create(u){return new tA(u)}}const eA=(a,u)=>u;class tA{constructor(u){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=u||eA}forEachItem(u){let p;for(p=this._itHead;null!==p;p=p._next)u(p)}forEachOperation(u){let p=this._itHead,g=this._removalsHead,b=0,A=null;for(;p||g;){const D=!g||p&&p.currentIndex<Na(g,b,A)?p:g,O=Na(D,b,A),F=D.currentIndex;if(D===g)b--,g=g._nextRemoved;else if(p=p._next,null==D.previousIndex)b++;else{A||(A=[]);const J=O-b,de=F-b;if(J!=de){for(let Je=0;Je<J;Je++){const At=Je<A.length?A[Je]:A[Je]=0,mn=At+Je;de<=mn&&mn<J&&(A[Je]=At+1)}A[D.previousIndex]=de-J}}O!==F&&u(D,O,F)}}forEachPreviousItem(u){let p;for(p=this._previousItHead;null!==p;p=p._nextPrevious)u(p)}forEachAddedItem(u){let p;for(p=this._additionsHead;null!==p;p=p._nextAdded)u(p)}forEachMovedItem(u){let p;for(p=this._movesHead;null!==p;p=p._nextMoved)u(p)}forEachRemovedItem(u){let p;for(p=this._removalsHead;null!==p;p=p._nextRemoved)u(p)}forEachIdentityChange(u){let p;for(p=this._identityChangesHead;null!==p;p=p._nextIdentityChange)u(p)}diff(u){if(null==u&&(u=[]),!Di(u))throw new Nn(900,!1);return this.check(u)?this:null}onDestroy(){}check(u){this._reset();let b,A,D,p=this._itHead,g=!1;if(Array.isArray(u)){this.length=u.length;for(let O=0;O<this.length;O++)A=u[O],D=this._trackByFn(O,A),null!==p&&Object.is(p.trackById,D)?(g&&(p=this._verifyReinsertion(p,A,D,O)),Object.is(p.item,A)||this._addIdentityChange(p,A)):(p=this._mismatch(p,A,D,O),g=!0),p=p._next}else b=0,function ev(a,u){if(Array.isArray(a))for(let p=0;p<a.length;p++)u(a[p]);else{const p=a[Symbol.iterator]();let g;for(;!(g=p.next()).done;)u(g.value)}}(u,O=>{D=this._trackByFn(b,O),null!==p&&Object.is(p.trackById,D)?(g&&(p=this._verifyReinsertion(p,O,D,b)),Object.is(p.item,O)||this._addIdentityChange(p,O)):(p=this._mismatch(p,O,D,b),g=!0),p=p._next,b++}),this.length=b;return this._truncate(p),this.collection=u,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let u;for(u=this._previousItHead=this._itHead;null!==u;u=u._next)u._nextPrevious=u._next;for(u=this._additionsHead;null!==u;u=u._nextAdded)u.previousIndex=u.currentIndex;for(this._additionsHead=this._additionsTail=null,u=this._movesHead;null!==u;u=u._nextMoved)u.previousIndex=u.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(u,p,g,b){let A;return null===u?A=this._itTail:(A=u._prev,this._remove(u)),null!==(u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(u.item,p)||this._addIdentityChange(u,p),this._reinsertAfter(u,A,b)):null!==(u=null===this._linkedRecords?null:this._linkedRecords.get(g,b))?(Object.is(u.item,p)||this._addIdentityChange(u,p),this._moveAfter(u,A,b)):u=this._addAfter(new TS(p,g),A,b),u}_verifyReinsertion(u,p,g,b){let A=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==A?u=this._reinsertAfter(A,u._prev,b):u.currentIndex!=b&&(u.currentIndex=b,this._addToMoves(u,b)),u}_truncate(u){for(;null!==u;){const p=u._next;this._addToRemovals(this._unlink(u)),u=p}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(u,p,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(u);const b=u._prevRemoved,A=u._nextRemoved;return null===b?this._removalsHead=A:b._nextRemoved=A,null===A?this._removalsTail=b:A._prevRemoved=b,this._insertAfter(u,p,g),this._addToMoves(u,g),u}_moveAfter(u,p,g){return this._unlink(u),this._insertAfter(u,p,g),this._addToMoves(u,g),u}_addAfter(u,p,g){return this._insertAfter(u,p,g),this._additionsTail=null===this._additionsTail?this._additionsHead=u:this._additionsTail._nextAdded=u,u}_insertAfter(u,p,g){const b=null===p?this._itHead:p._next;return u._next=b,u._prev=p,null===b?this._itTail=u:b._prev=u,null===p?this._itHead=u:p._next=u,null===this._linkedRecords&&(this._linkedRecords=new tv),this._linkedRecords.put(u),u.currentIndex=g,u}_remove(u){return this._addToRemovals(this._unlink(u))}_unlink(u){null!==this._linkedRecords&&this._linkedRecords.remove(u);const p=u._prev,g=u._next;return null===p?this._itHead=g:p._next=g,null===g?this._itTail=p:g._prev=p,u}_addToMoves(u,p){return u.previousIndex===p||(this._movesTail=null===this._movesTail?this._movesHead=u:this._movesTail._nextMoved=u),u}_addToRemovals(u){return null===this._unlinkedRecords&&(this._unlinkedRecords=new tv),this._unlinkedRecords.put(u),u.currentIndex=null,u._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=u,u._prevRemoved=null):(u._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=u),u}_addIdentityChange(u,p){return u.item=p,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=u:this._identityChangesTail._nextIdentityChange=u,u}}class TS{constructor(u,p){this.item=u,this.trackById=p,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class xl{constructor(){this._head=null,this._tail=null}add(u){null===this._head?(this._head=this._tail=u,u._nextDup=null,u._prevDup=null):(this._tail._nextDup=u,u._prevDup=this._tail,u._nextDup=null,this._tail=u)}get(u,p){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===p||p<=g.currentIndex)&&Object.is(g.trackById,u))return g;return null}remove(u){const p=u._prevDup,g=u._nextDup;return null===p?this._head=g:p._nextDup=g,null===g?this._tail=p:g._prevDup=p,null===this._head}}class tv{constructor(){this.map=new Map}put(u){const p=u.trackById;let g=this.map.get(p);g||(g=new xl,this.map.set(p,g)),g.add(u)}get(u,p){const b=this.map.get(u);return b?b.get(u,p):null}remove(u){const p=u.trackById;return this.map.get(p).remove(u)&&this.map.delete(p),u}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Na(a,u,p){const g=a.previousIndex;if(null===g)return g;let b=0;return p&&g<p.length&&(b=p[g]),g+u+b}class Id{constructor(){}supports(u){return u instanceof Map||Nw(u)}create(){return new nA}}class nA{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(u){let p;for(p=this._mapHead;null!==p;p=p._next)u(p)}forEachPreviousItem(u){let p;for(p=this._previousMapHead;null!==p;p=p._nextPrevious)u(p)}forEachChangedItem(u){let p;for(p=this._changesHead;null!==p;p=p._nextChanged)u(p)}forEachAddedItem(u){let p;for(p=this._additionsHead;null!==p;p=p._nextAdded)u(p)}forEachRemovedItem(u){let p;for(p=this._removalsHead;null!==p;p=p._nextRemoved)u(p)}diff(u){if(u){if(!(u instanceof Map||Nw(u)))throw new Nn(900,!1)}else u=new Map;return this.check(u)?this:null}onDestroy(){}check(u){this._reset();let p=this._mapHead;if(this._appendAfter=null,this._forEach(u,(g,b)=>{if(p&&p.key===b)this._maybeAddToChanges(p,g),this._appendAfter=p,p=p._next;else{const A=this._getOrCreateRecordForKey(b,g);p=this._insertBeforeOrAppend(p,A)}}),p){p._prev&&(p._prev._next=null),this._removalsHead=p;for(let g=p;null!==g;g=g._nextRemoved)g===this._mapHead&&(this._mapHead=null),this._records.delete(g.key),g._nextRemoved=g._next,g.previousValue=g.currentValue,g.currentValue=null,g._prev=null,g._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(u,p){if(u){const g=u._prev;return p._next=u,p._prev=g,u._prev=p,g&&(g._next=p),u===this._mapHead&&(this._mapHead=p),this._appendAfter=u,u}return this._appendAfter?(this._appendAfter._next=p,p._prev=this._appendAfter):this._mapHead=p,this._appendAfter=p,null}_getOrCreateRecordForKey(u,p){if(this._records.has(u)){const b=this._records.get(u);this._maybeAddToChanges(b,p);const A=b._prev,D=b._next;return A&&(A._next=D),D&&(D._prev=A),b._next=null,b._prev=null,b}const g=new Fw(u);return this._records.set(u,g),g.currentValue=p,this._addToAdditions(g),g}_reset(){if(this.isDirty){let u;for(this._previousMapHead=this._mapHead,u=this._previousMapHead;null!==u;u=u._next)u._nextPrevious=u._next;for(u=this._changesHead;null!==u;u=u._nextChanged)u.previousValue=u.currentValue;for(u=this._additionsHead;null!=u;u=u._nextAdded)u.previousValue=u.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(u,p){Object.is(p,u.currentValue)||(u.previousValue=u.currentValue,u.currentValue=p,this._addToChanges(u))}_addToAdditions(u){null===this._additionsHead?this._additionsHead=this._additionsTail=u:(this._additionsTail._nextAdded=u,this._additionsTail=u)}_addToChanges(u){null===this._changesHead?this._changesHead=this._changesTail=u:(this._changesTail._nextChanged=u,this._changesTail=u)}_forEach(u,p){u instanceof Map?u.forEach(p):Object.keys(u).forEach(g=>p(u[g],g))}}class Fw{constructor(u){this.key=u,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Dg(){return new cu([new Yx])}let cu=(()=>{var a;class u{constructor(g){this.factories=g}static create(g,b){if(null!=b){const A=b.factories.slice();g=g.concat(A)}return new u(g)}static extend(g){return{provide:u,useFactory:b=>u.create(g,b||Dg()),deps:[[u,new ix,new To]]}}find(g){const b=this.factories.find(A=>A.supports(g));if(null!=b)return b;throw new Nn(901,!1)}}return(a=u).\u0275prov=Ei({token:a,providedIn:"root",factory:Dg}),u})();function Bw(){return new Lp([new Id])}let Lp=(()=>{var a;class u{constructor(g){this.factories=g}static create(g,b){if(b){const A=b.factories.slice();g=g.concat(A)}return new u(g)}static extend(g){return{provide:u,useFactory:b=>u.create(g,b||Bw()),deps:[[u,new ix,new To]]}}find(g){const b=this.factories.find(A=>A.supports(g));if(b)return b;throw new Nn(901,!1)}}return(a=u).\u0275prov=Ei({token:a,providedIn:"root",factory:Bw}),u})();function bl(a,u,p,g,b=!1){for(;null!==p;){const A=u[p.index];null!==A&&g.push(Yo(A)),ps(A)&&Kx(A,g);const D=p.type;if(8&D)bl(a,u,p.child,g);else if(32&D){const O=ml(p,u);let F;for(;F=O();)g.push(F)}else if(16&D){const O=NT(u,p);if(Array.isArray(O))g.push(...O);else{const F=bd(u[Mn]);bl(F[Qn],F,O,g,!0)}}p=b?p.projectionNext:p.next}return g}function Kx(a,u){for(let p=Bo;p<a.length;p++){const g=a[p],b=g[Qn].firstChild;null!==b&&bl(g[Qn],g,b,u)}a[ja]!==a[eo]&&u.push(a[ja])}let rA=[];const Rg={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:a=>{Ro(a.lView)},consumerOnSignalRead(){this.lView[Ia]=this}};function bf(a){return a.ngOriginalError}class Td{constructor(){this._console=console}handleError(u){const p=this._findOriginalError(u);this._console.error("ERROR",u),p&&this._console.error("ORIGINAL ERROR",p)}_findOriginalError(u){let p=u&&bf(u);for(;p&&bf(p);)p=bf(p);return p||null}}const Jx=new re("",{providedIn:"root",factory:()=>K(Td).handleError.bind(void 0)}),tb=new re("",{providedIn:"root",factory:()=>!1}),Ni={};function Ng(a){wf(yo(),Tn(),Zt()+a,!1)}function wf(a,u,p,g){if(!g)if(3==(3&u[$r])){const A=a.preOrderCheckHooks;null!==A&&$m(u,A,p)}else{const A=a.preOrderHooks;null!==A&&jm(u,A,0,p)}ar(p)}function Ad(a,u=pi.Default){const p=Tn();return null===p?N(a,u):Q0(Ho(),p,cn(a),u)}function Fg(){throw new Error("invalid")}function Fp(a,u,p,g,b,A,D,O,F,J,de){const we=u.blueprint.slice();return we[eo]=b,we[$r]=204|g,(null!==J||a&&2048&a[$r])&&(we[$r]|=2048),oh(we),we[jo]=we[Ge]=a,we[_i]=p,we[se]=D||a&&a[se],we[Y]=O||a&&a[Y],we[Ps]=F||a&&a[Ps]||null,we[ws]=A,we[ul]=function IT(){return ET++}(),we[ka]=de,we[dl]=J,we[Mn]=2==u.type?a[Mn]:we,we}function Bp(a,u,p,g,b){let A=a.data[u];if(null===A)A=function iv(a,u,p,g,b){const A=Y1(),D=Bm(),F=a.data[u]=function DS(a,u,p,g,b,A){let D=u?u.injectorIndex:-1,O=0;return ld()&&(O|=128),{type:p,index:g,insertBeforeIndex:null,injectorIndex:D,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:O,providerIndexes:0,value:b,attrs:A,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:u,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,D?A:A&&A.parent,p,u,g,b);return null===a.firstChild&&(a.firstChild=F),null!==A&&(D?null==A.child&&null!==F.parent&&(A.child=F):null===A.next&&(A.next=F,F.prev=A)),F}(a,u,p,g,b),function zm(){return mi.lFrame.inI18n}()&&(A.flags|=32);else if(64&A.type){A.type=p,A.value=g,A.attrs=b;const D=function Qh(){const a=mi.lFrame,u=a.currentTNode;return a.isParent?u:u.parent}();A.injectorIndex=null===D?-1:D.injectorIndex}return qa(A,!0),A}function Ef(a,u,p,g){if(0===p)return-1;const b=u.length;for(let A=0;A<p;A++)u.push(g),a.blueprint.push(g),a.data.push(null);return b}function Vg(a,u,p,g,b){const A=Zt(),D=2&g;try{ar(-1),D&&u.length>hi&&wf(a,u,hi,!1),ca(D?2:0,b),p(g,b)}finally{ar(A),ca(D?3:1,b)}}function ov(a,u,p){if(od(u)){const g=Ve(null);try{const A=u.directiveEnd;for(let D=u.directiveStart;D<A;D++){const O=a.data[D];O.contentQueries&&O.contentQueries(1,p[D],D)}}finally{Ve(g)}}}function nb(a,u,p){cp()&&(function qw(a,u,p,g){const b=p.directiveStart,A=p.directiveEnd;Ta(p)&&function jg(a,u,p){const g=tr(u,a),b=rb(p);let D=16;p.signals?D=4096:p.onPush&&(D=64);const O=uv(a,Fp(a,b,null,D,g,u,null,a[se].rendererFactory.createRenderer(g,p),null,null,null));a[u.index]=O}(u,p,a.data[b+p.componentOffset]),a.firstCreatePass||Iy(p,u),pl(g,u);const D=p.initialInputs;for(let O=b;O<A;O++){const F=a.data[O],J=Au(u,a,O,p);pl(J,u),null!==D&&Vp(0,O-b,J,F,0,D),ms(F)&&(Ha(p.index,u)[_i]=Au(u,a,O,p))}}(a,u,p,tr(p,u)),64==(64&p.flags)&&lv(a,u,p))}function zw(a,u,p=tr){const g=u.localNames;if(null!==g){let b=u.index+1;for(let A=0;A<g.length;A+=2){const D=g[A+1],O=-1===D?p(u,a):a[D];a[b++]=O}}}function rb(a){const u=a.tView;return null===u||u.incompleteFirstPass?a.tView=sv(1,null,a.template,a.decls,a.vars,a.directiveDefs,a.pipeDefs,a.viewQuery,a.schemas,a.consts,a.id):u}function sv(a,u,p,g,b,A,D,O,F,J,de){const we=hi+g,Je=we+b,At=function Uw(a,u){const p=[];for(let g=0;g<u;g++)p.push(g<a?null:Ni);return p}(we,Je),mn="function"==typeof J?J():J;return At[Qn]={type:a,blueprint:At,template:p,queries:null,viewQuery:O,declTNode:u,data:At.slice().fill(null,we),bindingStartIndex:we,expandoStartIndex:Je,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof A?A():A,pipeRegistry:"function"==typeof D?D():D,firstChild:null,schemas:F,consts:mn,incompleteFirstPass:!1,ssrId:de}}let If=a=>null;function jw(a,u,p,g){for(let b in a)if(a.hasOwnProperty(b)){p=null===p?{}:p;const A=a[b];null===g?sA(p,u,b,A):g.hasOwnProperty(b)&&sA(p,u,g[b],A)}return p}function sA(a,u,p,g){a.hasOwnProperty(p)?a[p].push(u,g):a[p]=[u,g]}function Ug(a,u,p,g){if(cp()){const b=null===g?null:{"":-1},A=function ob(a,u){const p=a.directiveRegistry;let g=null,b=null;if(p)for(let D=0;D<p.length;D++){const O=p[D];if(ic(u,O.selectors,!1))if(g||(g=[]),ms(O))if(null!==O.findHostDirectiveDefs){const F=[];b=b||new Map,O.findHostDirectiveDefs(O,F,b),g.unshift(...F,O),cv(a,u,F.length)}else g.unshift(O),cv(a,u,0);else{var A;b=b||new Map,null===(A=O.findHostDirectiveDefs)||void 0===A||A.call(O,O,g,b),g.push(O)}}return null===g?null:[g,b]}(a,p);let D,O;null===A?D=O=null:[D,O]=A,null!==D&&Tf(a,u,p,D,b,O),b&&function Yw(a,u,p){if(u){const g=a.localNames=[];for(let b=0;b<u.length;b+=2){const A=p[u[b+1]];if(null==A)throw new Nn(-301,!1);g.push(u[b],A)}}}(p,g,b)}p.mergedAttrs=go(p.mergedAttrs,p.attrs)}function Tf(a,u,p,g,b,A){for(let we=0;we<g.length;we++)Ty(Iy(p,u),a,g[we].type);!function $g(a,u,p){a.flags|=1,a.directiveStart=u,a.directiveEnd=u+p,a.providerIndexes=u}(p,a.data.length,g.length);for(let we=0;we<g.length;we++){const Je=g[we];Je.providersResolver&&Je.providersResolver(Je)}let D=!1,O=!1,F=Ef(a,u,g.length,null);for(let we=0;we<g.length;we++){const Je=g[we];p.mergedAttrs=go(p.mergedAttrs,Je.hostAttrs),cA(a,p,u,F,Je),uu(F,Je,b),null!==Je.contentQueries&&(p.flags|=4),(null!==Je.hostBindings||null!==Je.hostAttrs||0!==Je.hostVars)&&(p.flags|=64);const At=Je.type.prototype;var J,de;!D&&(At.ngOnChanges||At.ngOnInit||At.ngDoCheck)&&((null!==(J=a.preOrderHooks)&&void 0!==J?J:a.preOrderHooks=[]).push(p.index),D=!0),O||!At.ngOnChanges&&!At.ngDoCheck||((null!==(de=a.preOrderCheckHooks)&&void 0!==de?de:a.preOrderCheckHooks=[]).push(p.index),O=!0),F++}!function aA(a,u,p){const b=u.directiveEnd,A=a.data,D=u.attrs,O=[];let F=null,J=null;for(let de=u.directiveStart;de<b;de++){const we=A[de],Je=p?p.get(we):null,mn=Je?Je.outputs:null;F=jw(we.inputs,de,F,Je?Je.inputs:null),J=jw(we.outputs,de,J,mn);const $n=null===F||null===D||Wl(u)?null:sb(F,de,D);O.push($n)}null!==F&&(F.hasOwnProperty("class")&&(u.flags|=8),F.hasOwnProperty("style")&&(u.flags|=16)),u.initialInputs=O,u.inputs=F,u.outputs=J}(a,p,A)}function lv(a,u,p){const g=p.directiveStart,b=p.directiveEnd,A=p.index,D=function ef(){return mi.lFrame.currentDirectiveIndex}();try{ar(A);for(let O=g;O<b;O++){const F=a.data[O],J=u[O];fp(O),(null!==F.hostBindings||0!==F.hostVars||null!==F.hostAttrs)&&wo(F,J)}}finally{ar(-1),fp(D)}}function wo(a,u){null!==a.hostBindings&&a.hostBindings(1,u)}function cv(a,u,p){var g;u.componentOffset=p,(null!==(g=a.components)&&void 0!==g?g:a.components=[]).push(u.index)}function uu(a,u,p){if(p){if(u.exportAs)for(let g=0;g<u.exportAs.length;g++)p[u.exportAs[g]]=a;ms(u)&&(p[""]=a)}}function cA(a,u,p,g,b){a.data[g]=b;const A=b.factory||(b.factory=yi(b.type)),D=new nf(A,ms(b),Ad);a.blueprint[g]=D,p[g]=D,function ib(a,u,p,g,b){const A=b.hostBindings;if(A){let D=a.hostBindingOpCodes;null===D&&(D=a.hostBindingOpCodes=[]);const O=~u.index;(function Ww(a){let u=a.length;for(;u>0;){const p=a[--u];if("number"==typeof p&&p<0)return p}return 0})(D)!=O&&D.push(O),D.push(p,g,A)}}(a,u,g,Ef(a,p,b.hostVars,Ni),b)}function Cd(a,u,p,g,b,A){const D=tr(a,u);!function Zw(a,u,p,g,b,A,D){if(null==A)a.removeAttribute(u,b,p);else{const O=null==D?Tr(A):D(A,g||"",b);a.setAttribute(u,b,O,p)}}(u[Y],D,A,a.value,p,g,b)}function Vp(a,u,p,g,b,A){const D=A[u];if(null!==D)for(let O=0;O<D.length;)Kw(g,p,D[O++],D[O++],D[O++])}function Kw(a,u,p,g,b){const A=Ve(null);try{const D=a.inputTransforms;null!==D&&D.hasOwnProperty(g)&&(b=D[g].call(u,b)),null!==a.setInput?a.setInput(u,b,p,g):u[g]=b}finally{Ve(A)}}function sb(a,u,p){let g=null,b=0;for(;b<p.length;){const A=p[b];if(0!==A)if(5!==A){if("number"==typeof A)break;if(a.hasOwnProperty(A)){null===g&&(g=[]);const D=a[A];for(let O=0;O<D.length;O+=2)if(D[O]===u){g.push(A,D[O+1],p[b+1]);break}}b+=2}else b+=2;else b+=4}return g}function Xw(a,u,p,g){return[a,!0,0,u,null,g,null,p,null,null]}function Gg(a,u){const p=a.contentQueries;if(null!==p){const g=Ve(null);try{for(let b=0;b<p.length;b+=2){const D=p[b+1];if(-1!==D){const O=a.data[D];pp(p[b]),O.contentQueries(2,u[D],D)}}}finally{Ve(g)}}}function uv(a,u){return a[Re]?a[le][ta]=u:a[Re]=u,a[le]=u,u}function Da(a,u,p){pp(0);const g=Ve(null);try{u(a,p)}finally{Ve(g)}}function zp(a){return a[sc]||(a[sc]=[])}function Af(a){return a.cleanup||(a.cleanup=[])}function Up(a,u){const p=a[Ps],g=p?p.get(Td,null):null;g&&g.handleError(u)}function ab(a,u,p,g,b){for(let A=0;A<p.length;){const D=p[A++],O=p[A++];Kw(a.data[D],u[D],g,O,b)}}function dv(a,u,p,g){var b;const A=u[$r];if(256==(256&A))return;null===(b=u[se].inlineEffectRunner)||void 0===b||b.flush(),X(u);let O=null,F=null;(function Yg(a){return 2!==a.type})(a)&&(F=function AS(a){var u;return null!==(u=a[Ia])&&void 0!==u?u:function Mg(a){var u;const p=null!==(u=rA.pop())&&void 0!==u?u:Object.create(Rg);return p.lView=a,p}(a)}(u),O=function Ot(a){return a&&(a.nextProducerIndex=0),Ve(a)}(F));try{oh(u),function hp(a){return mi.lFrame.bindingIndex=a}(a.bindingStartIndex),null!==p&&Vg(a,u,p,2,g);const J=3==(3&A);if(J){const Je=a.preOrderCheckHooks;null!==Je&&$m(u,Je,null)}else{const Je=a.preOrderHooks;null!==Je&&jm(u,Je,0,null),Y0(u,0)}if(function uA(a){for(let u=MT(a);null!==u;u=mh(u)){if(!(u[$r]&wu.HasTransplantedViews))continue;const p=u[Vt];for(let g=0;g<p.length;g++){sh(p[g])}}}(u),Sd(u,0),null!==a.contentQueries&&Gg(a,u),J){const Je=a.contentCheckHooks;null!==Je&&$m(u,Je)}else{const Je=a.contentHooks;null!==Je&&jm(u,Je,1),Y0(u,1)}!function Bg(a,u){const p=a.hostBindingOpCodes;if(null!==p)try{for(let g=0;g<p.length;g++){const b=p[g];if(b<0)ar(~b);else{const A=b,D=p[++g],O=p[++g];yy(D,A),O(2,u[A])}}}finally{ar(-1)}}(a,u);const de=a.components;null!==de&&eE(u,de,0);const we=a.viewQuery;if(null!==we&&Da(2,we,g),J){const Je=a.viewCheckHooks;null!==Je&&$m(u,Je)}else{const Je=a.viewHooks;null!==Je&&jm(u,Je,2),Y0(u,2)}if(!0===a.firstUpdatePass&&(a.firstUpdatePass=!1),u[wc]){for(const Je of u[wc])Je();u[wc]=null}u[$r]&=-73}catch(J){throw Ro(u),J}finally{null!==F&&(function Rt(a,u){if(Ve(u),a&&void 0!==a.producerNode&&void 0!==a.producerIndexOfThis&&void 0!==a.producerLastReadVersion){if(st(a))for(let p=a.nextProducerIndex;p<a.producerNode.length;p++)me(a.producerNode[p],a.producerIndexOfThis[p]);for(;a.producerNode.length>a.nextProducerIndex;)a.producerNode.pop(),a.producerLastReadVersion.pop(),a.producerIndexOfThis.pop()}}(F,O),function Xx(a){a.lView[Ia]!==a&&(a.lView=null,rA.push(a))}(F)),jt()}}function Sd(a,u){for(let p=MT(a);null!==p;p=mh(p)){p[$r]&=~wu.HasChildViewsToRefresh;for(let g=Bo;g<p.length;g++)Zg(p[g],u)}}function cb(a,u,p){Zg(Ha(u,a),p)}function Zg(a,u){ih(a)&&Fu(a,u)}function Fu(a,u){const g=a[Qn],b=a[$r],A=a[Ia];let D=!!(0===u&&16&b);if(D||(D=!!(64&b&&0===u)),D||(D=!!(1024&b)),D||(D=!(null==A||!A.dirty||!Pt(A))),A&&(A.dirty=!1),a[$r]&=-9217,D)dv(g,a,g.template,a[_i]);else if(8192&b){Sd(a,1);const O=g.components;null!==O&&eE(a,O,1)}}function eE(a,u,p){for(let g=0;g<u.length;g++)cb(a,u[g],p)}function Bu(a){var u;for(null===(u=a[se].changeDetectionScheduler)||void 0===u||u.notify();a;){a[$r]|=64;const p=bd(a);if(nh(a)&&!p)return a;a=p}return null}class Cf{get rootNodes(){const u=this._lView,p=u[Qn];return bl(p,u,p.firstChild,[])}constructor(u,p,g=!0){this._lView=u,this._cdRefInjectingView=p,this.notifyErrorHandler=g,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[_i]}set context(u){this._lView[_i]=u}get destroyed(){return 256==(256&this._lView[$r])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const u=this._lView[jo];if(ps(u)){const p=u[8],g=p?p.indexOf(this):-1;g>-1&&(_h(u,g),Vo(p,g))}this._attachedToViewContainer=!1}Cx(this._lView[Qn],this._lView)}onDestroy(u){qh(this._lView,u)}markForCheck(){Bu(this._cdRefInjectingView||this._lView)}detach(){this._lView[$r]&=-129}reattach(){Go(this._lView),this._lView[$r]|=128}detectChanges(){this._lView[$r]|=1024,function qg(a,u=!0){const p=a[se],g=p.rendererFactory,b=p.afterRenderEventManager;var D;null===(D=g.begin)||void 0===D||D.call(g),null==b||b.begin();try{!function lb(a){Fu(a,0);let u=0;for(;Fm(a);){if(100===u)throw new Nn(103,!1);u++,Fu(a,1)}}(a)}catch(J){throw u&&Up(a,J),J}finally{var O,F;null===(O=g.end)||void 0===O||O.call(g),null===(F=p.inlineEffectRunner)||void 0===F||F.flush(),null==b||b.end()}}(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Nn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Pc(a,u){gf(a,u,u[Y],2,null,null)}(this._lView[Qn],this._lView)}attachToAppRef(u){if(this._attachedToViewContainer)throw new Nn(902,!1);this._appRef=u,Go(this._lView)}}let tE=(()=>{class u{}return u.__NG_ELEMENT_ID__=hv,u})();function hv(a){return function dA(a,u,p){if(Ta(a)&&!p){const g=Ha(a.index,u);return new Cf(g,g)}return 47&a.type?new Cf(u[Mn],u):null}(Ho(),Tn(),16==(16&a))}let db=(()=>{var a;class u{}return(a=u).__NG_ELEMENT_ID__=nE,a.__NG_ENV_ID__=p=>p,u})();class MS extends db{constructor(u){super(),this._lView=u}onDestroy(u){return qh(this._lView,u),()=>function Yh(a,u){if(null===a[Pl])return;const p=a[Pl].indexOf(u);-1!==p&&a[Pl].splice(p,1)}(this._lView,u)}}function nE(){return new MS(Tn())}const Cs=new Set;function fc(a){var u,p;Cs.has(a)||(Cs.add(a),null===(u=performance)||void 0===u||null===(p=u.mark)||void 0===p||p.call(u,"mark_feature_usage",{detail:{feature:a}}))}function $p(a){return u=>{setTimeout(a,void 0,u)}}const du=class pv extends An.x{constructor(u=!1){super(),this.__isAsync=u}emit(u){super.next(u)}subscribe(u,p,g){let b=u,A=p||(()=>null),D=g;if(u&&"object"==typeof u){var O,F,J;const we=u;b=null===(O=we.next)||void 0===O?void 0:O.bind(we),A=null===(F=we.error)||void 0===F?void 0:F.bind(we),D=null===(J=we.complete)||void 0===J?void 0:J.bind(we)}this.__isAsync&&(A=$p(A),b&&(b=$p(b)),D&&(D=$p(D)));const de=super.subscribe({next:b,error:A,complete:D});return u instanceof qe.w0&&u.add(de),de}};function rE(...a){}class ya{constructor({enableLongStackTrace:u=!1,shouldCoalesceEventChangeDetection:p=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new du(!1),this.onMicrotaskEmpty=new du(!1),this.onStable=new du(!1),this.onError=new du(!1),typeof Zone>"u")throw new Nn(908,!1);Zone.assertZonePatched();const b=this;b._nesting=0,b._outer=b._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(b._inner=b._inner.fork(new Zone.TaskTrackingZoneSpec)),u&&Zone.longStackTraceZoneSpec&&(b._inner=b._inner.fork(Zone.longStackTraceZoneSpec)),b.shouldCoalesceEventChangeDetection=!g&&p,b.shouldCoalesceRunChangeDetection=g,b.lastRequestAnimationFrameId=-1,b.nativeRequestAnimationFrame=function PS(){const a="function"==typeof Se.requestAnimationFrame;let u=Se[a?"requestAnimationFrame":"setTimeout"],p=Se[a?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&u&&p){const g=u[Zone.__symbol__("OriginalDelegate")];g&&(u=g);const b=p[Zone.__symbol__("OriginalDelegate")];b&&(p=b)}return{nativeRequestAnimationFrame:u,nativeCancelAnimationFrame:p}}().nativeRequestAnimationFrame,function oE(a){const u=()=>{!function Dd(a){a.isCheckStableRunning||-1!==a.lastRequestAnimationFrameId||(a.lastRequestAnimationFrameId=a.nativeRequestAnimationFrame.call(Se,()=>{a.fakeTopEventTask||(a.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{a.lastRequestAnimationFrameId=-1,Ao(a),a.isCheckStableRunning=!0,va(a),a.isCheckStableRunning=!1},void 0,()=>{},()=>{})),a.fakeTopEventTask.invoke()}),Ao(a))}(a)};a._inner=a._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(p,g,b,A,D,O)=>{if(function sE(a){var u;return!(!Array.isArray(a)||1!==a.length)&&!0===(null===(u=a[0].data)||void 0===u?void 0:u.__ignore_ng_zone__)}(O))return p.invokeTask(b,A,D,O);try{return hb(a),p.invokeTask(b,A,D,O)}finally{(a.shouldCoalesceEventChangeDetection&&"eventTask"===A.type||a.shouldCoalesceRunChangeDetection)&&u(),zu(a)}},onInvoke:(p,g,b,A,D,O,F)=>{try{return hb(a),p.invoke(b,A,D,O,F)}finally{a.shouldCoalesceRunChangeDetection&&u(),zu(a)}},onHasTask:(p,g,b,A)=>{p.hasTask(b,A),g===b&&("microTask"==A.change?(a._hasPendingMicrotasks=A.microTask,Ao(a),va(a)):"macroTask"==A.change&&(a.hasPendingMacrotasks=A.macroTask))},onHandleError:(p,g,b,A)=>(p.handleError(b,A),a.runOutsideAngular(()=>a.onError.emit(A)),!1)})}(b)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ya.isInAngularZone())throw new Nn(909,!1)}static assertNotInAngularZone(){if(ya.isInAngularZone())throw new Nn(909,!1)}run(u,p,g){return this._inner.run(u,p,g)}runTask(u,p,g,b){const A=this._inner,D=A.scheduleEventTask("NgZoneEvent: "+b,u,iE,rE,rE);try{return A.runTask(D,p,g)}finally{A.cancelTask(D)}}runGuarded(u,p,g){return this._inner.runGuarded(u,p,g)}runOutsideAngular(u){return this._outer.run(u)}}const iE={};function va(a){if(0==a._nesting&&!a.hasPendingMicrotasks&&!a.isStable)try{a._nesting++,a.onMicrotaskEmpty.emit(null)}finally{if(a._nesting--,!a.hasPendingMicrotasks)try{a.runOutsideAngular(()=>a.onStable.emit(null))}finally{a.isStable=!0}}}function Ao(a){a.hasPendingMicrotasks=!!(a._hasPendingMicrotasks||(a.shouldCoalesceEventChangeDetection||a.shouldCoalesceRunChangeDetection)&&-1!==a.lastRequestAnimationFrameId)}function hb(a){a._nesting++,a.isStable&&(a.isStable=!1,a.onUnstable.emit(null))}function zu(a){a._nesting--,va(a)}class Xg{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new du,this.onMicrotaskEmpty=new du,this.onStable=new du,this.onError=new du}run(u,p,g){return u.apply(p,g)}runGuarded(u,p,g){return u.apply(p,g)}runOutsideAngular(u){return u()}runTask(u,p,g,b){return u.apply(p,g)}}var jp=function(a){return a[a.EarlyRead=0]="EarlyRead",a[a.Write=1]="Write",a[a.MixedReadWrite=2]="MixedReadWrite",a[a.Read=3]="Read",a}(jp||{});const fb={destroy(){}};function gv(a,u){var p,g,b;!u&&function mx(a){if(!Wi()&&!function ut(){return Kn}())throw new Nn(-203,!1)}();const A=null!==(p=null==u?void 0:u.injector)&&void 0!==p?p:K(Os);if(!function Pu(a){return"browser"===(null!=a?a:K(Os)).get(hf)}(A))return fb;fc("NgAfterNextRender");const D=A.get(_v),O=null!==(g=D.handler)&&void 0!==g?g:D.handler=new Qg,F=null!==(b=null==u?void 0:u.phase)&&void 0!==b?b:jp.MixedReadWrite,J=()=>{O.unregister(we),de()},de=A.get(db).onDestroy(J),we=new mb(A,F,()=>{J(),a()});return O.register(we),{destroy:J}}class mb{constructor(u,p,g){this.phase=p,this.callbackFn=g,this.zone=u.get(ya),this.errorHandler=u.get(Td,null,{optional:!0})}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(p){var u;null===(u=this.errorHandler)||void 0===u||u.handleError(p)}}}class Qg{constructor(){this.executingCallbacks=!1,this.buckets={[jp.EarlyRead]:new Set,[jp.Write]:new Set,[jp.MixedReadWrite]:new Set,[jp.Read]:new Set},this.deferredCallbacks=new Set}validateBegin(){if(this.executingCallbacks)throw new Nn(102,!1)}register(u){(this.executingCallbacks?this.deferredCallbacks:this.buckets[u.phase]).add(u)}unregister(u){this.buckets[u.phase].delete(u),this.deferredCallbacks.delete(u)}execute(){this.executingCallbacks=!0;for(const u of Object.values(this.buckets))for(const p of u)p.invoke();this.executingCallbacks=!1;for(const u of this.deferredCallbacks)this.buckets[u.phase].add(u);this.deferredCallbacks.clear()}destroy(){for(const u of Object.values(this.buckets))u.clear();this.deferredCallbacks.clear()}}let _v=(()=>{var a;class u{constructor(){this.renderDepth=0,this.handler=null,this.internalCallbacks=[]}begin(){var g;null===(g=this.handler)||void 0===g||g.validateBegin(),this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth){var g;for(const b of this.internalCallbacks)b();this.internalCallbacks.length=0,null===(g=this.handler)||void 0===g||g.execute()}}ngOnDestroy(){var g;null===(g=this.handler)||void 0===g||g.destroy(),this.handler=null,this.internalCallbacks.length=0}}return(a=u).\u0275prov=Ei({token:a,providedIn:"root",factory:()=>new a}),u})();function OS(a,u){const p=Ha(u,a),g=p[Qn];!function pA(a,u){for(let p=u.length;p<a.blueprint.length;p++)u.push(a.blueprint[p])}(g,p);const b=p[eo];null!==b&&null===p[ka]&&(p[ka]=Cw(b,p[Ps])),Uu(g,p,p[_i])}function Uu(a,u,p){X(u);try{const g=a.viewQuery;null!==g&&Da(1,g,p);const b=a.template;null!==b&&Vg(a,u,b,1,p),a.firstCreatePass&&(a.firstCreatePass=!1),a.staticContentQueries&&Gg(a,u),a.staticViewQueries&&Da(2,a.viewQuery,p);const A=a.components;null!==A&&function yv(a,u){for(let p=0;p<u.length;p++)OS(a,u[p])}(u,A)}catch(g){throw a.firstCreatePass&&(a.incompleteFirstPass=!0,a.firstCreatePass=!1),g}finally{u[$r]&=-5,jt()}}function wh(a,u,p){let g=p?a.styles:null,b=p?a.classes:null,A=0;if(null!==u)for(let D=0;D<u.length;D++){const O=u[D];"number"==typeof O?A=O:1==A?b=nn(b,O):2==A&&(g=nn(g,O+": "+u[++D]+";"))}p?a.styles=g:a.stylesWithoutHost=g,p?a.classes=b:a.classesWithoutHost=b}class Jg extends Pw{constructor(u){super(),this.ngModule=u}resolveComponentFactory(u){const p=di(u);return new Md(p,this.ngModule)}}function vv(a){const u=[];for(let p in a)a.hasOwnProperty(p)&&u.push({propName:a[p],templateName:p});return u}class xv{constructor(u,p){this.injector=u,this.parentInjector=p}get(u,p,g){g=Fe(g);const b=this.injector.get(u,kw,g);return b!==kw||p===kw?b:this.parentInjector.get(u,p,g)}}class Md extends xf{get inputs(){const u=this.componentDef,p=u.inputTransforms,g=vv(u.inputs);if(null!==p)for(const b of g)p.hasOwnProperty(b.propName)&&(b.transform=p[b.propName]);return g}get outputs(){return vv(this.componentDef.outputs)}constructor(u,p){super(),this.componentDef=u,this.ngModule=p,this.componentType=u.type,this.selector=function ea(a){return a.map(Us).join(",")}(u.selectors),this.ngContentSelectors=u.ngContentSelectors?u.ngContentSelectors:[],this.isBoundToModule=!!p}create(u,p,g,b){var D;let O=(b=b||this.ngModule)instanceof Dc?b:null===(D=b)||void 0===D?void 0:D.injector;O&&null!==this.componentDef.getStandaloneInjector&&(O=this.componentDef.getStandaloneInjector(O)||O);const F=O?new xv(u,O):u,J=F.get(Ow,null);if(null===J)throw new Nn(407,!1);const At={rendererFactory:J,sanitizer:F.get(kp,null),inlineEffectRunner:null,afterRenderEventManager:F.get(_v,null),changeDetectionScheduler:F.get(VD,null)},mn=J.createRenderer(null,this.componentDef),$n=this.componentDef.selectors[0][0]||"div",or=g?function nl(a,u,p,g){const A=g.get(tb,!1)||p===rs.ShadowDom,D=a.selectRootElement(u,A);return function wl(a){If(a)}(D),D}(mn,g,this.componentDef.encapsulation,F):Tx(mn,$n,function mA(a){const u=a.toLowerCase();return"svg"===u?"svg":"math"===u?"math":null}($n));let wr=512;this.componentDef.signals?wr|=4096:this.componentDef.onPush||(wr|=16);let zn=null;null!==or&&(zn=Cw(or,F,!0));const Li=sv(0,null,null,1,0,null,null,null,null,null,null),zi=Fp(null,Li,null,wr,null,null,At,mn,F,null,zn);let Do,al;X(zi);try{const sp=this.componentDef;let j1,aM=null;sp.findHostDirectiveDefs?(j1=[],aM=new Map,sp.findHostDirectiveDefs(sp,j1,aM),j1.push(sp)):j1=[sp];const AD=function Ss(a,u){const p=a[Qn],g=hi;return a[g]=u,Bp(p,g,2,"#host",null)}(zi,or),PM=function lE(a,u,p,g,b,A,D){const O=b[Qn];!function _A(a,u,p,g){for(const b of a)u.mergedAttrs=go(u.mergedAttrs,b.hostAttrs);null!==u.mergedAttrs&&(wh(u,u.mergedAttrs,!0),null!==p&&Rx(g,p,u))}(g,a,u,D);let F=null;null!==u&&(F=Cw(u,b[Ps]));const J=A.rendererFactory.createRenderer(u,p);let de=16;p.signals?de=4096:p.onPush&&(de=64);const we=Fp(b,rb(p),null,de,b[a.index],a,A,J,null,null,F);return O.firstCreatePass&&cv(O,a,g.length-1),uv(b,we),b[a.index]=we}(AD,or,sp,j1,zi,At,mn);al=Ca(Li,hi),or&&function e_(a,u,p,g){if(g)$a(a,p,["ng-version","17.0.8"]);else{const{attrs:b,classes:A}=function dy(a){const u=[],p=[];let g=1,b=2;for(;g<a.length;){let A=a[g];if("string"==typeof A)2===b?""!==A&&u.push(A,a[++g]):8===b&&p.push(A);else{if(!Ea(b))break;b=A}g++}return{attrs:u,classes:p}}(u.selectors[0]);b&&$a(a,p,b),A&&A.length>0&&VT(a,p,A.join(" "))}}(mn,sp,or,g),void 0!==p&&function Eh(a,u,p){const g=a.projection=[];for(let b=0;b<u.length;b++){const A=p[b];g.push(null!=A?Array.from(A):null)}}(al,this.ngContentSelectors,p),Do=function $u(a,u,p,g,b,A){const D=Ho(),O=b[Qn],F=tr(D,b);Tf(O,b,D,p,null,g);for(let de=0;de<p.length;de++)pl(Au(b,O,D.directiveStart+de,D),b);lv(O,b,D),F&&pl(F,b);const J=Au(b,O,D.directiveStart+D.componentOffset,D);if(a[_i]=b[_i]=J,null!==A)for(const de of A)de(J,u);return ov(O,D,a),J}(PM,sp,j1,aM,zi,[cE]),Uu(Li,zi,null)}finally{jt()}return new gA(this.componentType,Do,Jy(al,zi),zi,al)}}class gA extends bh{constructor(u,p,g,b,A){super(),this.location=g,this._rootLView=b,this._tNode=A,this.previousInputValues=null,this.instance=p,this.hostView=this.changeDetectorRef=new Cf(b,void 0,!1),this.componentType=u}setInput(u,p){const g=this._tNode.inputs;let b;if(null!==g&&(b=g[u])){var A;if(null!==(A=this.previousInputValues)&&void 0!==A||(this.previousInputValues=new Map),this.previousInputValues.has(u)&&Object.is(this.previousInputValues.get(u),p))return;const D=this._rootLView;ab(D[Qn],D,b,u,p),this.previousInputValues.set(u,p),Bu(Ha(this._tNode.index,D))}}get injector(){return new pa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(u){this.hostView.onDestroy(u)}}function cE(){const a=Ho();tu(Tn()[Qn],a)}function Gp(a){let u=function t_(a){return Object.getPrototypeOf(a.prototype).constructor}(a.type),p=!0;const g=[a];for(;u;){let b;if(ms(a))b=u.\u0275cmp||u.\u0275dir;else{if(u.\u0275cmp)throw new Nn(903,!1);b=u.\u0275dir}if(b){if(p){g.push(b);const D=a;D.inputs=Ul(a.inputs),D.inputTransforms=Ul(a.inputTransforms),D.declaredInputs=Ul(a.declaredInputs),D.outputs=Ul(a.outputs);const O=b.hostBindings;O&&vA(a,O);const F=b.viewQuery,J=b.contentQueries;if(F&&yA(a,F),J&&kS(a,J),Bt(a.inputs,b.inputs),Bt(a.declaredInputs,b.declaredInputs),Bt(a.outputs,b.outputs),null!==b.inputTransforms&&(null===D.inputTransforms&&(D.inputTransforms={}),Bt(D.inputTransforms,b.inputTransforms)),ms(b)&&b.data.animation){const de=a.data;de.animation=(de.animation||[]).concat(b.data.animation)}}const A=b.features;if(A)for(let D=0;D<A.length;D++){const O=A[D];O&&O.ngInherit&&O(a),O===Gp&&(p=!1)}}u=Object.getPrototypeOf(u)}!function bv(a){let u=0,p=null;for(let g=a.length-1;g>=0;g--){const b=a[g];b.hostVars=u+=b.hostVars,b.hostAttrs=go(b.hostAttrs,p=go(p,b.hostAttrs))}}(g)}function Ul(a){return a===Ks?{}:a===br?[]:a}function yA(a,u){const p=a.viewQuery;a.viewQuery=p?(g,b)=>{u(g,b),p(g,b)}:u}function kS(a,u){const p=a.contentQueries;a.contentQueries=p?(g,b,A)=>{u(g,b,A),p(g,b,A)}:u}function vA(a,u){const p=a.hostBindings;a.hostBindings=p?(g,b)=>{u(g,b),p(g,b)}:u}function Lc(a){const u=a.inputConfig,p={};for(const g in u)if(u.hasOwnProperty(g)){const b=u[g];Array.isArray(b)&&b[2]&&(p[g]=b[2])}a.inputTransforms=p}function hu(a,u,p){return a[u]=p}function ks(a,u,p){return!Object.is(a[u],p)&&(a[u]=p,!0)}function ju(a,u,p,g){const b=ks(a,u,p);return ks(a,u+1,g)||b}function Pd(a,u,p,g){const b=Tn();return ks(b,Za(),u)&&(yo(),Cd(_r(),b,a,u,p,g)),Pd}function Iv(a,u){return a<<17|u<<2}function Hu(a){return a>>17&32767}function yb(a){return 2|a}function rl(a){return(131068&a)>>2}function mc(a,u){return-131069&a|u<<2}function Xp(a){return 1|a}function kd(a,u,p,g,b){const A=a[p+1],D=null===u;let O=g?Hu(A):rl(A),F=!1;for(;0!==O&&(!1===F||D);){const de=a[O+1];hE(a[O],u)&&(F=!0,a[O+1]=g?Xp(de):yb(de)),O=g?Hu(de):rl(de)}F&&(a[p+1]=g?yb(A):Xp(A))}function hE(a,u){return null===a||null==u||(Array.isArray(a)?a[1]:a)===u||!(!Array.isArray(a)||"string"!=typeof u)&&hd(a,u)>=0}function Dv(a,u,p){const g=Tn();return ks(g,Za(),u)&&function El(a,u,p,g,b,A,D,O){const F=tr(u,p);let de,J=u.inputs;!O&&null!=J&&(de=J[g])?(ab(a,p,de,g,b),Ta(u)&&function av(a,u){const p=Ha(u,a);16&p[$r]||(p[$r]|=64)}(p,u.index)):3&u.type&&(g=function lA(a){return"class"===a?"className":"for"===a?"htmlFor":"formaction"===a?"formAction":"innerHtml"===a?"innerHTML":"readonly"===a?"readOnly":"tabindex"===a?"tabIndex":a}(g),b=null!=D?D(b,u.value||"",g):b,A.setProperty(F,g,b))}(yo(),_r(),g,a,u,g[Y],p,!1),Dv}function jn(a,u,p,g,b){const D=b?"class":"style";ab(a,p,u.inputs[D],D,g)}function ba(a,u){return function hr(a,u,p,g){const b=Tn(),A=yo(),D=function Kl(a){const u=mi.lFrame,p=u.bindingIndex;return u.bindingIndex=u.bindingIndex+a,p}(2);A.firstUpdatePass&&function Ma(a,u,p,g){const b=a.data;if(null===b[p+1]){const A=b[Zt()],D=function qn(a,u){return u>=a.expandoStartIndex}(a,p);(function Hs(a,u){return 0!=(a.flags&(u?8:16))})(A,g)&&null===u&&!D&&(u=!1),u=function mE(a,u,p,g){const b=function Um(a){const u=mi.lFrame.currentDirectiveIndex;return-1===u?null:a[u]}(a);let A=g?u.residualClasses:u.residualStyles;if(null===b)0===(g?u.classBindings:u.styleBindings)&&(p=Mv(p=gE(null,a,u,p,g),u.attrs,g),A=null);else{const D=u.directiveStylingLast;if(-1===D||a[D]!==b)if(p=gE(b,a,u,p,g),null===A){let F=function FS(a,u,p){const g=p?u.classBindings:u.styleBindings;if(0!==rl(g))return a[Hu(g)]}(a,u,g);void 0!==F&&Array.isArray(F)&&(F=gE(null,a,u,F[1],g),F=Mv(F,u.attrs,g),function BS(a,u,p,g){a[Hu(p?u.classBindings:u.styleBindings)]=g}(a,u,g,F))}else A=function zo(a,u,p){let g;const b=u.directiveEnd;for(let A=1+u.directiveStylingLast;A<b;A++)g=Mv(g,a[A].hostAttrs,p);return Mv(g,u.attrs,p)}(a,u,g)}return void 0!==A&&(g?u.residualClasses=A:u.residualStyles=A),p}(b,A,u,g),function xb(a,u,p,g,b,A){let D=A?u.classBindings:u.styleBindings,O=Hu(D),F=rl(D);a[g]=p;let de,J=!1;if(Array.isArray(p)?(de=p[1],(null===de||hd(p,de)>0)&&(J=!0)):de=p,b)if(0!==F){const Je=Hu(a[O+1]);a[g+1]=Iv(Je,O),0!==Je&&(a[Je+1]=mc(a[Je+1],g)),a[O+1]=function _b(a,u){return 131071&a|u<<17}(a[O+1],g)}else a[g+1]=Iv(O,0),0!==O&&(a[O+1]=mc(a[O+1],g)),O=g;else a[g+1]=Iv(F,0),0===O?O=g:a[F+1]=mc(a[F+1],g),F=g;J&&(a[g+1]=yb(a[g+1])),kd(a,de,g,!0),kd(a,de,g,!1),function Tv(a,u,p,g,b){const A=b?a.residualClasses:a.residualStyles;null!=A&&"string"==typeof u&&hd(A,u)>=0&&(p[g+1]=Xp(p[g+1]))}(u,de,a,g,A),D=Iv(O,F),A?u.classBindings=D:u.styleBindings=D}(b,A,u,p,D,g)}}(A,a,D,g),u!==Ni&&ks(b,D,u)&&function _E(a,u,p,g,b,A,D,O){if(!(3&u.type))return;const F=a.data,J=F[O+1],de=function Fa(a){return 1==(1&a)}(J)?ki(F,u,p,b,rl(J),D):void 0;Th(de)||(Th(A)||function r_(a){return 2==(2&a)}(J)&&(A=ki(F,null,p,b,O,D)),function Mx(a,u,p,g,b){if(u)b?a.addClass(p,g):a.removeClass(p,g);else{let A=-1===g.indexOf("-")?void 0:vx.DashCase;null==b?a.removeStyle(p,g,A):("string"==typeof b&&b.endsWith("!important")&&(b=b.slice(0,-10),A|=vx.Important),a.setStyle(p,g,b,A))}}(g,D,Tu(Zt(),p),b,A))}(A,A.data[Zt()],b,b[Y],a,b[D+1]=function AA(a,u){return null==a||""===a||("string"==typeof u?a+=u:"object"==typeof a&&(a=zt(Xl(a)))),a}(u,p),g,D)}(a,u,null,!0),ba}function gE(a,u,p,g,b){let A=null;const D=p.directiveEnd;let O=p.directiveStylingLast;for(-1===O?O=p.directiveStart:O++;O<D&&(A=u[O],g=Mv(g,A.hostAttrs,b),A!==a);)O++;return null!==a&&(p.directiveStylingLast=O),g}function Mv(a,u,p){const g=p?1:2;let b=-1;if(null!==u)for(let A=0;A<u.length;A++){const D=u[A];"number"==typeof D?b=D:b===g&&(Array.isArray(a)||(a=void 0===a?[]:["",a]),ru(a,D,!!p||u[++A]))}return void 0===a?null:a}function ki(a,u,p,g,b,A){const D=null===u;let O;for(;b>0;){const F=a[b],J=Array.isArray(F),de=J?F[1]:F,we=null===de;let Je=p[b+1];Je===Ni&&(Je=we?br:void 0);let At=we?vp(Je,g):de===g?Je:void 0;if(J&&!Th(At)&&(At=vp(F,g)),Th(At)&&(O=At,D))return O;const mn=a[b+1];b=D?Hu(mn):rl(mn)}if(null!==u){let F=A?u.residualClasses:u.residualStyles;null!=F&&(O=vp(F,g))}return O}function Th(a){return void 0!==a}let TE=(a,u)=>null;function Vc(a,u){return TE(a,u)}class OA{destroy(u){}updateValue(u,p){}swap(u,p){const g=Math.min(u,p),b=Math.max(u,p),A=this.detach(b);if(b-g>1){const D=this.detach(g);this.attach(g,A),this.attach(b,D)}else this.attach(g,A)}move(u,p){this.attach(p,this.detach(u))}}function Tb(a,u,p,g,b){return a===p&&Object.is(u,g)?1:Object.is(b(a,u),b(p,g))?-1:0}function Ch(a,u,p,g){return!(void 0===u||!u.has(g)||(a.attach(p,u.get(g)),u.delete(g),0))}function kA(a,u,p,g,b){if(Ch(a,u,g,p(g,b)))a.updateValue(g,b);else{const A=a.create(g,b);a.attach(g,A)}}function l_(a,u,p,g){const b=new Set;for(let A=u;A<=p;A++)b.add(g(A,a.at(A)));return b}class Ab{constructor(){this.kvMap=new Map,this._vMap=void 0}has(u){return this.kvMap.has(u)}delete(u){if(!this.has(u))return!1;const p=this.kvMap.get(u);return void 0!==this._vMap&&this._vMap.has(p)?(this.kvMap.set(u,this._vMap.get(p)),this._vMap.delete(p)):this.kvMap.delete(u),!0}get(u){return this.kvMap.get(u)}set(u,p){if(this.kvMap.has(u)){let g=this.kvMap.get(u);void 0===this._vMap&&(this._vMap=new Map);const b=this._vMap;for(;b.has(g);)g=b.get(g);b.set(g,p)}else this.kvMap.set(u,p)}forEach(u){for(let[p,g]of this.kvMap)if(u(g,p),void 0!==this._vMap){const b=this._vMap;for(;b.has(g);)g=b.get(g),u(g,p)}}}function c_(a,u,p,g){var b,A;const D=u.tView,J=Fp(a,D,p,4096&a[$r]?4096:16,null,u,null,null,null,null!==(b=null==g?void 0:g.injector)&&void 0!==b?b:null,null!==(A=null==g?void 0:g.dehydratedView)&&void 0!==A?A:null);J[Nr]=a[u.index];const we=a[as];return null!==we&&(J[as]=we.createEmbeddedView(D)),Uu(D,J,p),J}function gc(a,u){const p=Bo+u;if(p<a.length)return a[p]}function qs(a,u){return!u||null===u.firstChild||pf(a)}function u_(a,u,p,g=!0){const b=u[Qn];if(function Ax(a,u,p,g){const b=Bo+g,A=p.length;g>0&&(p[b-1][ta]=u),g<A-Bo?(u[ta]=p[b],Bl(p,Bo+g,u)):(p.push(u),u[ta]=null),u[jo]=p;const D=u[Nr];null!==D&&p!==D&&function FD(a,u){const p=a[Vt];u[Mn]!==u[jo][jo][Mn]&&(a[$r]|=wu.HasTransplantedViews),null===p?a[Vt]=[u]:p.push(u)}(D,u);const O=u[as];null!==O&&O.insertView(a),Go(u),u[$r]|=128}(b,u,a,p),g){const D=xg(p,a),O=u[Y],F=Dx(O,a[ja]);null!==F&&function RT(a,u,p,g,b,A){g[eo]=b,g[ws]=u,gf(a,g,p,1,b,A)}(b,a[ws],O,u,F,D)}const A=u[ka];null!==A&&null!==A.firstChild&&(A.firstChild=null)}function Nd(a,u){const p=_h(a,u);return void 0!==p&&Cx(p[Qn],p),p}let d_=(()=>{class u{}return u.__NG_ELEMENT_ID__=ys,u})();function ys(){return _u(Ho(),Tn())}const Fv=d_,Va=class extends Fv{constructor(u,p,g){super(),this._lContainer=u,this._hostTNode=p,this._hostLView=g}get element(){return Jy(this._hostTNode,this._hostLView)}get injector(){return new pa(this._hostTNode,this._hostLView)}get parentInjector(){const u=X0(this._hostTNode,this._hostLView);if(wy(u)){const p=Wm(u,this._hostLView),g=Hm(u);return new pa(p[Qn].data[g+8],p)}return new pa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(u){const p=Ko(this._lContainer);return null!==p&&p[u]||null}get length(){return this._lContainer.length-Bo}createEmbeddedView(u,p,g){let b,A;"number"==typeof g?b=g:null!=g&&(b=g.index,A=g.injector);const D=Vc(this._lContainer,u.ssrId),O=u.createEmbeddedViewImpl(p||{},A,D);return this.insertImpl(O,b,qs(this._hostTNode,D)),O}createComponent(u,p,g,b,A){var D,O,F;const J=u&&!function lh(a){return"function"==typeof a}(u);let de;if(J)de=p;else{const wr=p||{};de=wr.index,g=wr.injector,b=wr.projectableNodes,A=wr.environmentInjector||wr.ngModuleRef}const we=J?u:new Md(di(u)),Je=g||this.parentInjector;if(!A&&null==we.ngModule){const zn=(J?Je:this.parentInjector).get(Dc,null);zn&&(A=zn)}const At=di(null!==(D=we.componentType)&&void 0!==D?D:{}),mn=Vc(this._lContainer,null!==(O=null==At?void 0:At.id)&&void 0!==O?O:null),$n=null!==(F=null==mn?void 0:mn.firstChild)&&void 0!==F?F:null,or=we.create(Je,b,$n,A);return this.insertImpl(or.hostView,de,qs(this._hostTNode,mn)),or}insert(u,p){return this.insertImpl(u,p,!0)}insertImpl(u,p,g){const b=u._lView;if(function Wa(a){return ps(a[jo])}(b)){const O=this.indexOf(u);if(-1!==O)this.detach(O);else{const F=b[jo],J=new Va(F,F[ws],F[jo]);J.detach(J.indexOf(u))}}const A=this._adjustIndex(p),D=this._lContainer;return u_(D,b,A,g),u.attachToViewContainerRef(),Bl(rm(D),A,u),u}move(u,p){return this.insert(u,p)}indexOf(u){const p=Ko(this._lContainer);return null!==p?p.indexOf(u):-1}remove(u){const p=this._adjustIndex(u,-1),g=_h(this._lContainer,p);g&&(Vo(rm(this._lContainer),p),Cx(g[Qn],g))}detach(u){const p=this._adjustIndex(u,-1),g=_h(this._lContainer,p);return g&&null!=Vo(rm(this._lContainer),p)?new Cf(g):null}_adjustIndex(u,p=0){return null==u?this.length+p:u}};function Ko(a){return a[8]}function rm(a){return a[8]||(a[8]=[])}function _u(a,u){let p;const g=u[a.index];return ps(g)?p=g:(p=Xw(g,u,null,a),u[a.index]=p,uv(u,p)),Cb(p,u,a,g),new Va(p,a,u)}let Cb=function CE(a,u,p,g){if(a[ja])return;let b;b=8&p.type?Yo(g):function tc(a,u){const p=a[Y],g=p.createComment(""),b=tr(u,a);return _l(p,Dx(p,b),g,function kT(a,u){return a.nextSibling(u)}(p,b),!1),g}(u,p),a[ja]=b},AE=(a,u,p)=>!1;function Fd(a,u,p,g,b,A,D,O){const F=Tn(),J=yo(),de=a+hi,we=J.firstCreatePass?function Sb(a,u,p,g,b,A,D,O,F){const J=u.consts,de=Bp(u,a,4,D||null,fl(J,O));Ug(u,p,de,fl(J,F)),tu(u,de);const we=de.tView=sv(2,de,g,b,A,u.directiveRegistry,u.pipeRegistry,null,u.schemas,J,null);return null!==u.queries&&(u.queries.template(u,de),we.queries=u.queries.embeddedTView(de)),de}(de,J,F,u,p,g,b,A,D):J.data[de];qa(we,!1);const Je=Bd(J,F,we,a);eu()&&wd(J,F,Je,we),pl(Je,F);const At=Xw(Je,F,Je,we);return F[de]=At,uv(F,At),function sa(a,u,p){return AE(a,u,p)}(At,we,F),sd(we)&&nb(J,F,we),null!=D&&zw(F,we,O),Fd}let Bd=function LA(a,u,p,g){return ha(!0),u[Y].createComment("")};function Lf(a,u,p){fc("NgControlFlow");const g=Tn(),b=Za(),A=om(g,hi+a);if(ks(g,b,u)){const O=Ve(null);try{if(Nd(A,0),-1!==u){const F=Vf(g[Qn],hi+u),J=Vc(A,F.tView.ssrId);u_(A,c_(g,F,p,{dehydratedView:J}),0,qs(F,J))}}finally{Ve(O)}}else{const O=gc(A,0);void 0!==O&&(O[_i]=p)}}class Dh{constructor(u,p,g){this.lContainer=u,this.$implicit=p,this.$index=g}get $count(){return this.lContainer.length-Bo}}function im(a,u){return u}class Nf{constructor(u,p,g){this.hasEmptyBlock=u,this.trackByFn=p,this.liveCollection=g}}function SE(a,u,p,g,b,A,D,O,F,J,de){fc("NgControlFlow");const we=void 0!==F,Je=Tn(),At=O?D.bind(Je[Mn][_i]):D,mn=new Nf(we,At);Je[hi+a]=mn,Fd(a+1,u,p,g,b,A),we&&Fd(a+2,F,J,de)}class Ff extends OA{constructor(u,p,g){super(),this.lContainer=u,this.hostLView=p,this.templateTNode=g,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Bo}at(u){return this.getLView(u)[_i].$implicit}attach(u,p){const g=p[ka];this.needsIndexUpdate||(this.needsIndexUpdate=u!==this.length),u_(this.lContainer,p,u,qs(this.templateTNode,g))}detach(u){return this.needsIndexUpdate||(this.needsIndexUpdate=u!==this.length-1),function Bf(a,u){return _h(a,u)}(this.lContainer,u)}create(u,p){const g=Vc(this.lContainer,this.templateTNode.tView.ssrId);return c_(this.hostLView,this.templateTNode,new Dh(this.lContainer,p,u),{dehydratedView:g})}destroy(u){Cx(u[Qn],u)}updateValue(u,p){this.getLView(u)[_i].$implicit=p}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let u=0;u<this.length;u++)this.getLView(u)[_i].$index=u}getLView(u){return function Db(a,u){return gc(a,u)}(this.lContainer,u)}}function Vd(a){const u=Ve(null),p=Zt();try{const g=Tn(),b=g[Qn],A=g[p];if(void 0===A.liveCollection){const O=p+1,F=om(g,O),J=Vf(b,O);A.liveCollection=new Ff(F,g,J)}else A.liveCollection.reset();const D=A.liveCollection;if(function nm(a,u,p){var g;let b,A,D=0,O=a.length-1;if(Array.isArray(u)){let Je=u.length-1;for(;D<=O&&D<=Je;){var F,J;const At=a.at(D),mn=u[D],$n=Tb(D,At,D,mn,p);if(0!==$n){$n<0&&a.updateValue(D,mn),D++;continue}const or=a.at(O),wr=u[Je],zn=Tb(O,or,Je,wr,p);if(0!==zn){zn<0&&a.updateValue(O,wr),O--,Je--;continue}const Li=p(D,At),zi=p(O,or),Do=p(D,mn);if(Object.is(Do,zi)){const al=p(Je,wr);Object.is(al,Li)?(a.swap(D,O),a.updateValue(O,wr),Je--,O--):a.move(O,D),a.updateValue(D,mn),D++}else if(null!==(F=b)&&void 0!==F||(b=new Ab),null!==(J=A)&&void 0!==J||(A=l_(a,D,O,p)),Ch(a,b,D,Do))a.updateValue(D,mn),D++,O++;else if(A.has(Do))b.set(Li,a.detach(D)),O--;else{const al=a.create(D,u[D]);a.attach(D,al),D++,O++}}for(;D<=Je;)kA(a,b,p,D,u[D]),D++}else if(null!=u){const Je=u[Symbol.iterator]();let At=Je.next();for(;!At.done&&D<=O;){const mn=a.at(D),$n=At.value,or=Tb(D,mn,D,$n,p);if(0!==or)or<0&&a.updateValue(D,$n),D++,At=Je.next();else{var de,we;null!==(de=b)&&void 0!==de||(b=new Ab),null!==(we=A)&&void 0!==we||(A=l_(a,D,O,p));const wr=p(D,$n);if(Ch(a,b,D,wr))a.updateValue(D,$n),D++,O++,At=Je.next();else if(A.has(wr)){const zn=p(D,mn);b.set(zn,a.detach(D)),O--}else a.attach(D,a.create(D,$n)),D++,O++,At=Je.next()}}for(;!At.done;)kA(a,b,p,a.length,At.value),At=Je.next()}for(;D<=O;)a.destroy(a.detach(O--));null===(g=b)||void 0===g||g.forEach(Je=>{a.destroy(Je)})}(D,a,A.trackByFn),D.updateIndexes(),A.hasEmptyBlock){const O=Za(),F=0===D.length;if(ks(g,O,F)){const J=p+2,de=om(g,J);if(F){const we=Vf(b,J),Je=Vc(de,we.tView.ssrId);u_(de,c_(g,we,void 0,{dehydratedView:Je}),0,qs(we,Je))}else Nd(de,0)}}}finally{Ve(u)}}function om(a,u){return a[u]}function Vf(a,u){return Ca(a,u)}function kh(a,u,p,g){const b=Tn(),A=yo(),D=hi+a,O=b[Y],F=A.firstCreatePass?function jA(a,u,p,g,b,A){const D=u.consts,F=Bp(u,a,2,g,fl(D,b));return Ug(u,p,F,fl(D,A)),null!==F.attrs&&wh(F,F.attrs,!1),null!==F.mergedAttrs&&wh(F,F.mergedAttrs,!0),null!==u.queries&&u.queries.elementStart(u,F),F}(D,A,b,u,p,g):A.data[D],J=Lh(A,b,F,O,u,a);b[D]=J;const de=sd(F);return qa(F,!0),Rx(O,J,F),32!=(32&F.flags)&&eu()&&wd(A,b,J,F),0===function Zh(){return mi.lFrame.elementDepthCount}()&&pl(J,b),function Jc(){mi.lFrame.elementDepthCount++}(),de&&(nb(A,b,F),ov(A,F,b)),null!==g&&zw(b,F),kh}function jd(){let a=Ho();Bm()?Vm():(a=a.parent,qa(a,!1));const u=a;(function q1(a){return mi.skipHydrationRootTNode===a})(u)&&function gy(){mi.skipHydrationRootTNode=null}(),function my(){mi.lFrame.elementDepthCount--}();const p=yo();return p.firstCreatePass&&(tu(p,a),od(a)&&p.queries.elementEnd(a)),null!=u.classesWithoutHost&&function ra(a){return 0!=(8&a.flags)}(u)&&jn(p,u,Tn(),u.classesWithoutHost,!0),null!=u.stylesWithoutHost&&function by(a){return 0!=(16&a.flags)}(u)&&jn(p,u,Tn(),u.stylesWithoutHost,!1),jd}function Gb(a,u,p,g){return kh(a,u,p,g),jd(),Gb}let Lh=(a,u,p,g,b,A)=>(ha(!0),Tx(g,b,function cd(){return mi.lFrame.currentNamespace}()));function Hb(a,u,p){const g=Tn(),b=yo(),A=a+hi,D=b.firstCreatePass?function GA(a,u,p,g,b){const A=u.consts,D=fl(A,g),O=Bp(u,a,8,"ng-container",D);return null!==D&&wh(O,D,!0),Ug(u,p,O,fl(A,b)),null!==u.queries&&u.queries.elementStart(u,O),O}(A,b,g,u,p):b.data[A];qa(D,!0);const O=b_(b,g,D,a);return g[A]=O,eu()&&wd(b,g,O,D),pl(O,g),sd(D)&&(nb(b,g,D),ov(b,D,g)),null!=p&&zw(g,D),Hb}function Nh(){let a=Ho();const u=yo();return Bm()?Vm():(a=a.parent,qa(a,!1)),u.firstCreatePass&&(tu(u,a),od(a)&&u.queries.elementEnd(a)),Nh}function Yv(a,u,p){return Hb(a,u,p),Nh(),Yv}let b_=(a,u,p,g)=>(ha(!0),yg(u[Y],""));function Wb(){return Tn()}const vu=void 0;var Yb=["en",[["a","p"],["AM","PM"],vu],[["AM","PM"],vu,vu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],vu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],vu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",vu,"{1} 'at' {0}",vu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function YS(a){const p=Math.floor(Math.abs(a)),g=a.toString().replace(/^[^.]*\.?/,"").length;return 1===p&&0===g?1:5}];let xu={};function Zv(a){const u=function pm(a){return a.toLowerCase().replace(/_/g,"-")}(a);let p=fm(u);if(p)return p;const g=u.split("-")[0];if(p=fm(g),p)return p;if("en"===g)return Yb;throw new Nn(701,!1)}function Xv(a){return Zv(a)[Uc.PluralCase]}function fm(a){return a in xu||(xu[a]=Se.ng&&Se.ng.common&&Se.ng.common.locales&&Se.ng.common.locales[a]),xu[a]}var Uc=function(a){return a[a.LocaleId=0]="LocaleId",a[a.DayPeriodsFormat=1]="DayPeriodsFormat",a[a.DayPeriodsStandalone=2]="DayPeriodsStandalone",a[a.DaysFormat=3]="DaysFormat",a[a.DaysStandalone=4]="DaysStandalone",a[a.MonthsFormat=5]="MonthsFormat",a[a.MonthsStandalone=6]="MonthsStandalone",a[a.Eras=7]="Eras",a[a.FirstDayOfWeek=8]="FirstDayOfWeek",a[a.WeekendRange=9]="WeekendRange",a[a.DateFormat=10]="DateFormat",a[a.TimeFormat=11]="TimeFormat",a[a.DateTimeFormat=12]="DateTimeFormat",a[a.NumberSymbols=13]="NumberSymbols",a[a.NumberFormats=14]="NumberFormats",a[a.CurrencyCode=15]="CurrencyCode",a[a.CurrencySymbol=16]="CurrencySymbol",a[a.CurrencyName=17]="CurrencyName",a[a.Currencies=18]="Currencies",a[a.Directionality=19]="Directionality",a[a.PluralCase=20]="PluralCase",a[a.ExtraData=21]="ExtraData",a}(Uc||{});const Hf="en-US";let gm=Hf;function a1(a){return!!a&&"function"==typeof a.then}function qE(a){return!!a&&"function"==typeof a.subscribe}function V_(a,u,p,g){const b=Tn(),A=yo(),D=Ho();return function c0(a,u,p,g,b,A,D){const O=sd(g),J=a.firstCreatePass&&Af(a),de=u[_i],we=zp(u);let Je=!0;if(3&g.type||D){const $n=tr(g,u),or=D?D($n):$n,wr=we.length,zn=D?zi=>D(Yo(zi[g.index])):g.index;let Li=null;if(!D&&O&&(Li=function YE(a,u,p,g){const b=a.cleanup;if(null!=b)for(let A=0;A<b.length-1;A+=2){const D=b[A];if(D===p&&b[A+1]===g){const O=u[sc],F=b[A+2];return O.length>F?O[F]:null}"string"==typeof D&&(A+=2)}return null}(a,u,b,g.index)),null!==Li)(Li.__ngLastListenerFn__||Li).__ngNextListenerFn__=A,Li.__ngLastListenerFn__=A,Je=!1;else{A=l1(g,u,de,A,!1);const zi=p.listen(or,b,A);we.push(A,zi),J&&J.push(b,zn,wr,wr+1)}}else A=l1(g,u,de,A,!1);const At=g.outputs;let mn;if(Je&&null!==At&&(mn=At[b])){const $n=mn.length;if($n)for(let or=0;or<$n;or+=2){const Do=u[mn[or]][mn[or+1]].subscribe(A),al=we.length;we.push(A,Do),J&&J.push(b,g.index,al,-(al+1))}}}(A,b,b[Y],D,a,u,g),V_}function u0(a,u,p,g){try{return ca(6,u,p),!1!==p(g)}catch(b){return Up(a,b),!1}finally{ca(7,u,p)}}function l1(a,u,p,g,b){return function A(D){if(D===Function)return g;Bu(a.componentOffset>-1?Ha(a.index,u):u);let F=u0(u,p,g,D),J=A.__ngNextListenerFn__;for(;J;)F=u0(u,p,J,D)&&F,J=J.__ngNextListenerFn__;return b&&!1===F&&D.preventDefault(),F}}function z_(a=1){return function Bn(a){return(mi.lFrame.contextLView=function Ec(a,u){for(;a>0;)u=u[Ge],a--;return u}(a,mi.lFrame.contextLView))[_i]}(a)}function c1(a,u){let p=null;const g=function Zc(a){const u=a.attrs;if(null!=u){const p=u.indexOf(5);if(!(1&p))return u[p+1]}return null}(a);for(let b=0;b<u.length;b++){const A=u[b];if("*"!==A){if(null===g?ic(a,A,!0):nd(g,A))return b}else p=b}return p}function bm(a){const u=Tn()[Mn][ws];if(!u.projection){const g=u.projection=ch(a?a.length:1,null),b=g.slice();let A=u.child;for(;null!==A;){const D=a?c1(A,a):0;null!==D&&(b[D]?b[D].projectionNext=A:g[D]=A,b[D]=A),A=A.next}}}function U_(a,u=0,p){const g=Tn(),b=yo(),A=Bp(b,hi+a,16,null,p||null);null===A.projection&&(A.projection=u),Vm(),(!g[ka]||ld())&&32!=(32&A.flags)&&function FT(a,u,p){mw(u[Y],0,u,p,Dp(a,p,u),jy(p.parent||u[ws],p,u))}(b,g,A)}function rI(a,u=""){const p=Tn(),g=yo(),b=a+hi,A=g.firstCreatePass?Bp(g,b,1,u,null):g.data[b],D=iI(g,p,A,u,a);p[b]=D,eu()&&wd(g,p,D,A),qa(A,!1)}let iI=(a,u,p,g,b)=>(ha(!0),function $y(a,u){return a.createText(u)}(u[Y],g));function p0(a){return m0("",a,""),p0}function m0(a,u,p){const g=Tn(),b=function Nc(a,u,p,g){return ks(a,Za(),p)?u+Tr(p)+g:Ni}(g,a,u,p);return b!==Ni&&function Nu(a,u,p){const g=Tu(u,a);!function hw(a,u,p){a.setValue(u,p)}(a[Y],g,p)}(g,Zt(),b),m0}function f1(a,u,p,g,b){if(a=cn(a),Array.isArray(a))for(let A=0;A<a.length;A++)f1(a[A],u,p,g,b);else{const A=yo(),D=Tn(),O=Ho();let F=yd(a)?a:cn(a.provide);const J=Ry(a),de=1048575&O.providerIndexes,we=O.directiveStart,Je=O.providerIndexes>>20;if(yd(a)||!a.multi){const At=new nf(J,b,Ad),mn=W_(F,u,b?de:de+Je,we);-1===mn?(Ty(Iy(O,D),A,F),H_(A,a,u.length),u.push(F),O.directiveStart++,O.directiveEnd++,b&&(O.providerIndexes+=1048576),p.push(At),D.push(At)):(p[mn]=At,D[mn]=At)}else{const At=W_(F,u,de+Je,we),mn=W_(F,u,de,de+Je),or=mn>=0&&p[mn];if(b&&!or||!b&&!(At>=0&&p[At])){Ty(Iy(O,D),A,F);const wr=function m1(a,u,p,g,b){const A=new nf(a,p,Ad);return A.multi=[],A.index=u,A.componentProviders=0,_C(A,b,g&&!p),A}(b?vc:p1,p.length,b,g,J);!b&&or&&(p[mn].providerFactory=wr),H_(A,a,u.length,0),u.push(F),O.directiveStart++,O.directiveEnd++,b&&(O.providerIndexes+=1048576),p.push(wr),D.push(wr)}else H_(A,a,At>-1?At:mn,_C(p[b?mn:At],J,!b&&g));!b&&g&&or&&p[mn].componentProviders++}}}function H_(a,u,p,g){const b=yd(u),A=function QC(a){return!!a.useClass}(u);if(b||A){const F=(A?cn(u.useClass):u).prototype.ngOnDestroy;if(F){const J=a.destroyHooks||(a.destroyHooks=[]);if(!b&&u.multi){const de=J.indexOf(p);-1===de?J.push(p,[g,F]):J[de+1].push(g,F)}else J.push(p,F)}}}function _C(a,u,p){return p&&a.componentProviders++,a.multi.push(u)-1}function W_(a,u,p,g){for(let b=p;b<g;b++)if(u[b]===a)return b;return-1}function p1(a,u,p,g){return q_(this.multi,[])}function vc(a,u,p,g){const b=this.multi;let A;if(this.providerFactory){const D=this.providerFactory.componentProviders,O=Au(p,p[Qn],this.providerFactory.index,g);A=O.slice(0,D),q_(b,A);for(let F=D;F<O.length;F++)A.push(O[F])}else A=[],q_(b,A);return A}function q_(a,u){for(let p=0;p<a.length;p++)u.push((0,a[p])());return u}function g0(a,u=[]){return p=>{p.providersResolver=(g,b)=>function gC(a,u,p){const g=yo();if(g.firstCreatePass){const b=ms(a);f1(p,g.data,g.blueprint,b,!0),f1(u,g.data,g.blueprint,b,!1)}}(g,b?b(a):a,u)}}class ed{}class Kf{}function g1(a,u){return new lI(a,null!=u?u:null,[])}class lI extends ed{constructor(u,p,g){super(),this._parent=p,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Jg(this);const b=oi(u);this._bootstrapComponents=dc(b.bootstrap),this._r3Injector=ni(u,p,[{provide:ed,useValue:this},{provide:Pw,useValue:this.componentFactoryResolver},...g],zt(u),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(u)}get injector(){return this._r3Injector}destroy(){const u=this._r3Injector;!u.destroyed&&u.destroy(),this.destroyCbs.forEach(p=>p()),this.destroyCbs=null}onDestroy(u){this.destroyCbs.push(u)}}class _1 extends Kf{constructor(u){super(),this.moduleType=u}create(u){return new lI(this.moduleType,u,[])}}class y1 extends ed{constructor(u){super(),this.componentFactoryResolver=new Jg(this),this.instance=null;const p=new ag([...u.providers,{provide:ed,useValue:this},{provide:Pw,useValue:this.componentFactoryResolver}],u.parent||hx(),u.debugName,new Set(["environment"]));this.injector=p,u.runEnvironmentInitializers&&p.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(u){this.injector.onDestroy(u)}}function _0(a,u,p=null){return new y1({providers:a,parent:u,debugName:p,runEnvironmentInitializers:!0}).injector}let v1=(()=>{var a;class u{constructor(g){this._injector=g,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(g){if(!g.standalone)return null;if(!this.cachedInjectors.has(g)){const b=ng(0,g.type),A=b.length>0?_0([b],this._injector,`Standalone[${g.type.name}]`):null;this.cachedInjectors.set(g,A)}return this.cachedInjectors.get(g)}ngOnDestroy(){try{for(const g of this.cachedInjectors.values())null!==g&&g.destroy()}finally{this.cachedInjectors.clear()}}}return(a=u).\u0275prov=Ei({token:a,providedIn:"environment",factory:()=>new a(N(Dc))}),u})();function y0(a){fc("NgStandalone"),a.getStandaloneInjector=u=>u.get(v1).getOrCreateStandaloneInjector(a)}function E1(a,u,p){const g=Ya()+a,b=Tn();return b[g]===Ni?hu(b,g,p?u.call(p):u()):function qp(a,u){return a[u]}(b,g)}function Y_(a,u,p,g,b){return function T1(a,u,p,g,b,A,D){const O=u+p;return ju(a,O,b,A)?hu(a,O+2,D?g.call(D,b,A):g(b,A)):Qf(a,O+2)}(Tn(),Ya(),a,u,p,g,b)}function Z_(a,u,p,g,b,A){return function AC(a,u,p,g,b,A,D,O){const F=u+p;return function wv(a,u,p,g,b){const A=ju(a,u,p,g);return ks(a,u+2,b)||A}(a,F,b,A,D)?hu(a,F+3,O?g.call(O,b,A,D):g(b,A,D)):Qf(a,F+3)}(Tn(),Ya(),a,u,p,g,b,A)}function Qf(a,u){const p=a[u];return p===Ni?void 0:p}function Jf(a,u){const p=yo();let g;const b=a+hi;var A;p.firstCreatePass?(g=function iD(a,u){if(u)for(let p=u.length-1;p>=0;p--){const g=u[p];if(a===g.name)return g}}(u,p.pipeRegistry),p.data[b]=g,g.onDestroy&&(null!==(A=p.destroyHooks)&&void 0!==A?A:p.destroyHooks=[]).push(b,g.onDestroy)):g=p.data[b];const D=g.factory||(g.factory=yi(g.type)),F=Br(Ad);try{const J=qm(!1),de=D();return qm(J),function h0(a,u,p,g){p>=a.data.length&&(a.data[p]=null,a.blueprint[p]=null),u[p]=g}(p,Tn(),b,de),de}finally{Br(F)}}function w0(a,u,p){const g=a+hi,b=Tn(),A=function lc(a,u){return a[u]}(b,g);return function bu(a,u){return a[Qn].data[u].pure}(b,g)?function K_(a,u,p,g,b,A){const D=u+p;return ks(a,D,b)?hu(a,D+1,A?g.call(A,b):g(b)):Qf(a,D+1)}(b,Ya(),u,A.transform,p,A):A.transform(p)}function I0(){return this._results[Symbol.iterator]()}class T0{get changes(){var u;return null!==(u=this._changes)&&void 0!==u?u:this._changes=new du}constructor(u=!1){this._emitDistinctChangesOnly=u,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const p=T0.prototype;p[Symbol.iterator]||(p[Symbol.iterator]=I0)}get(u){return this._results[u]}map(u){return this._results.map(u)}filter(u){return this._results.filter(u)}find(u){return this._results.find(u)}reduce(u,p){return this._results.reduce(u,p)}forEach(u){this._results.forEach(u)}some(u){return this._results.some(u)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(u,p){this.dirty=!1;const g=function Fl(a){return a.flat(Number.POSITIVE_INFINITY)}(u);(this._changesDetected=!function _p(a,u,p){if(a.length!==u.length)return!1;for(let g=0;g<a.length;g++){let b=a[g],A=u[g];if(p&&(b=p(b),A=p(A)),A!==b)return!1}return!0}(this._results,g,p))&&(this._results=g,this.length=g.length,this.last=g[this.length-1],this.first=g[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}let Dm=(()=>{class u{}return u.__NG_ELEMENT_ID__=sl,u})();const A1=Dm,gI=class extends A1{constructor(u,p,g){super(),this._declarationLView=u,this._declarationTContainer=p,this.elementRef=g}get ssrId(){var u;return(null===(u=this._declarationTContainer.tView)||void 0===u?void 0:u.ssrId)||null}createEmbeddedView(u,p){return this.createEmbeddedViewImpl(u,p)}createEmbeddedViewImpl(u,p,g){const b=c_(this._declarationLView,this._declarationTContainer,u,{injector:p,dehydratedView:g});return new Cf(b)}};function sl(){return J_(Ho(),Tn())}function J_(a,u){return 4&a.type?new gI(u,a,Jy(a,u)):null}class _I{constructor(u){this.queryList=u,this.matches=null}clone(){return new _I(this.queryList)}setDirty(){this.queryList.setDirty()}}class ey{constructor(u=[]){this.queries=u}createEmbeddedView(u){const p=u.queries;if(null!==p){const g=null!==u.contentQueries?u.contentQueries[0]:p.length,b=[];for(let A=0;A<g;A++){const D=p.getByIndex(A);b.push(this.queries[D.indexInDeclarationView].clone())}return new ey(b)}return null}insertView(u){this.dirtyQueriesWithMatches(u)}detachView(u){this.dirtyQueriesWithMatches(u)}dirtyQueriesWithMatches(u){for(let p=0;p<this.queries.length;p++)null!==RC(u,p).matches&&this.queries[p].setDirty()}}class A0{constructor(u,p,g=null){this.predicate=u,this.flags=p,this.read=g}}class C0{constructor(u=[]){this.queries=u}elementStart(u,p){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(u,p)}elementEnd(u){for(let p=0;p<this.queries.length;p++)this.queries[p].elementEnd(u)}embeddedTView(u){let p=null;for(let g=0;g<this.length;g++){const b=null!==p?p.length:0,A=this.getByIndex(g).embeddedTView(u,b);A&&(A.indexInDeclarationView=g,null!==p?p.push(A):p=[A])}return null!==p?new C0(p):null}template(u,p){for(let g=0;g<this.queries.length;g++)this.queries[g].template(u,p)}getByIndex(u){return this.queries[u]}get length(){return this.queries.length}track(u){this.queries.push(u)}}class yI{constructor(u,p=-1){this.metadata=u,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=p}elementStart(u,p){this.isApplyingToNode(p)&&this.matchTNode(u,p)}elementEnd(u){this._declarationNodeIndex===u.index&&(this._appliesToNextNode=!1)}template(u,p){this.elementStart(u,p)}embeddedTView(u,p){return this.isApplyingToNode(u)?(this.crossesNgTemplate=!0,this.addMatch(-u.index,p),new yI(this.metadata)):null}isApplyingToNode(u){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const p=this._declarationNodeIndex;let g=u.parent;for(;null!==g&&8&g.type&&g.index!==p;)g=g.parent;return p===(null!==g?g.index:-1)}return this._appliesToNextNode}matchTNode(u,p){const g=this.metadata.predicate;if(Array.isArray(g))for(let b=0;b<g.length;b++){const A=g[b];this.matchTNodeWithReadOption(u,p,vI(p,A)),this.matchTNodeWithReadOption(u,p,J0(p,u,A,!1,!1))}else g===Dm?4&p.type&&this.matchTNodeWithReadOption(u,p,-1):this.matchTNodeWithReadOption(u,p,J0(p,u,g,!1,!1))}matchTNodeWithReadOption(u,p,g){if(null!==g){const b=this.metadata.read;if(null!==b)if(b===Sg||b===d_||b===Dm&&4&p.type)this.addMatch(p.index,-2);else{const A=J0(p,u,b,!1,!1);null!==A&&this.addMatch(p.index,A)}else this.addMatch(p.index,g)}}addMatch(u,p){null===this.matches?this.matches=[u,p]:this.matches.push(u,p)}}function vI(a,u){const p=a.localNames;if(null!==p)for(let g=0;g<p.length;g+=2)if(p[g]===u)return p[g+1];return null}function xI(a,u,p,g){return-1===p?function C1(a,u){return 11&a.type?Jy(a,u):4&a.type?J_(a,u):null}(u,a):-2===p?function S0(a,u,p){return p===Sg?Jy(u,a):p===Dm?J_(u,a):p===d_?_u(u,a):void 0}(a,u,g):Au(a,a[Qn],p,u)}function Kd(a,u,p,g){const b=u[as].queries[g];if(null===b.matches){const A=a.data,D=p.matches,O=[];for(let F=0;F<D.length;F+=2){const J=D[F];O.push(J<0?null:xI(u,A[J],D[F+1],p.metadata.read))}b.matches=O}return b.matches}function Al(a,u,p,g){const b=a.queries.getByIndex(p),A=b.matches;if(null!==A){const D=Kd(a,u,b,p);for(let O=0;O<A.length;O+=2){const F=A[O];if(F>0)g.push(D[O/2]);else{const J=A[O+1],de=u[-F];for(let we=Bo;we<de.length;we++){const Je=de[we];Je[Nr]===Je[jo]&&Al(Je[Qn],Je,J,g)}if(null!==de[Vt]){const we=de[Vt];for(let Je=0;Je<we.length;Je++){const At=we[Je];Al(At[Qn],At,J,g)}}}}}return g}function D0(a){const u=Tn(),p=yo(),g=vy();pp(g+1);const b=RC(p,g);if(a.dirty&&function H0(a){return 4==(4&a[$r])}(u)===(2==(2&b.metadata.flags))){if(null===b.matches)a.reset([]);else{const A=b.crossesNgTemplate?Al(p,u,g,[]):Kd(p,u,b,g);a.reset(A,$D),a.notifyOnChanges()}return!0}return!1}function DC(a,u,p){const g=yo();g.firstCreatePass&&(MC(g,new A0(a,u,p),-1),2==(2&u)&&(g.staticViewQueries=!0)),ty(g,Tn(),u)}function bI(a,u,p,g){const b=yo();if(b.firstCreatePass){const A=Ho();MC(b,new A0(u,p,g),A.index),function M0(a,u){const p=a.contentQueries||(a.contentQueries=[]);u!==(p.length?p[p.length-1]:-1)&&p.push(a.queries.length-1,u)}(b,a),2==(2&p)&&(b.staticContentQueries=!0)}ty(b,Tn(),p)}function wI(){return function oD(a,u){return a[as].queries[u].queryList}(Tn(),vy())}function ty(a,u,p){const g=new T0(4==(4&p));(function zg(a,u,p,g){const b=zp(u);b.push(p),a.firstCreatePass&&Af(a).push(g,b.length-1)})(a,u,g,g.destroy),null===u[as]&&(u[as]=new ey),u[as].queries.push(new _I(g))}function MC(a,u,p){null===a.queries&&(a.queries=new C0),a.queries.track(new yI(u,p))}function RC(a,u){return a.queries.getByIndex(u)}class y{constructor(u){this.full=u;const p=u.split(".");this.major=p[0],this.minor=p[1],this.patch=p.slice(2).join(".")}}const v=new y("17.0.8");let I=(()=>{var a;class u{log(g){console.log(g)}warn(g){console.warn(g)}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"platform"}),u})();class C{constructor(u,p){this.ngModuleFactory=u,this.componentFactories=p}}let S=(()=>{var a;class u{compileModuleSync(g){return new _1(g)}compileModuleAsync(g){return Promise.resolve(this.compileModuleSync(g))}compileModuleAndAllComponentsSync(g){const b=this.compileModuleSync(g),D=dc(oi(g).declarations).reduce((O,F)=>{const J=di(F);return J&&O.push(new Md(J)),O},[]);return new C(b,D)}compileModuleAndAllComponentsAsync(g){return Promise.resolve(this.compileModuleAndAllComponentsSync(g))}clearCache(){}clearCacheFor(g){}getModuleId(g){}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})(),R=(()=>{var a;class u{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ue.X(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const g=this.taskId++;return this.pendingTasks.add(g),g}remove(g){this.pendingTasks.delete(g),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})();const Ci=new re(""),Zr=new re("");let ci,zr=(()=>{var a;class u{constructor(g,b,A){this._ngZone=g,this.registry=b,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ci||(function Dr(a){ci=a}(A),A.addToWindow(b)),this._watchAngularEvents(),g.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ya.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let g=this._callbacks.pop();clearTimeout(g.timeoutId),g.doneCb(this._didWork)}this._didWork=!1});else{let g=this.getPendingTasks();this._callbacks=this._callbacks.filter(b=>!b.updateCb||!b.updateCb(g)||(clearTimeout(b.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(g=>({source:g.source,creationLocation:g.creationLocation,data:g.data})):[]}addCallback(g,b,A){let D=-1;b&&b>0&&(D=setTimeout(()=>{this._callbacks=this._callbacks.filter(O=>O.timeoutId!==D),g(this._didWork,this.getPendingTasks())},b)),this._callbacks.push({doneCb:g,timeoutId:D,updateCb:A})}whenStable(g,b,A){if(A&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(g,b,A),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(g){this.registry.registerApplication(g,this)}unregisterApplication(g){this.registry.unregisterApplication(g)}findProviders(g,b,A){return[]}}return(a=u).\u0275fac=function(g){return new(g||a)(N(ya),N(Pr),N(Zr))},a.\u0275prov=Ei({token:a,factory:a.\u0275fac}),u})(),Pr=(()=>{var a;class u{constructor(){this._applications=new Map}registerApplication(g,b){this._applications.set(g,b)}unregisterApplication(g){this._applications.delete(g)}unregisterAllApplications(){this._applications.clear()}getTestability(g){return this._applications.get(g)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(g,b=!0){var A,D;return null!==(A=null===(D=ci)||void 0===D?void 0:D.findTestabilityInTree(this,g,b))&&void 0!==A?A:null}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"platform"}),u})();const Pi=new re("Application Initializer");let Jr=(()=>{var a;class u{constructor(){var g;this.initialized=!1,this.done=!1,this.donePromise=new Promise((b,A)=>{this.resolve=b,this.reject=A}),this.appInits=null!==(g=K(Pi,{optional:!0}))&&void 0!==g?g:[]}runInitializers(){if(this.initialized)return;const g=[];for(const A of this.appInits){const D=A();if(a1(D))g.push(D);else if(qE(D)){const O=new Promise((F,J)=>{D.subscribe({complete:F,error:J})});g.push(O)}}const b=()=>{this.done=!0,this.resolve()};Promise.all(g).then(()=>{b()}).catch(A=>{this.reject(A)}),0===g.length&&b(),this.initialized=!0}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})();const Xi=new re("appBootstrapListener");function co(a,u){return Array.isArray(u)?u.reduce(co,a):{...a,...u}}let la=(()=>{var a;class u{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=K(Jx),this.componentTypes=[],this.components=[],this.isStable=K(R).hasPendingTasks.pipe((0,ye.U)(g=>!g)),this._injector=K(Dc)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(g,b){const A=g instanceof xf;if(!this._injector.get(Jr).done)throw!A&&is(g),new Nn(405,!1);let O;O=A?g:this._injector.get(Pw).resolveComponentFactory(g),this.componentTypes.push(O.componentType);const F=function Ns(a){return a.isBoundToModule}(O)?void 0:this._injector.get(ed),de=O.create(Os.NULL,[],b||O.selector,F),we=de.location.nativeElement,Je=de.injector.get(Ci,null);return null==Je||Je.registerApplication(we),de.onDestroy(()=>{this.detachView(de.hostView),jc(this.components,de),null==Je||Je.unregisterApplication(we)}),this._loadComponent(de),de}tick(){if(this._runningTick)throw new Nn(101,!1);try{this._runningTick=!0;for(let g of this._views)g.detectChanges()}catch(g){this.internalErrorHandler(g)}finally{this._runningTick=!1}}attachView(g){const b=g;this._views.push(b),b.attachToAppRef(this)}detachView(g){const b=g;jc(this._views,b),b.detachFromAppRef()}_loadComponent(g){this.attachView(g.hostView),this.tick(),this.components.push(g);const b=this._injector.get(Xi,[]);[...this._bootstrapListeners,...b].forEach(A=>A(g))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(g=>g()),this._views.slice().forEach(g=>g.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(g){return this._destroyListeners.push(g),()=>jc(this._destroyListeners,g)}destroy(){if(this._destroyed)throw new Nn(406,!1);const g=this._injector;g.destroy&&!g.destroyed&&g.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})();function jc(a,u){const p=a.indexOf(u);p>-1&&a.splice(p,1)}let L0=(()=>{var a;class u{constructor(){this.zone=K(ya),this.applicationRef=K(la)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){var g;null===(g=this._onMicrotaskEmptySubscription)||void 0===g||g.unsubscribe()}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})();function NI(){const a=K(ya),u=K(Td);return p=>a.runOutsideAngular(()=>u.handleError(p))}let BI=(()=>{var a;class u{constructor(){this.subscription=new qe.w0,this.initialized=!1,this.zone=K(ya),this.pendingTasks=K(R)}initialize(){if(this.initialized)return;this.initialized=!0;let g=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(g=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ya.assertNotInAngularZone(),queueMicrotask(()=>{null!==g&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(g),g=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{var b;ya.assertInAngularZone(),null!==(b=g)&&void 0!==b||(g=this.pendingTasks.add())}))}ngOnDestroy(){this.subscription.unsubscribe()}}return(a=u).\u0275fac=function(g){return new(g||a)},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"root"}),u})();const rp=new re("LocaleId",{providedIn:"root",factory:()=>K(rp,pi.Optional|pi.SkipSelf)||function VI(){return typeof $localize<"u"&&$localize.locale||Hf}()}),uo=new re("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"}),jh=new re("PlatformDestroyListeners");let Ua=(()=>{var a;class u{constructor(g){this._injector=g,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(g,b){const A=function mv(a="zone.js",u){return"noop"===a?new Xg:"zone.js"===a?new ya(u):a}(null==b?void 0:b.ngZone,function FI(a){var u,p;return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:null!==(u=null==a?void 0:a.eventCoalescing)&&void 0!==u&&u,shouldCoalesceRunChangeDetection:null!==(p=null==a?void 0:a.runCoalescing)&&void 0!==p&&p}}({eventCoalescing:null==b?void 0:b.ngZoneEventCoalescing,runCoalescing:null==b?void 0:b.ngZoneRunCoalescing}));return A.run(()=>{const D=function tD(a,u,p){return new lI(a,u,p)}(g.moduleType,this.injector,function N1(a){return[{provide:ya,useFactory:a},{provide:Sc,multi:!0,useFactory:()=>{const u=K(L0,{optional:!0});return()=>u.initialize()}},{provide:Sc,multi:!0,useFactory:()=>{const u=K(BI);return()=>{u.initialize()}}},{provide:Jx,useFactory:NI}]}(()=>A)),O=D.injector.get(Td,null);return A.runOutsideAngular(()=>{const F=A.onError.subscribe({next:J=>{O.handleError(J)}});D.onDestroy(()=>{jc(this._modules,D),F.unsubscribe()})}),function qo(a,u,p){try{const g=p();return a1(g)?g.catch(b=>{throw u.runOutsideAngular(()=>a.handleError(b)),b}):g}catch(g){throw u.runOutsideAngular(()=>a.handleError(g)),g}}(O,A,()=>{const F=D.injector.get(Jr);return F.runInitializers(),F.donePromise.then(()=>(function Qv(a){wi(a,"Expected localeId to be defined"),"string"==typeof a&&(gm=a.toLowerCase().replace(/_/g,"-"))}(D.injector.get(rp,Hf)||Hf),this._moduleDoBootstrap(D),D))})})}bootstrapModule(g,b=[]){const A=co({},b);return function vo(a,u,p){const g=new _1(p);return Promise.resolve(g)}(0,0,g).then(D=>this.bootstrapModuleFactory(D,A))}_moduleDoBootstrap(g){const b=g.injector.get(la);if(g._bootstrapComponents.length>0)g._bootstrapComponents.forEach(A=>b.bootstrap(A));else{if(!g.instance.ngDoBootstrap)throw new Nn(-403,!1);g.instance.ngDoBootstrap(b)}this._modules.push(g)}onDestroy(g){this._destroyListeners.push(g)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Nn(404,!1);this._modules.slice().forEach(b=>b.destroy()),this._destroyListeners.forEach(b=>b());const g=this._injector.get(jh,null);g&&(g.forEach(b=>b()),g.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(a=u).\u0275fac=function(g){return new(g||a)(N(Os))},a.\u0275prov=Ei({token:a,factory:a.\u0275fac,providedIn:"platform"}),u})(),Jo=null;const Hc=new re("AllowMultipleToken");function UI(a,u,p=[]){const g=`Platform: ${u}`,b=new re(g);return(A=[])=>{let D=Sl();if(!D||D.injector.get(Hc,!1)){const O=[...p,...A,{provide:b,useValue:!0}];a?a(O):function Om(a){if(Jo&&!Jo.get(Hc,!1))throw new Nn(400,!1);(function xo(){!function _n(a){Un=a}(()=>{throw new Nn(600,!1)})})(),Jo=a;const u=a.get(Ua);(function ip(a){const u=a.get(df,null);null==u||u.forEach(p=>p())})(a)}(function UC(a=[],u){return Os.create({name:u,providers:[{provide:sg,useValue:"platform"},{provide:jh,useValue:new Set([()=>Jo=null])},...a]})}(O,g))}return function Wc(a){const u=Sl();if(!u)throw new Nn(401,!1);return u}()}}function Sl(){var a,u;return null!==(a=null===(u=Jo)||void 0===u?void 0:u.get(Ua))&&void 0!==a?a:null}function BM(){return!1}function Zs(){}const JD=UI(null,"core",[]);let eM=(()=>{var a;class u{constructor(g){}}return(a=u).\u0275fac=function(g){return new(g||a)(N(la))},a.\u0275mod=ql({type:a}),a.\u0275inj=es({}),u})();function oR(a){return"boolean"==typeof a?a:null!=a&&"false"!==a}function MM(a,u){const p=di(a),g=u.elementInjector||hx();return new Md(p).create(g,u.projectableNodes,u.hostElement,u.environmentInjector)}function RM(a){const u=di(a);if(!u)return null;const p=new Md(u);return{get selector(){return p.selector},get type(){return p.componentType},get inputs(){return p.inputs},get outputs(){return p.outputs},get ngContentSelectors(){return p.ngContentSelectors},get isStandalone(){return u.standalone},get isSignal(){return u.signals}}}},95:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{u5:()=>_i,Fd:()=>ea,qQ:()=>bc,Cf:()=>Ft,JU:()=>gt,a5:()=>In,JJ:()=>Dn,On:()=>Kn});var E=ae(9212),he=ae(6814),at=ae(2459),Ie=ae(5592),ge=ae(7453),Ve=ae(4829),Le=ae(9940),Be=ae(8251),ze=ae(7400),wt=ae(2714),vt=ae(7398);let Mt=(()=>{var se;class Y{constructor(le,Ge){this._renderer=le,this._elementRef=Ge,this.onChange=Mn=>{},this.onTouched=()=>{}}setProperty(le,Ge){this._renderer.setProperty(this._elementRef.nativeElement,le,Ge)}registerOnTouched(le){this.onTouched=le}registerOnChange(le){this.onChange=le}setDisabledState(le){this.setProperty("disabled",le)}}return(se=Y).\u0275fac=function(le){return new(le||se)(E.Y36(E.Qsj),E.Y36(E.SBq))},se.\u0275dir=E.lG2({type:se}),Y})(),xt=(()=>{var se;class Y extends Mt{}return(se=Y).\u0275fac=(()=>{let Re;return function(Ge){return(Re||(Re=E.n5z(se)))(Ge||se)}})(),se.\u0275dir=E.lG2({type:se,features:[E.qOj]}),Y})();const gt=new E.OlP("NgValueAccessor"),Rt={provide:gt,useExisting:(0,E.Gpc)(()=>lt),multi:!0},hn=new E.OlP("CompositionEventMode");let lt=(()=>{var se;class Y extends Mt{constructor(le,Ge,Mn){super(le,Ge),this._compositionMode=Mn,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Pt(){const se=(0,he.q)()?(0,he.q)().getUserAgent():"";return/android (\d+)/.test(se.toLowerCase())}())}writeValue(le){this.setProperty("value",null==le?"":le)}_handleInput(le){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(le)}_compositionStart(){this._composing=!0}_compositionEnd(le){this._composing=!1,this._compositionMode&&this.onChange(le)}}return(se=Y).\u0275fac=function(le){return new(le||se)(E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(hn,8))},se.\u0275dir=E.lG2({type:se,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(le,Ge){1&le&&E.NdJ("input",function(Nr){return Ge._handleInput(Nr.target.value)})("blur",function(){return Ge.onTouched()})("compositionstart",function(){return Ge._compositionStart()})("compositionend",function(Nr){return Ge._compositionEnd(Nr.target.value)})},features:[E._Bn([Rt]),E.qOj]}),Y})();function me(se){return null==se||("string"==typeof se||Array.isArray(se))&&0===se.length}const Ft=new E.OlP("NgValidators"),Te=new E.OlP("NgAsyncValidators");function yt(se){return null}function Xe(se){return null!=se}function tt(se){return(0,E.QGY)(se)?(0,at.D)(se):se}function Ye(se){let Y={};return se.forEach(Re=>{Y=null!=Re?{...Y,...Re}:Y}),0===Object.keys(Y).length?null:Y}function _t(se,Y){return Y.map(Re=>Re(se))}function Gn(se){return se.map(Y=>function rn(se){return!se.validate}(Y)?Y:Re=>Y.validate(Re))}function Hn(se){return null!=se?function rr(se){if(!se)return null;const Y=se.filter(Xe);return 0==Y.length?null:function(Re){return Ye(_t(Re,Y))}}(Gn(se)):null}function gr(se){return null!=se?function mr(se){if(!se)return null;const Y=se.filter(Xe);return 0==Y.length?null:function(Re){return function Ue(...se){const Y=(0,Le.jO)(se),{args:Re,keys:le}=(0,ge.D)(se),Ge=new Ie.y(Mn=>{const{length:Nr}=Re;if(!Nr)return void Mn.complete();const Fo=new Array(Nr);let as=Nr,ul=Nr;for(let dl=0;dl<Nr;dl++){let Pl=!1;(0,Ve.Xf)(Re[dl]).subscribe((0,Be.x)(Mn,wc=>{Pl||(Pl=!0,ul--),Fo[dl]=wc},()=>as--,void 0,()=>{(!as||!Pl)&&(ul||Mn.next(le?(0,wt.n)(le,Fo):Fo),Mn.complete())}))}});return Y?Ge.pipe((0,ze.Z)(Y)):Ge}(_t(Re,Y).map(tt)).pipe((0,vt.U)(Ye))}}(Gn(se)):null}function ei(se,Y){return null===se?[Y]:Array.isArray(se)?[...se,Y]:[se,Y]}function ue(se){return se?Array.isArray(se)?se:[se]:[]}function ye(se,Y){return Array.isArray(se)?se.includes(Y):se===Y}function Me(se,Y){const Re=ue(Y);return ue(se).forEach(Ge=>{ye(Re,Ge)||Re.push(Ge)}),Re}function Bt(se,Y){return ue(Y).filter(Re=>!ye(se,Re))}class zt{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(Y){this._rawValidators=Y||[],this._composedValidatorFn=Hn(this._rawValidators)}_setAsyncValidators(Y){this._rawAsyncValidators=Y||[],this._composedAsyncValidatorFn=gr(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(Y){this._onDestroyCallbacks.push(Y)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(Y=>Y()),this._onDestroyCallbacks=[]}reset(Y=void 0){this.control&&this.control.reset(Y)}hasError(Y,Re){return!!this.control&&this.control.hasError(Y,Re)}getError(Y,Re){return this.control?this.control.getError(Y,Re):null}}class nn extends zt{get formDirective(){return null}get path(){return null}}class In extends zt{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Xt{constructor(Y){this._cd=Y}get isTouched(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.touched)}get isUntouched(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.untouched)}get isPristine(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.pristine)}get isDirty(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.dirty)}get isValid(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.valid)}get isInvalid(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.invalid)}get isPending(){var Y;return!(null===(Y=this._cd)||void 0===Y||null===(Y=Y.control)||void 0===Y||!Y.pending)}get isSubmitted(){var Y;return!(null===(Y=this._cd)||void 0===Y||!Y.submitted)}}let Dn=(()=>{var se;class Y extends Xt{constructor(le){super(le)}}return(se=Y).\u0275fac=function(le){return new(le||se)(E.Y36(In,2))},se.\u0275dir=E.lG2({type:se,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(le,Ge){2&le&&E.ekj("ng-untouched",Ge.isUntouched)("ng-touched",Ge.isTouched)("ng-pristine",Ge.isPristine)("ng-dirty",Ge.isDirty)("ng-valid",Ge.isValid)("ng-invalid",Ge.isInvalid)("ng-pending",Ge.isPending)},features:[E.qOj]}),Y})();const vn="VALID",En="INVALID",xn="PENDING",Ln="DISABLED";function Nt(se){return null!=se&&!Array.isArray(se)&&"object"==typeof se}class cr{constructor(Y,Re){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(Y),this._assignAsyncValidators(Re)}get validator(){return this._composedValidatorFn}set validator(Y){this._rawValidators=this._composedValidatorFn=Y}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(Y){this._rawAsyncValidators=this._composedAsyncValidatorFn=Y}get parent(){return this._parent}get valid(){return this.status===vn}get invalid(){return this.status===En}get pending(){return this.status==xn}get disabled(){return this.status===Ln}get enabled(){return this.status!==Ln}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(Y){this._assignValidators(Y)}setAsyncValidators(Y){this._assignAsyncValidators(Y)}addValidators(Y){this.setValidators(Me(Y,this._rawValidators))}addAsyncValidators(Y){this.setAsyncValidators(Me(Y,this._rawAsyncValidators))}removeValidators(Y){this.setValidators(Bt(Y,this._rawValidators))}removeAsyncValidators(Y){this.setAsyncValidators(Bt(Y,this._rawAsyncValidators))}hasValidator(Y){return ye(this._rawValidators,Y)}hasAsyncValidator(Y){return ye(this._rawAsyncValidators,Y)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(Y={}){this.touched=!0,this._parent&&!Y.onlySelf&&this._parent.markAsTouched(Y)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(Y=>Y.markAllAsTouched())}markAsUntouched(Y={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(Re=>{Re.markAsUntouched({onlySelf:!0})}),this._parent&&!Y.onlySelf&&this._parent._updateTouched(Y)}markAsDirty(Y={}){this.pristine=!1,this._parent&&!Y.onlySelf&&this._parent.markAsDirty(Y)}markAsPristine(Y={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(Re=>{Re.markAsPristine({onlySelf:!0})}),this._parent&&!Y.onlySelf&&this._parent._updatePristine(Y)}markAsPending(Y={}){this.status=xn,!1!==Y.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!Y.onlySelf&&this._parent.markAsPending(Y)}disable(Y={}){const Re=this._parentMarkedDirty(Y.onlySelf);this.status=Ln,this.errors=null,this._forEachChild(le=>{le.disable({...Y,onlySelf:!0})}),this._updateValue(),!1!==Y.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...Y,skipPristineCheck:Re}),this._onDisabledChange.forEach(le=>le(!0))}enable(Y={}){const Re=this._parentMarkedDirty(Y.onlySelf);this.status=vn,this._forEachChild(le=>{le.enable({...Y,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:Y.emitEvent}),this._updateAncestors({...Y,skipPristineCheck:Re}),this._onDisabledChange.forEach(le=>le(!1))}_updateAncestors(Y){this._parent&&!Y.onlySelf&&(this._parent.updateValueAndValidity(Y),Y.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(Y){this._parent=Y}getRawValue(){return this.value}updateValueAndValidity(Y={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===vn||this.status===xn)&&this._runAsyncValidator(Y.emitEvent)),!1!==Y.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!Y.onlySelf&&this._parent.updateValueAndValidity(Y)}_updateTreeValidity(Y={emitEvent:!0}){this._forEachChild(Re=>Re._updateTreeValidity(Y)),this.updateValueAndValidity({onlySelf:!0,emitEvent:Y.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ln:vn}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(Y){if(this.asyncValidator){this.status=xn,this._hasOwnPendingAsyncValidator=!0;const Re=tt(this.asyncValidator(this));this._asyncValidationSubscription=Re.subscribe(le=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(le,{emitEvent:Y})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(Y,Re={}){this.errors=Y,this._updateControlsErrors(!1!==Re.emitEvent)}get(Y){let Re=Y;return null==Re||(Array.isArray(Re)||(Re=Re.split(".")),0===Re.length)?null:Re.reduce((le,Ge)=>le&&le._find(Ge),this)}getError(Y,Re){const le=Re?this.get(Re):this;return le&&le.errors?le.errors[Y]:null}hasError(Y,Re){return!!this.getError(Y,Re)}get root(){let Y=this;for(;Y._parent;)Y=Y._parent;return Y}_updateControlsErrors(Y){this.status=this._calculateStatus(),Y&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(Y)}_initObservables(){this.valueChanges=new E.vpe,this.statusChanges=new E.vpe}_calculateStatus(){return this._allControlsDisabled()?Ln:this.errors?En:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(xn)?xn:this._anyControlsHaveStatus(En)?En:vn}_anyControlsHaveStatus(Y){return this._anyControls(Re=>Re.status===Y)}_anyControlsDirty(){return this._anyControls(Y=>Y.dirty)}_anyControlsTouched(){return this._anyControls(Y=>Y.touched)}_updatePristine(Y={}){this.pristine=!this._anyControlsDirty(),this._parent&&!Y.onlySelf&&this._parent._updatePristine(Y)}_updateTouched(Y={}){this.touched=this._anyControlsTouched(),this._parent&&!Y.onlySelf&&this._parent._updateTouched(Y)}_registerOnCollectionChange(Y){this._onCollectionChange=Y}_setUpdateStrategy(Y){Nt(Y)&&null!=Y.updateOn&&(this._updateOn=Y.updateOn)}_parentMarkedDirty(Y){return!Y&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(Y){return null}_assignValidators(Y){this._rawValidators=Array.isArray(Y)?Y.slice():Y,this._composedValidatorFn=function Ke(se){return Array.isArray(se)?Hn(se):se||null}(this._rawValidators)}_assignAsyncValidators(Y){this._rawAsyncValidators=Array.isArray(Y)?Y.slice():Y,this._composedAsyncValidatorFn=function rt(se){return Array.isArray(se)?gr(se):se||null}(this._rawAsyncValidators)}}const ho=new E.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>vs}),vs="always";function Ei(se,Y,Re=vs){var le,Ge;(function fo(se,Y){const Re=function An(se){return se._rawValidators}(se);null!==Y.validator?se.setValidators(ei(Re,Y.validator)):"function"==typeof Re&&se.setValidators([Re]);const le=function qe(se){return se._rawAsyncValidators}(se);null!==Y.asyncValidator?se.setAsyncValidators(ei(le,Y.asyncValidator)):"function"==typeof le&&se.setAsyncValidators([le]);const Ge=()=>se.updateValueAndValidity();es(Y._rawValidators,Ge),es(Y._rawAsyncValidators,Ge)})(se,Y),Y.valueAccessor.writeValue(se.value),(se.disabled||"always"===Re)&&(null===(le=(Ge=Y.valueAccessor).setDisabledState)||void 0===le||le.call(Ge,se.disabled)),function Fs(se,Y){Y.valueAccessor.registerOnChange(Re=>{se._pendingValue=Re,se._pendingChange=!0,se._pendingDirty=!0,"change"===se.updateOn&&po(se,Y)})}(se,Y),function ti(se,Y){const Re=(le,Ge)=>{Y.valueAccessor.writeValue(le),Ge&&Y.viewToModelUpdate(le)};se.registerOnChange(Re),Y._registerOnDestroy(()=>{se._unregisterOnChange(Re)})}(se,Y),function ns(se,Y){Y.valueAccessor.registerOnTouched(()=>{se._pendingTouched=!0,"blur"===se.updateOn&&se._pendingChange&&po(se,Y),"submit"!==se.updateOn&&se.markAsTouched()})}(se,Y),function ts(se,Y){if(Y.valueAccessor.setDisabledState){const Re=le=>{Y.valueAccessor.setDisabledState(le)};se.registerOnDisabledChange(Re),Y._registerOnDestroy(()=>{se._unregisterOnDisabledChange(Re)})}}(se,Y)}function es(se,Y){se.forEach(Re=>{Re.registerOnValidatorChange&&Re.registerOnValidatorChange(Y)})}function po(se,Y){se._pendingDirty&&se.markAsDirty(),se.setValue(se._pendingValue,{emitModelToViewChange:!1}),Y.viewToModelUpdate(se._pendingValue),se._pendingChange=!1}function Ct(se,Y){const Re=se.indexOf(Y);Re>-1&&se.splice(Re,1)}function Qt(se){return"object"==typeof se&&null!==se&&2===Object.keys(se).length&&"value"in se&&"disabled"in se}const q=class extends cr{constructor(Y=null,Re,le){super(function ht(se){return(Nt(se)?se.validators:se)||null}(Re),function ot(se,Y){return(Nt(Y)?Y.asyncValidators:se)||null}(le,Re)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(Y),this._setUpdateStrategy(Re),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Nt(Re)&&(Re.nonNullable||Re.initialValueIsDefault)&&(this.defaultValue=Qt(Y)?Y.value:Y)}setValue(Y,Re={}){this.value=this._pendingValue=Y,this._onChange.length&&!1!==Re.emitModelToViewChange&&this._onChange.forEach(le=>le(this.value,!1!==Re.emitViewToModelChange)),this.updateValueAndValidity(Re)}patchValue(Y,Re={}){this.setValue(Y,Re)}reset(Y=this.defaultValue,Re={}){this._applyFormState(Y),this.markAsPristine(Re),this.markAsUntouched(Re),this.setValue(this.value,Re),this._pendingChange=!1}_updateValue(){}_anyControls(Y){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(Y){this._onChange.push(Y)}_unregisterOnChange(Y){Ct(this._onChange,Y)}registerOnDisabledChange(Y){this._onDisabledChange.push(Y)}_unregisterOnDisabledChange(Y){Ct(this._onDisabledChange,Y)}_forEachChild(Y){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(Y){Qt(Y)?(this.value=this._pendingValue=Y.value,Y.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=Y}},kt={provide:In,useExisting:(0,E.Gpc)(()=>Kn)},wn=(()=>Promise.resolve())();let Kn=(()=>{var se;class Y extends In{constructor(le,Ge,Mn,Nr,Fo,as){super(),this._changeDetectorRef=Fo,this.callSetDisabledState=as,this.control=new q,this._registered=!1,this.name="",this.update=new E.vpe,this._parent=le,this._setValidators(Ge),this._setAsyncValidators(Mn),this.valueAccessor=function Ze(se,Y){if(!Y)return null;let Re,le,Ge;return Array.isArray(Y),Y.forEach(Mn=>{Mn.constructor===lt?Re=Mn:function Se(se){return Object.getPrototypeOf(se.constructor)===xt}(Mn)?le=Mn:Ge=Mn}),Ge||le||Re||null}(0,Nr)}ngOnChanges(le){if(this._checkForErrors(),!this._registered||"name"in le){if(this._registered&&(this._checkName(),this.formDirective)){const Ge=le.name.previousValue;this.formDirective.removeControl({name:Ge,path:this._getPath(Ge)})}this._setUpControl()}"isDisabled"in le&&this._updateDisabled(le),function Vs(se,Y){if(!se.hasOwnProperty("model"))return!1;const Re=se.model;return!!Re.isFirstChange()||!Object.is(Y,Re.currentValue)}(le,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(le){this.viewModel=le,this.update.emit(le)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ei(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(le){wn.then(()=>{var Ge;this.control.setValue(le,{emitViewToModelChange:!1}),null===(Ge=this._changeDetectorRef)||void 0===Ge||Ge.markForCheck()})}_updateDisabled(le){const Ge=le.isDisabled.currentValue,Mn=0!==Ge&&(0,E.VuI)(Ge);wn.then(()=>{var Nr;Mn&&!this.control.disabled?this.control.disable():!Mn&&this.control.disabled&&this.control.enable(),null===(Nr=this._changeDetectorRef)||void 0===Nr||Nr.markForCheck()})}_getPath(le){return this._parent?function cs(se,Y){return[...Y.path,se]}(le,this._parent):[le]}}return(se=Y).\u0275fac=function(le){return new(le||se)(E.Y36(nn,9),E.Y36(Ft,10),E.Y36(Te,10),E.Y36(gt,10),E.Y36(E.sBO,8),E.Y36(ho,8))},se.\u0275dir=E.lG2({type:se,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[E._Bn([kt]),E.qOj,E.TTD]}),Y})(),K=(()=>{var se;class Y{}return(se=Y).\u0275fac=function(le){return new(le||se)},se.\u0275mod=E.oAB({type:se}),se.\u0275inj=E.cJS({}),Y})();function nd(se){return"number"==typeof se?se:parseFloat(se)}let Ml=(()=>{var se;class Y{constructor(){this._validator=yt}ngOnChanges(le){if(this.inputName in le){const Ge=this.normalizeInput(le[this.inputName].currentValue);this._enabled=this.enabled(Ge),this._validator=this._enabled?this.createValidator(Ge):yt,this._onChange&&this._onChange()}}validate(le){return this._validator(le)}registerOnValidatorChange(le){this._onChange=le}enabled(le){return null!=le}}return(se=Y).\u0275fac=function(le){return new(le||se)},se.\u0275dir=E.lG2({type:se,features:[E.TTD]}),Y})();const Us={provide:Ft,useExisting:(0,E.Gpc)(()=>ea),multi:!0};let ea=(()=>{var se;class Y extends Ml{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=le=>nd(le),this.createValidator=le=>function Gt(se){return Y=>{if(me(Y.value)||me(se))return null;const Re=parseFloat(Y.value);return!isNaN(Re)&&Re>se?{max:{max:se,actual:Y.value}}:null}}(le)}}return(se=Y).\u0275fac=(()=>{let Re;return function(Ge){return(Re||(Re=E.n5z(se)))(Ge||se)}})(),se.\u0275dir=E.lG2({type:se,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(le,Ge){2&le&&E.uIk("max",Ge._enabled?Ge.max:null)},inputs:{max:"max"},features:[E._Bn([Us]),E.qOj]}),Y})();const dy={provide:Ft,useExisting:(0,E.Gpc)(()=>bc),multi:!0};let bc=(()=>{var se;class Y extends Ml{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=le=>nd(le),this.createValidator=le=>function mt(se){return Y=>{if(me(Y.value)||me(se))return null;const Re=parseFloat(Y.value);return!isNaN(Re)&&Re<se?{min:{min:se,actual:Y.value}}:null}}(le)}}return(se=Y).\u0275fac=(()=>{let Re;return function(Ge){return(Re||(Re=E.n5z(se)))(Ge||se)}})(),se.\u0275dir=E.lG2({type:se,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(le,Ge){2&le&&E.uIk("min",Ge._enabled?Ge.min:null)},inputs:{min:"min"},features:[E._Bn([dy]),E.qOj]}),Y})(),id=(()=>{var se;class Y{}return(se=Y).\u0275fac=function(le){return new(le||se)},se.\u0275mod=E.oAB({type:se}),se.\u0275inj=E.cJS({imports:[K]}),Y})(),_i=(()=>{var se;class Y{static withConfig(le){var Ge;return{ngModule:Y,providers:[{provide:ho,useValue:null!==(Ge=le.callSetDisabledState)&&void 0!==Ge?Ge:vs}]}}}return(se=Y).\u0275fac=function(le){return new(le||se)},se.\u0275mod=E.oAB({type:se}),se.\u0275inj=E.cJS({imports:[id]}),Y})()},6593:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Dx:()=>nn,b2:()=>ue,q6:()=>gr});var E=ae(9212),he=ae(6814);class at extends he.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Ie extends at{static makeCurrent(){(0,he.HT)(new Ie)}onAndCancel(Ke,ot,rt){return Ke.addEventListener(ot,rt),()=>{Ke.removeEventListener(ot,rt)}}dispatchEvent(Ke,ot){Ke.dispatchEvent(ot)}remove(Ke){Ke.parentNode&&Ke.parentNode.removeChild(Ke)}createElement(Ke,ot){return(ot=ot||this.getDefaultDocument()).createElement(Ke)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ke){return Ke.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ke){return Ke instanceof DocumentFragment}getGlobalEventTarget(Ke,ot){return"window"===ot?window:"document"===ot?Ke:"body"===ot?Ke.body:null}getBaseHref(Ke){const ot=function Ve(){return ge=ge||document.querySelector("base"),ge?ge.getAttribute("href"):null}();return null==ot?null:function Le(ht){return new URL(ht,document.baseURI).pathname}(ot)}resetBaseElement(){ge=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ke){return(0,he.Mx)(document.cookie,Ke)}}let ge=null,ze=(()=>{var ht;class Ke{build(){return new XMLHttpRequest}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();const wt=new E.OlP("EventManagerPlugins");let Ue=(()=>{var ht;class Ke{constructor(rt,Nt){this._zone=Nt,this._eventNameToPlugin=new Map,rt.forEach(qt=>{qt.manager=this}),this._plugins=rt.slice().reverse()}addEventListener(rt,Nt,qt){return this._findPluginFor(Nt).addEventListener(rt,Nt,qt)}getZone(){return this._zone}_findPluginFor(rt){let Nt=this._eventNameToPlugin.get(rt);if(Nt)return Nt;if(Nt=this._plugins.find(Rn=>Rn.supports(rt)),!Nt)throw new E.vHH(5101,!1);return this._eventNameToPlugin.set(rt,Nt),Nt}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(wt),E.LFG(E.R0b))},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();class vt{constructor(Ke){this._doc=Ke}}const Mt="ng-app-id";let xt=(()=>{var ht;class Ke{constructor(rt,Nt,qt,Rn={}){this.doc=rt,this.appId=Nt,this.nonce=qt,this.platformId=Rn,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,he.PM)(Rn),this.resetHostNodes()}addStyles(rt){for(const Nt of rt)1===this.changeUsageCount(Nt,1)&&this.onStyleAdded(Nt)}removeStyles(rt){for(const Nt of rt)this.changeUsageCount(Nt,-1)<=0&&this.onStyleRemoved(Nt)}ngOnDestroy(){const rt=this.styleNodesInDOM;rt&&(rt.forEach(Nt=>Nt.remove()),rt.clear());for(const Nt of this.getAllStyles())this.onStyleRemoved(Nt);this.resetHostNodes()}addHost(rt){this.hostNodes.add(rt);for(const Nt of this.getAllStyles())this.addStyleToHost(rt,Nt)}removeHost(rt){this.hostNodes.delete(rt)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(rt){for(const Nt of this.hostNodes)this.addStyleToHost(Nt,rt)}onStyleRemoved(rt){var Nt;const qt=this.styleRef;null===(Nt=qt.get(rt))||void 0===Nt||null===(Nt=Nt.elements)||void 0===Nt||Nt.forEach(Rn=>Rn.remove()),qt.delete(rt)}collectServerRenderedStyles(){var rt;const Nt=null===(rt=this.doc.head)||void 0===rt?void 0:rt.querySelectorAll(`style[${Mt}="${this.appId}"]`);if(null!=Nt&&Nt.length){const qt=new Map;return Nt.forEach(Rn=>{null!=Rn.textContent&&qt.set(Rn.textContent,Rn)}),qt}return null}changeUsageCount(rt,Nt){const qt=this.styleRef;if(qt.has(rt)){const Rn=qt.get(rt);return Rn.usage+=Nt,Rn.usage}return qt.set(rt,{usage:Nt,elements:[]}),Nt}getStyleElement(rt,Nt){const qt=this.styleNodesInDOM,Rn=null==qt?void 0:qt.get(Nt);if((null==Rn?void 0:Rn.parentNode)===rt)return qt.delete(Nt),Rn.removeAttribute(Mt),Rn;{const cr=this.doc.createElement("style");return this.nonce&&cr.setAttribute("nonce",this.nonce),cr.textContent=Nt,this.platformIsServer&&cr.setAttribute(Mt,this.appId),rt.appendChild(cr),cr}}addStyleToHost(rt,Nt){var qt;const Rn=this.getStyleElement(rt,Nt),cr=this.styleRef,Sr=null===(qt=cr.get(Nt))||void 0===qt?void 0:qt.elements;Sr?Sr.push(Rn):cr.set(Nt,{elements:[Rn],usage:1})}resetHostNodes(){const rt=this.hostNodes;rt.clear(),rt.add(this.doc.head)}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(he.K0),E.LFG(E.AFp),E.LFG(E.Ojb,8),E.LFG(E.Lbi))},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();const gt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Jt=/%COMP%/g,lt=new E.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!0});function Ft(ht,Ke){return Ke.map(ot=>ot.replace(Jt,ht))}let Te=(()=>{var ht;class Ke{constructor(rt,Nt,qt,Rn,cr,Sr,ii,ji=null){this.eventManager=rt,this.sharedStylesHost=Nt,this.appId=qt,this.removeStylesOnCompDestroy=Rn,this.doc=cr,this.platformId=Sr,this.ngZone=ii,this.nonce=ji,this.rendererByCompId=new Map,this.platformIsServer=(0,he.PM)(Sr),this.defaultRenderer=new De(rt,cr,ii,this.platformIsServer)}createRenderer(rt,Nt){if(!rt||!Nt)return this.defaultRenderer;this.platformIsServer&&Nt.encapsulation===E.ifc.ShadowDom&&(Nt={...Nt,encapsulation:E.ifc.Emulated});const qt=this.getOrCreateRenderer(rt,Nt);return qt instanceof Un?qt.applyToHost(rt):qt instanceof on&&qt.applyStyles(),qt}getOrCreateRenderer(rt,Nt){const qt=this.rendererByCompId;let Rn=qt.get(Nt.id);if(!Rn){const cr=this.doc,Sr=this.ngZone,ii=this.eventManager,ji=this.sharedStylesHost,wi=this.removeStylesOnCompDestroy,dr=this.platformIsServer;switch(Nt.encapsulation){case E.ifc.Emulated:Rn=new Un(ii,ji,Nt,this.appId,wi,cr,Sr,dr);break;case E.ifc.ShadowDom:return new en(ii,ji,rt,Nt,cr,Sr,this.nonce,dr);default:Rn=new on(ii,ji,Nt,wi,cr,Sr,dr)}qt.set(Nt.id,Rn)}return Rn}ngOnDestroy(){this.rendererByCompId.clear()}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(Ue),E.LFG(xt),E.LFG(E.AFp),E.LFG(lt),E.LFG(he.K0),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(E.Ojb))},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();class De{constructor(Ke,ot,rt,Nt){this.eventManager=Ke,this.doc=ot,this.ngZone=rt,this.platformIsServer=Nt,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(Ke,ot){return ot?this.doc.createElementNS(gt[ot]||ot,Ke):this.doc.createElement(Ke)}createComment(Ke){return this.doc.createComment(Ke)}createText(Ke){return this.doc.createTextNode(Ke)}appendChild(Ke,ot){(Gt(Ke)?Ke.content:Ke).appendChild(ot)}insertBefore(Ke,ot,rt){Ke&&(Gt(Ke)?Ke.content:Ke).insertBefore(ot,rt)}removeChild(Ke,ot){Ke&&Ke.removeChild(ot)}selectRootElement(Ke,ot){let rt="string"==typeof Ke?this.doc.querySelector(Ke):Ke;if(!rt)throw new E.vHH(-5104,!1);return ot||(rt.textContent=""),rt}parentNode(Ke){return Ke.parentNode}nextSibling(Ke){return Ke.nextSibling}setAttribute(Ke,ot,rt,Nt){if(Nt){ot=Nt+":"+ot;const qt=gt[Nt];qt?Ke.setAttributeNS(qt,ot,rt):Ke.setAttribute(ot,rt)}else Ke.setAttribute(ot,rt)}removeAttribute(Ke,ot,rt){if(rt){const Nt=gt[rt];Nt?Ke.removeAttributeNS(Nt,ot):Ke.removeAttribute(`${rt}:${ot}`)}else Ke.removeAttribute(ot)}addClass(Ke,ot){Ke.classList.add(ot)}removeClass(Ke,ot){Ke.classList.remove(ot)}setStyle(Ke,ot,rt,Nt){Nt&(E.JOm.DashCase|E.JOm.Important)?Ke.style.setProperty(ot,rt,Nt&E.JOm.Important?"important":""):Ke.style[ot]=rt}removeStyle(Ke,ot,rt){rt&E.JOm.DashCase?Ke.style.removeProperty(ot):Ke.style[ot]=""}setProperty(Ke,ot,rt){null!=Ke&&(Ke[ot]=rt)}setValue(Ke,ot){Ke.nodeValue=ot}listen(Ke,ot,rt){if("string"==typeof Ke&&!(Ke=(0,he.q)().getGlobalEventTarget(this.doc,Ke)))throw new Error(`Unsupported event target ${Ke} for event ${ot}`);return this.eventManager.addEventListener(Ke,ot,this.decoratePreventDefault(rt))}decoratePreventDefault(Ke){return ot=>{if("__ngUnwrap__"===ot)return Ke;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>Ke(ot)):Ke(ot))&&ot.preventDefault()}}}function Gt(ht){return"TEMPLATE"===ht.tagName&&void 0!==ht.content}class en extends De{constructor(Ke,ot,rt,Nt,qt,Rn,cr,Sr){super(Ke,qt,Rn,Sr),this.sharedStylesHost=ot,this.hostEl=rt,this.shadowRoot=rt.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const ii=Ft(Nt.id,Nt.styles);for(const ji of ii){const wi=document.createElement("style");cr&&wi.setAttribute("nonce",cr),wi.textContent=ji,this.shadowRoot.appendChild(wi)}}nodeOrShadowRoot(Ke){return Ke===this.hostEl?this.shadowRoot:Ke}appendChild(Ke,ot){return super.appendChild(this.nodeOrShadowRoot(Ke),ot)}insertBefore(Ke,ot,rt){return super.insertBefore(this.nodeOrShadowRoot(Ke),ot,rt)}removeChild(Ke,ot){return super.removeChild(this.nodeOrShadowRoot(Ke),ot)}parentNode(Ke){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ke)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class on extends De{constructor(Ke,ot,rt,Nt,qt,Rn,cr,Sr){super(Ke,qt,Rn,cr),this.sharedStylesHost=ot,this.removeStylesOnCompDestroy=Nt,this.styles=Sr?Ft(Sr,rt.styles):rt.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Un extends on{constructor(Ke,ot,rt,Nt,qt,Rn,cr,Sr){const ii=Nt+"-"+rt.id;super(Ke,ot,rt,qt,Rn,cr,Sr,ii),this.contentAttr=function me(ht){return"_ngcontent-%COMP%".replace(Jt,ht)}(ii),this.hostAttr=function st(ht){return"_nghost-%COMP%".replace(Jt,ht)}(ii)}applyToHost(Ke){this.applyStyles(),this.setAttribute(Ke,this.hostAttr,"")}createElement(Ke,ot){const rt=super.createElement(Ke,ot);return super.setAttribute(rt,this.contentAttr,""),rt}}let nr=(()=>{var ht;class Ke extends vt{constructor(rt){super(rt)}supports(rt){return!0}addEventListener(rt,Nt,qt){return rt.addEventListener(Nt,qt,!1),()=>this.removeEventListener(rt,Nt,qt)}removeEventListener(rt,Nt,qt){return rt.removeEventListener(Nt,qt)}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(he.K0))},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();const _n=["alt","control","meta","shift"],sn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},yt={alt:ht=>ht.altKey,control:ht=>ht.ctrlKey,meta:ht=>ht.metaKey,shift:ht=>ht.shiftKey};let Xe=(()=>{var ht;class Ke extends vt{constructor(rt){super(rt)}supports(rt){return null!=Ke.parseEventName(rt)}addEventListener(rt,Nt,qt){const Rn=Ke.parseEventName(Nt),cr=Ke.eventCallback(Rn.fullKey,qt,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,he.q)().onAndCancel(rt,Rn.domEventName,cr))}static parseEventName(rt){const Nt=rt.toLowerCase().split("."),qt=Nt.shift();if(0===Nt.length||"keydown"!==qt&&"keyup"!==qt)return null;const Rn=Ke._normalizeKey(Nt.pop());let cr="",Sr=Nt.indexOf("code");if(Sr>-1&&(Nt.splice(Sr,1),cr="code."),_n.forEach(ji=>{const wi=Nt.indexOf(ji);wi>-1&&(Nt.splice(wi,1),cr+=ji+".")}),cr+=Rn,0!=Nt.length||0===Rn.length)return null;const ii={};return ii.domEventName=qt,ii.fullKey=cr,ii}static matchEventFullKeyCode(rt,Nt){let qt=sn[rt.key]||rt.key,Rn="";return Nt.indexOf("code.")>-1&&(qt=rt.code,Rn="code."),!(null==qt||!qt)&&(qt=qt.toLowerCase()," "===qt?qt="space":"."===qt&&(qt="dot"),_n.forEach(cr=>{cr!==qt&&(0,yt[cr])(rt)&&(Rn+=cr+".")}),Rn+=qt,Rn===Nt)}static eventCallback(rt,Nt,qt){return Rn=>{Ke.matchEventFullKeyCode(Rn,rt)&&qt.runGuarded(()=>Nt(Rn))}}static _normalizeKey(rt){return"esc"===rt?"escape":rt}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(he.K0))},ht.\u0275prov=E.Yz7({token:ht,factory:ht.\u0275fac}),Ke})();const gr=(0,E.eFA)(E._c5,"browser",[{provide:E.Lbi,useValue:he.bD},{provide:E.g9A,useValue:function Gn(){Ie.makeCurrent()},multi:!0},{provide:he.K0,useFactory:function Hn(){return(0,E.RDi)(document),document},deps:[]}]),ei=new E.OlP(""),An=[{provide:E.rWj,useClass:class Be{addToWindow(Ke){E.dqk.getAngularTestability=(rt,Nt=!0)=>{const qt=Ke.findTestabilityInTree(rt,Nt);if(null==qt)throw new E.vHH(5103,!1);return qt},E.dqk.getAllAngularTestabilities=()=>Ke.getAllTestabilities(),E.dqk.getAllAngularRootElements=()=>Ke.getAllRootElements(),E.dqk.frameworkStabilizers||(E.dqk.frameworkStabilizers=[]),E.dqk.frameworkStabilizers.push(rt=>{const Nt=E.dqk.getAllAngularTestabilities();let qt=Nt.length,Rn=!1;const cr=function(Sr){Rn=Rn||Sr,qt--,0==qt&&rt(Rn)};Nt.forEach(Sr=>{Sr.whenStable(cr)})})}findTestabilityInTree(Ke,ot,rt){if(null==ot)return null;const Nt=Ke.getTestability(ot);return null!=Nt?Nt:rt?(0,he.q)().isShadowRoot(ot)?this.findTestabilityInTree(Ke,ot.host,!0):this.findTestabilityInTree(Ke,ot.parentElement,!0):null}},deps:[]},{provide:E.lri,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]},{provide:E.dDg,useClass:E.dDg,deps:[E.R0b,E.eoX,E.rWj]}],qe=[{provide:E.zSh,useValue:"root"},{provide:E.qLn,useFactory:function rr(){return new E.qLn},deps:[]},{provide:wt,useClass:nr,multi:!0,deps:[he.K0,E.R0b,E.Lbi]},{provide:wt,useClass:Xe,multi:!0,deps:[he.K0]},Te,xt,Ue,{provide:E.FYo,useExisting:Te},{provide:he.JF,useClass:ze,deps:[]},[]];let ue=(()=>{var ht;class Ke{constructor(rt){}static withServerTransition(rt){return{ngModule:Ke,providers:[{provide:E.AFp,useValue:rt.appId}]}}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(ei,12))},ht.\u0275mod=E.oAB({type:ht}),ht.\u0275inj=E.cJS({providers:[...qe,...An],imports:[he.ez,E.hGG]}),Ke})(),nn=(()=>{var ht;class Ke{constructor(rt){this._doc=rt}getTitle(){return this._doc.title}setTitle(rt){this._doc.title=rt||""}}return(ht=Ke).\u0275fac=function(rt){return new(rt||ht)(E.LFG(he.K0))},ht.\u0275prov=E.Yz7({token:ht,factory:function(rt){let Nt=null;return Nt=rt?new rt:function zt(){return new nn((0,E.LFG)(he.K0))}(),Nt},providedIn:"root"}),Ke})();typeof window<"u"&&window},4653:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{gz:()=>ui,y6:()=>be,OD:()=>_e,eC:()=>qe,wm:()=>Ro,wN:()=>Yo,F0:()=>Wa,rH:()=>sh,Bz:()=>Jh,Hx:()=>Mo});var E=ae(9212),he=ae(5592),at=ae(4674),ge=ae(2459),Ve=ae(2096),Le=ae(5619),Be=ae(2572);const wt=(0,ae(2306).d)(L=>function(){L(this),this.name="EmptyError",this.message="no elements in sequence"});var Ue=ae(5211),vt=ae(4911),Mt=ae(8407),xt=ae(8504),gt=ae(6232),Jt=ae(3168),Ot=ae(8645),Rt=ae(7394),Pt=ae(6814),hn=ae(7398),lt=ae(4664),me=ae(8180),st=ae(9940),Ft=ae(9360),De=ae(2181),dt=ae(1631),mt=ae(8251);function Gt(L){return(0,Ft.e)(($,X)=>{let B=!1;$.subscribe((0,mt.x)(X,Q=>{B=!0,X.next(Q)},()=>{B||X.next(L),X.complete()}))})}function en(L=on){return(0,Ft.e)(($,X)=>{let B=!1;$.subscribe((0,mt.x)(X,Q=>{B=!0,X.next(Q)},()=>B?X.complete():X.error(L())))})}function on(){return new wt}var Un=ae(2737);function nr(L,$){const X=arguments.length>=2;return B=>B.pipe(L?(0,De.h)((Q,Ee)=>L(Q,Ee,B)):Un.y,(0,me.q)(1),X?Gt($):en(()=>new wt))}function _n(L,$){return(0,at.m)($)?(0,dt.z)(L,$,1):(0,dt.z)(L,1)}var sn=ae(9397),yt=ae(6306);function Ye(L){return L<=0?()=>gt.E:(0,Ft.e)(($,X)=>{let B=[];$.subscribe((0,mt.x)(X,Q=>{B.push(Q),L<B.length&&B.shift()},()=>{for(const Q of B)X.next(Q);X.complete()},void 0,()=>{B=null}))})}var rn=ae(975);function Gn(L){return(0,Ft.e)(($,X)=>{try{$.subscribe(X)}finally{X.add(L)}})}var rr=ae(6196),Hn=ae(4829),mr=ae(2420),ei=ae(7537),An=ae(6593);const qe="primary",ue=Symbol("RouteTitle");class ye{constructor($){this.params=$||{}}has($){return Object.prototype.hasOwnProperty.call(this.params,$)}get($){if(this.has($)){const X=this.params[$];return Array.isArray(X)?X[0]:X}return null}getAll($){if(this.has($)){const X=this.params[$];return Array.isArray(X)?X:[X]}return[]}get keys(){return Object.keys(this.params)}}function Me(L){return new ye(L)}function Bt(L,$,X){const B=X.path.split("/");if(B.length>L.length||"full"===X.pathMatch&&($.hasChildren()||B.length<L.length))return null;const Q={};for(let Ee=0;Ee<B.length;Ee++){const je=B[Ee],jt=L[Ee];if(je.startsWith(":"))Q[je.substring(1)]=jt;else if(je!==jt.path)return null}return{consumed:L.slice(0,B.length),posParams:Q}}function nn(L,$){const X=L?In(L):void 0,B=$?In($):void 0;if(!X||!B||X.length!=B.length)return!1;let Q;for(let Ee=0;Ee<X.length;Ee++)if(Q=X[Ee],!Xt(L[Q],$[Q]))return!1;return!0}function In(L){return[...Object.keys(L),...Object.getOwnPropertySymbols(L)]}function Xt(L,$){if(Array.isArray(L)&&Array.isArray($)){if(L.length!==$.length)return!1;const X=[...L].sort(),B=[...$].sort();return X.every((Q,Ee)=>B[Ee]===Q)}return L===$}function Zn(L){return L.length>0?L[L.length-1]:null}function cn(L){return function Ie(L){return!!L&&(L instanceof he.y||(0,at.m)(L.lift)&&(0,at.m)(L.subscribe))}(L)?L:(0,E.QGY)(L)?(0,ge.D)(Promise.resolve(L)):(0,Ve.of)(L)}const Dn={exact:function Nn(L,$,X){if(!Tr(L.segments,$.segments)||!ri(L.segments,$.segments,X)||L.numberOfChildren!==$.numberOfChildren)return!1;for(const B in $.children)if(!L.children[B]||!Nn(L.children[B],$.children[B],X))return!1;return!0},subset:Lr},ir={exact:function Mi(L,$){return nn(L,$)},subset:function Kr(L,$){return Object.keys($).length<=Object.keys(L).length&&Object.keys($).every(X=>Xt(L[X],$[X]))},ignored:()=>!0};function bi(L,$,X){return Dn[X.paths](L.root,$.root,X.matrixParams)&&ir[X.queryParams](L.queryParams,$.queryParams)&&!("exact"===X.fragment&&L.fragment!==$.fragment)}function Lr(L,$,X){return qi(L,$,$.segments,X)}function qi(L,$,X,B){if(L.segments.length>X.length){const Q=L.segments.slice(0,X.length);return!(!Tr(Q,X)||$.hasChildren()||!ri(Q,X,B))}if(L.segments.length===X.length){if(!Tr(L.segments,X)||!ri(L.segments,X,B))return!1;for(const Q in $.children)if(!L.children[Q]||!Lr(L.children[Q],$.children[Q],B))return!1;return!0}{const Q=X.slice(0,L.segments.length),Ee=X.slice(L.segments.length);return!!(Tr(L.segments,Q)&&ri(L.segments,Q,B)&&L.children[qe])&&qi(L.children[qe],$,Ee,B)}}function ri(L,$,X){return $.every((B,Q)=>ir[X](L[Q].parameters,B.parameters))}class Ui{constructor($=new fr([],{}),X={},B=null){this.root=$,this.queryParams=X,this.fragment=B}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Me(this.queryParams)),this._queryParamMap}toString(){return an.serialize(this)}}class fr{constructor($,X){this.segments=$,this.children=X,this.parent=null,Object.values(X).forEach(B=>B.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return yn(this)}}class io{constructor($,X){this.path=$,this.parameters=X}get parameterMap(){return this._parameterMap||(this._parameterMap=Me(this.parameters)),this._parameterMap}toString(){return rt(this)}}function Tr(L,$){return L.length===$.length&&L.every((X,B)=>X.path===$[B].path)}let Mo=(()=>{var L;class ${}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:()=>new Ht,providedIn:"root"}),$})();class Ht{parse($){const X=new ho($);return new Ui(X.parseRootSegment(),X.parseQueryParams(),X.parseFragment())}serialize($){const X=`/${vn($.root,!0)}`,B=function qt(L){const $=Object.keys(L).map(X=>{const B=L[X];return Array.isArray(B)?B.map(Q=>`${xn(X)}=${xn(Q)}`).join("&"):`${xn(X)}=${xn(B)}`}).filter(X=>!!X);return $.length?`?${$.join("&")}`:""}($.queryParams);return`${X}${B}${"string"==typeof $.fragment?`#${function Ln(L){return encodeURI(L)}($.fragment)}`:""}`}}const an=new Ht;function yn(L){return L.segments.map($=>rt($)).join("/")}function vn(L,$){if(!L.hasChildren())return yn(L);if($){const X=L.children[qe]?vn(L.children[qe],!1):"",B=[];return Object.entries(L.children).forEach(([Q,Ee])=>{Q!==qe&&B.push(`${Q}:${vn(Ee,!1)}`)}),B.length>0?`${X}(${B.join("//")})`:X}{const X=function Gr(L,$){let X=[];return Object.entries(L.children).forEach(([B,Q])=>{B===qe&&(X=X.concat($(Q,B)))}),Object.entries(L.children).forEach(([B,Q])=>{B!==qe&&(X=X.concat($(Q,B)))}),X}(L,(B,Q)=>Q===qe?[vn(L.children[qe],!1)]:[`${Q}:${vn(B,!1)}`]);return 1===Object.keys(L.children).length&&null!=L.children[qe]?`${yn(L)}/${X[0]}`:`${yn(L)}/(${X.join("//")})`}}function En(L){return encodeURIComponent(L).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xn(L){return En(L).replace(/%3B/gi,";")}function ht(L){return En(L).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ke(L){return decodeURIComponent(L)}function ot(L){return Ke(L.replace(/\+/g,"%20"))}function rt(L){return`${ht(L.path)}${function Nt(L){return Object.keys(L).map($=>`;${ht($)}=${ht(L[$])}`).join("")}(L.parameters)}`}const Rn=/^[^\/()?;#]+/;function cr(L){const $=L.match(Rn);return $?$[0]:""}const Sr=/^[^\/()?;=#]+/,ji=/^[^=?&#]+/,dr=/^[^&#]+/;class ho{constructor($){this.url=$,this.remaining=$}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fr([],{}):new fr([],this.parseChildren())}parseQueryParams(){const $={};if(this.consumeOptional("?"))do{this.parseQueryParam($)}while(this.consumeOptional("&"));return $}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const $=[];for(this.peekStartsWith("(")||$.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),$.push(this.parseSegment());let X={};this.peekStartsWith("/(")&&(this.capture("/"),X=this.parseParens(!0));let B={};return this.peekStartsWith("(")&&(B=this.parseParens(!1)),($.length>0||Object.keys(X).length>0)&&(B[qe]=new fr($,X)),B}parseSegment(){const $=cr(this.remaining);if(""===$&&this.peekStartsWith(";"))throw new E.vHH(4009,!1);return this.capture($),new io(Ke($),this.parseMatrixParams())}parseMatrixParams(){const $={};for(;this.consumeOptional(";");)this.parseParam($);return $}parseParam($){const X=function ii(L){const $=L.match(Sr);return $?$[0]:""}(this.remaining);if(!X)return;this.capture(X);let B="";if(this.consumeOptional("=")){const Q=cr(this.remaining);Q&&(B=Q,this.capture(B))}$[Ke(X)]=Ke(B)}parseQueryParam($){const X=function wi(L){const $=L.match(ji);return $?$[0]:""}(this.remaining);if(!X)return;this.capture(X);let B="";if(this.consumeOptional("=")){const je=function Oo(L){const $=L.match(dr);return $?$[0]:""}(this.remaining);je&&(B=je,this.capture(B))}const Q=ot(X),Ee=ot(B);if($.hasOwnProperty(Q)){let je=$[Q];Array.isArray(je)||(je=[je],$[Q]=je),je.push(Ee)}else $[Q]=Ee}parseParens($){const X={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const B=cr(this.remaining),Q=this.remaining[B.length];if("/"!==Q&&")"!==Q&&";"!==Q)throw new E.vHH(4010,!1);let Ee;B.indexOf(":")>-1?(Ee=B.slice(0,B.indexOf(":")),this.capture(Ee),this.capture(":")):$&&(Ee=qe);const je=this.parseChildren();X[Ee]=1===Object.keys(je).length?je[qe]:new fr([],je),this.consumeOptional("//")}return X}peekStartsWith($){return this.remaining.startsWith($)}consumeOptional($){return!!this.peekStartsWith($)&&(this.remaining=this.remaining.substring($.length),!0)}capture($){if(!this.consumeOptional($))throw new E.vHH(4011,!1)}}function vs(L){return L.segments.length>0?new fr([],{[qe]:L}):L}function cs(L){const $={};for(const B of Object.keys(L.children)){const Ee=cs(L.children[B]);if(B===qe&&0===Ee.segments.length&&Ee.hasChildren())for(const[je,jt]of Object.entries(Ee.children))$[je]=jt;else(Ee.segments.length>0||Ee.hasChildren())&&($[B]=Ee)}return function Ei(L){if(1===L.numberOfChildren&&L.children[qe]){const $=L.children[qe];return new fr(L.segments.concat($.segments),$.children)}return L}(new fr(L.segments,$))}function ko(L){return L instanceof Ui}function ts(L){var $;let X;const Ee=vs(function B(je){const jt={};for(const Zt of je.children){const ar=B(Zt);jt[Zt.outlet]=ar}const Bn=new fr(je.url,jt);return je===L&&(X=Bn),Bn}(L.root));return null!==($=X)&&void 0!==$?$:Ee}function fo(L,$,X,B){let Q=L;for(;Q.parent;)Q=Q.parent;if(0===$.length)return ns(Q,Q,Q,X,B);const Ee=function ds(L){if("string"==typeof L[0]&&1===L.length&&"/"===L[0])return new ti(!0,0,L);let $=0,X=!1;const B=L.reduce((Q,Ee,je)=>{if("object"==typeof Ee&&null!=Ee){if(Ee.outlets){const jt={};return Object.entries(Ee.outlets).forEach(([Bn,Zt])=>{jt[Bn]="string"==typeof Zt?Zt.split("/"):Zt}),[...Q,{outlets:jt}]}if(Ee.segmentPath)return[...Q,Ee.segmentPath]}return"string"!=typeof Ee?[...Q,Ee]:0===je?(Ee.split("/").forEach((jt,Bn)=>{0==Bn&&"."===jt||(0==Bn&&""===jt?X=!0:".."===jt?$++:""!=jt&&Q.push(jt))}),Q):[...Q,Ee]},[]);return new ti(X,$,B)}($);if(Ee.toRoot())return ns(Q,Q,new fr([],{}),X,B);const je=function pi(L,$,X){if(L.isAbsolute)return new Qi($,!0,0);if(!X)return new Qi($,!1,NaN);if(null===X.parent)return new Qi(X,!0,0);const B=us(L.commands[0])?0:1;return function xs(L,$,X){let B=L,Q=$,Ee=X;for(;Ee>Q;){if(Ee-=Q,B=B.parent,!B)throw new E.vHH(4005,!1);Q=B.segments.length}return new Qi(B,!1,Q-Ee)}(X,X.segments.length-1+B,L.numberOfDoubleDots)}(Ee,Q,L),jt=je.processChildren?Bs(je.segmentGroup,je.index,Ee.commands):Br(je.segmentGroup,je.index,Ee.commands);return ns(Q,je.segmentGroup,jt,X,B)}function us(L){return"object"==typeof L&&null!=L&&!L.outlets&&!L.segmentPath}function Fs(L){return"object"==typeof L&&null!=L&&L.outlets}function ns(L,$,X,B,Q){let je,Ee={};B&&Object.entries(B).forEach(([Bn,Zt])=>{Ee[Bn]=Array.isArray(Zt)?Zt.map(ar=>`${ar}`):`${Zt}`}),je=L===$?X:po(L,$,X);const jt=vs(cs(je));return new Ui(jt,Ee,Q)}function po(L,$,X){const B={};return Object.entries(L.children).forEach(([Q,Ee])=>{B[Q]=Ee===$?X:po(Ee,$,X)}),new fr(L.segments,B)}class ti{constructor($,X,B){if(this.isAbsolute=$,this.numberOfDoubleDots=X,this.commands=B,$&&B.length>0&&us(B[0]))throw new E.vHH(4003,!1);const Q=B.find(Fs);if(Q&&Q!==Zn(B))throw new E.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Qi{constructor($,X,B){this.segmentGroup=$,this.processChildren=X,this.index=B}}function Br(L,$,X){if(L||(L=new fr([],{})),0===L.segments.length&&L.hasChildren())return Bs(L,$,X);const B=function Vs(L,$,X){let B=0,Q=$;const Ee={match:!1,pathIndex:0,commandIndex:0};for(;Q<L.segments.length;){if(B>=X.length)return Ee;const je=L.segments[Q],jt=X[B];if(Fs(jt))break;const Bn=`${jt}`,Zt=B<X.length-1?X[B+1]:null;if(Q>0&&void 0===Bn)break;if(Bn&&Zt&&"object"==typeof Zt&&void 0===Zt.outlets){if(!re(Bn,Zt,je))return Ee;B+=2}else{if(!re(Bn,{},je))return Ee;B++}Q++}return{match:!0,pathIndex:Q,commandIndex:B}}(L,$,X),Q=X.slice(B.commandIndex);if(B.match&&B.pathIndex<L.segments.length){const Ee=new fr(L.segments.slice(0,B.pathIndex),{});return Ee.children[qe]=new fr(L.segments.slice(B.pathIndex),L.children),Bs(Ee,0,Q)}return B.match&&0===Q.length?new fr(L.segments,{}):B.match&&!L.hasChildren()?Se(L,$,X):B.match?Bs(L,0,Q):Se(L,$,X)}function Bs(L,$,X){if(0===X.length)return new fr(L.segments,{});{const B=function Wi(L){return Fs(L[0])?L[0].outlets:{[qe]:L}}(X),Q={};if(Object.keys(B).some(Ee=>Ee!==qe)&&L.children[qe]&&1===L.numberOfChildren&&0===L.children[qe].segments.length){const Ee=Bs(L.children[qe],$,X);return new fr(L.segments,Ee.children)}return Object.entries(B).forEach(([Ee,je])=>{"string"==typeof je&&(je=[je]),null!==je&&(Q[Ee]=Br(L.children[Ee],$,je))}),Object.entries(L.children).forEach(([Ee,je])=>{void 0===B[Ee]&&(Q[Ee]=je)}),new fr(L.segments,Q)}}function Se(L,$,X){const B=L.segments.slice(0,$);let Q=0;for(;Q<X.length;){const Ee=X[Q];if(Fs(Ee)){const Bn=Et(Ee.outlets);return new fr(B,Bn)}if(0===Q&&us(X[0])){B.push(new io(L.segments[$].path,Ze(X[0]))),Q++;continue}const je=Fs(Ee)?Ee.outlets[qe]:`${Ee}`,jt=Q<X.length-1?X[Q+1]:null;je&&jt&&us(jt)?(B.push(new io(je,Ze(jt))),Q+=2):(B.push(new io(je,{})),Q++)}return new fr(B,{})}function Et(L){const $={};return Object.entries(L).forEach(([X,B])=>{"string"==typeof B&&(B=[B]),null!==B&&($[X]=Se(new fr([],{}),0,B))}),$}function Ze(L){const $={};return Object.entries(L).forEach(([X,B])=>$[X]=`${B}`),$}function re(L,$,X){return L==X.path&&nn($,X.parameters)}const ne="imperative";class Z{constructor($,X){this.id=$,this.url=X}}class _e extends Z{constructor($,X,B="imperative",Q=null){super($,X),this.type=0,this.navigationTrigger=B,this.restoredState=Q}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class We extends Z{constructor($,X,B){super($,X),this.urlAfterRedirects=B,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ct extends Z{constructor($,X,B,Q){super($,X),this.reason=B,this.code=Q,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Qt extends Z{constructor($,X,B,Q){super($,X),this.reason=B,this.code=Q,this.type=16}}class q extends Z{constructor($,X,B,Q){super($,X),this.error=B,this.target=Q,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ce extends Z{constructor($,X,B,Q){super($,X),this.urlAfterRedirects=B,this.state=Q,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Pe extends Z{constructor($,X,B,Q){super($,X),this.urlAfterRedirects=B,this.state=Q,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ct extends Z{constructor($,X,B,Q,Ee){super($,X),this.urlAfterRedirects=B,this.state=Q,this.shouldActivate=Ee,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $t extends Z{constructor($,X,B,Q){super($,X),this.urlAfterRedirects=B,this.state=Q,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bt extends Z{constructor($,X,B,Q){super($,X),this.urlAfterRedirects=B,this.state=Q,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fn{constructor($){this.route=$,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bn{constructor($){this.route=$,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Fn{constructor($){this.snapshot=$,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Pn{constructor($){this.snapshot=$,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kt{constructor($){this.snapshot=$,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wn{constructor($){this.snapshot=$,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kn{constructor($,X,B){this.routerEvent=$,this.position=X,this.anchor=B,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class ut{}class Sn{constructor($){this.url=$}}class N{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new be,this.attachRef=null}}let be=(()=>{var L;class ${constructor(){this.contexts=new Map}onChildOutletCreated(B,Q){const Ee=this.getOrCreateContext(B);Ee.outlet=Q,this.contexts.set(B,Ee)}onChildOutletDestroyed(B){const Q=this.getContext(B);Q&&(Q.outlet=null,Q.attachRef=null)}onOutletDeactivated(){const B=this.contexts;return this.contexts=new Map,B}onOutletReAttached(B){this.contexts=B}getOrCreateContext(B){let Q=this.getContext(B);return Q||(Q=new N,this.contexts.set(B,Q)),Q}getContext(B){return this.contexts.get(B)||null}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();class K{constructor($){this._root=$}get root(){return this._root.value}parent($){const X=this.pathFromRoot($);return X.length>1?X[X.length-2]:null}children($){const X=Fe($,this._root);return X?X.children.map(B=>B.value):[]}firstChild($){const X=Fe($,this._root);return X&&X.children.length>0?X.children[0].value:null}siblings($){const X=Lt($,this._root);return X.length<2?[]:X[X.length-2].children.map(Q=>Q.value).filter(Q=>Q!==$)}pathFromRoot($){return Lt($,this._root).map(X=>X.value)}}function Fe(L,$){if(L===$.value)return $;for(const X of $.children){const B=Fe(L,X);if(B)return B}return null}function Lt(L,$){if(L===$.value)return[$];for(const X of $.children){const B=Lt(L,X);if(B.length)return B.unshift($),B}return[]}class Hr{constructor($,X){this.value=$,this.children=X}toString(){return`TreeNode(${this.value})`}}function $o(L){const $={};return L&&L.children.forEach(X=>$[X.value.outlet]=X),$}class zs extends K{constructor($,X){super($),this.snapshot=X,Hl(this,$)}toString(){return this.snapshot.toString()}}function Wn(L,$){const X=function Yr(L,$){const je=new Ks([],{},{},"",{},qe,$,null,{});return new br("",new Hr(je,[]))}(0,$),B=new Le.X([new io("",{})]),Q=new Le.X({}),Ee=new Le.X({}),je=new Le.X({}),jt=new Le.X(""),Bn=new ui(B,Q,je,jt,Ee,qe,$,X.root);return Bn.snapshot=X.root,new zs(new Hr(Bn,[]),X)}class ui{constructor($,X,B,Q,Ee,je,jt,Bn){var Zt,ar;this.urlSubject=$,this.paramsSubject=X,this.queryParamsSubject=B,this.fragmentSubject=Q,this.dataSubject=Ee,this.outlet=je,this.component=jt,this._futureSnapshot=Bn,this.title=null!==(Zt=null===(ar=this.dataSubject)||void 0===ar?void 0:ar.pipe((0,hn.U)(_r=>_r[ue])))&&void 0!==Zt?Zt:(0,Ve.of)(void 0),this.url=$,this.params=X,this.queryParams=B,this.fragment=Q,this.data=Ee}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,hn.U)($=>Me($)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,hn.U)($=>Me($)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function rs(L,$,X="emptyOnly"){var B;let Q;const{routeConfig:Ee}=L;var je;return Q=null===$||"always"!==X&&""!==(null==Ee?void 0:Ee.path)&&($.component||null!==(B=$.routeConfig)&&void 0!==B&&B.loadComponent)?{params:{...L.params},data:{...L.data},resolve:{...L.data,...null!==(je=L._resolvedData)&&void 0!==je?je:{}}}:{params:{...$.params,...L.params},data:{...$.data,...L.data},resolve:{...L.data,...$.data,...null==Ee?void 0:Ee.data,...L._resolvedData}},Ee&&go(Ee)&&(Q.resolve[ue]=Ee.title),Q}class Ks{get title(){var $;return null===($=this.data)||void 0===$?void 0:$[ue]}constructor($,X,B,Q,Ee,je,jt,Bn,Zt){this.url=$,this.params=X,this.queryParams=B,this.fragment=Q,this.data=Ee,this.outlet=je,this.component=jt,this.routeConfig=Bn,this._resolve=Zt}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Me(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Me(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(B=>B.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class br extends K{constructor($,X){super(X),this.url=$,Hl(this,X)}toString(){return $a(this._root)}}function Hl(L,$){$.value._routerState=L,$.children.forEach(X=>Hl(L,X))}function $a(L){const $=L.children.length>0?` { ${L.children.map($a).join(", ")} } `:"";return`${L.value}${$}`}function rc(L){if(L.snapshot){const $=L.snapshot,X=L._futureSnapshot;L.snapshot=X,nn($.queryParams,X.queryParams)||L.queryParamsSubject.next(X.queryParams),$.fragment!==X.fragment&&L.fragmentSubject.next(X.fragment),nn($.params,X.params)||L.paramsSubject.next(X.params),function zt(L,$){if(L.length!==$.length)return!1;for(let X=0;X<L.length;++X)if(!nn(L[X],$[X]))return!1;return!0}($.url,X.url)||L.urlSubject.next(X.url),nn($.data,X.data)||L.dataSubject.next(X.data)}else L.snapshot=L._futureSnapshot,L.dataSubject.next(L._futureSnapshot.data)}function Js(L,$){const X=nn(L.params,$.params)&&function Io(L,$){return Tr(L,$)&&L.every((X,B)=>nn(X.parameters,$[B].parameters))}(L.url,$.url);return X&&!(!L.parent!=!$.parent)&&(!L.parent||Js(L.parent,$.parent))}function go(L){return"string"==typeof L.title||null===L.title}let td=(()=>{var L;class ${constructor(){this.activated=null,this._activatedRoute=null,this.name=qe,this.activateEvents=new E.vpe,this.deactivateEvents=new E.vpe,this.attachEvents=new E.vpe,this.detachEvents=new E.vpe,this.parentContexts=(0,E.f3M)(be),this.location=(0,E.f3M)(E.s_b),this.changeDetector=(0,E.f3M)(E.sBO),this.environmentInjector=(0,E.f3M)(E.lqb),this.inputBinder=(0,E.f3M)(qc,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(B){if(B.name){const{firstChange:Q,previousValue:Ee}=B.name;if(Q)return;this.isTrackedInParentContexts(Ee)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(Ee)),this.initializeOutletWithName()}}ngOnDestroy(){var B;this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),null===(B=this.inputBinder)||void 0===B||B.unsubscribeFromRouteData(this)}isTrackedInParentContexts(B){var Q;return(null===(Q=this.parentContexts.getContext(B))||void 0===Q?void 0:Q.outlet)===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const B=this.parentContexts.getContext(this.name);null!=B&&B.route&&(B.attachRef?this.attach(B.attachRef,B.route):this.activateWith(B.route,B.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new E.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new E.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new E.vHH(4012,!1);this.location.detach();const B=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(B.instance),B}attach(B,Q){var Ee;this.activated=B,this._activatedRoute=Q,this.location.insert(B.hostView),null===(Ee=this.inputBinder)||void 0===Ee||Ee.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(B.instance)}deactivate(){if(this.activated){const B=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(B)}}activateWith(B,Q){var Ee;if(this.isActivated)throw new E.vHH(4013,!1);this._activatedRoute=B;const je=this.location,Bn=B.snapshot.component,Zt=this.parentContexts.getOrCreateContext(this.name).children,ar=new xc(B,Zt,je.injector);this.activated=je.createComponent(Bn,{index:je.length,injector:ar,environmentInjector:null!=Q?Q:this.environmentInjector}),this.changeDetector.markForCheck(),null===(Ee=this.inputBinder)||void 0===Ee||Ee.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275dir=E.lG2({type:L,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[E.TTD]}),$})();class xc{constructor($,X,B){this.route=$,this.childContexts=X,this.parent=B}get($,X){return $===ui?this.route:$===be?this.childContexts:this.parent.get($,X)}}const qc=new E.OlP("");let Wl=(()=>{var L;class ${constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(B){this.unsubscribeFromRouteData(B),this.subscribeToRouteData(B)}unsubscribeFromRouteData(B){var Q;null===(Q=this.outletDataSubscriptions.get(B))||void 0===Q||Q.unsubscribe(),this.outletDataSubscriptions.delete(B)}subscribeToRouteData(B){const{activatedRoute:Q}=B,Ee=(0,Be.a)([Q.queryParams,Q.params,Q.data]).pipe((0,lt.w)(([je,jt,Bn],Zt)=>(Bn={...je,...jt,...Bn},0===Zt?(0,Ve.of)(Bn):Promise.resolve(Bn)))).subscribe(je=>{if(!B.isActivated||!B.activatedComponentRef||B.activatedRoute!==Q||null===Q.component)return void this.unsubscribeFromRouteData(B);const jt=(0,E.qFp)(Q.component);if(jt)for(const{templateName:Bn}of jt.inputs)B.activatedComponentRef.setInput(Bn,je[Bn]);else this.unsubscribeFromRouteData(B)});this.outletDataSubscriptions.set(B,Ee)}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac}),$})();function Yc(L,$,X){if(X&&L.shouldReuseRoute($.value,X.value.snapshot)){const B=X.value;B._futureSnapshot=$.value;const Q=function Ea(L,$,X){return $.children.map(B=>{for(const Q of X.children)if(L.shouldReuseRoute(B.value,Q.value.snapshot))return Yc(L,B,Q);return Yc(L,B)})}(L,$,X);return new Hr(B,Q)}{if(L.shouldAttach($.value)){const Ee=L.retrieve($.value);if(null!==Ee){const je=Ee.route;return je.value._futureSnapshot=$.value,je.children=$.children.map(jt=>Yc(L,jt)),je}}const B=function Gh(L){return new ui(new Le.X(L.url),new Le.X(L.params),new Le.X(L.queryParams),new Le.X(L.fragment),new Le.X(L.data),L.outlet,L.component,L)}($.value),Q=$.children.map(Ee=>Yc(L,Ee));return new Hr(B,Q)}}const ic="ngNavigationCancelingError";function Zc(L,$){const{redirectTo:X,navigationBehaviorOptions:B}=ko($)?{redirectTo:$,navigationBehaviorOptions:void 0}:$,Q=hs(!1,0,$);return Q.url=X,Q.navigationBehaviorOptions=B,Q}function hs(L,$,X){const B=new Error("NavigationCancelingError: "+(L||""));return B[ic]=!0,B.cancellationCode=$,X&&(B.url=X),B}function nd(L){return L&&L[ic]}let Ml=(()=>{var L;class ${}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275cmp=E.Xpm({type:L,selectors:[["ng-component"]],standalone:!0,features:[E.jDz],decls:1,vars:0,template:function(B,Q){1&B&&E._UZ(0,"router-outlet")},dependencies:[td],encapsulation:2}),$})();function oc(L){const $=L.children&&L.children.map(oc),X=$?{...L,children:$}:{...L};return!X.component&&!X.loadComponent&&($||X.loadChildren)&&X.outlet&&X.outlet!==qe&&(X.component=Ml),X}function di(L){return L.outlet||qe}function No(L){var $;if(!L)return null;if(null!==($=L.routeConfig)&&void 0!==$&&$._injector)return L.routeConfig._injector;for(let X=L.parent;X;X=X.parent){const B=X.routeConfig;if(null!=B&&B._loadedInjector)return B._loadedInjector;if(null!=B&&B._injector)return B._injector}return null}class Hh{constructor($,X,B,Q,Ee){this.routeReuseStrategy=$,this.futureState=X,this.currState=B,this.forwardEvent=Q,this.inputBindingEnabled=Ee}activate($){const X=this.futureState._root,B=this.currState?this.currState._root:null;this.deactivateChildRoutes(X,B,$),rc(this.futureState.root),this.activateChildRoutes(X,B,$)}deactivateChildRoutes($,X,B){const Q=$o(X);$.children.forEach(Ee=>{const je=Ee.value.outlet;this.deactivateRoutes(Ee,Q[je],B),delete Q[je]}),Object.values(Q).forEach(Ee=>{this.deactivateRouteAndItsChildren(Ee,B)})}deactivateRoutes($,X,B){const Q=$.value,Ee=X?X.value:null;if(Q===Ee)if(Q.component){const je=B.getContext(Q.outlet);je&&this.deactivateChildRoutes($,X,je.children)}else this.deactivateChildRoutes($,X,B);else Ee&&this.deactivateRouteAndItsChildren(X,B)}deactivateRouteAndItsChildren($,X){$.value.component&&this.routeReuseStrategy.shouldDetach($.value.snapshot)?this.detachAndStoreRouteSubtree($,X):this.deactivateRouteAndOutlet($,X)}detachAndStoreRouteSubtree($,X){const B=X.getContext($.value.outlet),Q=B&&$.value.component?B.children:X,Ee=$o($);for(const je of Object.keys(Ee))this.deactivateRouteAndItsChildren(Ee[je],Q);if(B&&B.outlet){const je=B.outlet.detach(),jt=B.children.onOutletDeactivated();this.routeReuseStrategy.store($.value.snapshot,{componentRef:je,route:$,contexts:jt})}}deactivateRouteAndOutlet($,X){const B=X.getContext($.value.outlet),Q=B&&$.value.component?B.children:X,Ee=$o($);for(const je of Object.keys(Ee))this.deactivateRouteAndItsChildren(Ee[je],Q);B&&(B.outlet&&(B.outlet.deactivate(),B.children.onOutletDeactivated()),B.attachRef=null,B.route=null)}activateChildRoutes($,X,B){const Q=$o(X);$.children.forEach(Ee=>{this.activateRoutes(Ee,Q[Ee.value.outlet],B),this.forwardEvent(new wn(Ee.value.snapshot))}),$.children.length&&this.forwardEvent(new Pn($.value.snapshot))}activateRoutes($,X,B){const Q=$.value,Ee=X?X.value:null;if(rc(Q),Q===Ee)if(Q.component){const je=B.getOrCreateContext(Q.outlet);this.activateChildRoutes($,X,je.children)}else this.activateChildRoutes($,X,B);else if(Q.component){const je=B.getOrCreateContext(Q.outlet);if(this.routeReuseStrategy.shouldAttach(Q.snapshot)){const jt=this.routeReuseStrategy.retrieve(Q.snapshot);this.routeReuseStrategy.store(Q.snapshot,null),je.children.onOutletReAttached(jt.contexts),je.attachRef=jt.componentRef,je.route=jt.route.value,je.outlet&&je.outlet.attach(jt.componentRef,jt.route.value),rc(jt.route.value),this.activateChildRoutes($,null,je.children)}else{const jt=No(Q.snapshot);je.attachRef=null,je.route=Q,je.injector=jt,je.outlet&&je.outlet.activateWith(Q,je.injector),this.activateChildRoutes($,null,je.children)}}else this.activateChildRoutes($,null,B)}}class th{constructor($){this.path=$,this.route=this.path[this.path.length-1]}}class cl{constructor($,X){this.component=$,this.route=X}}function rd(L,$,X){const B=L._root;return Qn(B,$?$._root:null,X,[B.value])}function eo(L,$){const X=Symbol(),B=$.get(L,X);return B===X?"function"!=typeof L||(0,E.Z0I)(L)?$.get(L):L:B}function Qn(L,$,X,B,Q={canDeactivateChecks:[],canActivateChecks:[]}){const Ee=$o($);return L.children.forEach(je=>{(function $r(L,$,X,B,Q={canDeactivateChecks:[],canActivateChecks:[]}){const Ee=L.value,je=$?$.value:null,jt=X?X.getContext(L.value.outlet):null;if(je&&Ee.routeConfig===je.routeConfig){const Bn=function jo(L,$,X){if("function"==typeof X)return X(L,$);switch(X){case"pathParamsChange":return!Tr(L.url,$.url);case"pathParamsOrQueryParamsChange":return!Tr(L.url,$.url)||!nn(L.queryParams,$.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Js(L,$)||!nn(L.queryParams,$.queryParams);default:return!Js(L,$)}}(je,Ee,Ee.routeConfig.runGuardsAndResolvers);Bn?Q.canActivateChecks.push(new th(B)):(Ee.data=je.data,Ee._resolvedData=je._resolvedData),Qn(L,$,Ee.component?jt?jt.children:null:X,B,Q),Bn&&jt&&jt.outlet&&jt.outlet.isActivated&&Q.canDeactivateChecks.push(new cl(jt.outlet.component,je))}else je&&ta($,jt,Q),Q.canActivateChecks.push(new th(B)),Qn(L,null,Ee.component?jt?jt.children:null:X,B,Q)})(je,Ee[je.value.outlet],X,B.concat([je.value]),Q),delete Ee[je.value.outlet]}),Object.entries(Ee).forEach(([je,jt])=>ta(jt,X.getContext(je),Q)),Q}function ta(L,$,X){const B=$o(L),Q=L.value;Object.entries(B).forEach(([Ee,je])=>{ta(je,Q.component?$?$.children.getContext(Ee):null:$,X)}),X.canDeactivateChecks.push(new cl(Q.component&&$&&$.outlet&&$.outlet.isActivated?$.outlet.component:null,Q))}function ws(L){return"function"==typeof L}function Ge(L){return L instanceof wt||"EmptyError"===(null==L?void 0:L.name)}const Mn=Symbol("INITIAL_VALUE");function Nr(){return(0,lt.w)(L=>(0,Be.a)(L.map($=>$.pipe((0,me.q)(1),function Te(...L){const $=(0,st.yG)(L);return(0,Ft.e)((X,B)=>{($?(0,Ue.z)(L,X,$):(0,Ue.z)(L,X)).subscribe(B)})}(Mn)))).pipe((0,hn.U)($=>{for(const X of $)if(!0!==X){if(X===Mn)return Mn;if(!1===X||X instanceof Ui)return X}return!0}),(0,De.h)($=>$!==Mn),(0,me.q)(1)))}function Kc(L){return(0,Mt.z)((0,sn.b)($=>{if(ko($))throw Zc(0,$)}),(0,hn.U)($=>!0===$))}class Xc{constructor($){this.segmentGroup=$||null}}class Vt extends Error{constructor($){super(),this.urlTree=$}}function Bo(L){return(0,xt._)(new Xc(L))}class od{constructor($,X){this.urlSerializer=$,this.urlTree=X}lineralizeSegments($,X){let B=[],Q=X.root;for(;;){if(B=B.concat(Q.segments),0===Q.numberOfChildren)return(0,Ve.of)(B);if(Q.numberOfChildren>1||!Q.children[qe])return(0,xt._)(new E.vHH(4e3,!1));Q=Q.children[qe]}}applyRedirectCommands($,X,B){const Q=this.applyRedirectCreateUrlTree(X,this.urlSerializer.parse(X),$,B);if(X.startsWith("/"))throw new Vt(Q);return Q}applyRedirectCreateUrlTree($,X,B,Q){const Ee=this.createSegmentGroup($,X.root,B,Q);return new Ui(Ee,this.createQueryParams(X.queryParams,this.urlTree.queryParams),X.fragment)}createQueryParams($,X){const B={};return Object.entries($).forEach(([Q,Ee])=>{if("string"==typeof Ee&&Ee.startsWith(":")){const jt=Ee.substring(1);B[Q]=X[jt]}else B[Q]=Ee}),B}createSegmentGroup($,X,B,Q){const Ee=this.createSegments($,X.segments,B,Q);let je={};return Object.entries(X.children).forEach(([jt,Bn])=>{je[jt]=this.createSegmentGroup($,Bn,B,Q)}),new fr(Ee,je)}createSegments($,X,B,Q){return X.map(Ee=>Ee.path.startsWith(":")?this.findPosParam($,Ee,Q):this.findOrReturn(Ee,B))}findPosParam($,X,B){const Q=B[X.path.substring(1)];if(!Q)throw new E.vHH(4001,!1);return Q}findOrReturn($,X){let B=0;for(const Q of X){if(Q.path===$.path)return X.splice(B),Q;B++}return $}}const Ta={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sd(L,$,X,B,Q){const Ee=ms(L,$,X);return Ee.matched?(B=function Us(L,$){var X;return L.providers&&!L._injector&&(L._injector=(0,E.MMx)(L.providers,$,`Route: ${L.path}`)),null!==(X=L._injector)&&void 0!==X?X:$}($,B),function ja(L,$,X,B){const Q=$.canMatch;if(!Q||0===Q.length)return(0,Ve.of)(!0);const Ee=Q.map(je=>{const jt=eo(je,L);return cn(function Y(L){return L&&ws(L.canMatch)}(jt)?jt.canMatch($,X):(0,E.r_H)(L,()=>jt($,X)))});return(0,Ve.of)(Ee).pipe(Nr(),Kc())}(B,$,X).pipe((0,hn.U)(je=>!0===je?Ee:{...Ta}))):(0,Ve.of)(Ee)}function ms(L,$,X){var B,Q;if("**"===$.path)return function nh(L){return{matched:!0,parameters:L.length>0?Zn(L).parameters:{},consumedSegments:L,remainingSegments:[],positionalParamSegments:{}}}(X);if(""===$.path)return"full"===$.pathMatch&&(L.hasChildren()||X.length>0)?{...Ta}:{matched:!0,consumedSegments:[],remainingSegments:X,parameters:{},positionalParamSegments:{}};const je=($.matcher||Bt)(X,L,$);if(!je)return{...Ta};const jt={};Object.entries(null!==(B=je.posParams)&&void 0!==B?B:{}).forEach(([Zt,ar])=>{jt[Zt]=ar.path});const Bn=je.consumed.length>0?{...jt,...je.consumed[je.consumed.length-1].parameters}:jt;return{matched:!0,consumedSegments:je.consumed,remainingSegments:X.slice(je.consumed.length),parameters:Bn,positionalParamSegments:null!==(Q=je.posParams)&&void 0!==Q?Q:{}}}function hl(L,$,X,B){return X.length>0&&function ap(L,$,X){return X.some(B=>Eu(L,$,B)&&di(B)!==qe)}(L,X,B)?{segmentGroup:new fr($,Lm(B,new fr(X,L.children))),slicedSegments:[]}:0===X.length&&function fy(L,$,X){return X.some(B=>Eu(L,$,B))}(L,X,B)?{segmentGroup:new fr(L.segments,hy(L,0,X,B,L.children)),slicedSegments:X}:{segmentGroup:new fr(L.segments,L.children),slicedSegments:X}}function hy(L,$,X,B,Q){const Ee={};for(const je of B)if(Eu(L,X,je)&&!Q[di(je)]){const jt=new fr([],{});Ee[di(je)]=jt}return{...Q,...Ee}}function Lm(L,$){const X={};X[qe]=$;for(const B of L)if(""===B.path&&di(B)!==qe){const Q=new fr([],{});X[di(B)]=Q}return X}function Eu(L,$,X){return(!(L.hasChildren()||$.length>0)||"full"!==X.pathMatch)&&""===X.path}class $0{}class py{constructor($,X,B,Q,Ee,je,jt){this.injector=$,this.configLoader=X,this.rootComponentType=B,this.config=Q,this.urlTree=Ee,this.paramsInheritanceStrategy=je,this.urlSerializer=jt,this.applyRedirects=new od(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError($){return new E.vHH(4002,`'${$.segmentGroup}'`)}recognize(){const $=hl(this.urlTree.root,[],[],this.config).segmentGroup;return this.match($).pipe((0,hn.U)(X=>{const B=new Ks([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},qe,this.rootComponentType,null,{}),Q=new Hr(B,X),Ee=new br("",Q),je=function es(L,$,X=null,B=null){return fo(ts(L),$,X,B)}(B,[],this.urlTree.queryParams,this.urlTree.fragment);return je.queryParams=this.urlTree.queryParams,Ee.url=this.urlSerializer.serialize(je),this.inheritParamsAndData(Ee._root,null),{state:Ee,tree:je}}))}match($){return this.processSegmentGroup(this.injector,this.config,$,qe).pipe((0,yt.K)(B=>{if(B instanceof Vt)return this.urlTree=B.urlTree,this.match(B.urlTree.root);throw B instanceof Xc?this.noMatchError(B):B}))}inheritParamsAndData($,X){const B=$.value,Q=rs(B,X,this.paramsInheritanceStrategy);B.params=Object.freeze(Q.params),B.data=Object.freeze(Q.data),$.children.forEach(Ee=>this.inheritParamsAndData(Ee,B))}processSegmentGroup($,X,B,Q){return 0===B.segments.length&&B.hasChildren()?this.processChildren($,X,B):this.processSegment($,X,B,B.segments,Q,!0).pipe((0,hn.U)(Ee=>Ee instanceof Hr?[Ee]:[]))}processChildren($,X,B){const Q=[];for(const Ee of Object.keys(B.children))"primary"===Ee?Q.unshift(Ee):Q.push(Ee);return(0,ge.D)(Q).pipe(_n(Ee=>{const je=B.children[Ee],jt=function Lo(L,$){const X=L.filter(B=>di(B)===$);return X.push(...L.filter(B=>di(B)!==$)),X}(X,Ee);return this.processSegmentGroup($,jt,je,Ee)}),function tt(L,$){return(0,Ft.e)(function Xe(L,$,X,B,Q){return(Ee,je)=>{let jt=X,Bn=$,Zt=0;Ee.subscribe((0,mt.x)(je,ar=>{const _r=Zt++;Bn=jt?L(Bn,ar,_r):(jt=!0,ar),B&&je.next(Bn)},Q&&(()=>{jt&&je.next(Bn),je.complete()})))}}(L,$,arguments.length>=2,!0))}((Ee,je)=>(Ee.push(...je),Ee)),Gt(null),function _t(L,$){const X=arguments.length>=2;return B=>B.pipe(L?(0,De.h)((Q,Ee)=>L(Q,Ee,B)):Un.y,Ye(1),X?Gt($):en(()=>new wt))}(),(0,dt.z)(Ee=>{if(null===Ee)return Bo(B);const je=rh(Ee);return function Nm(L){L.sort(($,X)=>$.value.outlet===qe?-1:X.value.outlet===qe?1:$.value.outlet.localeCompare(X.value.outlet))}(je),(0,Ve.of)(je)}))}processSegment($,X,B,Q,Ee,je){return(0,ge.D)(X).pipe(_n(jt=>{var Bn;return this.processSegmentAgainstRoute(null!==(Bn=jt._injector)&&void 0!==Bn?Bn:$,X,jt,B,Q,Ee,je).pipe((0,yt.K)(Zt=>{if(Zt instanceof Xc)return(0,Ve.of)(null);throw Zt}))}),nr(jt=>!!jt),(0,yt.K)(jt=>{if(Ge(jt))return function lp(L,$,X){return 0===$.length&&!L.children[X]}(B,Q,Ee)?(0,Ve.of)(new $0):Bo(B);throw jt}))}processSegmentAgainstRoute($,X,B,Q,Ee,je,jt){return function U0(L,$,X,B){return!!(di(L)===B||B!==qe&&Eu($,X,L))&&ms($,L,X).matched}(B,Q,Ee,je)?void 0===B.redirectTo?this.matchSegmentAgainstRoute($,Q,B,Ee,je):this.allowRedirects&&jt?this.expandSegmentAgainstRouteUsingRedirect($,Q,X,B,Ee,je):Bo(Q):Bo(Q)}expandSegmentAgainstRouteUsingRedirect($,X,B,Q,Ee,je){const{matched:jt,consumedSegments:Bn,positionalParamSegments:Zt,remainingSegments:ar}=ms(X,Q,Ee);if(!jt)return Bo(X);Q.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const _r=this.applyRedirects.applyRedirectCommands(Bn,Q.redirectTo,Zt);return this.applyRedirects.lineralizeSegments(Q,_r).pipe((0,dt.z)(os=>this.processSegment($,B,X,os.concat(ar),je,!1)))}matchSegmentAgainstRoute($,X,B,Q,Ee){const je=sd(X,B,Q,$);return"**"===B.path&&(X.children={}),je.pipe((0,lt.w)(jt=>{var Bn;return jt.matched?($=null!==(Bn=B._injector)&&void 0!==Bn?Bn:$,this.getChildConfig($,B,Q).pipe((0,lt.w)(({routes:Zt})=>{var ar,_r,os;const mo=null!==(ar=B._loadedInjector)&&void 0!==ar?ar:$,{consumedSegments:js,remainingSegments:da,parameters:cd}=jt,ud=new Ks(js,cd,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function V(L){return L.data||{}}(B),di(B),null!==(_r=null!==(os=B.component)&&void 0!==os?os:B._loadedComponent)&&void 0!==_r?_r:null,B,function ie(L){return L.resolve||{}}(B)),{segmentGroup:eu,slicedSegments:ha}=hl(X,js,da,Zt);if(0===ha.length&&eu.hasChildren())return this.processChildren(mo,Zt,eu).pipe((0,hn.U)(tu=>null===tu?null:new Hr(ud,tu)));if(0===Zt.length&&0===ha.length)return(0,Ve.of)(new Hr(ud,[]));const mp=di(B)===Ee;return this.processSegment(mo,Zt,eu,ha,mp?qe:Ee,!0).pipe((0,hn.U)(tu=>new Hr(ud,tu instanceof Hr?[tu]:[])))}))):Bo(X)}))}getChildConfig($,X,B){return X.children?(0,Ve.of)({routes:X.children,injector:$}):X.loadChildren?void 0!==X._loadedRoutes?(0,Ve.of)({routes:X._loadedRoutes,injector:X._loadedInjector}):function Wh(L,$,X,B){const Q=$.canLoad;if(void 0===Q||0===Q.length)return(0,Ve.of)(!0);const Ee=Q.map(je=>{const jt=eo(je,L);return cn(function sc(L){return L&&ws(L.canLoad)}(jt)?jt.canLoad($,X):(0,E.r_H)(L,()=>jt($,X)))});return(0,Ve.of)(Ee).pipe(Nr(),Kc())}($,X,B).pipe((0,dt.z)(Q=>Q?this.configLoader.loadChildren($,X).pipe((0,sn.b)(Ee=>{X._loadedRoutes=Ee.routes,X._loadedInjector=Ee.injector})):function ps(L){return(0,xt._)(hs(!1,3))}())):(0,Ve.of)({routes:[],injector:$})}}function H1(L){const $=L.value.routeConfig;return $&&""===$.path}function rh(L){const $=[],X=new Set;for(const B of L){if(!H1(B)){$.push(B);continue}const Q=$.find(Ee=>B.value.routeConfig===Ee.value.routeConfig);void 0!==Q?(Q.children.push(...B.children),X.add(Q)):$.push(B)}for(const B of X){const Q=rh(B.children);$.push(new Hr(B.value,Q))}return $.filter(B=>!X.has(B))}function Ne(L){const $=L.children.map(X=>Ne(X)).flat();return[L,...$]}function yi(L){return(0,lt.w)($=>{const X=L($);return X?(0,ge.D)(X).pipe((0,hn.U)(()=>$)):(0,Ve.of)($)})}let Yi=(()=>{var L;class ${buildTitle(B){let Q,Ee=B.root;for(;void 0!==Ee;){var je;Q=null!==(je=this.getResolvedTitleForRoute(Ee))&&void 0!==je?je:Q,Ee=Ee.children.find(jt=>jt.outlet===qe)}return Q}getResolvedTitleForRoute(B){return B.data[ue]}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:()=>(0,E.f3M)(to),providedIn:"root"}),$})(),to=(()=>{var L;class $ extends Yi{constructor(B){super(),this.title=B}updateTitle(B){const Q=this.buildTitle(B);void 0!==Q&&this.title.setTitle(Q)}}return(L=$).\u0275fac=function(B){return new(B||L)(E.LFG(An.Dx))},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();const Ii=new E.OlP("",{providedIn:"root",factory:()=>({})}),_o=new E.OlP("ROUTES");let oo=(()=>{var L;class ${constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,E.f3M)(E.Sil)}loadComponent(B){if(this.componentLoaders.get(B))return this.componentLoaders.get(B);if(B._loadedComponent)return(0,Ve.of)(B._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(B);const Q=cn(B.loadComponent()).pipe((0,hn.U)(Er),(0,sn.b)(je=>{this.onLoadEndListener&&this.onLoadEndListener(B),B._loadedComponent=je}),Gn(()=>{this.componentLoaders.delete(B)})),Ee=new Jt.c(Q,()=>new Ot.x).pipe((0,rr.x)());return this.componentLoaders.set(B,Ee),Ee}loadChildren(B,Q){if(this.childrenLoaders.get(Q))return this.childrenLoaders.get(Q);if(Q._loadedRoutes)return(0,Ve.of)({routes:Q._loadedRoutes,injector:Q._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(Q);const je=function $s(L,$,X,B){return cn(L.loadChildren()).pipe((0,hn.U)(Er),(0,dt.z)(Q=>Q instanceof E.YKP||Array.isArray(Q)?(0,Ve.of)(Q):(0,ge.D)($.compileModuleAsync(Q))),(0,hn.U)(Q=>{B&&B(L);let Ee,je,jt=!1;return Array.isArray(Q)?(je=Q,!0):(Ee=Q.create(X).injector,je=Ee.get(_o,[],{optional:!0,self:!0}).flat()),{routes:je.map(oc),injector:Ee}}))}(Q,this.compiler,B,this.onLoadEndListener).pipe(Gn(()=>{this.childrenLoaders.delete(Q)})),jt=new Jt.c(je,()=>new Ot.x).pipe((0,rr.x)());return this.childrenLoaders.set(Q,jt),jt}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();function Er(L){return function Ol(L){return L&&"object"==typeof L&&"default"in L}(L)?L.default:L}let Yl=(()=>{var L;class ${}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:()=>(0,E.f3M)(kl),providedIn:"root"}),$})(),kl=(()=>{var L;class ${shouldProcessUrl(B){return!0}extract(B){return B}merge(B,Q){return B}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();const ca=new E.OlP(""),Ga=new E.OlP("");function Qc(L,$,X){const B=L.get(Ga),Q=L.get(Pt.K0);return L.get(E.R0b).runOutsideAngular(()=>{if(!Q.startViewTransition||B.skipNextTransition)return B.skipNextTransition=!1,Promise.resolve();let Ee;const je=new Promise(Zt=>{Ee=Zt}),jt=Q.startViewTransition(()=>(Ee(),function Ll(L){return new Promise($=>{(0,E.T8G)($,{injector:L})})}(L))),{onViewTransitionCreated:Bn}=B;return Bn&&(0,E.r_H)(L,()=>Bn({transition:jt,from:$,to:X})),je})}let Aa=(()=>{var L;class ${get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ot.x,this.transitionAbortSubject=new Ot.x,this.configLoader=(0,E.f3M)(oo),this.environmentInjector=(0,E.f3M)(E.lqb),this.urlSerializer=(0,E.f3M)(Mo),this.rootContexts=(0,E.f3M)(be),this.location=(0,E.f3M)(Pt.Ye),this.inputBindingEnabled=null!==(0,E.f3M)(qc,{optional:!0}),this.titleStrategy=(0,E.f3M)(Yi),this.options=(0,E.f3M)(Ii,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=(0,E.f3M)(Yl),this.createViewTransition=(0,E.f3M)(ca,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,Ve.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=Ee=>this.events.next(new bn(Ee)),this.configLoader.onLoadStartListener=Ee=>this.events.next(new fn(Ee))}complete(){var B;null===(B=this.transitions)||void 0===B||B.complete()}handleNavigationRequest(B){var Q;const Ee=++this.navigationId;null===(Q=this.transitions)||void 0===Q||Q.next({...this.transitions.value,...B,id:Ee})}setupNavigations(B,Q,Ee){return this.transitions=new Le.X({id:0,currentUrlTree:Q,currentRawUrl:Q,extractedUrl:this.urlHandlingStrategy.extract(Q),urlAfterRedirects:this.urlHandlingStrategy.extract(Q),rawUrl:Q,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ne,restoredState:null,currentSnapshot:Ee.snapshot,targetSnapshot:null,currentRouterState:Ee,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,De.h)(je=>0!==je.id),(0,hn.U)(je=>({...je,extractedUrl:this.urlHandlingStrategy.extract(je.rawUrl)})),(0,lt.w)(je=>{this.currentTransition=je;let jt=!1,Bn=!1;return(0,Ve.of)(je).pipe((0,sn.b)(Zt=>{this.currentNavigation={id:Zt.id,initialUrl:Zt.rawUrl,extractedUrl:Zt.extractedUrl,trigger:Zt.source,extras:Zt.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,lt.w)(Zt=>{var ar;const _r=!B.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),os=null!==(ar=Zt.extras.onSameUrlNavigation)&&void 0!==ar?ar:B.onSameUrlNavigation;if(!_r&&"reload"!==os){const mo="";return this.events.next(new Qt(Zt.id,this.urlSerializer.serialize(Zt.rawUrl),mo,0)),Zt.resolve(null),gt.E}if(this.urlHandlingStrategy.shouldProcessUrl(Zt.rawUrl))return(0,Ve.of)(Zt).pipe((0,lt.w)(mo=>{var js,da;const cd=null===(js=this.transitions)||void 0===js?void 0:js.getValue();return this.events.next(new _e(mo.id,this.urlSerializer.serialize(mo.extractedUrl),mo.source,mo.restoredState)),cd!==(null===(da=this.transitions)||void 0===da?void 0:da.getValue())?gt.E:Promise.resolve(mo)}),function Qe(L,$,X,B,Q,Ee){return(0,dt.z)(je=>function JI(L,$,X,B,Q,Ee,je="emptyOnly"){return new py(L,$,X,B,Q,je,Ee).recognize()}(L,$,X,B,je.extractedUrl,Q,Ee).pipe((0,hn.U)(({state:jt,tree:Bn})=>({...je,targetSnapshot:jt,urlAfterRedirects:Bn}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,B.config,this.urlSerializer,this.paramsInheritanceStrategy),(0,sn.b)(mo=>{je.targetSnapshot=mo.targetSnapshot,je.urlAfterRedirects=mo.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:mo.urlAfterRedirects};const js=new ce(mo.id,this.urlSerializer.serialize(mo.extractedUrl),this.urlSerializer.serialize(mo.urlAfterRedirects),mo.targetSnapshot);this.events.next(js)}));if(_r&&this.urlHandlingStrategy.shouldProcessUrl(Zt.currentRawUrl)){const{id:mo,extractedUrl:js,source:da,restoredState:cd,extras:ud}=Zt,eu=new _e(mo,this.urlSerializer.serialize(js),da,cd);this.events.next(eu);const ha=Wn(0,this.rootComponentType).snapshot;return this.currentTransition=je={...Zt,targetSnapshot:ha,urlAfterRedirects:js,extras:{...ud,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=js,(0,Ve.of)(je)}{const mo="";return this.events.next(new Qt(Zt.id,this.urlSerializer.serialize(Zt.extractedUrl),mo,1)),Zt.resolve(null),gt.E}}),(0,sn.b)(Zt=>{const ar=new Pe(Zt.id,this.urlSerializer.serialize(Zt.extractedUrl),this.urlSerializer.serialize(Zt.urlAfterRedirects),Zt.targetSnapshot);this.events.next(ar)}),(0,hn.U)(Zt=>(this.currentTransition=je={...Zt,guards:rd(Zt.targetSnapshot,Zt.currentSnapshot,this.rootContexts)},je)),function Fo(L,$){return(0,dt.z)(X=>{const{targetSnapshot:B,currentSnapshot:Q,guards:{canActivateChecks:Ee,canDeactivateChecks:je}}=X;return 0===je.length&&0===Ee.length?(0,Ve.of)({...X,guardsResult:!0}):function as(L,$,X,B){return(0,ge.D)(L).pipe((0,dt.z)(Q=>function hi(L,$,X,B,Q){const Ee=$&&$.routeConfig?$.routeConfig.canDeactivate:null;if(!Ee||0===Ee.length)return(0,Ve.of)(!0);const je=Ee.map(jt=>{var Bn;const Zt=null!==(Bn=No($))&&void 0!==Bn?Bn:Q,ar=eo(jt,Zt);return cn(function se(L){return L&&ws(L.canDeactivate)}(ar)?ar.canDeactivate(L,$,X,B):(0,E.r_H)(Zt,()=>ar(L,$,X,B))).pipe(nr())});return(0,Ve.of)(je).pipe(Nr())}(Q.component,Q.route,X,$,B)),nr(Q=>!0!==Q,!0))}(je,B,Q,L).pipe((0,dt.z)(jt=>jt&&function ka(L){return"boolean"==typeof L}(jt)?function ul(L,$,X,B){return(0,ge.D)($).pipe(_n(Q=>(0,Ue.z)(function Pl(L,$){return null!==L&&$&&$(new Fn(L)),(0,Ve.of)(!0)}(Q.route.parent,B),function dl(L,$){return null!==L&&$&&$(new kt(L)),(0,Ve.of)(!0)}(Q.route,B),function Ia(L,$,X){const B=$[$.length-1],Ee=$.slice(0,$.length-1).reverse().map(je=>function id(L){const $=L.routeConfig?L.routeConfig.canActivateChild:null;return $&&0!==$.length?{node:L,guards:$}:null}(je)).filter(je=>null!==je).map(je=>(0,vt.P)(()=>{const jt=je.guards.map(Bn=>{var Zt;const ar=null!==(Zt=No(je.node))&&void 0!==Zt?Zt:X,_r=eo(Bn,ar);return cn(function Ps(L){return L&&ws(L.canActivateChild)}(_r)?_r.canActivateChild(B,L):(0,E.r_H)(ar,()=>_r(B,L))).pipe(nr())});return(0,Ve.of)(jt).pipe(Nr())}));return(0,Ve.of)(Ee).pipe(Nr())}(L,Q.path,X),function wc(L,$,X){const B=$.routeConfig?$.routeConfig.canActivate:null;if(!B||0===B.length)return(0,Ve.of)(!0);const Q=B.map(Ee=>(0,vt.P)(()=>{var je;const jt=null!==(je=No($))&&void 0!==je?je:X,Bn=eo(Ee,jt);return cn(function _i(L){return L&&ws(L.canActivate)}(Bn)?Bn.canActivate($,L):(0,E.r_H)(jt,()=>Bn($,L))).pipe(nr())}));return(0,Ve.of)(Q).pipe(Nr())}(L,Q.route,X))),nr(Q=>!0!==Q,!0))}(B,Ee,L,$):(0,Ve.of)(jt)),(0,hn.U)(jt=>({...X,guardsResult:jt})))})}(this.environmentInjector,Zt=>this.events.next(Zt)),(0,sn.b)(Zt=>{if(je.guardsResult=Zt.guardsResult,ko(Zt.guardsResult))throw Zc(0,Zt.guardsResult);const ar=new ct(Zt.id,this.urlSerializer.serialize(Zt.extractedUrl),this.urlSerializer.serialize(Zt.urlAfterRedirects),Zt.targetSnapshot,!!Zt.guardsResult);this.events.next(ar)}),(0,De.h)(Zt=>!!Zt.guardsResult||(this.cancelNavigationTransition(Zt,"",3),!1)),yi(Zt=>{if(Zt.guards.canActivateChecks.length)return(0,Ve.of)(Zt).pipe((0,sn.b)(ar=>{const _r=new $t(ar.id,this.urlSerializer.serialize(ar.extractedUrl),this.urlSerializer.serialize(ar.urlAfterRedirects),ar.targetSnapshot);this.events.next(_r)}),(0,lt.w)(ar=>{let _r=!1;return(0,Ve.of)(ar).pipe(function ee(L,$){return(0,dt.z)(X=>{const{targetSnapshot:B,guards:{canActivateChecks:Q}}=X;if(!Q.length)return(0,Ve.of)(X);const Ee=new Set(Q.map(Bn=>Bn.route)),je=new Set;for(const Bn of Ee)if(!je.has(Bn))for(const Zt of Ne(Bn))je.add(Zt);let jt=0;return(0,ge.D)(je).pipe(_n(Bn=>Ee.has(Bn)?function pt(L,$,X,B){const Q=L.routeConfig,Ee=L._resolve;return void 0!==(null==Q?void 0:Q.title)&&!go(Q)&&(Ee[ue]=Q.title),function Cn(L,$,X,B){const Q=In(L);if(0===Q.length)return(0,Ve.of)({});const Ee={};return(0,ge.D)(Q).pipe((0,dt.z)(je=>function er(L,$,X,B){var Q;const Ee=null!==(Q=No($))&&void 0!==Q?Q:B,je=eo(L,Ee);return cn(je.resolve?je.resolve($,X):(0,E.r_H)(Ee,()=>je($,X)))}(L[je],$,X,B).pipe(nr(),(0,sn.b)(jt=>{Ee[je]=jt}))),Ye(1),(0,rn.h)(Ee),(0,yt.K)(je=>Ge(je)?gt.E:(0,xt._)(je)))}(Ee,L,$,B).pipe((0,hn.U)(je=>(L._resolvedData=je,L.data=rs(L,L.parent,X).resolve,null)))}(Bn,B,L,$):(Bn.data=rs(Bn,Bn.parent,L).resolve,(0,Ve.of)(void 0))),(0,sn.b)(()=>jt++),Ye(1),(0,dt.z)(Bn=>jt===je.size?(0,Ve.of)(X):gt.E))})}(this.paramsInheritanceStrategy,this.environmentInjector),(0,sn.b)({next:()=>_r=!0,complete:()=>{_r||this.cancelNavigationTransition(ar,"",2)}}))}),(0,sn.b)(ar=>{const _r=new bt(ar.id,this.urlSerializer.serialize(ar.extractedUrl),this.urlSerializer.serialize(ar.urlAfterRedirects),ar.targetSnapshot);this.events.next(_r)}))}),yi(Zt=>{const ar=_r=>{var os;const mo=[];null!==(os=_r.routeConfig)&&void 0!==os&&os.loadComponent&&!_r.routeConfig._loadedComponent&&mo.push(this.configLoader.loadComponent(_r.routeConfig).pipe((0,sn.b)(js=>{_r.component=js}),(0,hn.U)(()=>{})));for(const js of _r.children)mo.push(...ar(js));return mo};return(0,Be.a)(ar(Zt.targetSnapshot.root)).pipe(Gt(null),(0,me.q)(1))}),yi(()=>this.afterPreactivation()),(0,lt.w)(()=>{var Zt;const{currentSnapshot:ar,targetSnapshot:_r}=je,os=null===(Zt=this.createViewTransition)||void 0===Zt?void 0:Zt.call(this,this.environmentInjector,ar.root,_r.root);return os?(0,ge.D)(os).pipe((0,hn.U)(()=>je)):(0,Ve.of)(je)}),(0,hn.U)(Zt=>{const ar=function eh(L,$,X){const B=Yc(L,$._root,X?X._root:void 0);return new zs(B,$)}(B.routeReuseStrategy,Zt.targetSnapshot,Zt.currentRouterState);return this.currentTransition=je={...Zt,targetRouterState:ar},this.currentNavigation.targetRouterState=ar,je}),(0,sn.b)(()=>{this.events.next(new ut)}),((L,$,X,B)=>(0,hn.U)(Q=>(new Hh($,Q.targetRouterState,Q.currentRouterState,X,B).activate(L),Q)))(this.rootContexts,B.routeReuseStrategy,Zt=>this.events.next(Zt),this.inputBindingEnabled),(0,me.q)(1),(0,sn.b)({next:Zt=>{var ar;jt=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new We(Zt.id,this.urlSerializer.serialize(Zt.extractedUrl),this.urlSerializer.serialize(Zt.urlAfterRedirects))),null===(ar=this.titleStrategy)||void 0===ar||ar.updateTitle(Zt.targetRouterState.snapshot),Zt.resolve(!0)},complete:()=>{jt=!0}}),function gr(L){return(0,Ft.e)(($,X)=>{(0,Hn.Xf)(L).subscribe((0,mt.x)(X,()=>X.complete(),mr.Z)),!X.closed&&$.subscribe(X)})}(this.transitionAbortSubject.pipe((0,sn.b)(Zt=>{throw Zt}))),Gn(()=>{var Zt;jt||Bn||this.cancelNavigationTransition(je,"",1),(null===(Zt=this.currentNavigation)||void 0===Zt?void 0:Zt.id)===je.id&&(this.currentNavigation=null)}),(0,yt.K)(Zt=>{if(Bn=!0,nd(Zt))this.events.next(new Ct(je.id,this.urlSerializer.serialize(je.extractedUrl),Zt.message,Zt.cancellationCode)),function Ur(L){return nd(L)&&ko(L.url)}(Zt)?this.events.next(new Sn(Zt.url)):je.resolve(!1);else{var ar;this.events.next(new q(je.id,this.urlSerializer.serialize(je.extractedUrl),Zt,null!==(ar=je.targetSnapshot)&&void 0!==ar?ar:void 0));try{je.resolve(B.errorHandler(Zt))}catch(_r){je.reject(_r)}}return gt.E}))}))}cancelNavigationTransition(B,Q,Ee){const je=new Ct(B.id,this.urlSerializer.serialize(B.extractedUrl),Q,Ee);this.events.next(je),B.resolve(!1)}isUpdatingInternalState(){var B,Q;return(null===(B=this.currentTransition)||void 0===B?void 0:B.extractedUrl.toString())!==(null===(Q=this.currentTransition)||void 0===Q?void 0:Q.currentUrlTree.toString())}isUpdatedBrowserUrl(){var B,Q;return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==(null===(B=this.currentTransition)||void 0===B?void 0:B.extractedUrl.toString())&&!(null!==(Q=this.currentTransition)&&void 0!==Q&&Q.extras.skipLocationChange)}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();function Iu(L){return L!==ne}let Yo=(()=>{var L;class ${}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:()=>(0,E.f3M)(Tu),providedIn:"root"}),$})();class ad{shouldDetach($){return!1}store($,X){}shouldAttach($){return!1}retrieve($){return null}shouldReuseRoute($,X){return $.routeConfig===X.routeConfig}}let Tu=(()=>{var L;class $ extends ad{}return(L=$).\u0275fac=(()=>{let X;return function(Q){return(X||(X=E.n5z(L)))(Q||L)}})(),L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})(),tr=(()=>{var L;class ${}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:()=>(0,E.f3M)(ac),providedIn:"root"}),$})(),ac=(()=>{var L;class $ extends tr{constructor(){super(...arguments),this.location=(0,E.f3M)(Pt.Ye),this.urlSerializer=(0,E.f3M)(Mo),this.options=(0,E.f3M)(Ii,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=(0,E.f3M)(Yl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Ui,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Wn(0,null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){var B,Q;return"computed"!==this.canceledNavigationResolution?this.currentPageId:null!==(B=null===(Q=this.restoredState())||void 0===Q?void 0:Q.\u0275routerPageId)&&void 0!==B?B:this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(B){return this.location.subscribe(Q=>{"popstate"===Q.type&&B(Q.url,Q.state)})}handleRouterEvent(B,Q){if(B instanceof _e)this.stateMemento=this.createStateMemento();else if(B instanceof Qt)this.rawUrlTree=Q.initialUrl;else if(B instanceof ce){if("eager"===this.urlUpdateStrategy&&!Q.extras.skipLocationChange){const Ee=this.urlHandlingStrategy.merge(Q.finalUrl,Q.initialUrl);this.setBrowserUrl(Ee,Q)}}else B instanceof ut?(this.currentUrlTree=Q.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(Q.finalUrl,Q.initialUrl),this.routerState=Q.targetRouterState,"deferred"===this.urlUpdateStrategy&&(Q.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,Q))):B instanceof Ct&&(3===B.code||2===B.code)?this.restoreHistory(Q):B instanceof q?this.restoreHistory(Q,!0):B instanceof We&&(this.lastSuccessfulId=B.id,this.currentPageId=this.browserPageId)}setBrowserUrl(B,Q){const Ee=this.urlSerializer.serialize(B);if(this.location.isCurrentPathEqualTo(Ee)||Q.extras.replaceUrl){const jt={...Q.extras.state,...this.generateNgRouterState(Q.id,this.browserPageId)};this.location.replaceState(Ee,"",jt)}else{const je={...Q.extras.state,...this.generateNgRouterState(Q.id,this.browserPageId+1)};this.location.go(Ee,"",je)}}restoreHistory(B,Q=!1){if("computed"===this.canceledNavigationResolution){const je=this.currentPageId-this.browserPageId;0!==je?this.location.historyGo(je):this.currentUrlTree===B.finalUrl&&0===je&&(this.resetState(B),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(Q&&this.resetState(B),this.resetUrlToCurrentUrlTree())}resetState(B){var Q;this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,null!==(Q=B.finalUrl)&&void 0!==Q?Q:this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(B,Q){return"computed"===this.canceledNavigationResolution?{navigationId:B,\u0275routerPageId:Q}:{navigationId:B}}}return(L=$).\u0275fac=(()=>{let X;return function(Q){return(X||(X=E.n5z(L)))(Q||L)}})(),L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();var Ca=function(L){return L[L.COMPLETE=0]="COMPLETE",L[L.FAILED=1]="FAILED",L[L.REDIRECTING=2]="REDIRECTING",L}(Ca||{});function lc(L,$){L.events.pipe((0,De.h)(X=>X instanceof We||X instanceof Ct||X instanceof q||X instanceof Qt),(0,hn.U)(X=>X instanceof We||X instanceof Qt?Ca.COMPLETE:X instanceof Ct&&(0===X.code||1===X.code)?Ca.REDIRECTING:Ca.FAILED),(0,De.h)(X=>X!==Ca.REDIRECTING),(0,me.q)(1)).subscribe(()=>{$()})}function Ha(L){throw L}const H0={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ih={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Wa=(()=>{var L;class ${get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){var B,Q;this.disposed=!1,this.isNgZoneEnabled=!1,this.console=(0,E.f3M)(E.c2e),this.stateManager=(0,E.f3M)(tr),this.options=(0,E.f3M)(Ii,{optional:!0})||{},this.pendingTasks=(0,E.f3M)(E.I6F),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=(0,E.f3M)(Aa),this.urlSerializer=(0,E.f3M)(Mo),this.location=(0,E.f3M)(Pt.Ye),this.urlHandlingStrategy=(0,E.f3M)(Yl),this._events=new Ot.x,this.errorHandler=this.options.errorHandler||Ha,this.navigated=!1,this.routeReuseStrategy=(0,E.f3M)(Yo),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=null!==(B=null===(Q=(0,E.f3M)(_o,{optional:!0}))||void 0===Q?void 0:Q.flat())&&void 0!==B?B:[],this.componentInputBindingEnabled=!!(0,E.f3M)(qc,{optional:!0}),this.eventsSubscription=new Rt.w0,this.isNgZoneEnabled=(0,E.f3M)(E.R0b)instanceof E.R0b&&E.R0b.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:Ee=>{this.console.warn(Ee)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const B=this.navigationTransitions.events.subscribe(Q=>{try{const Ee=this.navigationTransitions.currentTransition,je=this.navigationTransitions.currentNavigation;if(null!==Ee&&null!==je)if(this.stateManager.handleRouterEvent(Q,je),Q instanceof Ct&&0!==Q.code&&1!==Q.code)this.navigated=!0;else if(Q instanceof We)this.navigated=!0;else if(Q instanceof Sn){const jt=this.urlHandlingStrategy.merge(Q.url,Ee.currentRawUrl),Bn={skipLocationChange:Ee.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Iu(Ee.source)};this.scheduleNavigation(jt,ne,null,Bn,{resolve:Ee.resolve,reject:Ee.reject,promise:Ee.promise})}(function oh(L){return!(L instanceof ut||L instanceof Sn)})(Q)&&this._events.next(Q)}catch(Ee){this.navigationTransitions.transitionAbortSubject.next(Ee)}});this.eventsSubscription.add(B)}resetRootComponentType(B){this.routerState.root.component=B,this.navigationTransitions.rootComponentType=B}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),ne,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription||(this.nonRouterCurrentEntryChangeSubscription=this.stateManager.registerNonRouterCurrentEntryChangeListener((B,Q)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(B,"popstate",Q)},0)}))}navigateToSyncWithBrowser(B,Q,Ee){const je={replaceUrl:!0},jt=null!=Ee&&Ee.navigationId?Ee:null;if(Ee){const Zt={...Ee};delete Zt.navigationId,delete Zt.\u0275routerPageId,0!==Object.keys(Zt).length&&(je.state=Zt)}const Bn=this.parseUrl(B);this.scheduleNavigation(Bn,Q,jt,je)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(B){this.config=B.map(oc),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(B,Q={}){const{relativeTo:Ee,queryParams:je,fragment:jt,queryParamsHandling:Bn,preserveFragment:Zt}=Q,ar=Zt?this.currentUrlTree.fragment:jt;let os,_r=null;switch(Bn){case"merge":_r={...this.currentUrlTree.queryParams,...je};break;case"preserve":_r=this.currentUrlTree.queryParams;break;default:_r=je||null}null!==_r&&(_r=this.removeEmptyProps(_r));try{os=ts(Ee?Ee.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof B[0]||!B[0].startsWith("/"))&&(B=[]),os=this.currentUrlTree.root}return fo(os,B,_r,null!=ar?ar:null)}navigateByUrl(B,Q={skipLocationChange:!1}){const Ee=ko(B)?B:this.parseUrl(B),je=this.urlHandlingStrategy.merge(Ee,this.rawUrlTree);return this.scheduleNavigation(je,ne,null,Q)}navigate(B,Q={skipLocationChange:!1}){return function fl(L){for(let $=0;$<L.length;$++)if(null==L[$])throw new E.vHH(4008,!1)}(B),this.navigateByUrl(this.createUrlTree(B,Q),Q)}serializeUrl(B){return this.urlSerializer.serialize(B)}parseUrl(B){try{return this.urlSerializer.parse(B)}catch{return this.urlSerializer.parse("/")}}isActive(B,Q){let Ee;if(Ee=!0===Q?{...H0}:!1===Q?{...ih}:Q,ko(B))return bi(this.currentUrlTree,B,Ee);const je=this.parseUrl(B);return bi(this.currentUrlTree,je,Ee)}removeEmptyProps(B){return Object.keys(B).reduce((Q,Ee)=>{const je=B[Ee];return null!=je&&(Q[Ee]=je),Q},{})}scheduleNavigation(B,Q,Ee,je,jt){if(this.disposed)return Promise.resolve(!1);let Bn,Zt,ar;jt?(Bn=jt.resolve,Zt=jt.reject,ar=jt.promise):ar=new Promise((os,mo)=>{Bn=os,Zt=mo});const _r=this.pendingTasks.add();return lc(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(_r))}),this.navigationTransitions.handleNavigationRequest({source:Q,restoredState:Ee,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:B,extras:je,resolve:Bn,reject:Zt,promise:ar,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ar.catch(os=>Promise.reject(os))}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})(),sh=(()=>{var L;class ${constructor(B,Q,Ee,je,jt,Bn){var Zt;this.router=B,this.route=Q,this.tabIndexAttribute=Ee,this.renderer=je,this.el=jt,this.locationStrategy=Bn,this.href=null,this.commands=null,this.onChanges=new Ot.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const ar=null===(Zt=jt.nativeElement.tagName)||void 0===Zt?void 0:Zt.toLowerCase();this.isAnchorElement="a"===ar||"area"===ar,this.isAnchorElement?this.subscription=B.events.subscribe(_r=>{_r instanceof We&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(B){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",B)}ngOnChanges(B){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(B){null!=B?(this.commands=Array.isArray(B)?B:[B],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(B,Q,Ee,je,jt){return!!(null===this.urlTree||this.isAnchorElement&&(0!==B||Q||Ee||je||jt||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){var B;null===(B=this.subscription)||void 0===B||B.unsubscribe()}updateHref(){var B;this.href=null!==this.urlTree&&this.locationStrategy?null===(B=this.locationStrategy)||void 0===B?void 0:B.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const Q=null===this.href?null:(0,E.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",Q)}applyAttributeValue(B,Q){const Ee=this.renderer,je=this.el.nativeElement;null!==Q?Ee.setAttribute(je,B,Q):Ee.removeAttribute(je,B)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(L=$).\u0275fac=function(B){return new(B||L)(E.Y36(Wa),E.Y36(ui),E.$8M("tabindex"),E.Y36(E.Qsj),E.Y36(E.SBq),E.Y36(Pt.S$))},L.\u0275dir=E.lG2({type:L,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(B,Q){1&B&&E.NdJ("click",function(je){return Q.onClick(je.button,je.ctrlKey,je.shiftKey,je.altKey,je.metaKey)}),2&B&&E.uIk("target",Q.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",E.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",E.VuI],replaceUrl:["replaceUrl","replaceUrl",E.VuI],routerLink:"routerLink"},standalone:!0,features:[E.Xq5,E.TTD]}),$})();class Go{}let Ro=(()=>{var L;class ${preload(B,Q){return Q().pipe((0,yt.K)(()=>(0,Ve.of)(null)))}}return(L=$).\u0275fac=function(B){return new(B||L)},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})(),Yh=(()=>{var L;class ${constructor(B,Q,Ee,je,jt){this.router=B,this.injector=Ee,this.preloadingStrategy=je,this.loader=jt}setUpPreloading(){this.subscription=this.router.events.pipe((0,De.h)(B=>B instanceof We),_n(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(B,Q){const Ee=[];for(const Zt of Q){var je,jt;Zt.providers&&!Zt._injector&&(Zt._injector=(0,E.MMx)(Zt.providers,B,`Route: ${Zt.path}`));const ar=null!==(je=Zt._injector)&&void 0!==je?je:B,_r=null!==(jt=Zt._loadedInjector)&&void 0!==jt?jt:ar;var Bn;(Zt.loadChildren&&!Zt._loadedRoutes&&void 0===Zt.canLoad||Zt.loadComponent&&!Zt._loadedComponent)&&Ee.push(this.preloadConfig(ar,Zt)),(Zt.children||Zt._loadedRoutes)&&Ee.push(this.processRoutes(_r,null!==(Bn=Zt.children)&&void 0!==Bn?Bn:Zt._loadedRoutes))}return(0,ge.D)(Ee).pipe((0,ei.J)())}preloadConfig(B,Q){return this.preloadingStrategy.preload(Q,()=>{let Ee;Ee=Q.loadChildren&&void 0===Q.canLoad?this.loader.loadChildren(B,Q):(0,Ve.of)(null);const je=Ee.pipe((0,dt.z)(jt=>{var Bn;return null===jt?(0,Ve.of)(void 0):(Q._loadedRoutes=jt.routes,Q._loadedInjector=jt.injector,this.processRoutes(null!==(Bn=jt.injector)&&void 0!==Bn?Bn:B,jt.routes))}));if(Q.loadComponent&&!Q._loadedComponent){const jt=this.loader.loadComponent(Q);return(0,ge.D)([je,jt]).pipe((0,ei.J)())}return je})}}return(L=$).\u0275fac=function(B){return new(B||L)(E.LFG(Wa),E.LFG(E.Sil),E.LFG(E.lqb),E.LFG(Go),E.LFG(oo))},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"}),$})();const mi=new E.OlP("");let Zl=(()=>{var L;class ${constructor(B,Q,Ee,je,jt={}){this.urlSerializer=B,this.transitions=Q,this.viewportScroller=Ee,this.zone=je,this.options=jt,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},jt.scrollPositionRestoration=jt.scrollPositionRestoration||"disabled",jt.anchorScrolling=jt.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(B=>{B instanceof _e?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=B.navigationTrigger,this.restoredId=B.restoredState?B.restoredState.navigationId:0):B instanceof We?(this.lastId=B.id,this.scheduleScrollEvent(B,this.urlSerializer.parse(B.urlAfterRedirects).fragment)):B instanceof Qt&&0===B.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(B,this.urlSerializer.parse(B.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(B=>{B instanceof Kn&&(B.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(B.position):B.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(B.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(B,Q){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Kn(B,"popstate"===this.lastSource?this.store[this.restoredId]:null,Q))})},0)})}ngOnDestroy(){var B,Q;null===(B=this.routerEventsSubscription)||void 0===B||B.unsubscribe(),null===(Q=this.scrollEventsSubscription)||void 0===Q||Q.unsubscribe()}}return(L=$).\u0275fac=function(B){E.$Z()},L.\u0275prov=E.Yz7({token:L,factory:L.\u0275fac}),$})();function Jc(L,$){return{\u0275kind:L,\u0275providers:$}}function Kh(){const L=(0,E.f3M)(E.zs3);return $=>{var X,B;const Q=L.get(E.z2F);if($!==Q.components[0])return;const Ee=L.get(Wa),je=L.get(W0);1===L.get(Xh)&&Ee.initialNavigation(),null===(X=L.get(up,null,E.XFs.Optional))||void 0===X||X.setUpPreloading(),null===(B=L.get(mi,null,E.XFs.Optional))||void 0===B||B.init(),Ee.resetRootComponentType(Q.componentTypes[0]),je.closed||(je.next(),je.complete(),je.unsubscribe())}}const W0=new E.OlP("",{factory:()=>new Ot.x}),Xh=new E.OlP("",{providedIn:"root",factory:()=>1}),up=new E.OlP("");function q0(L){return Jc(0,[{provide:up,useExisting:Yh},{provide:Go,useExisting:L}])}function Bm(L){return Jc(9,[{provide:ca,useValue:Qc},{provide:Ga,useValue:{skipNextTransition:!(null==L||!L.skipInitialTransition),...L}}])}const dp=new E.OlP("ROUTER_FORROOT_GUARD"),_y=[Pt.Ye,{provide:Mo,useClass:Ht},Wa,be,{provide:ui,useFactory:function Zh(L){return L.routerState.root},deps:[Wa]},oo,[]];let Jh=(()=>{var L;class ${constructor(B){}static forRoot(B,Q){return{ngModule:$,providers:[_y,[],{provide:_o,multi:!0,useValue:B},{provide:dp,useFactory:Za,deps:[[Wa,new E.FiY,new E.tp0]]},{provide:Ii,useValue:Q||{}},null!=Q&&Q.useHash?{provide:Pt.S$,useClass:Pt.Do}:{provide:Pt.S$,useClass:Pt.b0},{provide:mi,useFactory:()=>{const L=(0,E.f3M)(Pt.EM),$=(0,E.f3M)(E.R0b),X=(0,E.f3M)(Ii),B=(0,E.f3M)(Aa),Q=(0,E.f3M)(Mo);return X.scrollOffset&&L.setOffset(X.scrollOffset),new Zl(Q,B,L,$,X)}},null!=Q&&Q.preloadingStrategy?q0(Q.preloadingStrategy).\u0275providers:[],null!=Q&&Q.initialNavigation?Kl(Q):[],null!=Q&&Q.bindToComponentInputs?Jc(8,[Wl,{provide:qc,useExisting:Wl}]).\u0275providers:[],null!=Q&&Q.enableViewTransitions?Bm().\u0275providers:[],[{provide:zm,useFactory:Kh},{provide:E.tb,multi:!0,useExisting:zm}]]}}static forChild(B){return{ngModule:$,providers:[{provide:_o,multi:!0,useValue:B}]}}}return(L=$).\u0275fac=function(B){return new(B||L)(E.LFG(dp,8))},L.\u0275mod=E.oAB({type:L}),L.\u0275inj=E.cJS({}),$})();function Za(L){return"guarded"}function Kl(L){return["disabled"===L.initialNavigation?Jc(3,[{provide:E.ip1,multi:!0,useFactory:()=>{const $=(0,E.f3M)(Wa);return()=>{$.setUpLocationChangeListener()}}},{provide:Xh,useValue:2}]).\u0275providers:[],"enabledBlocking"===L.initialNavigation?Jc(2,[{provide:Xh,useValue:0},{provide:E.ip1,multi:!0,deps:[E.zs3],useFactory:$=>{const X=$.get(Pt.V_,Promise.resolve());return()=>X.then(()=>new Promise(B=>{const Q=$.get(Wa),Ee=$.get(W0);lc(Q,()=>{B(!0)}),$.get(Aa).afterPreactivation=()=>(B(!0),Ee.closed?(0,Ve.of)(void 0):Ee),Q.initialNavigation()}))}}]).\u0275providers:[]]}const zm=new E.OlP("")},7346:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{y4:()=>Ui,De:()=>Kr,dy:()=>Lr,oU:()=>Fs,ki:()=>rt,O1:()=>Qi,d8:()=>ht,jP:()=>cs,UN:()=>pi,r4:()=>Et,SH:()=>ir,xs:()=>Ze,j:()=>ns,H:()=>po,bk:()=>Wi,DN:()=>ts,Wn:()=>xs,vk:()=>Br});var E=ae(5861),he=ae(9212),at=ae(4653),Ie=ae(6814);class ge{constructor(){this.m=new Map}reset(ne){this.m=new Map(Object.entries(ne))}get(ne,Z){const _e=this.m.get(ne);return void 0!==_e?_e:Z}getBoolean(ne,Z=!1){const _e=this.m.get(ne);return void 0===_e?Z:"string"==typeof _e?"true"===_e:!!_e}getNumber(ne,Z){const _e=parseFloat(this.m.get(ne));return isNaN(_e)?void 0!==Z?Z:NaN:_e}set(ne,Z){this.m.set(ne,Z)}}const Ve=new ge,Mt=re=>gt(re),gt=(re=window)=>{if(typeof re>"u")return[];re.Ionic=re.Ionic||{};let ne=re.Ionic.platforms;return null==ne&&(ne=re.Ionic.platforms=Jt(re),ne.forEach(Z=>re.document.documentElement.classList.add(`plt-${Z}`))),ne},Jt=re=>{const ne=Ve.get("platform");return Object.keys(_n).filter(Z=>{const _e=null==ne?void 0:ne[Z];return"function"==typeof _e?_e(re):_n[Z](re)})},Rt=re=>!!(Un(re,/iPad/i)||Un(re,/Macintosh/i)&&Te(re)),lt=re=>Un(re,/android|sink/i),Te=re=>nr(re,"(any-pointer:coarse)"),dt=re=>mt(re)||Gt(re),mt=re=>!!(re.cordova||re.phonegap||re.PhoneGap),Gt=re=>{const ne=re.Capacitor;return!(null==ne||!ne.isNative)},Un=(re,ne)=>ne.test(re.navigator.userAgent),nr=(re,ne)=>{var Z;return null===(Z=re.matchMedia)||void 0===Z?void 0:Z.call(re,ne).matches},_n={ipad:Rt,iphone:re=>Un(re,/iPhone/i),ios:re=>Un(re,/iPhone|iPod/i)||Rt(re),android:lt,phablet:re=>{const ne=re.innerWidth,Z=re.innerHeight,_e=Math.min(ne,Z),We=Math.max(ne,Z);return _e>390&&_e<520&&We>620&&We<800},tablet:re=>{const ne=re.innerWidth,Z=re.innerHeight,_e=Math.min(ne,Z),We=Math.max(ne,Z);return Rt(re)||(re=>lt(re)&&!Un(re,/mobile/i))(re)||_e>460&&_e<820&&We>780&&We<1400},cordova:mt,capacitor:Gt,electron:re=>Un(re,/electron/i),pwa:re=>{var ne;return!!(null!==(ne=re.matchMedia)&&void 0!==ne&&ne.call(re,"(display-mode: standalone)").matches||re.navigator.standalone)},mobile:Te,mobileweb:re=>Te(re)&&!dt(re),desktop:re=>!Te(re),hybrid:dt};var tt=ae(191),Ye=ae(3630),_t=ae(8645),rn=ae(2438),Gn=ae(5619),rr=ae(2572),Hn=ae(2096),mr=ae(7582),gr=ae(2181),ei=ae(4664),An=ae(2737),qe=ae(9360),ue=ae(8251);function Me(re,ne){return re===ne}var Bt=ae(95);const zt=["tabsInner"];let Zn=(()=>{class re{constructor(Z,_e){this.doc=Z,this.backButton=new _t.x,this.keyboardDidShow=new _t.x,this.keyboardDidHide=new _t.x,this.pause=new _t.x,this.resume=new _t.x,this.resize=new _t.x,_e.run(()=>{var We;let Ct;this.win=Z.defaultView,this.backButton.subscribeWithPriority=function(Qt,q){return this.subscribe(ce=>ce.register(Qt,Pe=>_e.run(()=>q(Pe))))},Dn(this.pause,Z,"pause",_e),Dn(this.resume,Z,"resume",_e),Dn(this.backButton,Z,"ionBackButton",_e),Dn(this.resize,this.win,"resize",_e),Dn(this.keyboardDidShow,this.win,"ionKeyboardDidShow",_e),Dn(this.keyboardDidHide,this.win,"ionKeyboardDidHide",_e),this._readyPromise=new Promise(Qt=>{Ct=Qt}),null!==(We=this.win)&&void 0!==We&&We.cordova?Z.addEventListener("deviceready",()=>{Ct("cordova")},{once:!0}):Ct("dom")})}is(Z){return((re,ne)=>("string"==typeof re&&(ne=re,re=void 0),Mt(re).includes(ne)))(this.win,Z)}platforms(){return Mt(this.win)}ready(){return this._readyPromise}get isRTL(){return"rtl"===this.doc.dir}getQueryParam(Z){return cn(this.win.location.href,Z)}isLandscape(){return!this.isPortrait()}isPortrait(){var Z,_e;return null===(Z=(_e=this.win).matchMedia)||void 0===Z?void 0:Z.call(_e,"(orientation: portrait)").matches}testUserAgent(Z){const _e=this.win.navigator;return!!(null!=_e&&_e.userAgent&&_e.userAgent.indexOf(Z)>=0)}url(){return this.win.location.href}width(){return this.win.innerWidth}height(){return this.win.innerHeight}}return re.\u0275fac=function(Z){return new(Z||re)(he.LFG(Ie.K0),he.LFG(he.R0b))},re.\u0275prov=he.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})();const cn=(re,ne)=>{ne=ne.replace(/[[\]\\]/g,"\\$&");const _e=new RegExp("[\\?&]"+ne+"=([^&#]*)").exec(re);return _e?decodeURIComponent(_e[1].replace(/\+/g," ")):null},Dn=(re,ne,Z,_e)=>{ne&&ne.addEventListener(Z,We=>{_e.run(()=>{re.next(null!=We?We.detail:void 0)})})};let ir=(()=>{class re{constructor(Z,_e,We,Ct){this.location=_e,this.serializer=We,this.router=Ct,this.direction=Mi,this.animated=Nn,this.guessDirection="forward",this.lastNavId=-1,Ct&&Ct.events.subscribe(Qt=>{if(Qt instanceof at.OD){const q=Qt.restoredState?Qt.restoredState.navigationId:Qt.id;this.guessDirection=q<this.lastNavId?"back":"forward",this.guessAnimation=Qt.restoredState?void 0:this.guessDirection,this.lastNavId="forward"===this.guessDirection?Qt.id:q}}),Z.backButton.subscribeWithPriority(0,Qt=>{this.pop(),Qt()})}navigateForward(Z,_e={}){return this.setDirection("forward",_e.animated,_e.animationDirection,_e.animation),this.navigate(Z,_e)}navigateBack(Z,_e={}){return this.setDirection("back",_e.animated,_e.animationDirection,_e.animation),this.navigate(Z,_e)}navigateRoot(Z,_e={}){return this.setDirection("root",_e.animated,_e.animationDirection,_e.animation),this.navigate(Z,_e)}back(Z={animated:!0,animationDirection:"back"}){return this.setDirection("back",Z.animated,Z.animationDirection,Z.animation),this.location.back()}pop(){var Z=this;return(0,E.Z)(function*(){let _e=Z.topOutlet;for(;_e;){if(yield _e.pop())return!0;_e=_e.parentOutlet}return!1})()}setDirection(Z,_e,We,Ct){this.direction=Z,this.animated=bi(Z,_e,We),this.animationBuilder=Ct}setTopOutlet(Z){this.topOutlet=Z}consumeTransition(){let _e,Z="root";const We=this.animationBuilder;return"auto"===this.direction?(Z=this.guessDirection,_e=this.guessAnimation):(_e=this.animated,Z=this.direction),this.direction=Mi,this.animated=Nn,this.animationBuilder=void 0,{direction:Z,animation:_e,animationBuilder:We}}navigate(Z,_e){if(Array.isArray(Z))return this.router.navigate(Z,_e);{const We=this.serializer.parse(Z.toString());return void 0!==_e.queryParams&&(We.queryParams={..._e.queryParams}),void 0!==_e.fragment&&(We.fragment=_e.fragment),this.router.navigateByUrl(We,_e)}}}return re.\u0275fac=function(Z){return new(Z||re)(he.LFG(Zn),he.LFG(Ie.Ye),he.LFG(at.Hx),he.LFG(at.F0,8))},re.\u0275prov=he.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})();const bi=(re,ne,Z)=>{if(!1!==ne){if(void 0!==Z)return Z;if("forward"===re||"back"===re)return re;if("root"===re&&!0===ne)return"forward"}},Mi="auto",Nn=void 0;let Kr=(()=>{class re{get(Z,_e){const We=qi();return We?We.get(Z,_e):null}getBoolean(Z,_e){const We=qi();return!!We&&We.getBoolean(Z,_e)}getNumber(Z,_e){const We=qi();return We?We.getNumber(Z,_e):0}}return re.\u0275fac=function(Z){return new(Z||re)},re.\u0275prov=he.Yz7({token:re,factory:re.\u0275fac,providedIn:"root"}),re})();const Lr=new he.OlP("USERCONFIG"),qi=()=>{if(typeof window<"u"){const re=window.Ionic;if(null!=re&&re.config)return re.config}return null};class ri{constructor(ne={}){this.data=ne}get(ne){return this.data[ne]}}let Ui=(()=>{class re{constructor(){this.zone=(0,he.f3M)(he.R0b),this.applicationRef=(0,he.f3M)(he.z2F)}create(Z,_e,We){return new fr(Z,_e,this.applicationRef,this.zone,We)}}return re.\u0275fac=function(Z){return new(Z||re)},re.\u0275prov=he.Yz7({token:re,factory:re.\u0275fac}),re})();class fr{constructor(ne,Z,_e,We,Ct){this.environmentInjector=ne,this.injector=Z,this.applicationRef=_e,this.zone=We,this.elementReferenceKey=Ct,this.elRefMap=new WeakMap,this.elEventsMap=new WeakMap}attachViewToDom(ne,Z,_e,We){return this.zone.run(()=>new Promise(Ct=>{const Qt={..._e};void 0!==this.elementReferenceKey&&(Qt[this.elementReferenceKey]=ne),Ct(io(this.zone,this.environmentInjector,this.injector,this.applicationRef,this.elRefMap,this.elEventsMap,ne,Z,Qt,We,this.elementReferenceKey))}))}removeViewFromDom(ne,Z){return this.zone.run(()=>new Promise(_e=>{const We=this.elRefMap.get(Z);if(We){We.destroy(),this.elRefMap.delete(Z);const Ct=this.elEventsMap.get(Z);Ct&&(Ct(),this.elEventsMap.delete(Z))}_e()}))}}const io=(re,ne,Z,_e,We,Ct,Qt,q,ce,Pe,ct)=>{const $t=he.zs3.create({providers:Mo(ce),parent:Z}),bt=(0,he.LMc)(q,{environmentInjector:ne,elementInjector:$t}),fn=bt.instance,bn=bt.location.nativeElement;if(ce&&(ct&&void 0!==fn[ct]&&console.error(`[Ionic Error]: ${ct} is a reserved property when using ${Qt.tagName.toLowerCase()}. Rename or remove the "${ct}" property from ${q.name}.`),Object.assign(fn,ce)),Pe)for(const Pn of Pe)bn.classList.add(Pn);const Fn=Tr(re,fn,bn);return Qt.appendChild(bn),_e.attachView(bt.hostView),We.set(bn,bt),Ct.set(bn,Fn),bn},Io=[tt.L,tt.a,tt.b,tt.c,tt.d],Tr=(re,ne,Z)=>re.run(()=>{const _e=Io.filter(We=>"function"==typeof ne[We]).map(We=>{const Ct=Qt=>ne[We](Qt.detail);return Z.addEventListener(We,Ct),()=>Z.removeEventListener(We,Ct)});return()=>_e.forEach(We=>We())}),Gr=new he.OlP("NavParamsToken"),Mo=re=>[{provide:Gr,useValue:re},{provide:ri,useFactory:Ht,deps:[Gr]}],Ht=re=>new ri(re),an=(re,ne)=>{const Z=re.prototype;ne.forEach(_e=>{Object.defineProperty(Z,_e,{get(){return this.el[_e]},set(We){this.z.runOutsideAngular(()=>this.el[_e]=We)}})})},yn=(re,ne)=>{const Z=re.prototype;ne.forEach(_e=>{Z[_e]=function(){const We=arguments;return this.z.runOutsideAngular(()=>this.el[_e].apply(this.el,We))}})},vn=(re,ne,Z)=>{Z.forEach(_e=>re[_e]=(0,rn.R)(ne,_e))};function En(re){return function(Z){const{defineCustomElementFn:_e,inputs:We,methods:Ct}=re;return void 0!==_e&&_e(),We&&an(Z,We),Ct&&yn(Z,Ct),Z}}const xn=["alignment","animated","arrow","keepContentsMounted","backdropDismiss","cssClass","dismissOnSelect","enterAnimation","event","isOpen","keyboardClose","leaveAnimation","mode","showBackdrop","translucent","trigger","triggerAction","reference","size","side"],Ln=["present","dismiss","onDidDismiss","onWillDismiss"];let ht=(()=>{let re=class{constructor(Z,_e,We){this.z=We,this.isCmpOpen=!1,this.el=_e.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,Z.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,Z.detectChanges()}),vn(this,this.el,["ionPopoverDidPresent","ionPopoverWillPresent","ionPopoverWillDismiss","ionPopoverDidDismiss","didPresent","willPresent","willDismiss","didDismiss"])}};return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(he.sBO),he.Y36(he.SBq),he.Y36(he.R0b))},re.\u0275dir=he.lG2({type:re,selectors:[["ion-popover"]],contentQueries:function(Z,_e,We){if(1&Z&&he.Suo(We,he.Rgc,5),2&Z){let Ct;he.iGM(Ct=he.CRH())&&(_e.template=Ct.first)}},inputs:{alignment:"alignment",animated:"animated",arrow:"arrow",keepContentsMounted:"keepContentsMounted",backdropDismiss:"backdropDismiss",cssClass:"cssClass",dismissOnSelect:"dismissOnSelect",enterAnimation:"enterAnimation",event:"event",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger",triggerAction:"triggerAction",reference:"reference",size:"size",side:"side"}}),re=(0,mr.gn)([En({inputs:xn,methods:Ln})],re),re})();const Ke=["animated","keepContentsMounted","backdropBreakpoint","backdropDismiss","breakpoints","canDismiss","cssClass","enterAnimation","event","handle","handleBehavior","initialBreakpoint","isOpen","keyboardClose","leaveAnimation","mode","presentingElement","showBackdrop","translucent","trigger"],ot=["present","dismiss","onDidDismiss","onWillDismiss","setCurrentBreakpoint","getCurrentBreakpoint"];let rt=(()=>{let re=class{constructor(Z,_e,We){this.z=We,this.isCmpOpen=!1,this.el=_e.nativeElement,this.el.addEventListener("ionMount",()=>{this.isCmpOpen=!0,Z.detectChanges()}),this.el.addEventListener("didDismiss",()=>{this.isCmpOpen=!1,Z.detectChanges()}),vn(this,this.el,["ionModalDidPresent","ionModalWillPresent","ionModalWillDismiss","ionModalDidDismiss","ionBreakpointDidChange","didPresent","willPresent","willDismiss","didDismiss"])}};return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(he.sBO),he.Y36(he.SBq),he.Y36(he.R0b))},re.\u0275dir=he.lG2({type:re,selectors:[["ion-modal"]],contentQueries:function(Z,_e,We){if(1&Z&&he.Suo(We,he.Rgc,5),2&Z){let Ct;he.iGM(Ct=he.CRH())&&(_e.template=Ct.first)}},inputs:{animated:"animated",keepContentsMounted:"keepContentsMounted",backdropBreakpoint:"backdropBreakpoint",backdropDismiss:"backdropDismiss",breakpoints:"breakpoints",canDismiss:"canDismiss",cssClass:"cssClass",enterAnimation:"enterAnimation",event:"event",handle:"handle",handleBehavior:"handleBehavior",initialBreakpoint:"initialBreakpoint",isOpen:"isOpen",keyboardClose:"keyboardClose",leaveAnimation:"leaveAnimation",mode:"mode",presentingElement:"presentingElement",showBackdrop:"showBackdrop",translucent:"translucent",trigger:"trigger"}}),re=(0,mr.gn)([En({inputs:Ke,methods:ot})],re),re})();const qt=(re,ne)=>((re=re.filter(Z=>Z.stackId!==ne.stackId)).push(ne),re),Sr=(re,ne)=>{const Z=re.createUrlTree(["."],{relativeTo:ne});return re.serializeUrl(Z)},ii=(re,ne)=>!ne||re.stackId!==ne.stackId,ji=(re,ne)=>{if(!re)return;const Z=wi(ne);for(let _e=0;_e<Z.length;_e++){if(_e>=re.length)return Z[_e];if(Z[_e]!==re[_e])return}},wi=re=>re.split("/").map(ne=>ne.trim()).filter(ne=>""!==ne),dr=re=>{re&&(re.ref.destroy(),re.unlistenEvents())};class Oo{constructor(ne,Z,_e,We,Ct,Qt){this.containerEl=Z,this.router=_e,this.navCtrl=We,this.zone=Ct,this.location=Qt,this.views=[],this.skipTransition=!1,this.nextId=0,this.tabsPrefix=void 0!==ne?wi(ne):void 0}createView(ne,Z){var _e;const We=Sr(this.router,Z),Ct=null==ne||null===(_e=ne.location)||void 0===_e?void 0:_e.nativeElement,Qt=Tr(this.zone,ne.instance,Ct);return{id:this.nextId++,stackId:ji(this.tabsPrefix,We),unlistenEvents:Qt,element:Ct,ref:ne,url:We}}getExistingView(ne){const Z=Sr(this.router,ne),_e=this.views.find(We=>We.url===Z);return _e&&_e.ref.changeDetectorRef.reattach(),_e}setActive(ne){var Z,_e;const We=this.navCtrl.consumeTransition();let{direction:Ct,animation:Qt,animationBuilder:q}=We;const ce=this.activeView,Pe=ii(ne,ce);Pe&&(Ct="back",Qt=void 0);const ct=this.views.slice();let $t;const bt=this.router;bt.getCurrentNavigation?$t=bt.getCurrentNavigation():null!==(Z=bt.navigations)&&void 0!==Z&&Z.value&&($t=bt.navigations.value),null!==(_e=$t)&&void 0!==_e&&null!==(_e=_e.extras)&&void 0!==_e&&_e.replaceUrl&&this.views.length>0&&this.views.splice(-1,1);const fn=this.views.includes(ne),bn=this.insertView(ne,Ct);fn||ne.ref.changeDetectorRef.detectChanges();const Fn=ne.animationBuilder;return void 0===q&&"back"===Ct&&!Pe&&void 0!==Fn&&(q=Fn),ce&&(ce.animationBuilder=q),this.zone.runOutsideAngular(()=>this.wait(()=>(ce&&ce.ref.changeDetectorRef.detach(),ne.ref.changeDetectorRef.reattach(),this.transition(ne,ce,Qt,this.canGoBack(1),!1,q).then(()=>ho(ne,bn,ct,this.location,this.zone)).then(()=>({enteringView:ne,direction:Ct,animation:Qt,tabSwitch:Pe})))))}canGoBack(ne,Z=this.getActiveStackId()){return this.getStack(Z).length>ne}pop(ne,Z=this.getActiveStackId()){return this.zone.run(()=>{const _e=this.getStack(Z);if(_e.length<=ne)return Promise.resolve(!1);const We=_e[_e.length-ne-1];let Ct=We.url;const Qt=We.savedData;if(Qt){var q;const Pe=Qt.get("primary");null!=Pe&&null!==(q=Pe.route)&&void 0!==q&&null!==(q=q._routerState)&&void 0!==q&&q.snapshot.url&&(Ct=Pe.route._routerState.snapshot.url)}const{animationBuilder:ce}=this.navCtrl.consumeTransition();return this.navCtrl.navigateBack(Ct,{...We.savedExtras,animation:ce}).then(()=>!0)})}startBackTransition(){const ne=this.activeView;if(ne){const Z=this.getStack(ne.stackId),_e=Z[Z.length-2],We=_e.animationBuilder;return this.wait(()=>this.transition(_e,ne,"back",this.canGoBack(2),!0,We))}return Promise.resolve()}endBackTransition(ne){ne?(this.skipTransition=!0,this.pop(1)):this.activeView&&vs(this.activeView,this.views,this.views,this.location,this.zone)}getLastUrl(ne){const Z=this.getStack(ne);return Z.length>0?Z[Z.length-1]:void 0}getRootUrl(ne){const Z=this.getStack(ne);return Z.length>0?Z[0]:void 0}getActiveStackId(){return this.activeView?this.activeView.stackId:void 0}getActiveView(){return this.activeView}hasRunningTask(){return void 0!==this.runningTask}destroy(){this.containerEl=void 0,this.views.forEach(dr),this.activeView=void 0,this.views=[]}getStack(ne){return this.views.filter(Z=>Z.stackId===ne)}insertView(ne,Z){return this.activeView=ne,this.views=((re,ne,Z)=>"root"===Z?qt(re,ne):"forward"===Z?((re,ne)=>(re.indexOf(ne)>=0?re=re.filter(_e=>_e.stackId!==ne.stackId||_e.id<=ne.id):re.push(ne),re))(re,ne):((re,ne)=>re.indexOf(ne)>=0?re.filter(_e=>_e.stackId!==ne.stackId||_e.id<=ne.id):qt(re,ne))(re,ne))(this.views,ne,Z),this.views.slice()}transition(ne,Z,_e,We,Ct,Qt){if(this.skipTransition)return this.skipTransition=!1,Promise.resolve(!1);if(Z===ne)return Promise.resolve(!1);const q=ne?ne.element:void 0,ce=Z?Z.element:void 0,Pe=this.containerEl;return q&&q!==ce&&(q.classList.add("ion-page"),q.classList.add("ion-page-invisible"),q.parentElement!==Pe&&Pe.appendChild(q),Pe.commit)?Pe.commit(q,ce,{duration:void 0===_e?0:void 0,direction:_e,showGoBack:We,progressAnimation:Ct,animationBuilder:Qt}):Promise.resolve(!1)}wait(ne){var Z=this;return(0,E.Z)(function*(){void 0!==Z.runningTask&&(yield Z.runningTask,Z.runningTask=void 0);const _e=Z.runningTask=ne();return _e.finally(()=>Z.runningTask=void 0),_e})()}}const ho=(re,ne,Z,_e,We)=>"function"==typeof requestAnimationFrame?new Promise(Ct=>{requestAnimationFrame(()=>{vs(re,ne,Z,_e,We),Ct()})}):Promise.resolve(),vs=(re,ne,Z,_e,We)=>{We.run(()=>Z.filter(Ct=>!ne.includes(Ct)).forEach(dr)),ne.forEach(Ct=>{const q=_e.path().split("?")[0].split("#")[0];if(Ct!==re&&Ct.url!==q){const ce=Ct.element;ce.setAttribute("aria-hidden","true"),ce.classList.add("ion-page-hidden"),Ct.ref.changeDetectorRef.detach()}})};let cs=(()=>{class re{constructor(Z,_e,We,Ct,Qt,q,ce,Pe){this.parentOutlet=Pe,this.activatedView=null,this.proxyMap=new WeakMap,this.currentActivatedRoute$=new Gn.X(null),this.activated=null,this._activatedRoute=null,this.name=at.eC,this.stackWillChange=new he.vpe,this.stackDidChange=new he.vpe,this.activateEvents=new he.vpe,this.deactivateEvents=new he.vpe,this.parentContexts=(0,he.f3M)(at.y6),this.location=(0,he.f3M)(he.s_b),this.environmentInjector=(0,he.f3M)(he.lqb),this.inputBinder=(0,he.f3M)(ko,{optional:!0}),this.supportsBindingToComponentInputs=!0,this.config=(0,he.f3M)(Kr),this.navCtrl=(0,he.f3M)(ir),this.nativeEl=Ct.nativeElement,this.name=Z||at.eC,this.tabsPrefix="true"===_e?Sr(Qt,ce):void 0,this.stackCtrl=new Oo(this.tabsPrefix,this.nativeEl,Qt,this.navCtrl,q,We),this.parentContexts.onChildOutletCreated(this.name,this)}get activatedComponentRef(){return this.activated}set animation(Z){this.nativeEl.animation=Z}set animated(Z){this.nativeEl.animated=Z}set swipeGesture(Z){this._swipeGesture=Z,this.nativeEl.swipeHandler=Z?{canStart:()=>this.stackCtrl.canGoBack(1)&&!this.stackCtrl.hasRunningTask(),onStart:()=>this.stackCtrl.startBackTransition(),onEnd:_e=>this.stackCtrl.endBackTransition(_e)}:void 0}ngOnDestroy(){var Z;this.stackCtrl.destroy(),null===(Z=this.inputBinder)||void 0===Z||Z.unsubscribeFromRouteData(this)}getContext(){return this.parentContexts.getContext(this.name)}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(!this.activated){const Z=this.getContext();null!=Z&&Z.route&&this.activateWith(Z.route,Z.injector)}new Promise(Z=>(0,Ye.c)(this.nativeEl,Z)).then(()=>{void 0===this._swipeGesture&&(this.swipeGesture=this.config.getBoolean("swipeBackEnabled","ios"===this.nativeEl.mode))})}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){throw new Error("incompatible reuse strategy")}attach(Z,_e){throw new Error("incompatible reuse strategy")}deactivate(){if(this.activated){if(this.activatedView){const _e=this.getContext();this.activatedView.savedData=new Map(_e.children.contexts);const We=this.activatedView.savedData.get("primary");if(We&&_e.route&&(We.route={..._e.route}),this.activatedView.savedExtras={},_e.route){const Ct=_e.route.snapshot;this.activatedView.savedExtras.queryParams=Ct.queryParams,this.activatedView.savedExtras.fragment=Ct.fragment}}const Z=this.component;this.activatedView=null,this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(Z)}}activateWith(Z,_e){var We;if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=Z;let Ct,Qt=this.stackCtrl.getExistingView(Z);if(Qt){Ct=this.activated=Qt.ref;const Pe=Qt.savedData;Pe&&(this.getContext().children.contexts=Pe),this.updateActivatedRouteProxy(Ct.instance,Z)}else{var q;const Pe=Z._futureSnapshot,ct=this.parentContexts.getOrCreateContext(this.name).children,$t=new Gn.X(null),bt=this.createActivatedRouteProxy($t,Z),fn=new Ei(bt,ct,this.location.injector),bn=null!==(q=Pe.routeConfig.component)&&void 0!==q?q:Pe.component;Ct=this.activated=this.location.createComponent(bn,{index:this.location.length,injector:fn,environmentInjector:null!=_e?_e:this.environmentInjector}),$t.next(Ct.instance),Qt=this.stackCtrl.createView(this.activated,Z),this.proxyMap.set(Ct.instance,bt),this.currentActivatedRoute$.next({component:Ct.instance,activatedRoute:Z})}null===(We=this.inputBinder)||void 0===We||We.bindActivatedRouteToOutletComponent(this),this.activatedView=Qt,this.navCtrl.setTopOutlet(this);const ce=this.stackCtrl.getActiveView();this.stackWillChange.emit({enteringView:Qt,tabSwitch:ii(Qt,ce)}),this.stackCtrl.setActive(Qt).then(Pe=>{this.activateEvents.emit(Ct.instance),this.stackDidChange.emit(Pe)})}canGoBack(Z=1,_e){return this.stackCtrl.canGoBack(Z,_e)}pop(Z=1,_e){return this.stackCtrl.pop(Z,_e)}getLastUrl(Z){const _e=this.stackCtrl.getLastUrl(Z);return _e?_e.url:void 0}getLastRouteView(Z){return this.stackCtrl.getLastUrl(Z)}getRootView(Z){return this.stackCtrl.getRootUrl(Z)}getActiveStackId(){return this.stackCtrl.getActiveStackId()}createActivatedRouteProxy(Z,_e){const We=new at.gz;return We._futureSnapshot=_e._futureSnapshot,We._routerState=_e._routerState,We.snapshot=_e.snapshot,We.outlet=_e.outlet,We.component=_e.component,We._paramMap=this.proxyObservable(Z,"paramMap"),We._queryParamMap=this.proxyObservable(Z,"queryParamMap"),We.url=this.proxyObservable(Z,"url"),We.params=this.proxyObservable(Z,"params"),We.queryParams=this.proxyObservable(Z,"queryParams"),We.fragment=this.proxyObservable(Z,"fragment"),We.data=this.proxyObservable(Z,"data"),We}proxyObservable(Z,_e){return Z.pipe((0,gr.h)(We=>!!We),(0,ei.w)(We=>this.currentActivatedRoute$.pipe((0,gr.h)(Ct=>null!==Ct&&Ct.component===We),(0,ei.w)(Ct=>Ct&&Ct.activatedRoute[_e]),function ye(re,ne=An.y){return re=null!=re?re:Me,(0,qe.e)((Z,_e)=>{let We,Ct=!0;Z.subscribe((0,ue.x)(_e,Qt=>{const q=ne(Qt);(Ct||!re(We,q))&&(Ct=!1,We=q,_e.next(Qt))}))})}())))}updateActivatedRouteProxy(Z,_e){const We=this.proxyMap.get(Z);if(!We)throw new Error("Could not find activated route proxy for view");We._futureSnapshot=_e._futureSnapshot,We._routerState=_e._routerState,We.snapshot=_e.snapshot,We.outlet=_e.outlet,We.component=_e.component,this.currentActivatedRoute$.next({component:Z,activatedRoute:_e})}}return re.\u0275fac=function(Z){return new(Z||re)(he.$8M("name"),he.$8M("tabs"),he.Y36(Ie.Ye),he.Y36(he.SBq),he.Y36(at.F0),he.Y36(he.R0b),he.Y36(at.gz),he.Y36(re,12))},re.\u0275dir=he.lG2({type:re,selectors:[["ion-router-outlet"]],inputs:{animated:"animated",animation:"animation",mode:"mode",swipeGesture:"swipeGesture",name:"name"},outputs:{stackWillChange:"stackWillChange",stackDidChange:"stackDidChange",activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),re})();class Ei{constructor(ne,Z,_e){this.route=ne,this.childContexts=Z,this.parent=_e}get(ne,Z){return ne===at.gz?this.route:ne===at.y6?this.childContexts:this.parent.get(ne,Z)}}const ko=new he.OlP("");let es=(()=>{class re{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(Z){this.unsubscribeFromRouteData(Z),this.subscribeToRouteData(Z)}unsubscribeFromRouteData(Z){var _e;null===(_e=this.outletDataSubscriptions.get(Z))||void 0===_e||_e.unsubscribe(),this.outletDataSubscriptions.delete(Z)}subscribeToRouteData(Z){const{activatedRoute:_e}=Z,We=(0,rr.a)([_e.queryParams,_e.params,_e.data]).pipe((0,ei.w)(([Ct,Qt,q],ce)=>(q={...Ct,...Qt,...q},0===ce?(0,Hn.of)(q):Promise.resolve(q)))).subscribe(Ct=>{if(!Z.isActivated||!Z.activatedComponentRef||Z.activatedRoute!==_e||null===_e.component)return void this.unsubscribeFromRouteData(Z);const Qt=(0,he.qFp)(_e.component);if(Qt)for(const{templateName:q}of Qt.inputs)Z.activatedComponentRef.setInput(q,Ct[q]);else this.unsubscribeFromRouteData(Z)});this.outletDataSubscriptions.set(Z,We)}}return re.\u0275fac=function(Z){return new(Z||re)},re.\u0275prov=he.Yz7({token:re,factory:re.\u0275fac}),re})();const ts=()=>({provide:ko,useFactory:fo,deps:[at.F0]});function fo(re){return null!=re&&re.componentInputBindingEnabled?new es:null}const us=["color","defaultHref","disabled","icon","mode","routerAnimation","text","type"];let Fs=(()=>{let re=class{constructor(Z,_e,We,Ct,Qt,q){this.routerOutlet=Z,this.navCtrl=_e,this.config=We,this.r=Ct,this.z=Qt,q.detach(),this.el=this.r.nativeElement}onClick(Z){var _e;const We=this.defaultHref||this.config.get("backButtonDefaultHref");null!==(_e=this.routerOutlet)&&void 0!==_e&&_e.canGoBack()?(this.navCtrl.setDirection("back",void 0,void 0,this.routerAnimation),this.routerOutlet.pop(),Z.preventDefault()):null!=We&&(this.navCtrl.navigateBack(We,{animation:this.routerAnimation}),Z.preventDefault())}};return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(cs,8),he.Y36(ir),he.Y36(Kr),he.Y36(he.SBq),he.Y36(he.R0b),he.Y36(he.sBO))},re.\u0275dir=he.lG2({type:re,hostBindings:function(Z,_e){1&Z&&he.NdJ("click",function(Ct){return _e.onClick(Ct)})},inputs:{color:"color",defaultHref:"defaultHref",disabled:"disabled",icon:"icon",mode:"mode",routerAnimation:"routerAnimation",text:"text",type:"type"}}),re=(0,mr.gn)([En({inputs:us})],re),re})(),ns=(()=>{class re{constructor(Z,_e,We,Ct,Qt){this.locationStrategy=Z,this.navCtrl=_e,this.elementRef=We,this.router=Ct,this.routerLink=Qt,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){var Z;if(null!==(Z=this.routerLink)&&void 0!==Z&&Z.urlTree){const _e=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=_e}}onClick(Z){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation),Z.preventDefault()}}return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(Ie.S$),he.Y36(ir),he.Y36(he.SBq),he.Y36(at.F0),he.Y36(at.rH,8))},re.\u0275dir=he.lG2({type:re,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(Z,_e){1&Z&&he.NdJ("click",function(Ct){return _e.onClick(Ct)})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[he.TTD]}),re})(),po=(()=>{class re{constructor(Z,_e,We,Ct,Qt){this.locationStrategy=Z,this.navCtrl=_e,this.elementRef=We,this.router=Ct,this.routerLink=Qt,this.routerDirection="forward"}ngOnInit(){this.updateTargetUrlAndHref()}ngOnChanges(){this.updateTargetUrlAndHref()}updateTargetUrlAndHref(){var Z;if(null!==(Z=this.routerLink)&&void 0!==Z&&Z.urlTree){const _e=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.routerLink.urlTree));this.elementRef.nativeElement.href=_e}}onClick(){this.navCtrl.setDirection(this.routerDirection,void 0,void 0,this.routerAnimation)}}return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(Ie.S$),he.Y36(ir),he.Y36(he.SBq),he.Y36(at.F0),he.Y36(at.rH,8))},re.\u0275dir=he.lG2({type:re,selectors:[["a","routerLink",""],["area","routerLink",""]],hostBindings:function(Z,_e){1&Z&&he.NdJ("click",function(){return _e.onClick()})},inputs:{routerDirection:"routerDirection",routerAnimation:"routerAnimation"},features:[he.TTD]}),re})();const ti=["animated","animation","root","rootParams","swipeGesture"],ds=["push","insert","insertPages","pop","popTo","popToRoot","removeIndex","setRoot","setPages","getActive","getByIndex","canGoBack","getPrevious"];let Qi=(()=>{let re=class{constructor(Z,_e,We,Ct,Qt,q){this.z=Qt,q.detach(),this.el=Z.nativeElement,Z.nativeElement.delegate=Ct.create(_e,We),vn(this,this.el,["ionNavDidChange","ionNavWillChange"])}};return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(he.SBq),he.Y36(he.lqb),he.Y36(he.zs3),he.Y36(Ui),he.Y36(he.R0b),he.Y36(he.sBO))},re.\u0275dir=he.lG2({type:re,inputs:{animated:"animated",animation:"animation",root:"root",rootParams:"rootParams",swipeGesture:"swipeGesture"}}),re=(0,mr.gn)([En({inputs:ti,methods:ds})],re),re})(),pi=(()=>{class re{constructor(Z){this.navCtrl=Z,this.ionTabsWillChange=new he.vpe,this.ionTabsDidChange=new he.vpe,this.tabBarSlot="bottom"}ngAfterContentInit(){this.detectSlotChanges()}ngAfterContentChecked(){this.detectSlotChanges()}onStackWillChange({enteringView:Z,tabSwitch:_e}){const We=Z.stackId;_e&&void 0!==We&&this.ionTabsWillChange.emit({tab:We})}onStackDidChange({enteringView:Z,tabSwitch:_e}){const We=Z.stackId;_e&&void 0!==We&&(this.tabBar&&(this.tabBar.selectedTab=We),this.ionTabsDidChange.emit({tab:We}))}select(Z){const _e="string"==typeof Z,We=_e?Z:Z.detail.tab,Ct=this.outlet.getActiveStackId()===We,Qt=`${this.outlet.tabsPrefix}/${We}`;if(_e||Z.stopPropagation(),Ct){const q=this.outlet.getActiveStackId(),ce=this.outlet.getLastRouteView(q);if((null==ce?void 0:ce.url)===Qt)return;const Pe=this.outlet.getRootView(We);return this.navCtrl.navigateRoot(Qt,{...Pe&&Qt===Pe.url&&Pe.savedExtras,animated:!0,animationDirection:"back"})}{const q=this.outlet.getLastRouteView(We);return this.navCtrl.navigateRoot((null==q?void 0:q.url)||Qt,{...null==q?void 0:q.savedExtras,animated:!0,animationDirection:"back"})}}getSelected(){return this.outlet.getActiveStackId()}detectSlotChanges(){this.tabBars.forEach(Z=>{const _e=Z.el.getAttribute("slot");_e!==this.tabBarSlot&&(this.tabBarSlot=_e,this.relocateTabBar())})}relocateTabBar(){const Z=this.tabBar.el;"top"===this.tabBarSlot?this.tabsInner.nativeElement.before(Z):this.tabsInner.nativeElement.after(Z)}}return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(ir))},re.\u0275dir=he.lG2({type:re,selectors:[["ion-tabs"]],viewQuery:function(Z,_e){if(1&Z&&he.Gf(zt,7,he.SBq),2&Z){let We;he.iGM(We=he.CRH())&&(_e.tabsInner=We.first)}},hostBindings:function(Z,_e){1&Z&&he.NdJ("ionTabButtonClick",function(Ct){return _e.select(Ct)})},outputs:{ionTabsWillChange:"ionTabsWillChange",ionTabsDidChange:"ionTabsDidChange"}}),re})();const xs=re=>"function"==typeof __zone_symbol__requestAnimationFrame?__zone_symbol__requestAnimationFrame(re):"function"==typeof requestAnimationFrame?requestAnimationFrame(re):setTimeout(re);let Wi=(()=>{class re{constructor(Z,_e){this.injector=Z,this.elementRef=_e,this.onChange=()=>{},this.onTouched=()=>{}}writeValue(Z){this.elementRef.nativeElement.value=this.lastValue=Z,Br(this.elementRef)}handleValueChange(Z,_e){Z===this.elementRef.nativeElement&&(_e!==this.lastValue&&(this.lastValue=_e,this.onChange(_e)),Br(this.elementRef))}_handleBlurEvent(Z){Z===this.elementRef.nativeElement&&(this.onTouched(),Br(this.elementRef))}registerOnChange(Z){this.onChange=Z}registerOnTouched(Z){this.onTouched=Z}setDisabledState(Z){this.elementRef.nativeElement.disabled=Z}ngOnDestroy(){this.statusChanges&&this.statusChanges.unsubscribe()}ngAfterViewInit(){let Z;try{Z=this.injector.get(Bt.a5)}catch{}if(!Z)return;Z.statusChanges&&(this.statusChanges=Z.statusChanges.subscribe(()=>Br(this.elementRef)));const _e=Z.control;_e&&["markAsTouched","markAllAsTouched","markAsUntouched","markAsDirty","markAsPristine"].forEach(Ct=>{if(typeof _e[Ct]<"u"){const Qt=_e[Ct].bind(_e);_e[Ct]=(...q)=>{Qt(...q),Br(this.elementRef)}}})}}return re.\u0275fac=function(Z){return new(Z||re)(he.Y36(he.zs3),he.Y36(he.SBq))},re.\u0275dir=he.lG2({type:re,hostBindings:function(Z,_e){1&Z&&he.NdJ("ionBlur",function(Ct){return _e._handleBlurEvent(Ct.target)})}}),re})();const Br=re=>{xs(()=>{const ne=re.nativeElement,Z=null!=ne.value&&ne.value.toString().length>0,_e=Bs(ne);Vs(ne,_e);const We=ne.closest("ion-item");We&&Vs(We,Z?[..._e,"item-has-value"]:_e)})},Bs=re=>{const ne=re.classList,Z=[];for(let _e=0;_e<ne.length;_e++){const We=ne.item(_e);null!==We&&Se(We,"ng-")&&Z.push(`ion-${We.substring(3)}`)}return Z},Vs=(re,ne)=>{const Z=re.classList;Z.remove("ion-valid","ion-invalid","ion-touched","ion-untouched","ion-dirty","ion-pristine"),Z.add(...ne)},Se=(re,ne)=>re.substring(0,ne.length)===ne;class Et{shouldDetach(ne){return!1}shouldAttach(ne){return!1}store(ne,Z){}retrieve(ne){return null}shouldReuseRoute(ne,Z){if(ne.routeConfig!==Z.routeConfig)return!1;const _e=ne.params,We=Z.params,Ct=Object.keys(_e),Qt=Object.keys(We);if(Ct.length!==Qt.length)return!1;for(const q of Ct)if(We[q]!==_e[q])return!1;return!0}}class Ze{constructor(ne){this.ctrl=ne}create(ne){return this.ctrl.create(ne||{})}dismiss(ne,Z,_e){return this.ctrl.dismiss(ne,Z,_e)}getTop(){return this.ctrl.getTop()}}},1929:(ur,Kt,ae)=>{"use strict";ae.d(Kt,{Br:()=>Pe,vB:()=>ct,w:()=>on,dr:()=>mr,BJ:()=>gr,yp:()=>An,YG:()=>ye,Sm:()=>Me,PM:()=>Bt,FN:()=>zt,Zi:()=>nn,tO:()=>In,Dq:()=>Xt,hM:()=>cn,W2:()=>ir,IJ:()=>Nn,W4:()=>Kr,zq:()=>Lr,fr:()=>qi,Gu:()=>Ui,gu:()=>fr,Ie:()=>Mo,rH:()=>Ht,Q$:()=>xn,q_:()=>Ln,ki:()=>_e,nJ:()=>dr,Wo:()=>Oo,jP:()=>Se,VI:()=>ko,PQ:()=>ns,yq:()=>ti,ZU:()=>ds,UN:()=>Et,Bs:()=>xs,wd:()=>Wi,ho:()=>Bs,sr:()=>Vs,Pc:()=>Ji,YI:()=>ne,j9:()=>sn,yF:()=>wn});var E=ae(9212),he=ae(95),at=ae(7346),Ie=ae(7582),ge=ae(2438),Ve=ae(6814),Le=ae(4653),Be=ae(4913),vt=(ae(2325),ae(3433),ae(6615),ae(4510)),xt=(ae(6535),ae(2905)),gt=ae(8958),Ot=(ae(5613),ae(9207)),Pt=(ae(1848),ae(771));ae(2019);const st=xt.i,Te=["*"],De=["outlet"],dt=[[["","slot","top"]],"*"],mt=["[slot=top]","*"];function Gt(N,be){if(1&N&&(E.TgZ(0,"div",1),E.GkF(1,2),E.qZA()),2&N){const K=E.oxw();E.xp6(1),E.Q6J("ngTemplateOutlet",K.template)}}let on=(()=>{class N extends at.bk{constructor(K,Fe){super(K,Fe)}writeValue(K){this.elementRef.nativeElement.checked=this.lastValue=K,(0,at.vk)(this.elementRef)}_handleIonChange(K){this.handleValueChange(K,K.checked)}}return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.zs3),E.Y36(E.SBq))},N.\u0275dir=E.lG2({type:N,selectors:[["ion-checkbox"],["ion-toggle"]],hostBindings:function(K,Fe){1&K&&E.NdJ("ionChange",function(Hr){return Fe._handleIonChange(Hr.target)})},features:[E._Bn([{provide:he.JU,useExisting:N,multi:!0}]),E.qOj]}),N})(),sn=(()=>{class N extends at.bk{constructor(K,Fe){super(K,Fe)}_handleInputEvent(K){this.handleValueChange(K,K.value)}}return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.zs3),E.Y36(E.SBq))},N.\u0275dir=E.lG2({type:N,selectors:[["ion-input",3,"type","number"],["ion-textarea"],["ion-searchbar"],["ion-range"]],hostBindings:function(K,Fe){1&K&&E.NdJ("ionInput",function(Hr){return Fe._handleInputEvent(Hr.target)})},features:[E._Bn([{provide:he.JU,useExisting:N,multi:!0}]),E.qOj]}),N})();const yt=(N,be)=>{const K=N.prototype;be.forEach(Fe=>{Object.defineProperty(K,Fe,{get(){return this.el[Fe]},set(Lt){this.z.runOutsideAngular(()=>this.el[Fe]=Lt)},configurable:!0})})},Xe=(N,be)=>{const K=N.prototype;be.forEach(Fe=>{K[Fe]=function(){const Lt=arguments;return this.z.runOutsideAngular(()=>this.el[Fe].apply(this.el,Lt))}})},tt=(N,be,K)=>{K.forEach(Fe=>N[Fe]=(0,ge.R)(be,Fe))};function _t(N){return function(K){const{defineCustomElementFn:Fe,inputs:Lt,methods:Hr}=N;return void 0!==Fe&&Fe(),Lt&&yt(K,Lt),Hr&&Xe(K,Hr),K}}let mr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-app"]],ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({})],N),N})(),gr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-avatar"]],ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({})],N),N})(),An=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-badge"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode"]})],N),N})(),ye=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionFocus","ionBlur"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-button"]],inputs:{buttonType:"buttonType",color:"color",disabled:"disabled",download:"download",expand:"expand",fill:"fill",form:"form",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",size:"size",strong:"strong",target:"target",type:"type"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["buttonType","color","disabled","download","expand","fill","form","href","mode","rel","routerAnimation","routerDirection","shape","size","strong","target","type"]})],N),N})(),Me=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-buttons"]],inputs:{collapse:"collapse"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["collapse"]})],N),N})(),Bt=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-card"]],inputs:{button:"button",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",target:"target",type:"type"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["button","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","target","type"]})],N),N})(),zt=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-card-content"]],inputs:{mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["mode"]})],N),N})(),nn=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-card-header"]],inputs:{color:"color",mode:"mode",translucent:"translucent"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode","translucent"]})],N),N})(),In=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-card-subtitle"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode"]})],N),N})(),Xt=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-card-title"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode"]})],N),N})(),cn=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-chip"]],inputs:{color:"color",disabled:"disabled",mode:"mode",outline:"outline"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","disabled","mode","outline"]})],N),N})(),ir=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionScrollStart","ionScroll","ionScrollEnd"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-content"]],inputs:{color:"color",forceOverscroll:"forceOverscroll",fullscreen:"fullscreen",scrollEvents:"scrollEvents",scrollX:"scrollX",scrollY:"scrollY"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","forceOverscroll","fullscreen","scrollEvents","scrollX","scrollY"],methods:["getScrollElement","scrollToTop","scrollToBottom","scrollByPoint","scrollToPoint"]})],N),N})(),Nn=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-fab"]],inputs:{activated:"activated",edge:"edge",horizontal:"horizontal",vertical:"vertical"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["activated","edge","horizontal","vertical"],methods:["close"]})],N),N})(),Kr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionFocus","ionBlur"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-fab-button"]],inputs:{activated:"activated",closeIcon:"closeIcon",color:"color",disabled:"disabled",download:"download",href:"href",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",show:"show",size:"size",target:"target",translucent:"translucent",type:"type"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["activated","closeIcon","color","disabled","download","href","mode","rel","routerAnimation","routerDirection","show","size","target","translucent","type"]})],N),N})(),Lr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-fab-list"]],inputs:{activated:"activated",side:"side"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["activated","side"]})],N),N})(),qi=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-footer"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["collapse","mode","translucent"]})],N),N})(),Ui=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-header"]],inputs:{collapse:"collapse",mode:"mode",translucent:"translucent"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["collapse","mode","translucent"]})],N),N})(),fr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-icon"]],inputs:{color:"color",flipRtl:"flipRtl",icon:"icon",ios:"ios",lazy:"lazy",md:"md",mode:"mode",name:"name",sanitize:"sanitize",size:"size",src:"src"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","flipRtl","icon","ios","lazy","md","mode","name","sanitize","size","src"]})],N),N})(),Mo=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-item"]],inputs:{button:"button",color:"color",counter:"counter",counterFormatter:"counterFormatter",detail:"detail",detailIcon:"detailIcon",disabled:"disabled",download:"download",fill:"fill",href:"href",lines:"lines",mode:"mode",rel:"rel",routerAnimation:"routerAnimation",routerDirection:"routerDirection",shape:"shape",target:"target",type:"type"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["button","color","counter","counterFormatter","detail","detailIcon","disabled","download","fill","href","lines","mode","rel","routerAnimation","routerDirection","shape","target","type"]})],N),N})(),Ht=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-item-divider"]],inputs:{color:"color",mode:"mode",sticky:"sticky"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode","sticky"]})],N),N})(),xn=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-label"]],inputs:{color:"color",mode:"mode",position:"position"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode","position"]})],N),N})(),Ln=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-list"]],inputs:{inset:"inset",lines:"lines",mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["inset","lines","mode"],methods:["closeSlidingItems"]})],N),N})(),dr=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionRefresh","ionPull","ionStart"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-refresher"]],inputs:{closeDuration:"closeDuration",disabled:"disabled",mode:"mode",pullFactor:"pullFactor",pullMax:"pullMax",pullMin:"pullMin",snapbackDuration:"snapbackDuration"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["closeDuration","disabled","mode","pullFactor","pullMax","pullMin","snapbackDuration"],methods:["complete","cancel","getProgress"]})],N),N})(),Oo=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-refresher-content"]],inputs:{pullingIcon:"pullingIcon",pullingText:"pullingText",refreshingSpinner:"refreshingSpinner",refreshingText:"refreshingText"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["pullingIcon","pullingText","refreshingSpinner","refreshingText"]})],N),N})(),ko=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionInput","ionChange","ionCancel","ionClear","ionBlur","ionFocus"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-searchbar"]],inputs:{animated:"animated",autocomplete:"autocomplete",autocorrect:"autocorrect",cancelButtonIcon:"cancelButtonIcon",cancelButtonText:"cancelButtonText",clearIcon:"clearIcon",color:"color",debounce:"debounce",disabled:"disabled",enterkeyhint:"enterkeyhint",inputmode:"inputmode",mode:"mode",name:"name",placeholder:"placeholder",searchIcon:"searchIcon",showCancelButton:"showCancelButton",showClearButton:"showClearButton",spellcheck:"spellcheck",type:"type",value:"value"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["animated","autocomplete","autocorrect","cancelButtonIcon","cancelButtonText","clearIcon","color","debounce","disabled","enterkeyhint","inputmode","mode","name","placeholder","searchIcon","showCancelButton","showClearButton","spellcheck","type","value"],methods:["setFocus","getInputElement"]})],N),N})(),ns=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-spinner"]],inputs:{color:"color",duration:"duration",name:"name",paused:"paused"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","duration","name","paused"]})],N),N})(),ti=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-tab-bar"]],inputs:{color:"color",mode:"mode",selectedTab:"selectedTab",translucent:"translucent"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode","selectedTab","translucent"]})],N),N})(),ds=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-tab-button"]],inputs:{disabled:"disabled",download:"download",href:"href",layout:"layout",mode:"mode",rel:"rel",selected:"selected",tab:"tab",target:"target"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["disabled","download","href","layout","mode","rel","selected","tab","target"]})],N),N})(),xs=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-thumbnail"]],ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({})],N),N})(),Wi=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-title"]],inputs:{color:"color",size:"size"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","size"]})],N),N})(),Bs=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement,tt(this,this.el,["ionChange","ionFocus","ionBlur"])}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-toggle"]],inputs:{alignment:"alignment",checked:"checked",color:"color",disabled:"disabled",enableOnOffLabels:"enableOnOffLabels",justify:"justify",labelPlacement:"labelPlacement",legacy:"legacy",mode:"mode",name:"name",value:"value"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["alignment","checked","color","disabled","enableOnOffLabels","justify","labelPlacement","legacy","mode","name","value"]})],N),N})(),Vs=(()=>{let N=class{constructor(K,Fe,Lt){this.z=Lt,K.detach(),this.el=Fe.nativeElement}};return N.\u0275fac=function(K){return new(K||N)(E.Y36(E.sBO),E.Y36(E.SBq),E.Y36(E.R0b))},N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-toolbar"]],inputs:{color:"color",mode:"mode"},ngContentSelectors:Te,decls:1,vars:0,template:function(K,Fe){1&K&&(E.F$t(),E.Hsn(0))},encapsulation:2,changeDetection:0}),N=(0,Ie.gn)([_t({inputs:["color","mode"]})],N),N})(),Se=(()=>{class N extends at.jP{constructor(K,Fe,Lt,Hr,$o,zs,Wn,Yr){super(K,Fe,Lt,Hr,$o,zs,Wn,Yr),this.parentOutlet=Yr}}return N.\u0275fac=function(K){return new(K||N)(E.$8M("name"),E.$8M("tabs"),E.Y36(Ve.Ye),E.Y36(E.SBq),E.Y36(Le.F0),E.Y36(E.R0b),E.Y36(Le.gz),E.Y36(N,12))},N.\u0275dir=E.lG2({type:N,selectors:[["ion-router-outlet"]],features:[E.qOj]}),N})(),Et=(()=>{class N extends at.UN{}return N.\u0275fac=(()=>{let be;return function(Fe){return(be||(be=E.n5z(N)))(Fe||N)}})(),N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-tabs"]],contentQueries:function(K,Fe,Lt){if(1&K&&(E.Suo(Lt,ti,5),E.Suo(Lt,ti,4)),2&K){let Hr;E.iGM(Hr=E.CRH())&&(Fe.tabBar=Hr.first),E.iGM(Hr=E.CRH())&&(Fe.tabBars=Hr)}},viewQuery:function(K,Fe){if(1&K&&E.Gf(De,5,Se),2&K){let Lt;E.iGM(Lt=E.CRH())&&(Fe.outlet=Lt.first)}},features:[E.qOj],ngContentSelectors:mt,decls:6,vars:0,consts:[[1,"tabs-inner"],["tabsInner",""],["tabs","true",3,"stackWillChange","stackDidChange"],["outlet",""]],template:function(K,Fe){1&K&&(E.F$t(dt),E.Hsn(0),E.TgZ(1,"div",0,1)(3,"ion-router-outlet",2,3),E.NdJ("stackWillChange",function(Hr){return Fe.onStackWillChange(Hr)})("stackDidChange",function(Hr){return Fe.onStackDidChange(Hr)}),E.qZA()(),E.Hsn(5,1))},dependencies:[Se],styles:["[_nghost-%COMP%]{display:flex;position:absolute;inset:0;flex-direction:column;width:100%;height:100%;contain:layout size style}.tabs-inner[_ngcontent-%COMP%]{position:relative;flex:1;contain:layout size style}"]}),N})(),ne=(()=>{class N extends at.j{}return N.\u0275fac=(()=>{let be;return function(Fe){return(be||(be=E.n5z(N)))(Fe||N)}})(),N.\u0275dir=E.lG2({type:N,selectors:[["","routerLink","",5,"a",5,"area"]],features:[E.qOj]}),N})(),_e=(()=>{class N extends at.ki{}return N.\u0275fac=(()=>{let be;return function(Fe){return(be||(be=E.n5z(N)))(Fe||N)}})(),N.\u0275cmp=E.Xpm({type:N,selectors:[["ion-modal"]],features:[E.qOj],decls:1,vars:1,consts:[["class","ion-delegate-host ion-page",4,"ngIf"],[1,"ion-delegate-host","ion-page"],[3,"ngTemplateOutlet"]],template:function(K,Fe){1&K&&E.YNc(0,Gt,2,1,"div",0),2&K&&E.Q6J("ngIf",Fe.isCmpOpen||Fe.keepContentsMounted)},dependencies:[Ve.O5,Ve.tP],encapsulation:2,changeDetection:0}),N})();const Ct={provide:he.Cf,useExisting:(0,E.Gpc)(()=>Qt),multi:!0};let Qt=(()=>{class N extends he.Fd{}return N.\u0275fac=(()=>{let be;return function(Fe){return(be||(be=E.n5z(N)))(Fe||N)}})(),N.\u0275dir=E.lG2({type:N,selectors:[["ion-input","type","number","max","","formControlName",""],["ion-input","type","number","max","","formControl",""],["ion-input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(K,Fe){2&K&&E.uIk("max",Fe._enabled?Fe.max:null)},features:[E._Bn([Ct]),E.qOj]}),N})();const q={provide:he.Cf,useExisting:(0,E.Gpc)(()=>ce),multi:!0};let ce=(()=>{class N extends he.qQ{}return N.\u0275fac=(()=>{let be;return function(Fe){return(be||(be=E.n5z(N)))(Fe||N)}})(),N.\u0275dir=E.lG2({type:N,selectors:[["ion-input","type","number","min","","formControlName",""],["ion-input","type","number","min","","formControl",""],["ion-input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(K,Fe){2&K&&E.uIk("min",Fe._enabled?Fe.min:null)},features:[E._Bn([q]),E.qOj]}),N})(),Pe=(()=>{class N extends at.xs{constructor(){super(Ot.a)}}return N.\u0275fac=function(K){return new(K||N)},N.\u0275prov=E.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),N})(),ct=(()=>{class N{create(K){return(0,Be.c)(K)}easingTime(K,Fe,Lt,Hr,$o){return(0,vt.g)(K,Fe,Lt,Hr,$o)}}return N.\u0275fac=function(K){return new(K||N)},N.\u0275prov=E.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),N})(),Fn=(()=>{class N extends at.xs{constructor(){super(Ot.m),this.angularDelegate=(0,E.f3M)(at.y4),this.injector=(0,E.f3M)(E.zs3),this.environmentInjector=(0,E.f3M)(E.lqb)}create(K){return super.create({...K,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"modal")})}}return N.\u0275fac=function(K){return new(K||N)},N.\u0275prov=E.Yz7({token:N,factory:N.\u0275fac}),N})();class kt extends at.xs{constructor(){super(Ot.c),this.angularDelegate=(0,E.f3M)(at.y4),this.injector=(0,E.f3M)(E.zs3),this.environmentInjector=(0,E.f3M)(E.lqb)}create(be){return super.create({...be,delegate:this.angularDelegate.create(this.environmentInjector,this.injector,"popover")})}}let wn=(()=>{class N extends at.xs{constructor(){super(Ot.t)}}return N.\u0275fac=function(K){return new(K||N)},N.\u0275prov=E.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),N})();const Kn=(N,be,K)=>()=>{if(be.defaultView&&typeof window<"u"){(0,gt.s)({...N,_zoneGate:Hr=>K.run(Hr)});const Lt="__zone_symbol__addEventListener"in be.body?"__zone_symbol__addEventListener":"addEventListener";return function me(){var N=[];if(typeof window<"u"){var be=window;(!be.customElements||be.Element&&(!be.Element.prototype.closest||!be.Element.prototype.matches||!be.Element.prototype.remove||!be.Element.prototype.getRootNode))&&N.push(ae.e(6748).then(ae.t.bind(ae,3342,23))),("function"!=typeof Object.assign||!Object.entries||!Array.prototype.find||!Array.prototype.includes||!String.prototype.startsWith||!String.prototype.endsWith||be.NodeList&&!be.NodeList.prototype.forEach||!be.fetch||!function(){try{var Fe=new URL("b","http://a");return Fe.pathname="c%20d","http://a/c%20d"===Fe.href&&Fe.searchParams}catch{return!1}}()||typeof WeakMap>"u")&&N.push(ae.e(2214).then(ae.t.bind(ae,2668,23)))}return Promise.all(N)}().then(()=>((N,be)=>{if(!(typeof window>"u"))return st(),(0,Pt.b)(JSON.parse('[["ion-menu_3",[[33,"ion-menu-button",{"color":[513],"disabled":[4],"menu":[1],"autoHide":[4,"auto-hide"],"type":[1],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]],[33,"ion-menu",{"contentId":[513,"content-id"],"menuId":[513,"menu-id"],"type":[1025],"disabled":[1028],"side":[513],"swipeGesture":[4,"swipe-gesture"],"maxEdgeStart":[2,"max-edge-start"],"isPaneVisible":[32],"isEndSide":[32],"isOpen":[64],"isActive":[64],"open":[64],"close":[64],"toggle":[64],"setOpen":[64]},[[16,"ionSplitPaneVisible","onSplitPaneChanged"],[2,"click","onBackdropClick"],[0,"keydown","onKeydown"]],{"type":["typeChanged"],"disabled":["disabledChanged"],"side":["sideChanged"],"swipeGesture":["swipeGestureChanged"]}],[1,"ion-menu-toggle",{"menu":[1],"autoHide":[4,"auto-hide"],"visible":[32]},[[16,"ionMenuChange","visibilityChanged"],[16,"ionSplitPaneVisible","visibilityChanged"]]]]],["ion-fab_3",[[33,"ion-fab-button",{"color":[513],"activated":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1],"show":[4],"translucent":[4],"type":[1],"size":[1],"closeIcon":[1,"close-icon"]}],[1,"ion-fab",{"horizontal":[1],"vertical":[1],"edge":[4],"activated":[1028],"close":[64],"toggle":[64]},null,{"activated":["activatedChanged"]}],[1,"ion-fab-list",{"activated":[4],"side":[1]},null,{"activated":["activatedChanged"]}]]],["ion-refresher_2",[[0,"ion-refresher-content",{"pullingIcon":[1025,"pulling-icon"],"pullingText":[1,"pulling-text"],"refreshingSpinner":[1025,"refreshing-spinner"],"refreshingText":[1,"refreshing-text"]}],[32,"ion-refresher",{"pullMin":[2,"pull-min"],"pullMax":[2,"pull-max"],"closeDuration":[1,"close-duration"],"snapbackDuration":[1,"snapback-duration"],"pullFactor":[2,"pull-factor"],"disabled":[4],"nativeRefresher":[32],"state":[32],"complete":[64],"cancel":[64],"getProgress":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-back-button",[[33,"ion-back-button",{"color":[513],"defaultHref":[1025,"default-href"],"disabled":[516],"icon":[1],"text":[1],"type":[1],"routerAnimation":[16]}]]],["ion-toast",[[33,"ion-toast",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"color":[513],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"duration":[2],"header":[1],"layout":[1],"message":[1],"keyboardClose":[4,"keyboard-close"],"position":[1],"positionAnchor":[1,"position-anchor"],"buttons":[16],"translucent":[4],"animated":[4],"icon":[1],"htmlAttributes":[16],"swipeGesture":[1,"swipe-gesture"],"isOpen":[4,"is-open"],"trigger":[1],"revealContentToScreenReader":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"swipeGesture":["swipeGestureChanged"],"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-card_5",[[33,"ion-card",{"color":[513],"button":[4],"type":[1],"disabled":[4],"download":[1],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}],[32,"ion-card-content"],[33,"ion-card-header",{"color":[513],"translucent":[4]}],[33,"ion-card-subtitle",{"color":[513]}],[33,"ion-card-title",{"color":[513]}]]],["ion-item-option_3",[[33,"ion-item-option",{"color":[513],"disabled":[4],"download":[1],"expandable":[4],"href":[1],"rel":[1],"target":[1],"type":[1]}],[32,"ion-item-options",{"side":[1],"fireSwipeEvent":[64]}],[0,"ion-item-sliding",{"disabled":[4],"state":[32],"getOpenAmount":[64],"getSlidingRatio":[64],"open":[64],"close":[64],"closeOpened":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-accordion_2",[[49,"ion-accordion",{"value":[1],"disabled":[4],"readonly":[4],"toggleIcon":[1,"toggle-icon"],"toggleIconSlot":[1,"toggle-icon-slot"],"state":[32],"isNext":[32],"isPrevious":[32]},null,{"value":["valueChanged"]}],[33,"ion-accordion-group",{"animated":[4],"multiple":[4],"value":[1025],"disabled":[4],"readonly":[4],"expand":[1],"requestAccordionToggle":[64],"getAccordions":[64]},[[0,"keydown","onKeydown"]],{"value":["valueChanged"],"disabled":["disabledChanged"],"readonly":["readonlyChanged"]}]]],["ion-infinite-scroll_2",[[32,"ion-infinite-scroll-content",{"loadingSpinner":[1025,"loading-spinner"],"loadingText":[1,"loading-text"]}],[0,"ion-infinite-scroll",{"threshold":[1],"disabled":[4],"position":[1],"isLoading":[32],"complete":[64]},null,{"threshold":["thresholdChanged"],"disabled":["disabledChanged"]}]]],["ion-reorder_2",[[33,"ion-reorder",null,[[2,"click","onClick"]]],[0,"ion-reorder-group",{"disabled":[4],"state":[32],"complete":[64]},null,{"disabled":["disabledChanged"]}]]],["ion-segment_2",[[33,"ion-segment-button",{"disabled":[1028],"layout":[1],"type":[1],"value":[8],"checked":[32],"setFocus":[64]},null,{"value":["valueChanged"]}],[33,"ion-segment",{"color":[513],"disabled":[4],"scrollable":[4],"swipeGesture":[4,"swipe-gesture"],"value":[1032],"selectOnFocus":[4,"select-on-focus"],"activated":[32]},[[0,"keydown","onKeyDown"]],{"color":["colorChanged"],"swipeGesture":["swipeGestureChanged"],"value":["valueChanged"],"disabled":["disabledChanged"]}]]],["ion-tab-bar_2",[[33,"ion-tab-button",{"disabled":[4],"download":[1],"href":[1],"rel":[1],"layout":[1025],"selected":[1028],"tab":[1],"target":[1]},[[8,"ionTabBarChanged","onTabBarChanged"]]],[33,"ion-tab-bar",{"color":[513],"selectedTab":[1,"selected-tab"],"translucent":[4],"keyboardVisible":[32]},null,{"selectedTab":["selectedTabChanged"]}]]],["ion-chip",[[33,"ion-chip",{"color":[513],"outline":[4],"disabled":[4]}]]],["ion-datetime-button",[[33,"ion-datetime-button",{"color":[513],"disabled":[516],"datetime":[1],"datetimePresentation":[32],"dateText":[32],"timeText":[32],"datetimeActive":[32],"selectedButton":[32]}]]],["ion-input",[[38,"ion-input",{"color":[513],"accept":[1],"autocapitalize":[1],"autocomplete":[1],"autocorrect":[1],"autofocus":[4],"clearInput":[4,"clear-input"],"clearOnEdit":[4,"clear-on-edit"],"counter":[4],"counterFormatter":[16],"debounce":[2],"disabled":[4],"enterkeyhint":[1],"errorText":[1,"error-text"],"fill":[1],"inputmode":[1],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"max":[8],"maxlength":[2],"min":[8],"minlength":[2],"multiple":[4],"name":[1],"pattern":[1],"placeholder":[1],"readonly":[4],"required":[4],"shape":[1],"spellcheck":[4],"step":[1],"size":[2],"type":[1],"value":[1032],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"disabled":["disabledChanged"],"placeholder":["placeholderChanged"],"value":["valueChanged"]}]]],["ion-searchbar",[[34,"ion-searchbar",{"color":[513],"animated":[4],"autocomplete":[1],"autocorrect":[1],"cancelButtonIcon":[1,"cancel-button-icon"],"cancelButtonText":[1,"cancel-button-text"],"clearIcon":[1,"clear-icon"],"debounce":[2],"disabled":[4],"inputmode":[1],"enterkeyhint":[1],"name":[1],"placeholder":[1],"searchIcon":[1,"search-icon"],"showCancelButton":[1,"show-cancel-button"],"showClearButton":[1,"show-clear-button"],"spellcheck":[4],"type":[1],"value":[1025],"focused":[32],"noAnimate":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"value":["valueChanged"],"showCancelButton":["showCancelButtonChanged"]}]]],["ion-toggle",[[33,"ion-toggle",{"color":[513],"name":[1],"checked":[1028],"disabled":[4],"value":[1],"enableOnOffLabels":[4,"enable-on-off-labels"],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"alignment":[1],"activated":[32]},null,{"disabled":["disabledChanged"]}]]],["ion-nav_2",[[1,"ion-nav",{"delegate":[16],"swipeGesture":[1028,"swipe-gesture"],"animated":[4],"animation":[16],"rootParams":[16],"root":[1],"push":[64],"insert":[64],"insertPages":[64],"pop":[64],"popTo":[64],"popToRoot":[64],"removeIndex":[64],"setRoot":[64],"setPages":[64],"setRouteId":[64],"getRouteId":[64],"getActive":[64],"getByIndex":[64],"canGoBack":[64],"getPrevious":[64]},null,{"swipeGesture":["swipeGestureChanged"],"root":["rootChanged"]}],[0,"ion-nav-link",{"component":[1],"componentProps":[16],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}]]],["ion-textarea",[[38,"ion-textarea",{"color":[513],"autocapitalize":[1],"autofocus":[4],"clearOnEdit":[4,"clear-on-edit"],"debounce":[2],"disabled":[4],"fill":[1],"inputmode":[1],"enterkeyhint":[1],"maxlength":[2],"minlength":[2],"name":[1],"placeholder":[1],"readonly":[4],"required":[4],"spellcheck":[4],"cols":[514],"rows":[2],"wrap":[1],"autoGrow":[516,"auto-grow"],"value":[1025],"counter":[4],"counterFormatter":[16],"errorText":[1,"error-text"],"helperText":[1,"helper-text"],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"shape":[1],"hasFocus":[32],"setFocus":[64],"getInputElement":[64]},null,{"debounce":["debounceChanged"],"disabled":["disabledChanged"],"value":["valueChanged"]}]]],["ion-backdrop",[[33,"ion-backdrop",{"visible":[4],"tappable":[4],"stopPropagation":[4,"stop-propagation"]},[[2,"click","onMouseDown"]]]]],["ion-loading",[[34,"ion-loading",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"message":[1],"cssClass":[1,"css-class"],"duration":[2],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"spinner":[1025],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-breadcrumb_2",[[33,"ion-breadcrumb",{"collapsed":[4],"last":[4],"showCollapsedIndicator":[4,"show-collapsed-indicator"],"color":[1],"active":[4],"disabled":[4],"download":[1],"href":[1],"rel":[1],"separator":[4],"target":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16]}],[33,"ion-breadcrumbs",{"color":[513],"maxItems":[2,"max-items"],"itemsBeforeCollapse":[2,"items-before-collapse"],"itemsAfterCollapse":[2,"items-after-collapse"],"collapsed":[32],"activeChanged":[32]},[[0,"collapsedClick","onCollapsedClick"]],{"maxItems":["maxItemsChanged"],"itemsBeforeCollapse":["maxItemsChanged"],"itemsAfterCollapse":["maxItemsChanged"]}]]],["ion-modal",[[33,"ion-modal",{"hasController":[4,"has-controller"],"overlayIndex":[2,"overlay-index"],"delegate":[16],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"breakpoints":[16],"initialBreakpoint":[2,"initial-breakpoint"],"backdropBreakpoint":[2,"backdrop-breakpoint"],"handle":[4],"handleBehavior":[1,"handle-behavior"],"component":[1],"componentProps":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"showBackdrop":[4,"show-backdrop"],"animated":[4],"presentingElement":[16],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"keepContentsMounted":[4,"keep-contents-mounted"],"canDismiss":[4,"can-dismiss"],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"setCurrentBreakpoint":[64],"getCurrentBreakpoint":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-route_4",[[0,"ion-route",{"url":[1],"component":[1],"componentProps":[16],"beforeLeave":[16],"beforeEnter":[16]},null,{"url":["onUpdate"],"component":["onUpdate"],"componentProps":["onComponentProps"]}],[0,"ion-route-redirect",{"from":[1],"to":[1]},null,{"from":["propDidChange"],"to":["propDidChange"]}],[0,"ion-router",{"root":[1],"useHash":[4,"use-hash"],"canTransition":[64],"push":[64],"back":[64],"printDebug":[64],"navChanged":[64]},[[8,"popstate","onPopState"],[4,"ionBackButton","onBackButton"]]],[1,"ion-router-link",{"color":[513],"href":[1],"rel":[1],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"target":[1]}]]],["ion-avatar_3",[[33,"ion-avatar"],[33,"ion-badge",{"color":[513]}],[1,"ion-thumbnail"]]],["ion-col_3",[[1,"ion-col",{"offset":[1],"offsetXs":[1,"offset-xs"],"offsetSm":[1,"offset-sm"],"offsetMd":[1,"offset-md"],"offsetLg":[1,"offset-lg"],"offsetXl":[1,"offset-xl"],"pull":[1],"pullXs":[1,"pull-xs"],"pullSm":[1,"pull-sm"],"pullMd":[1,"pull-md"],"pullLg":[1,"pull-lg"],"pullXl":[1,"pull-xl"],"push":[1],"pushXs":[1,"push-xs"],"pushSm":[1,"push-sm"],"pushMd":[1,"push-md"],"pushLg":[1,"push-lg"],"pushXl":[1,"push-xl"],"size":[1],"sizeXs":[1,"size-xs"],"sizeSm":[1,"size-sm"],"sizeMd":[1,"size-md"],"sizeLg":[1,"size-lg"],"sizeXl":[1,"size-xl"]},[[9,"resize","onResize"]]],[1,"ion-grid",{"fixed":[4]}],[1,"ion-row"]]],["ion-tab_2",[[1,"ion-tab",{"active":[1028],"delegate":[16],"tab":[1],"component":[1],"setActive":[64]},null,{"active":["changeActive"]}],[1,"ion-tabs",{"useRouter":[1028,"use-router"],"selectedTab":[32],"select":[64],"getTab":[64],"getSelected":[64],"setRouteId":[64],"getRouteId":[64]}]]],["ion-img",[[1,"ion-img",{"alt":[1],"src":[1],"loadSrc":[32],"loadError":[32]},null,{"src":["srcChanged"]}]]],["ion-progress-bar",[[33,"ion-progress-bar",{"type":[1],"reversed":[4],"value":[2],"buffer":[2],"color":[513]}]]],["ion-range",[[33,"ion-range",{"color":[513],"debounce":[2],"name":[1],"label":[1],"dualKnobs":[4,"dual-knobs"],"min":[2],"max":[2],"pin":[4],"pinFormatter":[16],"snaps":[4],"step":[2],"ticks":[4],"activeBarStart":[1026,"active-bar-start"],"disabled":[4],"value":[1026],"labelPlacement":[1,"label-placement"],"legacy":[4],"ratioA":[32],"ratioB":[32],"pressedKnob":[32]},null,{"debounce":["debounceChanged"],"min":["minChanged"],"max":["maxChanged"],"activeBarStart":["activeBarStartChanged"],"disabled":["disabledChanged"],"value":["valueChanged"]}]]],["ion-split-pane",[[33,"ion-split-pane",{"contentId":[513,"content-id"],"disabled":[4],"when":[8],"visible":[32]},null,{"visible":["visibleChanged"],"disabled":["updateState"],"when":["updateState"]}]]],["ion-text",[[1,"ion-text",{"color":[513]}]]],["ion-item_8",[[33,"ion-item-divider",{"color":[513],"sticky":[4]}],[32,"ion-item-group"],[1,"ion-skeleton-text",{"animated":[4]}],[32,"ion-list",{"lines":[1],"inset":[4],"closeSlidingItems":[64]}],[33,"ion-list-header",{"color":[513],"lines":[1]}],[49,"ion-item",{"color":[513],"button":[4],"detail":[4],"detailIcon":[1,"detail-icon"],"disabled":[4],"download":[1],"fill":[1],"shape":[1],"href":[1],"rel":[1],"lines":[1],"counter":[4],"routerAnimation":[16],"routerDirection":[1,"router-direction"],"target":[1],"type":[1],"counterFormatter":[16],"multipleInputs":[32],"focusable":[32],"counterString":[32]},[[0,"ionInput","handleIonInput"],[0,"ionColor","labelColorChanged"],[0,"ionStyle","itemStyle"]],{"counterFormatter":["counterFormatterChanged"]}],[34,"ion-label",{"color":[513],"position":[1],"noAnimate":[32]},null,{"color":["colorChanged"],"position":["positionChanged"]}],[33,"ion-note",{"color":[513]}]]],["ion-select_3",[[33,"ion-select",{"cancelText":[1,"cancel-text"],"color":[513],"compareWith":[1,"compare-with"],"disabled":[4],"fill":[1],"interface":[1],"interfaceOptions":[8,"interface-options"],"justify":[1],"label":[1],"labelPlacement":[1,"label-placement"],"legacy":[4],"multiple":[4],"name":[1],"okText":[1,"ok-text"],"placeholder":[1],"selectedText":[1,"selected-text"],"toggleIcon":[1,"toggle-icon"],"expandedIcon":[1,"expanded-icon"],"shape":[1],"value":[1032],"isExpanded":[32],"open":[64]},null,{"disabled":["styleChanged"],"isExpanded":["styleChanged"],"placeholder":["styleChanged"],"value":["styleChanged"]}],[1,"ion-select-option",{"disabled":[4],"value":[8]}],[34,"ion-select-popover",{"header":[1],"subHeader":[1,"sub-header"],"message":[1],"multiple":[4],"options":[16]}]]],["ion-picker-internal",[[33,"ion-picker-internal",{"exitInputMode":[64]},[[1,"touchstart","preventTouchStartPropagation"]]]]],["ion-datetime_3",[[33,"ion-datetime",{"color":[1],"name":[1],"disabled":[4],"readonly":[4],"isDateEnabled":[16],"min":[1025],"max":[1025],"presentation":[1],"cancelText":[1,"cancel-text"],"doneText":[1,"done-text"],"clearText":[1,"clear-text"],"yearValues":[8,"year-values"],"monthValues":[8,"month-values"],"dayValues":[8,"day-values"],"hourValues":[8,"hour-values"],"minuteValues":[8,"minute-values"],"locale":[1],"firstDayOfWeek":[2,"first-day-of-week"],"titleSelectedDatesFormatter":[16],"multiple":[4],"highlightedDates":[16],"value":[1025],"showDefaultTitle":[4,"show-default-title"],"showDefaultButtons":[4,"show-default-buttons"],"showClearButton":[4,"show-clear-button"],"showDefaultTimeLabel":[4,"show-default-time-label"],"hourCycle":[1,"hour-cycle"],"size":[1],"preferWheel":[4,"prefer-wheel"],"showMonthAndYear":[32],"activeParts":[32],"workingParts":[32],"isTimePopoverOpen":[32],"forceRenderDate":[32],"confirm":[64],"reset":[64],"cancel":[64]},null,{"disabled":["disabledChanged"],"min":["minChanged"],"max":["maxChanged"],"yearValues":["yearValuesChanged"],"monthValues":["monthValuesChanged"],"dayValues":["dayValuesChanged"],"hourValues":["hourValuesChanged"],"minuteValues":["minuteValuesChanged"],"value":["valueChanged"]}],[34,"ion-picker",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"columns":[16],"cssClass":[1,"css-class"],"duration":[2],"showBackdrop":[4,"show-backdrop"],"backdropDismiss":[4,"backdrop-dismiss"],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"presented":[32],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64],"getColumn":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}],[32,"ion-picker-column",{"col":[16]},null,{"col":["colChanged"]}]]],["ion-radio_2",[[33,"ion-radio",{"color":[513],"name":[1],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"legacy":[4],"justify":[1],"alignment":[1],"checked":[32],"buttonTabindex":[32],"setFocus":[64],"setButtonTabindex":[64]},null,{"value":["valueChanged"],"checked":["styleChanged"],"color":["styleChanged"],"disabled":["styleChanged"]}],[0,"ion-radio-group",{"allowEmptySelection":[4,"allow-empty-selection"],"compareWith":[1,"compare-with"],"name":[1],"value":[1032]},[[4,"keydown","onKeydown"]],{"value":["valueChanged"]}]]],["ion-ripple-effect",[[1,"ion-ripple-effect",{"type":[1],"addRipple":[64]}]]],["ion-button_2",[[33,"ion-button",{"color":[513],"buttonType":[1025,"button-type"],"disabled":[516],"expand":[513],"fill":[1537],"routerDirection":[1,"router-direction"],"routerAnimation":[16],"download":[1],"href":[1],"rel":[1],"shape":[513],"size":[513],"strong":[4],"target":[1],"type":[1],"form":[1]},null,{"disabled":["disabledChanged"]}],[1,"ion-icon",{"mode":[1025],"color":[1],"ios":[1],"md":[1],"flipRtl":[4,"flip-rtl"],"name":[513],"src":[1],"icon":[8],"size":[1],"lazy":[4],"sanitize":[4],"svgContent":[32],"isVisible":[32]},null,{"name":["loadIcon"],"src":["loadIcon"],"icon":["loadIcon"],"ios":["loadIcon"],"md":["loadIcon"]}]]],["ion-action-sheet",[[34,"ion-action-sheet",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"buttons":[16],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"header":[1],"subHeader":[1,"sub-header"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"]}]]],["ion-alert",[[34,"ion-alert",{"overlayIndex":[2,"overlay-index"],"delegate":[16],"hasController":[4,"has-controller"],"keyboardClose":[4,"keyboard-close"],"enterAnimation":[16],"leaveAnimation":[16],"cssClass":[1,"css-class"],"header":[1],"subHeader":[1,"sub-header"],"message":[1],"buttons":[16],"inputs":[1040],"backdropDismiss":[4,"backdrop-dismiss"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"isOpen":[4,"is-open"],"trigger":[1],"present":[64],"dismiss":[64],"onDidDismiss":[64],"onWillDismiss":[64]},[[4,"keydown","onKeydown"]],{"isOpen":["onIsOpenChange"],"trigger":["triggerChanged"],"buttons":["buttonsChanged"],"inputs":["inputsChanged"]}]]],["ion-app_8",[[0,"ion-app",{"setFocus":[64]}],[1,"ion-content",{"color":[513],"fullscreen":[4],"forceOverscroll":[1028,"force-overscroll"],"scrollX":[4,"scroll-x"],"scrollY":[4,"scroll-y"],"scrollEvents":[4,"scroll-events"],"getScrollElement":[64],"getBackgroundElement":[64],"scrollToTop":[64],"scrollToBottom":[64],"scrollByPoint":[64],"scrollToPoint":[64]},[[9,"resize","onResize"]]],[36,"ion-footer",{"collapse":[1],"translucent":[4],"keyboardVisible":[32]}],[36,"ion-header",{"collapse":[1],"translucent":[4]}],[1,"ion-router-outlet",{"mode":[1025],"delegate":[16],"animated":[4],"animation":[16],"swipeHandler":[16],"commit":[64],"setRouteId":[64],"getRouteId":[64]},null,{"swipeHandler":["swipeHandlerChanged"]}],[33,"ion-title",{"color":[513],"size":[1]},null,{"size":["sizeChanged"]}],[33,"ion-toolbar",{"color":[513]},[[0,"ionStyle","childrenStyle"]]],[34,"ion-buttons",{"collapse":[4]}]]],["ion-picker-column-internal",[[33,"ion-picker-column-internal",{"disabled":[4],"items":[16],"value":[1032],"color":[513],"numericInput":[4,"numeric-input"],"isActive":[32],"scrollActiveItemIntoView":[64],"setValue":[64]},null,{"value":["valueChange"]}]]],["ion-popover",[[33,"ion-popover",{"hasController":[4,"has-controller"],"delegate":[16],"overlayIndex":[2,"overlay-index"],"enterAnimation":[16],"leaveAnimation":[16],"component":[1],"componentProps":[16],"keyboardClose":[4,"keyboard-close"],"cssClass":[1,"css-class"],"backdropDismiss":[4,"backdrop-dismiss"],"event":[8],"showBackdrop":[4,"show-backdrop"],"translucent":[4],"animated":[4],"htmlAttributes":[16],"triggerAction":[1,"trigger-action"],"trigger":[1],"size":[1],"dismissOnSelect":[4,"dismiss-on-select"],"reference":[1],"side":[1],"alignment":[1025],"arrow":[4],"isOpen":[4,"is-open"],"keyboardEvents":[4,"keyboard-events"],"keepContentsMounted":[4,"keep-contents-mounted"],"presented":[32],"presentFromTrigger":[64],"present":[64],"dismiss":[64],"getParentPopover":[64],"onDidDismiss":[64],"onWillDismiss":[64]},null,{"trigger":["onTriggerChange"],"triggerAction":["onTriggerChange"],"isOpen":["onIsOpenChange"]}]]],["ion-checkbox",[[33,"ion-checkbox",{"color":[513],"name":[1],"checked":[1028],"indeterminate":[1028],"disabled":[4],"value":[8],"labelPlacement":[1,"label-placement"],"justify":[1],"alignment":[1],"legacy":[4]},null,{"checked":["styleChanged"],"disabled":["styleChanged"]}]]],["ion-spinner",[[1,"ion-spinner",{"color":[513],"duration":[2],"name":[1],"paused":[4]}]]]]'),be)})(0,{exclude:["ion-tabs","ion-tab"],syncQueue:!0,raf:at.Wn,jmp:Hr=>K.runOutsideAngular(Hr),ael(Hr,$o,zs,Wn){Hr[Lt]($o,zs,Wn)},rel(Hr,$o,zs,Wn){Hr.removeEventListener($o,zs,Wn)}}))}};let Ji=(()=>{class N{static forRoot(K){return{ngModule:N,providers:[{provide:at.dy,useValue:K},{provide:E.ip1,useFactory:Kn,multi:!0,deps:[at.dy,Ve.K0,E.R0b]},(0,at.DN)()]}}}return N.\u0275fac=function(K){return new(K||N)},N.\u0275mod=E.oAB({type:N}),N.\u0275inj=E.cJS({providers:[at.y4,Fn,kt],imports:[Ve.ez]}),N})()},5861:(ur,Kt,ae)=>{"use strict";function E(at,Ie,ge,Ve,Le,Be,ze){try{var wt=at[Be](ze),Ue=wt.value}catch(vt){return void ge(vt)}wt.done?Ie(Ue):Promise.resolve(Ue).then(Ve,Le)}function he(at){return function(){var Ie=this,ge=arguments;return new Promise(function(Ve,Le){var Be=at.apply(Ie,ge);function ze(Ue){E(Be,Ve,Le,ze,wt,"next",Ue)}function wt(Ue){E(Be,Ve,Le,ze,wt,"throw",Ue)}ze(void 0)})}}ae.d(Kt,{Z:()=>he})},7582:(ur,Kt,ae)=>{"use strict";function Ie(yt,Xe){var tt={};for(var Ye in yt)Object.prototype.hasOwnProperty.call(yt,Ye)&&Xe.indexOf(Ye)<0&&(tt[Ye]=yt[Ye]);if(null!=yt&&"function"==typeof Object.getOwnPropertySymbols){var _t=0;for(Ye=Object.getOwnPropertySymbols(yt);_t<Ye.length;_t++)Xe.indexOf(Ye[_t])<0&&Object.prototype.propertyIsEnumerable.call(yt,Ye[_t])&&(tt[Ye[_t]]=yt[Ye[_t]])}return tt}function ge(yt,Xe,tt,Ye){var Gn,_t=arguments.length,rn=_t<3?Xe:null===Ye?Ye=Object.getOwnPropertyDescriptor(Xe,tt):Ye;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)rn=Reflect.decorate(yt,Xe,tt,Ye);else for(var rr=yt.length-1;rr>=0;rr--)(Gn=yt[rr])&&(rn=(_t<3?Gn(rn):_t>3?Gn(Xe,tt,rn):Gn(Xe,tt))||rn);return _t>3&&rn&&Object.defineProperty(Xe,tt,rn),rn}function vt(yt,Xe,tt,Ye){return new(tt||(tt=Promise))(function(rn,Gn){function rr(gr){try{mr(Ye.next(gr))}catch(ei){Gn(ei)}}function Hn(gr){try{mr(Ye.throw(gr))}catch(ei){Gn(ei)}}function mr(gr){gr.done?rn(gr.value):function _t(rn){return rn instanceof tt?rn:new tt(function(Gn){Gn(rn)})}(gr.value).then(rr,Hn)}mr((Ye=Ye.apply(yt,Xe||[])).next())})}function lt(yt){return this instanceof lt?(this.v=yt,this):new lt(yt)}function me(yt,Xe,tt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _t,Ye=tt.apply(yt,Xe||[]),rn=[];return _t={},Gn("next"),Gn("throw"),Gn("return"),_t[Symbol.asyncIterator]=function(){return this},_t;function Gn(An){Ye[An]&&(_t[An]=function(qe){return new Promise(function(ue,ye){rn.push([An,qe,ue,ye])>1||rr(An,qe)})})}function rr(An,qe){try{!function Hn(An){An.value instanceof lt?Promise.resolve(An.value.v).then(mr,gr):ei(rn[0][2],An)}(Ye[An](qe))}catch(ue){ei(rn[0][3],ue)}}function mr(An){rr("next",An)}function gr(An){rr("throw",An)}function ei(An,qe){An(qe),rn.shift(),rn.length&&rr(rn[0][0],rn[0][1])}}function Ft(yt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var tt,Xe=yt[Symbol.asyncIterator];return Xe?Xe.call(yt):(yt=function Jt(yt){var Xe="function"==typeof Symbol&&Symbol.iterator,tt=Xe&&yt[Xe],Ye=0;if(tt)return tt.call(yt);if(yt&&"number"==typeof yt.length)return{next:function(){return yt&&Ye>=yt.length&&(yt=void 0),{value:yt&&yt[Ye++],done:!yt}}};throw new TypeError(Xe?"Object is not iterable.":"Symbol.iterator is not defined.")}(yt),tt={},Ye("next"),Ye("throw"),Ye("return"),tt[Symbol.asyncIterator]=function(){return this},tt);function Ye(rn){tt[rn]=yt[rn]&&function(Gn){return new Promise(function(rr,Hn){!function _t(rn,Gn,rr,Hn){Promise.resolve(Hn).then(function(mr){rn({value:mr,done:rr})},Gn)}(rr,Hn,(Gn=yt[rn](Gn)).done,Gn.value)})}}}ae.d(Kt,{FC:()=>me,KL:()=>Ft,_T:()=>Ie,gn:()=>ge,mG:()=>vt,qq:()=>lt}),"function"==typeof SuppressedError&&SuppressedError}},ur=>{ur(ur.s=9900)}]);